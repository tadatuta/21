var os=Object.defineProperty;var is=(i,n,o)=>n in i?os(i,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[n]=o;var ne=(i,n,o)=>is(i,typeof n!="symbol"?n+"":n,o);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))s(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function o(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(u){if(u.ep)return;u.ep=!0;const d=o(u);fetch(u.href,d)}})();var Pi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function as(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Gi={exports:{}};(function(i,n){((o,s)=>{i.exports=s()})(Pi,function(){var o=function(t,e){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,a){r.__proto__=a}:function(r,a){for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}))(t,e)},s=function(){return(s=Object.assign||function(t){for(var e,r=1,a=arguments.length;r<a;r++)for(var l in e=arguments[r])Object.prototype.hasOwnProperty.call(e,l)&&(t[l]=e[l]);return t}).apply(this,arguments)};function u(t,e,r){for(var a,l=0,c=e.length;l<c;l++)!a&&l in e||((a=a||Array.prototype.slice.call(e,0,l))[l]=e[l]);return t.concat(a||Array.prototype.slice.call(e))}var d=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Pi,p=Object.keys,m=Array.isArray;function g(t,e){return typeof e=="object"&&p(e).forEach(function(r){t[r]=e[r]}),t}typeof Promise>"u"||d.Promise||(d.Promise=Promise);var S=Object.getPrototypeOf,$={}.hasOwnProperty;function I(t,e){return $.call(t,e)}function A(t,e){typeof e=="function"&&(e=e(S(t))),(typeof Reflect>"u"?p:Reflect.ownKeys)(e).forEach(function(r){L(t,r,e[r])})}var C=Object.defineProperty;function L(t,e,r,a){C(t,e,g(r&&I(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},a))}function q(t){return{from:function(e){return t.prototype=Object.create(e.prototype),L(t.prototype,"constructor",t),{extend:A.bind(null,t.prototype)}}}}var V=Object.getOwnPropertyDescriptor,tt=[].slice;function z(t,e,r){return tt.call(t,e,r)}function X(t,e){return e(t)}function et(t){if(!t)throw new Error("Assertion Failed")}function ct(t){d.setImmediate?setImmediate(t):setTimeout(t,0)}function gt(t,e){if(typeof e=="string"&&I(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],a=0,l=e.length;a<l;++a){var c=gt(t,e[a]);r.push(c)}return r}var f,h=e.indexOf(".");return h===-1||(f=t[e.substr(0,h)])==null?void 0:gt(f,e.substr(h+1))}function dt(t,e,r){if(t&&e!==void 0&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){et(typeof r!="string"&&"length"in r);for(var a=0,l=e.length;a<l;++a)dt(t,e[a],r[a])}else{var c,f,h=e.indexOf(".");h!==-1?(c=e.substr(0,h),(h=e.substr(h+1))===""?r===void 0?m(t)&&!isNaN(parseInt(c))?t.splice(c,1):delete t[c]:t[c]=r:dt(f=(f=t[c])&&I(t,c)?f:t[c]={},h,r)):r===void 0?m(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function ht(t){var e,r={};for(e in t)I(t,e)&&(r[e]=t[e]);return r}var Lt=[].concat;function ie(t){return Lt.apply([],t)}var ee="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ie([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return d[t]}),Zt=new Set(ee.map(function(t){return d[t]})),te=null;function jt(t){return te=new WeakMap,t=function e(r){if(!r||typeof r!="object")return r;var a=te.get(r);if(a)return a;if(m(r)){a=[],te.set(r,a);for(var l=0,c=r.length;l<c;++l)a.push(e(r[l]))}else if(Zt.has(r.constructor))a=r;else{var f,h=S(r);for(f in a=h===Object.prototype?{}:Object.create(h),te.set(r,a),r)I(r,f)&&(a[f]=e(r[f]))}return a}(t),te=null,t}var fe={}.toString;function pe(t){return fe.call(t).slice(8,-1)}var Xt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",He=typeof Xt=="symbol"?function(t){var e;return t!=null&&(e=t[Xt])&&e.apply(t)}:function(){return null};function Ut(t,e){e=t.indexOf(e),0<=e&&t.splice(e,1)}var be={};function ae(t){var e,r,a,l;if(arguments.length===1){if(m(t))return t.slice();if(this===be&&typeof t=="string")return[t];if(l=He(t))for(r=[];!(a=l.next()).done;)r.push(a.value);else{if(t==null)return[t];if(typeof(e=t.length)!="number")return[t];for(r=new Array(e);e--;)r[e]=t[e]}}else for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var Ve=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ee=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],zt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ee),Da={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Xe(t,e){this.name=t,this.message=e}function Xo(t,e){return t+". Errors: "+Object.keys(e).map(function(r){return e[r].toString()}).filter(function(r,a,l){return l.indexOf(r)===a}).join(`
`)}function Un(t,e,r,a){this.failures=e,this.failedKeys=a,this.successCount=r,this.message=Xo(t,e)}function Ge(t,e){this.name="BulkError",this.failures=Object.keys(e).map(function(r){return e[r]}),this.failuresByPos=e,this.message=Xo(t,this.failures)}q(Xe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),q(Un).from(Xe),q(Ge).from(Xe);var Br=zt.reduce(function(t,e){return t[e]=e+"Error",t},{}),Ia=Xe,Q=zt.reduce(function(t,e){var r=e+"Error";function a(l,c){this.name=r,l?typeof l=="string"?(this.message="".concat(l).concat(c?`
 `+c:""),this.inner=c||null):typeof l=="object"&&(this.message="".concat(l.name," ").concat(l.message),this.inner=l):(this.message=Da[e]||r,this.inner=null)}return q(a).from(Ia),t[e]=a,t},{}),Go=(Q.Syntax=SyntaxError,Q.Type=TypeError,Q.Range=RangeError,ee.reduce(function(t,e){return t[e+"Error"]=Q[e],t},{}));ee=zt.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=Q[e]),t},{});function vt(){}function bn(t){return t}function Ta(t,e){return t==null||t===bn?e:function(r){return e(t(r))}}function Ce(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Oa(t,e){return t===vt?e:function(){var r=t.apply(this,arguments),a=(r!==void 0&&(arguments[0]=r),this.onsuccess),l=this.onerror,c=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return a&&(this.onsuccess=this.onsuccess?Ce(a,this.onsuccess):a),l&&(this.onerror=this.onerror?Ce(l,this.onerror):l),c!==void 0?c:r}}function Aa(t,e){return t===vt?e:function(){t.apply(this,arguments);var r=this.onsuccess,a=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Ce(r,this.onsuccess):r),a&&(this.onerror=this.onerror?Ce(a,this.onerror):a)}}function Ca(t,e){return t===vt?e:function(l){var a=t.apply(this,arguments),l=(g(l,a),this.onsuccess),c=this.onerror,f=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return l&&(this.onsuccess=this.onsuccess?Ce(l,this.onsuccess):l),c&&(this.onerror=this.onerror?Ce(c,this.onerror):c),a===void 0?f===void 0?void 0:f:g(a,f)}}function Pa(t,e){return t===vt?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function Rr(t,e){return t===vt?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var a=this,l=arguments.length,c=new Array(l);l--;)c[l]=arguments[l];return r.then(function(){return e.apply(a,c)})}return e.apply(this,arguments)}}ee.ModifyError=Un,ee.DexieError=Xe,ee.BulkError=Ge;var se=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Qo(t){se=t}var wn={},Jo=100,_n=typeof Promise>"u"?[]:(zt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[_n=crypto.subtle.digest("SHA-512",new Uint8Array([0])),S(_n),zt]:[zt,S(zt),zt]),zt=_n[0],on=_n[1],on=on&&on.then,Pe=zt&&zt.constructor,Nr=!!_n[2],kn=function(t,e){En.push([t,e]),zn&&(queueMicrotask(La),zn=!1)},Kr=!0,zn=!0,$e=[],Yn=[],qr=bn,we={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:vt,pgp:!1,env:{},finalize:vt},G=we,En=[],Le=0,Hn=[];function F(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=G;if(typeof t!="function"){if(t!==wn)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Wr(this,this._value)}else this._state=null,this._value=null,++e.ref,function r(a,l){try{l(function(c){if(a._state===null){if(c===a)throw new TypeError("A promise cannot be resolved with itself.");var f=a._lib&&Qe();c&&typeof c.then=="function"?r(a,function(h,b){c instanceof F?c._then(h,b):c.then(h,b)}):(a._state=!0,a._value=c,ti(a)),f&&Je()}},Wr.bind(null,a))}catch(c){Wr(a,c)}}(this,t)}var Fr={get:function(){var t=G,e=Qn;function r(a,l){var c=this,f=!t.global&&(t!==G||e!==Qn),h=f&&!ke(),b=new F(function(D,w){Ur(c,new Zo(ni(a,t,f,h),ni(l,t,f,h),D,w,t))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return r.prototype=wn,r},set:function(t){L(this,"then",t&&t.prototype===wn?Fr:{get:function(){return t},set:Fr.set})}};function Zo(t,e,r,a,l){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=a,this.psd=l}function Wr(t,e){var r,a;Yn.push(e),t._state===null&&(r=t._lib&&Qe(),e=qr(e),t._state=!1,t._value=e,a=t,$e.some(function(l){return l._value===a._value})||$e.push(a),ti(t),r)&&Je()}function ti(t){var e=t._listeners;t._listeners=[];for(var r=0,a=e.length;r<a;++r)Ur(t,e[r]);var l=t._PSD;--l.ref||l.finalize(),Le===0&&(++Le,kn(function(){--Le==0&&zr()},[]))}function Ur(t,e){if(t._state===null)t._listeners.push(e);else{var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Le,kn($a,[r,t,e])}}function $a(t,e,r){try{var a,l=e._value;!e._state&&Yn.length&&(Yn=[]),a=se&&e._consoleTask?e._consoleTask.run(function(){return t(l)}):t(l),e._state||Yn.indexOf(l)!==-1||(c=>{for(var f=$e.length;f;)if($e[--f]._value===c._value)return $e.splice(f,1)})(e),r.resolve(a)}catch(c){r.reject(c)}finally{--Le==0&&zr(),--r.psd.ref||r.psd.finalize()}}function La(){je(we,function(){Qe()&&Je()})}function Qe(){var t=Kr;return zn=Kr=!1,t}function Je(){var t,e,r;do for(;0<En.length;)for(t=En,En=[],r=t.length,e=0;e<r;++e){var a=t[e];a[0].apply(null,a[1])}while(0<En.length);zn=Kr=!0}function zr(){for(var t=$e,e=($e=[],t.forEach(function(a){a._PSD.onunhandled.call(null,a._value,a)}),Hn.slice(0)),r=e.length;r;)e[--r]()}function Vn(t){return new F(wn,!1,t)}function bt(t,e){var r=G;return function(){var a=Qe(),l=G;try{return Ee(r,!0),t.apply(this,arguments)}catch(c){e&&e(c)}finally{Ee(l,!1),a&&Je()}}}A(F.prototype,{then:Fr,_then:function(t,e){Ur(this,new Zo(null,null,t,e,G))},catch:function(t){var e,r;return arguments.length===1?this.then(null,t):(e=t,r=arguments[1],typeof e=="function"?this.then(null,function(a){return(a instanceof e?r:Vn)(a)}):this.then(null,function(a){return(a&&a.name===e?r:Vn)(a)}))},finally:function(t){return this.then(function(e){return F.resolve(t()).then(function(){return e})},function(e){return F.resolve(t()).then(function(){return Vn(e)})})},timeout:function(t,e){var r=this;return t<1/0?new F(function(a,l){var c=setTimeout(function(){return l(new Q.Timeout(e))},t);r.then(a,l).finally(clearTimeout.bind(null,c))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&L(F.prototype,Symbol.toStringTag,"Dexie.Promise"),we.env=ei(),A(F,{all:function(){var t=ae.apply(null,arguments).map(Jn);return new F(function(e,r){t.length===0&&e([]);var a=t.length;t.forEach(function(l,c){return F.resolve(l).then(function(f){t[c]=f,--a||e(t)},r)})})},resolve:function(t){return t instanceof F?t:t&&typeof t.then=="function"?new F(function(e,r){t.then(e,r)}):new F(wn,!0,t)},reject:Vn,race:function(){var t=ae.apply(null,arguments).map(Jn);return new F(function(e,r){t.map(function(a){return F.resolve(a).then(e,r)})})},PSD:{get:function(){return G},set:function(t){return G=t}},totalEchoes:{get:function(){return Qn}},newPSD:_e,usePSD:je,scheduler:{get:function(){return kn},set:function(t){kn=t}},rejectionMapper:{get:function(){return qr},set:function(t){qr=t}},follow:function(t,e){return new F(function(r,a){return _e(function(l,c){var f=G;f.unhandleds=[],f.onunhandled=c,f.finalize=Ce(function(){var h,b=this;h=function(){b.unhandleds.length===0?l():c(b.unhandleds[0])},Hn.push(function D(){h(),Hn.splice(Hn.indexOf(D),1)}),++Le,kn(function(){--Le==0&&zr()},[])},f.finalize),t()},e,r,a)})}}),Pe&&(Pe.allSettled&&L(F,"allSettled",function(){var t=ae.apply(null,arguments).map(Jn);return new F(function(e){t.length===0&&e([]);var r=t.length,a=new Array(r);t.forEach(function(l,c){return F.resolve(l).then(function(f){return a[c]={status:"fulfilled",value:f}},function(f){return a[c]={status:"rejected",reason:f}}).then(function(){return--r||e(a)})})})}),Pe.any&&typeof AggregateError<"u"&&L(F,"any",function(){var t=ae.apply(null,arguments).map(Jn);return new F(function(e,r){t.length===0&&r(new AggregateError([]));var a=t.length,l=new Array(a);t.forEach(function(c,f){return F.resolve(c).then(function(h){return e(h)},function(h){l[f]=h,--a||r(new AggregateError(l))})})})}),Pe.withResolvers)&&(F.withResolvers=Pe.withResolvers);var Ct={awaits:0,echoes:0,id:0},ja=0,Xn=[],Gn=0,Qn=0,Ma=0;function _e(t,f,r,a){var l=G,c=Object.create(l),f=(c.parent=l,c.ref=0,c.global=!1,c.id=++Ma,we.env,c.env=Nr?{Promise:F,PromiseProp:{value:F,configurable:!0,writable:!0},all:F.all,race:F.race,allSettled:F.allSettled,any:F.any,resolve:F.resolve,reject:F.reject}:{},f&&g(c,f),++l.ref,c.finalize=function(){--this.parent.ref||this.parent.finalize()},je(c,t,r,a));return c.ref===0&&c.finalize(),f}function Ze(){return Ct.id||(Ct.id=++ja),++Ct.awaits,Ct.echoes+=Jo,Ct.id}function ke(){return!!Ct.awaits&&(--Ct.awaits==0&&(Ct.id=0),Ct.echoes=Ct.awaits*Jo,!0)}function Jn(t){return Ct.echoes&&t&&t.constructor===Pe?(Ze(),t.then(function(e){return ke(),e},function(e){return ke(),It(e)})):t}function Ba(){var t=Xn[Xn.length-1];Xn.pop(),Ee(t,!1)}function Ee(t,e){var r,a,l=G;(e?!Ct.echoes||Gn++&&t===G:!Gn||--Gn&&t===G)||queueMicrotask(e?(function(c){++Qn,Ct.echoes&&--Ct.echoes!=0||(Ct.echoes=Ct.awaits=Ct.id=0),Xn.push(G),Ee(c,!0)}).bind(null,t):Ba),t!==G&&(G=t,l===we&&(we.env=ei()),Nr)&&(r=we.env.Promise,a=t.env,l.global||t.global)&&(Object.defineProperty(d,"Promise",a.PromiseProp),r.all=a.all,r.race=a.race,r.resolve=a.resolve,r.reject=a.reject,a.allSettled&&(r.allSettled=a.allSettled),a.any)&&(r.any=a.any)}function ei(){var t=d.Promise;return Nr?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(d,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function je(t,e,r,a,l){var c=G;try{return Ee(t,!0),e(r,a,l)}finally{Ee(c,!1)}}function ni(t,e,r,a){return typeof t!="function"?t:function(){var l=G;r&&Ze(),Ee(e,!0);try{return t.apply(this,arguments)}finally{Ee(l,!1),a&&queueMicrotask(ke)}}}function Yr(t){Promise===Pe&&Ct.echoes===0?Gn===0?t():enqueueNativeMicroTask(t):setTimeout(t,0)}(""+on).indexOf("[native code]")===-1&&(Ze=ke=vt);var It=F.reject,Me="ï¿¿",he="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ri="String expected.",tn=[],Zn="__dbnames",Hr="readonly",Vr="readwrite";function Be(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var oi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function tr(t){return typeof t!="string"||/\./.test(t)?function(e){return e}:function(e){return e[t]===void 0&&t in e&&delete(e=jt(e))[t],e}}function ii(){throw Q.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function st(t,e){try{var r=ai(t),a=ai(e);if(r!==a)return r==="Array"?1:a==="Array"?-1:r==="binary"?1:a==="binary"?-1:r==="string"?1:a==="string"?-1:r==="Date"?1:a!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return e<t?1:t<e?-1:0;case"binary":for(var l=si(t),c=si(e),f=l.length,h=c.length,b=f<h?f:h,D=0;D<b;++D)if(l[D]!==c[D])return l[D]<c[D]?-1:1;return f===h?0:f<h?-1:1;case"Array":for(var w=t,v=e,k=w.length,E=v.length,_=k<E?k:E,y=0;y<_;++y){var T=st(w[y],v[y]);if(T!==0)return T}return k===E?0:k<E?-1:1}}catch{}return NaN}function ai(t){var e=typeof t;return e=="object"&&(ArrayBuffer.isView(t)||(e=pe(t))==="ArrayBuffer")?"binary":e}function si(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}function er(t,e,r){var a=t.schema.yProps;return a?(e&&0<r.numFailures&&(e=e.filter(function(l,c){return!r.failures[c]})),Promise.all(a.map(function(l){return l=l.updatesTable,e?t.db.table(l).where("k").anyOf(e).delete():t.db.table(l).clear()})).then(function(){return r})):r}li.prototype.execute=function(t){var e=this["@@propmod"];if(e.add!==void 0){var r=e.add;if(m(r))return u(u([],m(t)?t:[],!0),r).sort();if(typeof r=="number")return(Number(t)||0)+r;if(typeof r=="bigint")try{return BigInt(t)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(e.remove!==void 0){var a=e.remove;if(m(a))return m(t)?t.filter(function(l){return!a.includes(l)}).sort():[];if(typeof a=="number")return Number(t)-a;if(typeof a=="bigint")try{return BigInt(t)-a}catch{return BigInt(0)-a}throw new TypeError("Invalid subtrahend ".concat(a))}return r=(r=e.replacePrefix)==null?void 0:r[0],r&&typeof t=="string"&&t.startsWith(r)?e.replacePrefix[1]+t.substring(r.length):t};var Sn=li;function li(t){this["@@propmod"]=t}function ui(t,e){for(var r=p(e),a=r.length,l=!1,c=0;c<a;++c){var f=r[c],h=e[f],b=gt(t,f);h instanceof Sn?(dt(t,f,h.execute(b)),l=!0):b!==h&&(dt(t,f,h),l=!0)}return l}yt.prototype._trans=function(t,e,r){var a=this._tx||G.trans,l=this.name,c=se&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function f(D,w,v){if(v.schema[l])return e(v.idbtrans,v);throw new Q.NotFound("Table "+l+" not part of transaction")}var h=Qe();try{var b=a&&a.db._novip===this.db._novip?a===G.trans?a._promise(t,f,r):_e(function(){return a._promise(t,f,r)},{trans:a,transless:G.transless||G}):function D(w,v,k,E){if(w.idbdb&&(w._state.openComplete||G.letThrough||w._vip)){var _=w._createTransaction(v,k,w._dbSchema);try{_.create(),w._state.PR1398_maxLoop=3}catch(y){return y.name===Br.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return D(w,v,k,E)})):It(y)}return _._promise(v,function(y,T){return _e(function(){return G.trans=_,E(y,T,_)})}).then(function(y){if(v==="readwrite")try{_.idbtrans.commit()}catch{}return v==="readonly"?y:_._completion.then(function(){return y})})}if(w._state.openComplete)return It(new Q.DatabaseClosed(w._state.dbOpenError));if(!w._state.isBeingOpened){if(!w._state.autoOpen)return It(new Q.DatabaseClosed);w.open().catch(vt)}return w._state.dbReadyPromise.then(function(){return D(w,v,k,E)})}(this.db,t,[this.name],f);return c&&(b._consoleTask=c,b=b.catch(function(D){return console.trace(D),It(D)})),b}finally{h&&Je()}},yt.prototype.get=function(t,e){var r=this;return t&&t.constructor===Object?this.where(t).first(e):t==null?It(new Q.Type("Invalid argument to Table.get()")):this._trans("readonly",function(a){return r.core.get({trans:a,key:t}).then(function(l){return r.hook.reading.fire(l)})}).then(e)},yt.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(m(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var e=p(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(h){if(h.compound&&e.every(function(D){return 0<=h.keyPath.indexOf(D)})){for(var b=0;b<e.length;++b)if(e.indexOf(h.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(h,b){return h.keyPath.length-b.keyPath.length})[0];if(r&&this.db._maxKey!==Me)return f=r.keyPath.slice(0,e.length),this.where(f).equals(f.map(function(h){return t[h]}));!r&&se&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(e.join("+"),"]"));var a=this.schema.idxByName;function l(h,b){return st(h,b)===0}var f=e.reduce(function(w,b){var D=w[0],w=w[1],v=a[b],k=t[b];return[D||v,D||!v?Be(w,v&&v.multi?function(E){return E=gt(E,b),m(E)&&E.some(function(_){return l(k,_)})}:function(E){return l(k,gt(E,b))}):w]},[null,null]),c=f[0],f=f[1];return c?this.where(c.name).equals(t[c.keyPath]).filter(f):r?this.filter(f):this.where(e).equals("")},yt.prototype.filter=function(t){return this.toCollection().and(t)},yt.prototype.count=function(t){return this.toCollection().count(t)},yt.prototype.offset=function(t){return this.toCollection().offset(t)},yt.prototype.limit=function(t){return this.toCollection().limit(t)},yt.prototype.each=function(t){return this.toCollection().each(t)},yt.prototype.toArray=function(t){return this.toCollection().toArray(t)},yt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},yt.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,m(t)?"[".concat(t.join("+"),"]"):t))},yt.prototype.reverse=function(){return this.toCollection().reverse()},yt.prototype.mapToClass=function(t){for(var e=this.db,r=this.name,a=((this.schema.mappedClass=t).prototype instanceof ii&&(t=(f=>{var h=w,b=f;if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function D(){this.constructor=h}function w(){return f!==null&&f.apply(this,arguments)||this}return o(h,b),h.prototype=b===null?Object.create(b):(D.prototype=b.prototype,new D),Object.defineProperty(w.prototype,"db",{get:function(){return e},enumerable:!1,configurable:!0}),w.prototype.table=function(){return r},w})(t)),new Set),l=t.prototype;l;l=S(l))Object.getOwnPropertyNames(l).forEach(function(f){return a.add(f)});function c(f){if(!f)return f;var h,b=Object.create(t.prototype);for(h in f)if(!a.has(h))try{b[h]=f[h]}catch{}return b}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=c,this.hook("reading",c),t},yt.prototype.defineClass=function(){return this.mapToClass(function(t){g(this,t)})},yt.prototype.add=function(t,e){var r=this,a=this.schema.primKey,l=a.auto,c=a.keyPath,f=t;return c&&l&&(f=tr(c)(t)),this._trans("readwrite",function(h){return r.core.mutate({trans:h,type:"add",keys:e!=null?[e]:null,values:[f]})}).then(function(h){return h.numFailures?F.reject(h.failures[0]):h.lastResult}).then(function(h){if(c)try{dt(t,c,h)}catch{}return h})},yt.prototype.upsert=function(t,e){var r=this,a=this.schema.primKey.keyPath;return this._trans("readwrite",function(l){return r.core.get({trans:l,key:t}).then(function(c){var f=c??{};return ui(f,e),a&&dt(f,a,t),r.core.mutate({trans:l,type:"put",values:[f],keys:[t],upsert:!0,updates:{keys:[t],changeSpecs:[e]}}).then(function(h){return h.numFailures?F.reject(h.failures[0]):!!c})})})},yt.prototype.update=function(t,e){return typeof t!="object"||m(t)?this.where(":id").equals(t).modify(e):(t=gt(t,this.schema.primKey.keyPath))===void 0?It(new Q.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(e)},yt.prototype.put=function(t,e){var r=this,a=this.schema.primKey,l=a.auto,c=a.keyPath,f=t;return c&&l&&(f=tr(c)(t)),this._trans("readwrite",function(h){return r.core.mutate({trans:h,type:"put",values:[f],keys:e!=null?[e]:null})}).then(function(h){return h.numFailures?F.reject(h.failures[0]):h.lastResult}).then(function(h){if(c)try{dt(t,c,h)}catch{}return h})},yt.prototype.delete=function(t){var e=this;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"delete",keys:[t]}).then(function(a){return er(e,[t],a)}).then(function(a){return a.numFailures?F.reject(a.failures[0]):void 0})})},yt.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:oi}).then(function(r){return er(t,null,r)})}).then(function(e){return e.numFailures?F.reject(e.failures[0]):void 0})},yt.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",function(r){return e.core.getMany({keys:t,trans:r}).then(function(a){return a.map(function(l){return e.hook.reading.fire(l)})})})},yt.prototype.bulkAdd=function(t,e,r){var a=this,l=Array.isArray(e)?e:void 0,c=(r=r||(l?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",function(f){var h=a.schema.primKey,D=h.auto,h=h.keyPath;if(h&&l)throw new Q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(l&&l.length!==t.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");var b=t.length,D=h&&D?t.map(tr(h)):t;return a.core.mutate({trans:f,type:"add",keys:l,values:D,wantResults:c}).then(function(w){var v=w.numFailures,k=w.failures;if(v===0)return c?w.results:w.lastResult;throw new Ge("".concat(a.name,".bulkAdd(): ").concat(v," of ").concat(b," operations failed"),k)})})},yt.prototype.bulkPut=function(t,e,r){var a=this,l=Array.isArray(e)?e:void 0,c=(r=r||(l?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",function(f){var h=a.schema.primKey,D=h.auto,h=h.keyPath;if(h&&l)throw new Q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(l&&l.length!==t.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");var b=t.length,D=h&&D?t.map(tr(h)):t;return a.core.mutate({trans:f,type:"put",keys:l,values:D,wantResults:c}).then(function(w){var v=w.numFailures,k=w.failures;if(v===0)return c?w.results:w.lastResult;throw new Ge("".concat(a.name,".bulkPut(): ").concat(v," of ").concat(b," operations failed"),k)})})},yt.prototype.bulkUpdate=function(t){var e=this,r=this.core,a=t.map(function(f){return f.key}),l=t.map(function(f){return f.changes}),c=[];return this._trans("readwrite",function(f){return r.getMany({trans:f,keys:a,cache:"clone"}).then(function(h){var b=[],D=[],w=(t.forEach(function(v,k){var E=v.key,_=v.changes,y=h[k];if(y){for(var T=0,O=Object.keys(_);T<O.length;T++){var x=O[T],P=_[x];if(x===e.schema.primKey.keyPath){if(st(P,E)!==0)throw new Q.Constraint("Cannot update primary key in bulkUpdate()")}else dt(y,x,P)}c.push(k),b.push(E),D.push(y)}}),b.length);return r.mutate({trans:f,type:"put",keys:b,values:D,updates:{keys:a,changeSpecs:l}}).then(function(v){var k=v.numFailures,E=v.failures;if(k===0)return w;for(var _=0,y=Object.keys(E);_<y.length;_++){var T,O=y[_],x=c[Number(O)];x!=null&&(T=E[O],delete E[O],E[x]=T)}throw new Ge("".concat(e.name,".bulkUpdate(): ").concat(k," of ").concat(w," operations failed"),E)})})})},yt.prototype.bulkDelete=function(t){var e=this,r=t.length;return this._trans("readwrite",function(a){return e.core.mutate({trans:a,type:"delete",keys:t}).then(function(l){return er(e,t,l)})}).then(function(a){var l=a.numFailures,c=a.failures;if(l===0)return a.lastResult;throw new Ge("".concat(e.name,".bulkDelete(): ").concat(l," of ").concat(r," operations failed"),c)})};var ci=yt;function yt(){}function xn(t){function e(f,h){if(h){for(var b=arguments.length,D=new Array(b-1);--b;)D[b-1]=arguments[b];return r[f].subscribe.apply(null,D),t}if(typeof f=="string")return r[f]}var r={};e.addEventType=c;for(var a=1,l=arguments.length;a<l;++a)c(arguments[a]);return e;function c(f,h,b){var D,w;if(typeof f!="object")return h=h||Pa,w={subscribers:[],fire:b=b||vt,subscribe:function(v){w.subscribers.indexOf(v)===-1&&(w.subscribers.push(v),w.fire=h(w.fire,v))},unsubscribe:function(v){w.subscribers=w.subscribers.filter(function(k){return k!==v}),w.fire=w.subscribers.reduce(h,b)}},r[f]=e[f]=w;p(D=f).forEach(function(v){var k=D[v];if(m(k))c(v,D[v][0],D[v][1]);else{if(k!=="asap")throw new Q.InvalidArgument("Invalid event config");var E=c(v,bn,function(){for(var _=arguments.length,y=new Array(_);_--;)y[_]=arguments[_];E.subscribers.forEach(function(T){ct(function(){T.apply(null,y)})})})}})}}function Dn(t,e){return q(e).from({prototype:t}),e}function en(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Xr(t,e){t.filter=Be(t.filter,e)}function Gr(t,e,r){var a=t.replayFilter;t.replayFilter=a?function(){return Be(a(),e())}:e,t.justLimit=r&&!a}function nr(t,e){if(t.isPrimKey)return e.primaryKey;var r=e.getIndexByKeyPath(t.index);if(r)return r;throw new Q.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed")}function di(t,e,r){var a=nr(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:a,range:t.range}})}function rr(t,e,r,a){var l,c,f=t.replayFilter?Be(t.filter,t.replayFilter()):t.filter;return t.or?(l={},c=function(h,b,D){var w,v;f&&!f(b,D,function(k){return b.stop(k)},function(k){return b.fail(k)})||((v=""+(w=b.primaryKey))=="[object ArrayBuffer]"&&(v=""+new Uint8Array(w)),I(l,v))||(l[v]=!0,e(h,b,D))},Promise.all([t.or._iterate(c,r),fi(di(t,a,r),t.algorithm,c,!t.keysOnly&&t.valueMapper)])):fi(di(t,a,r),Be(t.algorithm,f),e,!t.keysOnly&&t.valueMapper)}function fi(t,e,r,a){var l=bt(a?function(c,f,h){return r(a(c),f,h)}:r);return t.then(function(c){if(c)return c.start(function(){var f=function(){return c.continue()};e&&!e(c,function(h){return f=h},function(h){c.stop(h),f=vt},function(h){c.fail(h),f=vt})||l(c.value,c,function(h){return f=h}),f()})})}ft.prototype._read=function(t,e){var r=this._ctx;return r.error?r.table._trans(null,It.bind(null,r.error)):r.table._trans("readonly",t).then(e)},ft.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,It.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},ft.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Be(e.algorithm,t)},ft.prototype._iterate=function(t,e){return rr(this._ctx,t,e,this._ctx.table.core)},ft.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&g(r,t),e._ctx=r,e},ft.prototype.raw=function(){return this._ctx.valueMapper=null,this},ft.prototype.each=function(t){var e=this._ctx;return this._read(function(r){return rr(e,t,r,e.table.core)})},ft.prototype.count=function(t){var e=this;return this._read(function(r){var a,l=e._ctx,c=l.table.core;return en(l,!0)?c.count({trans:r,query:{index:nr(l,c.schema),range:l.range}}).then(function(f){return Math.min(f,l.limit)}):(a=0,rr(l,function(){return++a,!1},r,c).then(function(){return a}))}).then(t)},ft.prototype.sortBy=function(t,e){var r=t.split(".").reverse(),a=r[0],l=r.length-1;function c(b,D){return D?c(b[r[D]],D-1):b[a]}var f=this._ctx.dir==="next"?1:-1;function h(b,D){return st(c(b,l),c(D,l))*f}return this.toArray(function(b){return b.sort(h)}).then(e)},ft.prototype.toArray=function(t){var e=this;return this._read(function(r){var a,l,c,f=e._ctx;return f.dir==="next"&&en(f,!0)&&0<f.limit?(a=f.valueMapper,l=nr(f,f.table.core.schema),f.table.core.query({trans:r,limit:f.limit,values:!0,query:{index:l,range:f.range}}).then(function(h){return h=h.result,a?h.map(a):h})):(c=[],rr(f,function(h){return c.push(h)},r,f.table.core).then(function(){return c}))},t)},ft.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,en(e)?Gr(e,function(){var r=t;return function(a,l){return r===0||(r===1?--r:l(function(){a.advance(r),r=0}),!1)}}):Gr(e,function(){var r=t;return function(){return--r<0}})),this},ft.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Gr(this._ctx,function(){var e=t;return function(r,a,l){return--e<=0&&a(l),0<=e}},!0),this},ft.prototype.until=function(t,e){return Xr(this._ctx,function(r,a,l){return!t(r.value)||(a(l),e)}),this},ft.prototype.first=function(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)},ft.prototype.last=function(t){return this.reverse().first(t)},ft.prototype.filter=function(t){var e;return Xr(this._ctx,function(r){return t(r.value)}),(e=this._ctx).isMatch=Be(e.isMatch,t),this},ft.prototype.and=function(t){return this.filter(t)},ft.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},ft.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ft.prototype.desc=function(){return this.reverse()},ft.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(r,a){t(a.key,a)})},ft.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},ft.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(r,a){t(a.primaryKey,a)})},ft.prototype.keys=function(t){var e=this._ctx,r=(e.keysOnly=!e.isMatch,[]);return this.each(function(a,l){r.push(l.key)}).then(function(){return r}).then(t)},ft.prototype.primaryKeys=function(t){var e=this._ctx;if(e.dir==="next"&&en(e,!0)&&0<e.limit)return this._read(function(a){var l=nr(e,e.table.core.schema);return e.table.core.query({trans:a,values:!1,limit:e.limit,query:{index:l,range:e.range}})}).then(function(a){return a.result}).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each(function(a,l){r.push(l.primaryKey)}).then(function(){return r}).then(t)},ft.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},ft.prototype.firstKey=function(t){return this.limit(1).keys(function(e){return e[0]}).then(t)},ft.prototype.lastKey=function(t){return this.reverse().firstKey(t)},ft.prototype.distinct=function(){var t,e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];return e&&e.multi&&(t={},Xr(this._ctx,function(a){var a=a.primaryKey.toString(),l=I(t,a);return t[a]=!0,!l})),this},ft.prototype.modify=function(t){var e=this,r=this._ctx;return this._write(function(a){function l(y,T){var O=T.failures;k+=y-T.numFailures;for(var x=0,P=p(O);x<P.length;x++){var j=P[x];v.push(O[j])}}var c=typeof t=="function"?t:function(y){return ui(y,t)},f=r.table.core,w=f.schema.primaryKey,h=w.outbound,b=w.extractKey,D=200,w=e.db._options.modifyChunkSize,v=(w&&(D=typeof w=="object"?w[f.name]||w["*"]||200:w),[]),k=0,E=[],_=t===pi;return e.clone().primaryKeys().then(function(y){function T(x){var P=Math.min(D,y.length-x),j=y.slice(x,x+P);return(_?Promise.resolve([]):f.getMany({trans:a,keys:j,cache:"immutable"})).then(function(R){var N=[],M=[],U=h?[]:null,W=_?j:[];if(!_)for(var B=0;B<P;++B){var Y=R[B],ut={value:jt(Y),primKey:y[x+B]};c.call(ut,ut.value,ut)!==!1&&(ut.value==null?W.push(y[x+B]):h||st(b(Y),b(ut.value))===0?(M.push(ut.value),h&&U.push(y[x+B])):(W.push(y[x+B]),N.push(ut.value)))}return Promise.resolve(0<N.length&&f.mutate({trans:a,type:"add",values:N}).then(function(pt){for(var Z in pt.failures)W.splice(parseInt(Z),1);l(N.length,pt)})).then(function(){return(0<M.length||O&&typeof t=="object")&&f.mutate({trans:a,type:"put",keys:U,values:M,criteria:O,changeSpec:typeof t!="function"&&t,isAdditionalChunk:0<x}).then(function(pt){return l(M.length,pt)})}).then(function(){return(0<W.length||O&&_)&&f.mutate({trans:a,type:"delete",keys:W,criteria:O,isAdditionalChunk:0<x}).then(function(pt){return er(r.table,W,pt)}).then(function(pt){return l(W.length,pt)})}).then(function(){return y.length>x+P&&T(x+D)})})}var O=en(r)&&r.limit===1/0&&(typeof t!="function"||_)&&{index:r.index,range:r.range};return T(0).then(function(){if(0<v.length)throw new Un("Error modifying one or more objects",v,k,E);return y.length})})})},ft.prototype.delete=function(){var t=this._ctx,e=t.range;return!en(t)||t.table.schema.yProps||!t.isPrimKey&&e.type!==3?this.modify(pi):this._write(function(r){var a=t.table.core.schema.primaryKey,l=e;return t.table.core.count({trans:r,query:{index:a,range:l}}).then(function(c){return t.table.core.mutate({trans:r,type:"deleteRange",range:l}).then(function(b){var h=b.failures,b=b.numFailures;if(b)throw new Un("Could not delete some values",Object.keys(h).map(function(D){return h[D]}),c-b);return c-b})})})};var Ra=ft;function ft(){}var pi=function(t,e){return e.value=null};function Na(t,e){return t<e?-1:t===e?0:1}function Ka(t,e){return e<t?-1:t===e?0:1}function Yt(t,e,r){return t=t instanceof mi?new t.Collection(t):t,t._ctx.error=new(r||TypeError)(e),t}function nn(t){return new t.Collection(t,function(){return hi("")}).limit(0)}function or(E,e,r,a){var l,c,f,h,b,D,w,v=r.length;if(!r.every(function(y){return typeof y=="string"}))return Yt(E,ri);function k(y){l=y==="next"?function(O){return O.toUpperCase()}:function(O){return O.toLowerCase()},c=y==="next"?function(O){return O.toLowerCase()}:function(O){return O.toUpperCase()},f=y==="next"?Na:Ka;var T=r.map(function(O){return{lower:c(O),upper:l(O)}}).sort(function(O,x){return f(O.lower,x.lower)});h=T.map(function(O){return O.upper}),b=T.map(function(O){return O.lower}),w=(D=y)==="next"?"":a}k("next");var E=new E.Collection(E,function(){return Se(h[0],b[v-1]+a)}),_=(E._ondirectionchange=function(y){k(y)},0);return E._addAlgorithm(function(y,T,O){var x=y.key;if(typeof x=="string"){var P=c(x);if(e(P,b,_))return!0;for(var j=null,R=_;R<v;++R){var N=((M,U,W,B,Y,ut)=>{for(var pt=Math.min(M.length,B.length),Z=-1,it=0;it<pt;++it){var _t=U[it];if(_t!==B[it])return Y(M[it],W[it])<0?M.substr(0,it)+W[it]+W.substr(it+1):Y(M[it],B[it])<0?M.substr(0,it)+B[it]+W.substr(it+1):0<=Z?M.substr(0,Z)+U[Z]+W.substr(Z+1):null;Y(M[it],_t)<0&&(Z=it)}return pt<B.length&&ut==="next"?M+W.substr(M.length):pt<M.length&&ut==="prev"?M.substr(0,W.length):Z<0?null:M.substr(0,Z)+B[Z]+W.substr(Z+1)})(x,P,h[R],b[R],f,D);N===null&&j===null?_=R+1:(j===null||0<f(j,N))&&(j=N)}T(j!==null?function(){y.continue(j+w)}:O)}return!1}),E}function Se(t,e,r,a){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:a}}function hi(t){return{type:1,lower:t,upper:t}}Object.defineProperty(Pt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Pt.prototype.between=function(t,e,r,a){r=r!==!1,a=a===!0;try{return 0<this._cmp(t,e)||this._cmp(t,e)===0&&(r||a)&&(!r||!a)?nn(this):new this.Collection(this,function(){return Se(t,e,!r,!a)})}catch{return Yt(this,he)}},Pt.prototype.equals=function(t){return t==null?Yt(this,he):new this.Collection(this,function(){return hi(t)})},Pt.prototype.above=function(t){return t==null?Yt(this,he):new this.Collection(this,function(){return Se(t,void 0,!0)})},Pt.prototype.aboveOrEqual=function(t){return t==null?Yt(this,he):new this.Collection(this,function(){return Se(t,void 0,!1)})},Pt.prototype.below=function(t){return t==null?Yt(this,he):new this.Collection(this,function(){return Se(void 0,t,!1,!0)})},Pt.prototype.belowOrEqual=function(t){return t==null?Yt(this,he):new this.Collection(this,function(){return Se(void 0,t)})},Pt.prototype.startsWith=function(t){return typeof t!="string"?Yt(this,ri):this.between(t,t+Me,!0,!0)},Pt.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):or(this,function(e,r){return e.indexOf(r[0])===0},[t],Me)},Pt.prototype.equalsIgnoreCase=function(t){return or(this,function(e,r){return e===r[0]},[t],"")},Pt.prototype.anyOfIgnoreCase=function(){var t=ae.apply(be,arguments);return t.length===0?nn(this):or(this,function(e,r){return r.indexOf(e)!==-1},t,"")},Pt.prototype.startsWithAnyOfIgnoreCase=function(){var t=ae.apply(be,arguments);return t.length===0?nn(this):or(this,function(e,r){return r.some(function(a){return e.indexOf(a)===0})},t,Me)},Pt.prototype.anyOf=function(){var t,e,r=this,a=ae.apply(be,arguments),l=this._cmp;try{a.sort(l)}catch{return Yt(this,he)}return a.length===0?nn(this):((t=new this.Collection(this,function(){return Se(a[0],a[a.length-1])}))._ondirectionchange=function(c){l=c==="next"?r._ascending:r._descending,a.sort(l)},e=0,t._addAlgorithm(function(c,f,h){for(var b=c.key;0<l(b,a[e]);)if(++e===a.length)return f(h),!1;return l(b,a[e])===0||(f(function(){c.continue(a[e])}),!1)}),t)},Pt.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Pt.prototype.noneOf=function(){var t=ae.apply(be,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return Yt(this,he)}var e=t.reduce(function(r,a){return r?r.concat([[r[r.length-1][1],a]]):[[-1/0,a]]},null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},Pt.prototype.inAnyRange=function(t,O){var r=this,a=this._cmp,l=this._ascending,c=this._descending,f=this._min,h=this._max;if(t.length===0)return nn(this);if(!t.every(function(x){return x[0]!==void 0&&x[1]!==void 0&&l(x[0],x[1])<=0}))return Yt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Q.InvalidArgument);var b=!O||O.includeLowers!==!1,D=O&&O.includeUppers===!0,w,v=l;function k(x,P){return v(x[0],P[0])}try{(w=t.reduce(function(x,P){for(var j=0,R=x.length;j<R;++j){var N=x[j];if(a(P[0],N[1])<0&&0<a(P[1],N[0])){N[0]=f(N[0],P[0]),N[1]=h(N[1],P[1]);break}}return j===R&&x.push(P),x},[])).sort(k)}catch{return Yt(this,he)}var E=0,_=D?function(x){return 0<l(x,w[E][1])}:function(x){return 0<=l(x,w[E][1])},y=b?function(x){return 0<c(x,w[E][0])}:function(x){return 0<=c(x,w[E][0])},T=_,O=new this.Collection(this,function(){return Se(w[0][0],w[w.length-1][1],!b,!D)});return O._ondirectionchange=function(x){v=x==="next"?(T=_,l):(T=y,c),w.sort(k)},O._addAlgorithm(function(x,P,j){for(var R,N=x.key;T(N);)if(++E===w.length)return P(j),!1;return!_(R=N)&&!y(R)||(r._cmp(N,w[E][1])===0||r._cmp(N,w[E][0])===0||P(function(){v===l?x.continue(w[E][0]):x.continue(w[E][1])}),!1)}),O},Pt.prototype.startsWithAnyOf=function(){var t=ae.apply(be,arguments);return t.every(function(e){return typeof e=="string"})?t.length===0?nn(this):this.inAnyRange(t.map(function(e){return[e,e+Me]})):Yt(this,"startsWithAnyOf() only works with strings")};var mi=Pt;function Pt(){}function le(t){return bt(function(e){return In(e),t(e.target.error),!1})}function In(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Tn="storagemutated",Qr="x-storagemutated-1",xe=xn(null,Tn),qa=(ue.prototype._lock=function(){return et(!G.global),++this._reculock,this._reculock!==1||G.global||(G.lockOwnerFor=this),this},ue.prototype._unlock=function(){if(et(!G.global),--this._reculock==0)for(G.global||(G.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{je(t[1],t[0])}catch{}}return this},ue.prototype._locked=function(){return this._reculock&&G.lockOwnerFor!==this},ue.prototype.create=function(t){var e=this;if(this.mode){var r=this.db.idbdb,a=this.db._state.dbOpenError;if(et(!this.idbtrans),!t&&!r)switch(a&&a.name){case"DatabaseClosedError":throw new Q.DatabaseClosed(a);case"MissingAPIError":throw new Q.MissingAPI(a.message,a);default:throw new Q.OpenFailed(a)}if(!this.active)throw new Q.TransactionInactive;et(this._completion._state===null),(t=this.idbtrans=t||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=bt(function(l){In(l),e._reject(t.error)}),t.onabort=bt(function(l){In(l),e.active&&e._reject(new Q.Abort(t.error)),e.active=!1,e.on("abort").fire(l)}),t.oncomplete=bt(function(){e.active=!1,e._resolve(),"mutatedParts"in t&&xe.storagemutated.fire(t.mutatedParts)})}return this},ue.prototype._promise=function(t,e,r){var a,l=this;return t==="readwrite"&&this.mode!=="readwrite"?It(new Q.ReadOnly("Transaction is readonly")):this.active?this._locked()?new F(function(c,f){l._blockedFuncs.push([function(){l._promise(t,e,r).then(c,f)},G])}):r?_e(function(){var c=new F(function(f,h){l._lock();var b=e(f,h,l);b&&b.then&&b.then(f,h)});return c.finally(function(){return l._unlock()}),c._lib=!0,c}):((a=new F(function(c,f){var h=e(c,f,l);h&&h.then&&h.then(c,f)}))._lib=!0,a):It(new Q.TransactionInactive)},ue.prototype._root=function(){return this.parent?this.parent._root():this},ue.prototype.waitFor=function(t){var e,r=this._root(),a=F.resolve(t),l=(r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return a}):(r._waitingFor=a,r._waitingQueue=[],e=r.idbtrans.objectStore(r.storeNames[0]),function c(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(e.get(-1/0).onsuccess=c)}()),r._waitingFor);return new F(function(c,f){a.then(function(h){return r._waitingQueue.push(bt(c.bind(null,h)))},function(h){return r._waitingQueue.push(bt(f.bind(null,h)))}).finally(function(){r._waitingFor===l&&(r._waitingFor=null)})})},ue.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Q.Abort))},ue.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(I(e,t))return e[t];var r=this.schema[t];if(r)return(r=new this.db.Table(t,r,this)).core=this.db.core.table(t),e[t]=r;throw new Q.NotFound("Table "+t+" not part of transaction")},ue);function ue(){}function Jr(t,e,r,a,l,c,f,h){return{name:t,keyPath:e,unique:r,multi:a,auto:l,compound:c,src:(r&&!f?"&":"")+(a?"*":"")+(l?"++":"")+gi(e),type:h}}function gi(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Zr(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:(a=function(l){return[l.name,l]},r.reduce(function(l,c,f){return c=a(c,f),c&&(l[c[0]]=c[1]),l},{}))};var a}var On=function(t){try{return t.only([[]]),On=function(){return[[]]},[[]]}catch{return On=function(){return Me},Me}};function to(t){return t==null?function(){}:typeof t=="string"?(e=t).split(".").length===1?function(r){return r[e]}:function(r){return gt(r,e)}:function(r){return gt(r,t)};var e}function vi(t){return[].slice.call(t)}var Fa=0;function An(t){return t==null?":id":typeof t=="string"?t:"[".concat(t.join("+"),"]")}function Wa(t,e,b){function a(_){if(_.type===3)return null;if(_.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var v=_.lower,k=_.upper,E=_.lowerOpen,_=_.upperOpen;return v===void 0?k===void 0?null:e.upperBound(k,!!_):k===void 0?e.lowerBound(v,!!E):e.bound(v,k,!!E,!!_)}function l(w){var v,k=w.name;return{name:k,schema:w,mutate:function(E){var _=E.trans,y=E.type,T=E.keys,O=E.values,x=E.range;return new Promise(function(P,j){P=bt(P);var R=_.objectStore(k),N=R.keyPath==null,M=y==="put"||y==="add";if(!M&&y!=="delete"&&y!=="deleteRange")throw new Error("Invalid operation type: "+y);var U,W=(T||O||{length:1}).length;if(T&&O&&T.length!==O.length)throw new Error("Given keys array must have same length as given values array.");if(W===0)return P({numFailures:0,failures:{},results:[],lastResult:void 0});function B(xt){++pt,In(xt)}var Y=[],ut=[],pt=0;if(y==="deleteRange"){if(x.type===4)return P({numFailures:pt,failures:ut,results:[],lastResult:void 0});x.type===3?Y.push(U=R.clear()):Y.push(U=R.delete(a(x)))}else{var N=M?N?[O,T]:[O,null]:[T,null],Z=N[0],it=N[1];if(M)for(var _t=0;_t<W;++_t)Y.push(U=it&&it[_t]!==void 0?R[y](Z[_t],it[_t]):R[y](Z[_t])),U.onerror=B;else for(_t=0;_t<W;++_t)Y.push(U=R[y](Z[_t])),U.onerror=B}function Gt(xt){xt=xt.target.result,Y.forEach(function(Ke,bo){return Ke.error!=null&&(ut[bo]=Ke.error)}),P({numFailures:pt,failures:ut,results:y==="delete"?T:Y.map(function(Ke){return Ke.result}),lastResult:xt})}U.onerror=function(xt){B(xt),Gt(xt)},U.onsuccess=Gt})},getMany:function(E){var _=E.trans,y=E.keys;return new Promise(function(T,O){T=bt(T);for(var x,P=_.objectStore(k),j=y.length,R=new Array(j),N=0,M=0,U=function(Y){Y=Y.target,R[Y._pos]=Y.result,++M===N&&T(R)},W=le(O),B=0;B<j;++B)y[B]!=null&&((x=P.get(y[B]))._pos=B,x.onsuccess=U,x.onerror=W,++N);N===0&&T(R)})},get:function(E){var _=E.trans,y=E.key;return new Promise(function(T,O){T=bt(T);var x=_.objectStore(k).get(y);x.onsuccess=function(P){return T(P.target.result)},x.onerror=le(O)})},query:(v=h,function(E){return new Promise(function(_,y){_=bt(_);var T,O,x,M=E.trans,P=E.values,j=E.limit,N=E.query,R=j===1/0?void 0:j,U=N.index,N=N.range,M=M.objectStore(k),M=U.isPrimaryKey?M:M.index(U.name),U=a(N);if(j===0)return _({result:[]});v?((N=P?M.getAll(U,R):M.getAllKeys(U,R)).onsuccess=function(W){return _({result:W.target.result})},N.onerror=le(y)):(T=0,O=!P&&"openKeyCursor"in M?M.openKeyCursor(U):M.openCursor(U),x=[],O.onsuccess=function(W){var B=O.result;return!B||(x.push(P?B.value:B.primaryKey),++T===j)?_({result:x}):void B.continue()},O.onerror=le(y))})}),openCursor:function(E){var _=E.trans,y=E.values,T=E.query,O=E.reverse,x=E.unique;return new Promise(function(P,j){P=bt(P);var M=T.index,R=T.range,N=_.objectStore(k),N=M.isPrimaryKey?N:N.index(M.name),M=O?x?"prevunique":"prev":x?"nextunique":"next",U=!y&&"openKeyCursor"in N?N.openKeyCursor(a(R),M):N.openCursor(a(R),M);U.onerror=le(j),U.onsuccess=bt(function(W){var B,Y,ut,pt,Z=U.result;Z?(Z.___id=++Fa,Z.done=!1,B=Z.continue.bind(Z),Y=(Y=Z.continuePrimaryKey)&&Y.bind(Z),ut=Z.advance.bind(Z),pt=function(){throw new Error("Cursor not stopped")},Z.trans=_,Z.stop=Z.continue=Z.continuePrimaryKey=Z.advance=function(){throw new Error("Cursor not started")},Z.fail=bt(j),Z.next=function(){var it=this,_t=1;return this.start(function(){return _t--?it.continue():it.stop()}).then(function(){return it})},Z.start=function(it){function _t(){if(U.result)try{it()}catch(xt){Z.fail(xt)}else Z.done=!0,Z.start=function(){throw new Error("Cursor behind last entry")},Z.stop()}var Gt=new Promise(function(xt,Ke){xt=bt(xt),U.onerror=le(Ke),Z.fail=Ke,Z.stop=function(bo){Z.stop=Z.continue=Z.continuePrimaryKey=Z.advance=pt,xt(bo)}});return U.onsuccess=bt(function(xt){U.onsuccess=_t,_t()}),Z.continue=B,Z.continuePrimaryKey=Y,Z.advance=ut,_t(),Gt},P(Z)):P(null)},j)})},count:function(E){var _=E.query,y=E.trans,T=_.index,O=_.range;return new Promise(function(x,P){var j=y.objectStore(k),j=T.isPrimaryKey?j:j.index(T.name),R=a(O),R=R?j.count(R):j.count();R.onsuccess=bt(function(N){return x(N.target.result)}),R.onerror=le(P)})}}}c=b,f=vi((b=t).objectStoreNames);var c,b={schema:{name:b.name,tables:f.map(function(w){return c.objectStore(w)}).map(function(w){var v=w.keyPath,k=w.autoIncrement,_=m(v),E={},_={name:w.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:v==null,compound:_,keyPath:v,autoIncrement:k,unique:!0,extractKey:to(v)},indexes:vi(w.indexNames).map(function(y){return w.index(y)}).map(function(x){var P=x.name,T=x.unique,O=x.multiEntry,x=x.keyPath,P={name:P,compound:m(x),keyPath:x,unique:T,multiEntry:O,extractKey:to(x)};return E[An(x)]=P}),getIndexByKeyPath:function(y){return E[An(y)]}};return E[":id"]=_.primaryKey,v!=null&&(E[An(v)]=_.primaryKey),_})},hasGetAll:0<f.length&&"getAll"in c.objectStore(f[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},f=b.schema,h=b.hasGetAll,b=f.tables.map(l),D={};return b.forEach(function(w){return D[w.name]=w}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(w){if(D[w])return D[w];throw new Error("Table '".concat(w,"' not found"))},MIN_KEY:-1/0,MAX_KEY:On(e),schema:f}}function Ua(t,e,r,a){return r=r.IDBKeyRange,e=Wa(e,r,a),{dbcore:t.dbcore.reduce(function(l,c){return c=c.create,s(s({},l),c(l))},e)}}function ir(t,e){var r=e.db,r=Ua(t._middlewares,r,t._deps,e);t.core=r.dbcore,t.tables.forEach(function(a){var l=a.name;t.core.schema.tables.some(function(c){return c.name===l})&&(a.core=t.core.table(l),t[l]instanceof t.Table)&&(t[l].core=a.core)})}function ar(t,e,r,a){r.forEach(function(l){var c=a[l];e.forEach(function(f){var h=function b(D,w){return V(D,w)||(D=S(D))&&b(D,w)}(f,l);(!h||"value"in h&&h.value===void 0)&&(f===t.Transaction.prototype||f instanceof t.Transaction?L(f,l,{get:function(){return this.table(l)},set:function(b){C(this,l,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):f[l]=new t.Table(l,c))})})}function eo(t,e){e.forEach(function(r){for(var a in r)r[a]instanceof t.Table&&delete r[a]})}function za(t,e){return t._cfg.version-e._cfg.version}function Ya(t,e,r,a){var l=t._dbSchema,c=(r.objectStoreNames.contains("$meta")&&!l.$meta&&(l.$meta=Zr("$meta",bi("")[0],[]),t._storeNames.push("$meta")),t._createTransaction("readwrite",t._storeNames,l)),f=(c.create(r),c._completion.catch(a),c._reject.bind(c)),h=G.transless||G;_e(function(){if(G.trans=c,G.transless=h,e!==0)return ir(t,r),D=e,((b=c).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(w){return w??D}):F.resolve(D)).then(function(T){var v=t,k=T,E=c,_=r,y=[],T=v._versions,O=v._dbSchema=lr(0,v.idbdb,_);return(T=T.filter(function(x){return x._cfg.version>=k})).length===0?F.resolve():(T.forEach(function(x){y.push(function(){var P,j,R,N=O,M=x._cfg.dbschema,U=(ur(v,N,_),ur(v,M,_),O=v._dbSchema=M,no(N,M)),W=(U.add.forEach(function(B){ro(_,B[0],B[1].primKey,B[1].indexes)}),U.change.forEach(function(B){if(B.recreate)throw new Q.Upgrade("Not yet support for changing primary key");var Y=_.objectStore(B.name);B.add.forEach(function(ut){return sr(Y,ut)}),B.change.forEach(function(ut){Y.deleteIndex(ut.name),sr(Y,ut)}),B.del.forEach(function(ut){return Y.deleteIndex(ut)})}),x._cfg.contentUpgrade);if(W&&x._cfg.version>k)return ir(v,_),E._memoizedTables={},P=ht(M),U.del.forEach(function(B){P[B]=N[B]}),eo(v,[v.Transaction.prototype]),ar(v,[v.Transaction.prototype],p(P),P),E.schema=P,(j=Ve(W))&&Ze(),M=F.follow(function(){var B;(R=W(E))&&j&&(B=ke.bind(null,null),R.then(B,B))}),R&&typeof R.then=="function"?F.resolve(R):M.then(function(){return R})}),y.push(function(P){var j,R,N=x._cfg.dbschema;j=N,R=P,[].slice.call(R.db.objectStoreNames).forEach(function(M){return j[M]==null&&R.db.deleteObjectStore(M)}),eo(v,[v.Transaction.prototype]),ar(v,[v.Transaction.prototype],v._storeNames,v._dbSchema),E.schema=v._dbSchema}),y.push(function(P){v.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(v.idbdb.version/10)===x._cfg.version?(v.idbdb.deleteObjectStore("$meta"),delete v._dbSchema.$meta,v._storeNames=v._storeNames.filter(function(j){return j!=="$meta"})):P.objectStore("$meta").put(x._cfg.version,"version"))})}),function x(){return y.length?F.resolve(y.shift()(E.idbtrans)).then(x):F.resolve()}().then(function(){yi(O,_)}))}).catch(f);var b,D;p(l).forEach(function(w){ro(r,w,l[w].primKey,l[w].indexes)}),ir(t,r),F.follow(function(){return t.on.populate.fire(c)}).catch(f)})}function Ha(t,e){yi(t._dbSchema,e),e.db.version%10!=0||e.objectStoreNames.contains("$meta")||e.db.createObjectStore("$meta").add(Math.ceil(e.db.version/10-1),"version");var r=lr(0,t.idbdb,e);ur(t,t._dbSchema,e);for(var a=0,l=no(r,t._dbSchema).change;a<l.length;a++){var c=(f=>{if(f.change.length||f.recreate)return console.warn("Unable to patch indexes of table ".concat(f.name," because it has changes on the type of index or primary key.")),{value:void 0};var h=e.objectStore(f.name);f.add.forEach(function(b){se&&console.debug("Dexie upgrade patch: Creating missing index ".concat(f.name,".").concat(b.src)),sr(h,b)})})(l[a]);if(typeof c=="object")return c.value}}function no(t,e){var r,a={del:[],add:[],change:[]};for(r in t)e[r]||a.del.push(r);for(r in e){var l=t[r],c=e[r];if(l){var f={name:r,def:c,recreate:!1,del:[],add:[],change:[]};if(""+(l.primKey.keyPath||"")!=""+(c.primKey.keyPath||"")||l.primKey.auto!==c.primKey.auto)f.recreate=!0,a.change.push(f);else{var h=l.idxByName,b=c.idxByName,D=void 0;for(D in h)b[D]||f.del.push(D);for(D in b){var w=h[D],v=b[D];w?w.src!==v.src&&f.change.push(v):f.add.push(v)}(0<f.del.length||0<f.add.length||0<f.change.length)&&a.change.push(f)}}else a.add.push([r,c])}return a}function ro(t,e,r,a){var l=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});a.forEach(function(c){return sr(l,c)})}function yi(t,e){p(t).forEach(function(r){e.db.objectStoreNames.contains(r)||(se&&console.debug("Dexie: Creating missing table",r),ro(e,r,t[r].primKey,t[r].indexes))})}function sr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function lr(t,e,r){var a={};return z(e.objectStoreNames,0).forEach(function(l){for(var c=r.objectStore(l),f=Jr(gi(D=c.keyPath),D||"",!0,!1,!!c.autoIncrement,D&&typeof D!="string",!0),h=[],b=0;b<c.indexNames.length;++b){var w=c.index(c.indexNames[b]),D=w.keyPath,w=Jr(w.name,D,!!w.unique,!!w.multiEntry,!1,D&&typeof D!="string",!1);h.push(w)}a[l]=Zr(l,f,h)}),a}function ur(t,e,r){for(var a=r.db.objectStoreNames,l=0;l<a.length;++l){var c=a[l],f=r.objectStore(c);t._hasGetAll="getAll"in f;for(var h=0;h<f.indexNames.length;++h){var b,D=f.indexNames[h],w=f.index(D).keyPath,w=typeof w=="string"?w:"["+z(w).join("+")+"]";e[c]&&(b=e[c].idxByName[w])&&(b.name=D,delete e[c].idxByName[w],e[c].idxByName[D]=b)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&d.WorkerGlobalScope&&d instanceof d.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function bi(t){return t.split(",").map(function(e,r){var l=e.split(":"),a=(a=l[1])==null?void 0:a.trim(),l=(e=l[0].trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return Jr(l,c||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),m(c),r===0,a)})}rn.prototype._createTableSchema=Zr,rn.prototype._parseIndexSyntax=bi,rn.prototype._parseStoresSpec=function(t,e){var r=this;p(t).forEach(function(a){if(t[a]!==null){var l=r._parseIndexSyntax(t[a]),c=l.shift();if(!c)throw new Q.Schema("Invalid schema for table "+a+": "+t[a]);if(c.unique=!0,c.multi)throw new Q.Schema("Primary key cannot be multiEntry*");l.forEach(function(f){if(f.auto)throw new Q.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new Q.Schema("Index must have a name and cannot be an empty string")}),c=r._createTableSchema(a,c,l),e[a]=c}})},rn.prototype.stores=function(r){var e=this.db,r=(this._cfg.storesSource=this._cfg.storesSource?g(this._cfg.storesSource,r):r,e._versions),a={},l={};return r.forEach(function(c){g(a,c._cfg.storesSource),l=c._cfg.dbschema={},c._parseStoresSpec(a,l)}),e._dbSchema=l,eo(e,[e._allTables,e,e.Transaction.prototype]),ar(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],p(l),l),e._storeNames=p(l),this},rn.prototype.upgrade=function(t){return this._cfg.contentUpgrade=Rr(this._cfg.contentUpgrade||vt,t),this};var Va=rn;function rn(){}function oo(t,e){var r=t._dbNamesDB;return r||(r=t._dbNamesDB=new me(Zn,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function io(t){return t&&typeof t.databases=="function"}function ao(t){return _e(function(){return G.letThrough=!0,t()})}function so(t){return!("from"in t)}var Bt=function(t,e){var r;if(!this)return r=new Bt,t&&"d"in t&&g(r,t),r;g(this,arguments.length?{d:1,from:t,to:1<arguments.length?e:t}:{d:0})};function Cn(t,e,r){var a=st(e,r);if(!isNaN(a)){if(0<a)throw RangeError();if(so(t))return g(t,{from:e,to:r,d:1});var a=t.l,l=t.r;if(st(r,t.from)<0)return a?Cn(a,e,r):t.l={from:e,to:r,d:1,l:null,r:null},_i(t);if(0<st(e,t.to))return l?Cn(l,e,r):t.r={from:e,to:r,d:1,l:null,r:null},_i(t);st(e,t.from)<0&&(t.from=e,t.l=null,t.d=l?l.d+1:1),0<st(r,t.to)&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1),e=!t.r,a&&!t.l&&Pn(t,a),l&&e&&Pn(t,l)}}function Pn(t,e){so(e)||function r(a,l){var c=l.from,f=l.l,h=l.r;Cn(a,c,l.to),f&&r(a,f),h&&r(a,h)}(t,e)}function wi(t,e){var r=cr(e),a=r.next();if(!a.done)for(var l=a.value,c=cr(t),f=c.next(l.from),h=f.value;!a.done&&!f.done;){if(st(h.from,l.to)<=0&&0<=st(h.to,l.from))return!0;st(l.from,h.from)<0?l=(a=r.next(h.from)).value:h=(f=c.next(l.from)).value}return!1}function cr(t){var e=so(t)?null:{s:0,n:t};return{next:function(r){for(var a=0<arguments.length;e;)switch(e.s){case 0:if(e.s=1,a)for(;e.n.l&&st(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!a||st(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function _i(t){var e,r,a,l=(((l=t.r)==null?void 0:l.d)||0)-(((l=t.l)==null?void 0:l.d)||0),l=1<l?"r":l<-1?"l":"";l&&(e=l=="r"?"l":"r",r=s({},t),a=t[l],t.from=a.from,t.to=a.to,t[l]=a[l],r[l]=a[e],(t[e]=r).d=ki(r)),t.d=ki(t)}function ki(r){var e=r.r,r=r.l;return(e?r?Math.max(e.d,r.d):e.d:r?r.d:0)+1}function dr(t,e){return p(e).forEach(function(r){t[r]?Pn(t[r],e[r]):t[r]=function a(l){var c,f,h={};for(c in l)I(l,c)&&(f=l[c],h[c]=!f||typeof f!="object"||Zt.has(f.constructor)?f:a(f));return h}(e[r])}),t}function lo(t,e){return t.all||e.all||Object.keys(t).some(function(r){return e[r]&&wi(e[r],t[r])})}A(Bt.prototype,((zt={add:function(t){return Pn(this,t),this},addKey:function(t){return Cn(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(r){return Cn(e,r,r)}),this},hasKey:function(t){var e=cr(this).next(t).value;return e&&st(e.from,t)<=0&&0<=st(e.to,t)}})[Xt]=function(){return cr(this)},zt));var Re={},uo={},co=!1;function fr(t){dr(uo,t),co||(co=!0,setTimeout(function(){co=!1,fo(uo,!(uo={}))},0))}function fo(t,e){e===void 0&&(e=!1);var r=new Set;if(t.all)for(var a=0,l=Object.values(Re);a<l.length;a++)Ei(h=l[a],t,r,e);else for(var c in t){var f,h,c=/^idb\:\/\/(.*)\/(.*)\//.exec(c);c&&(f=c[1],c=c[2],h=Re["idb://".concat(f,"/").concat(c)])&&Ei(h,t,r,e)}r.forEach(function(b){return b()})}function Ei(t,e,r,a){for(var l=[],c=0,f=Object.entries(t.queries.query);c<f.length;c++){for(var h=f[c],b=h[0],D=[],w=0,v=h[1];w<v.length;w++){var k=v[w];lo(e,k.obsSet)?k.subscribers.forEach(function(T){return r.add(T)}):a&&D.push(k)}a&&l.push([b,D])}if(a)for(var E=0,_=l;E<_.length;E++){var y=_[E],b=y[0],D=y[1];t.queries.query[b]=D}}function Xa(t){var e=t._state,r=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?It(e.dbOpenError):t});e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var a=e.openCanceller,l=Math.round(10*t.verno),c=!1;function f(){if(e.openCanceller!==a)throw new Q.DatabaseClosed("db.open() was cancelled")}function h(){return new F(function(k,E){if(f(),!r)throw new Q.MissingAPI;var _=t.name,y=e.autoSchema||!l?r.open(_):r.open(_,l);if(!y)throw new Q.MissingAPI;y.onerror=le(E),y.onblocked=bt(t._fireOnBlocked),y.onupgradeneeded=bt(function(T){var O;w=y.transaction,e.autoSchema&&!t._options.allowEmptyDB?(y.onerror=In,w.abort(),y.result.close(),(O=r.deleteDatabase(_)).onsuccess=O.onerror=bt(function(){E(new Q.NoSuchDatabase("Database ".concat(_," doesnt exist")))})):(w.onerror=le(E),O=T.oldVersion>Math.pow(2,62)?0:T.oldVersion,v=O<1,t.idbdb=y.result,c&&Ha(t,w),Ya(t,O/10,w,E))},E),y.onsuccess=bt(function(){w=null;var T,O,x,P,j,R,N=t.idbdb=y.result,M=z(N.objectStoreNames);if(0<M.length)try{var U=N.transaction((j=M).length===1?j[0]:j,"readonly");if(e.autoSchema)R=N,P=U,(x=t).verno=R.version/10,P=x._dbSchema=lr(0,R,P),x._storeNames=z(R.objectStoreNames,0),ar(x,[x._allTables],p(P),P);else if(ur(t,t._dbSchema,U),O=U,((O=no(lr(0,(T=t).idbdb,O),T._dbSchema)).add.length||O.change.some(function(W){return W.add.length||W.change.length}))&&!c)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),N.close(),l=N.version+1,c=!0,k(h());ir(t,U)}catch{}tn.push(t),N.onversionchange=bt(function(W){e.vcFired=!0,t.on("versionchange").fire(W)}),N.onclose=bt(function(){t.close({disableAutoOpen:!1})}),v&&(M=t._deps,j=_,io(R=M.indexedDB)||j===Zn||oo(R,M.IDBKeyRange).put({name:j}).catch(vt)),k()},E)}).catch(function(k){switch(k==null?void 0:k.name){case"UnknownError":if(0<e.PR1398_maxLoop)return e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),h();break;case"VersionError":if(0<l)return l=0,h()}return F.reject(k)})}var b,D=e.dbReadyResolve,w=null,v=!1;return F.race([a,(typeof navigator>"u"?F.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(k){function E(){return indexedDB.databases().finally(k)}b=setInterval(E,100),E()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(h)]).then(function(){return f(),e.onReadyBeingFired=[],F.resolve(ao(function(){return t.on.ready.fire(t.vip)})).then(function k(){var E;if(0<e.onReadyBeingFired.length)return E=e.onReadyBeingFired.reduce(Rr,vt),e.onReadyBeingFired=[],F.resolve(ao(function(){return E(t.vip)})).then(k)})}).finally(function(){e.openCanceller===a&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)}).catch(function(k){e.dbOpenError=k;try{w&&w.abort()}catch{}return a===e.openCanceller&&t._close(),It(k)}).finally(function(){e.openComplete=!0,D()}).then(function(){var k;return v&&(k={},t.tables.forEach(function(E){E.schema.indexes.forEach(function(_){_.name&&(k["idb://".concat(t.name,"/").concat(E.name,"/").concat(_.name)]=new Bt(-1/0,[[[]]]))}),k["idb://".concat(t.name,"/").concat(E.name,"/")]=k["idb://".concat(t.name,"/").concat(E.name,"/:dels")]=new Bt(-1/0,[[[]]])}),xe(Tn).fire(k),fo(k,!0)),t})}function po(t){function e(c){return t.next(c)}var r=l(e),a=l(function(c){return t.throw(c)});function l(c){return function(h){var h=c(h),b=h.value;return h.done?b:b&&typeof b.then=="function"?b.then(r,a):m(b)?Promise.all(b).then(r,a):r(b)}}return l(e)()}function pr(t,e,r){for(var a=m(t)?t.slice():[t],l=0;l<r;++l)a.push(e);return a}var Ga={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return s(s({},t),{table:function(a){var r=t.table(a),a=r.schema,l={},c=[];function f(k,E,_){var x=An(k),y=l[x]=l[x]||[],T=k==null?0:typeof k=="string"?1:k.length,O=0<E,x=s(s({},_),{name:O?"".concat(x,"(virtual-from:").concat(_.name,")"):_.name,lowLevelIndex:_,isVirtual:O,keyTail:E,keyLength:T,extractKey:to(k),unique:!O&&_.unique});return y.push(x),x.isPrimaryKey||c.push(x),1<T&&f(T===2?k[0]:k.slice(0,T-1),E+1,_),y.sort(function(P,j){return P.keyTail-j.keyTail}),x}var h=f(a.primaryKey.keyPath,0,a.primaryKey);l[":id"]=[h];for(var b=0,D=a.indexes;b<D.length;b++){var w=D[b];f(w.keyPath,0,w)}function v(k){var E,_=k.query.index;return _.isVirtual?s(s({},k),{query:{index:_.lowLevelIndex,range:(E=k.query.range,_=_.keyTail,{type:E.type===1?2:E.type,lower:pr(E.lower,E.lowerOpen?t.MAX_KEY:t.MIN_KEY,_),lowerOpen:!0,upper:pr(E.upper,E.upperOpen?t.MIN_KEY:t.MAX_KEY,_),upperOpen:!0})}}):k}return s(s({},r),{schema:s(s({},a),{primaryKey:h,indexes:c,getIndexByKeyPath:function(k){return(k=l[An(k)])&&k[0]}}),count:function(k){return r.count(v(k))},query:function(k){return r.query(v(k))},openCursor:function(k){var E=k.query.index,_=E.keyTail,y=E.keyLength;return E.isVirtual?r.openCursor(v(k)).then(function(O){return O&&T(O)}):r.openCursor(k);function T(O){return Object.create(O,{continue:{value:function(x){x!=null?O.continue(pr(x,k.reverse?t.MAX_KEY:t.MIN_KEY,_)):k.unique?O.continue(O.key.slice(0,y).concat(k.reverse?t.MIN_KEY:t.MAX_KEY,_)):O.continue()}},continuePrimaryKey:{value:function(x,P){O.continuePrimaryKey(pr(x,t.MAX_KEY,_),P)}},primaryKey:{get:function(){return O.primaryKey}},key:{get:function(){var x=O.key;return y===1?x[0]:x.slice(0,y)}},value:{get:function(){return O.value}}})}}})}})}};function ho(t,e,r,a){return r=r||{},a=a||"",p(t).forEach(function(l){var c,f,h;I(e,l)?(c=t[l],f=e[l],typeof c=="object"&&typeof f=="object"&&c&&f?(h=pe(c))!==pe(f)?r[a+l]=e[l]:h==="Object"?ho(c,f,r,a+l+"."):c!==f&&(r[a+l]=e[l]):c!==f&&(r[a+l]=e[l])):r[a+l]=void 0}),p(e).forEach(function(l){I(t,l)||(r[a+l]=e[l])}),r}function mo(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Qa={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return s(s({},t),{table:function(e){var r=t.table(e),a=r.schema.primaryKey;return s(s({},r),{mutate:function(l){var c=G.trans,f=c.table(e).hook,h=f.deleting,b=f.creating,D=f.updating;switch(l.type){case"add":if(b.fire===vt)break;return c._promise("readwrite",function(){return w(l)},!0);case"put":if(b.fire===vt&&D.fire===vt)break;return c._promise("readwrite",function(){return w(l)},!0);case"delete":if(h.fire===vt)break;return c._promise("readwrite",function(){return w(l)},!0);case"deleteRange":if(h.fire===vt)break;return c._promise("readwrite",function(){return function v(k,E,_){return r.query({trans:k,values:!1,query:{index:a,range:E},limit:_}).then(function(y){var T=y.result;return w({type:"delete",keys:T,trans:k}).then(function(O){return 0<O.numFailures?Promise.reject(O.failures[0]):T.length<_?{failures:[],numFailures:0,lastResult:void 0}:v(k,s(s({},E),{lower:T[T.length-1],lowerOpen:!0}),_)})})}(l.trans,l.range,1e4)},!0)}return r.mutate(l);function w(v){var k,E,_,y=G.trans,T=v.keys||mo(a,v);if(T)return(v=v.type==="add"||v.type==="put"?s(s({},v),{keys:T}):s({},v)).type!=="delete"&&(v.values=u([],v.values)),v.keys&&(v.keys=u([],v.keys)),k=r,_=T,((E=v).type==="add"?Promise.resolve([]):k.getMany({trans:E.trans,keys:_,cache:"immutable"})).then(function(O){var x=T.map(function(P,j){var R,N,M,U=O[j],W={onerror:null,onsuccess:null};return v.type==="delete"?h.fire.call(W,P,U,y):v.type==="add"||U===void 0?(R=b.fire.call(W,P,v.values[j],y),P==null&&R!=null&&(v.keys[j]=P=R,a.outbound||dt(v.values[j],a.keyPath,P))):(R=ho(U,v.values[j]),(N=D.fire.call(W,R,P,U,y))&&(M=v.values[j],Object.keys(N).forEach(function(B){I(M,B)?M[B]=N[B]:dt(M,B,N[B])}))),W});return r.mutate(v).then(function(P){for(var j=P.failures,R=P.results,N=P.numFailures,P=P.lastResult,M=0;M<T.length;++M){var U=(R||T)[M],W=x[M];U==null?W.onerror&&W.onerror(j[M]):W.onsuccess&&W.onsuccess(v.type==="put"&&O[M]?v.values[M]:U)}return{failures:j,results:R,numFailures:N,lastResult:P}}).catch(function(P){return x.forEach(function(j){return j.onerror&&j.onerror(P)}),Promise.reject(P)})});throw new Error("Keys missing")}}})}})}};function Si(t,e,r){try{if(!e||e.keys.length<t.length)return null;for(var a=[],l=0,c=0;l<e.keys.length&&c<t.length;++l)st(e.keys[l],t[c])===0&&(a.push(r?jt(e.values[l]):e.values[l]),++c);return a.length===t.length?a:null}catch{return null}}var Ja={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var r=t.table(e);return s(s({},r),{getMany:function(a){var l;return a.cache?(l=Si(a.keys,a.trans._cache,a.cache==="clone"))?F.resolve(l):r.getMany(a).then(function(c){return a.trans._cache={keys:a.keys,values:a.cache==="clone"?jt(c):c},c}):r.getMany(a)},mutate:function(a){return a.type!=="add"&&(a.trans._cache=null),r.mutate(a)}})}}}};function xi(t,e){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!e.schema.primaryKey.outbound}function Di(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Za={stack:"dbcore",level:0,name:"Observability",create:function(t){var e=t.schema.name,r=new Bt(t.MIN_KEY,t.MAX_KEY);return s(s({},t),{transaction:function(a,l,c){if(G.subscr&&l!=="readonly")throw new Q.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(G.querier));return t.transaction(a,l,c)},table:function(a){function l(T){var y,T=T.query;return[y=T.index,new Bt((y=(T=T.range).lower)!=null?y:t.MIN_KEY,(y=T.upper)!=null?y:t.MAX_KEY)]}var c=t.table(a),f=c.schema,h=f.primaryKey,b=f.indexes,D=h.extractKey,w=h.outbound,v=h.autoIncrement&&b.filter(function(_){return _.compound&&_.keyPath.includes(h.keyPath)}),k=s(s({},c),{mutate:function(_){function y(Y){return Y="idb://".concat(e,"/").concat(a,"/").concat(Y),j[Y]||(j[Y]=new Bt)}var T,O,x,P=_.trans,j=_.mutatedParts||(_.mutatedParts={}),R=y(""),N=y(":dels"),M=_.type,W=_.type==="deleteRange"?[_.range]:_.type==="delete"?[_.keys]:_.values.length<50?[mo(h,_).filter(function(Y){return Y}),_.values]:[],U=W[0],W=W[1],B=_.trans._cache;return m(U)?(R.addKeys(U),(M=M==="delete"||U.length===W.length?Si(U,B):null)||N.addKeys(U),(M||W)&&(T=y,O=M,x=W,f.indexes.forEach(function(Y){var ut=T(Y.name||"");function pt(it){return it!=null?Y.extractKey(it):null}function Z(it){Y.multiEntry&&m(it)?it.forEach(function(_t){return ut.addKey(_t)}):ut.addKey(it)}(O||x).forEach(function(it,xt){var Gt=O&&pt(O[xt]),xt=x&&pt(x[xt]);st(Gt,xt)!==0&&(Gt!=null&&Z(Gt),xt!=null)&&Z(xt)})}))):U?(W={from:(B=U.lower)!=null?B:t.MIN_KEY,to:(M=U.upper)!=null?M:t.MAX_KEY},N.add(W),R.add(W)):(R.add(r),N.add(r),f.indexes.forEach(function(Y){return y(Y.name).add(r)})),c.mutate(_).then(function(Y){return!U||_.type!=="add"&&_.type!=="put"||(R.addKeys(Y.results),v&&v.forEach(function(ut){for(var pt=_.values.map(function(Gt){return ut.extractKey(Gt)}),Z=ut.keyPath.findIndex(function(Gt){return Gt===h.keyPath}),it=0,_t=Y.results.length;it<_t;++it)pt[it][Z]=Y.results[it];y(ut.name).addKeys(pt)})),P.mutatedParts=dr(P.mutatedParts||{},j),Y})}}),E={get:function(_){return[h,new Bt(_.key)]},getMany:function(_){return[h,new Bt().addKeys(_.keys)]},count:l,query:l,openCursor:l};return p(E).forEach(function(_){k[_]=function(y){var T=G.subscr,O=!!T,x=xi(G,c)&&Di(_,y)?y.obsSet={}:T;if(O){var P,T=function(W){return W="idb://".concat(e,"/").concat(a,"/").concat(W),x[W]||(x[W]=new Bt)},j=T(""),R=T(":dels"),O=E[_](y),N=O[0],O=O[1];if((_==="query"&&N.isPrimaryKey&&!y.values?R:T(N.name||"")).add(O),!N.isPrimaryKey){if(_!=="count")return P=_==="query"&&w&&y.values&&c.query(s(s({},y),{values:!1})),c[_].apply(this,arguments).then(function(W){if(_==="query"){if(w&&y.values)return P.then(function(pt){return pt=pt.result,j.addKeys(pt),W});var B=y.values?W.result.map(D):W.result;(y.values?j:R).addKeys(B)}else{var Y,ut;if(_==="openCursor")return ut=y.values,(Y=W)&&Object.create(Y,{key:{get:function(){return R.addKey(Y.primaryKey),Y.key}},primaryKey:{get:function(){var pt=Y.primaryKey;return R.addKey(pt),pt}},value:{get:function(){return ut&&j.addKey(Y.primaryKey),Y.value}}})}return W});R.add(r)}}return c[_].apply(this,arguments)}}),k}})}};function Ii(t,e,r){var a;return r.numFailures===0?e:e.type==="deleteRange"||(a=e.keys?e.keys.length:"values"in e&&e.values?e.values.length:1,r.numFailures===a)?null:(a=s({},e),m(a.keys)&&(a.keys=a.keys.filter(function(l,c){return!(c in r.failures)})),"values"in a&&m(a.values)&&(a.values=a.values.filter(function(l,c){return!(c in r.failures)})),a)}function go(t,e){return r=t,((a=e).lower===void 0||(a.lowerOpen?0<st(r,a.lower):0<=st(r,a.lower)))&&(r=t,(a=e).upper===void 0||(a.upperOpen?st(r,a.upper)<0:st(r,a.upper)<=0));var r,a}function Ti(t,e,r,a,l,c){var f,h,b,D,w,v;return!r||r.length===0||(f=e.query.index,h=f.multiEntry,b=e.query.range,D=a.schema.primaryKey.extractKey,w=f.extractKey,v=(f.lowLevelIndex||f).extractKey,(a=r.reduce(function(k,E){var _=k,y=[];if(E.type==="add"||E.type==="put")for(var T=new Bt,O=E.values.length-1;0<=O;--O){var x,P=E.values[O],j=D(P);!T.hasKey(j)&&(x=w(P),h&&m(x)?x.some(function(W){return go(W,b)}):go(x,b))&&(T.addKey(j),y.push(P))}switch(E.type){case"add":var R=new Bt().addKeys(e.values?k.map(function(B){return D(B)}):k),_=k.concat(e.values?y.filter(function(B){return B=D(B),!R.hasKey(B)&&(R.addKey(B),!0)}):y.map(function(B){return D(B)}).filter(function(B){return!R.hasKey(B)&&(R.addKey(B),!0)}));break;case"put":var N=new Bt().addKeys(E.values.map(function(B){return D(B)}));_=k.filter(function(B){return!N.hasKey(e.values?D(B):B)}).concat(e.values?y:y.map(function(B){return D(B)}));break;case"delete":var M=new Bt().addKeys(E.keys);_=k.filter(function(B){return!M.hasKey(e.values?D(B):B)});break;case"deleteRange":var U=E.range;_=k.filter(function(B){return!go(D(B),U)})}return _},t))===t)?t:(a.sort(function(k,E){return st(v(k),v(E))||st(D(k),D(E))}),e.limit&&e.limit<1/0&&(a.length>e.limit?a.length=e.limit:t.length===e.limit&&a.length<e.limit&&(l.dirty=!0)),c?Object.freeze(a):a)}function Oi(t,e){return st(t.lower,e.lower)===0&&st(t.upper,e.upper)===0&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function ts(t,e){return((r,a,l,c)=>{if(r===void 0)return a!==void 0?-1:0;if(a===void 0)return 1;if((r=st(r,a))===0){if(l&&c)return 0;if(l)return 1;if(c)return-1}return r})(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&0<=((r,a,l,c)=>{if(r===void 0)return a!==void 0?1:0;if(a===void 0)return-1;if((r=st(r,a))===0){if(l&&c)return 0;if(l)return-1;if(c)return 1}return r})(t.upper,e.upper,t.upperOpen,e.upperOpen)}function es(t,e,r,a){t.subscribers.add(r),a.addEventListener("abort",function(){var l,c;t.subscribers.delete(r),t.subscribers.size===0&&(l=t,c=e,setTimeout(function(){l.subscribers.size===0&&Ut(c,l)},3e3))})}var ns={stack:"dbcore",level:0,name:"Cache",create:function(t){var e=t.schema.name;return s(s({},t),{transaction:function(r,a,l){var c,f,h=t.transaction(r,a,l);return a==="readwrite"&&(l=(c=new AbortController).signal,h.addEventListener("abort",(f=function(b){return function(){if(c.abort(),a==="readwrite"){for(var D=new Set,w=0,v=r;w<v.length;w++){var k=v[w],E=Re["idb://".concat(e,"/").concat(k)];if(E){var _=t.table(k),y=E.optimisticOps.filter(function(Y){return Y.trans===h});if(h._explicit&&b&&h.mutatedParts)for(var T=0,O=Object.values(E.queries.query);T<O.length;T++)for(var x=0,P=(N=O[T]).slice();x<P.length;x++)lo((M=P[x]).obsSet,h.mutatedParts)&&(Ut(N,M),M.subscribers.forEach(function(Y){return D.add(Y)}));else if(0<y.length){E.optimisticOps=E.optimisticOps.filter(function(Y){return Y.trans!==h});for(var j=0,R=Object.values(E.queries.query);j<R.length;j++)for(var N,M,U,W=0,B=(N=R[j]).slice();W<B.length;W++)(M=B[W]).res!=null&&h.mutatedParts&&(b&&!M.dirty?(U=Object.isFrozen(M.res),U=Ti(M.res,M.req,y,_,M,U),M.dirty?(Ut(N,M),M.subscribers.forEach(function(Y){return D.add(Y)})):U!==M.res&&(M.res=U,M.promise=F.resolve({result:U}))):(M.dirty&&Ut(N,M),M.subscribers.forEach(function(Y){return D.add(Y)})))}}}D.forEach(function(Y){return Y()})}}})(!1),{signal:l}),h.addEventListener("error",f(!1),{signal:l}),h.addEventListener("complete",f(!0),{signal:l})),h},table:function(r){var a=t.table(r),l=a.schema.primaryKey;return s(s({},a),{mutate:function(c){var f,h=G.trans;return!l.outbound&&h.db._options.cache!=="disabled"&&!h.explicit&&h.idbtrans.mode==="readwrite"&&(f=Re["idb://".concat(e,"/").concat(r)])?(h=a.mutate(c),c.type!=="add"&&c.type!=="put"||!(50<=c.values.length||mo(l,c).some(function(b){return b==null}))?(f.optimisticOps.push(c),c.mutatedParts&&fr(c.mutatedParts),h.then(function(b){0<b.numFailures&&(Ut(f.optimisticOps,c),(b=Ii(0,c,b))&&f.optimisticOps.push(b),c.mutatedParts)&&fr(c.mutatedParts)}),h.catch(function(){Ut(f.optimisticOps,c),c.mutatedParts&&fr(c.mutatedParts)})):h.then(function(b){var D=Ii(0,s(s({},c),{values:c.values.map(function(w,v){var k;return b.failures[v]?w:(dt(k=(k=l.keyPath)!=null&&k.includes(".")?jt(w):s({},w),l.keyPath,b.results[v]),k)})}),b);f.optimisticOps.push(D),queueMicrotask(function(){return c.mutatedParts&&fr(c.mutatedParts)})}),h):a.mutate(c)},query:function(c){var f,h,b,D,w,v,k;return xi(G,a)&&Di("query",c)?(f=((b=G.trans)==null?void 0:b.db._options.cache)==="immutable",h=(b=G).requery,b=b.signal,v=((E,_,y,T)=>{var O=Re["idb://".concat(E,"/").concat(_)];if(!O)return[];if(!(E=O.queries[y]))return[null,!1,O,null];var x=E[(T.query?T.query.index.name:null)||""];if(!x)return[null,!1,O,null];switch(y){case"query":var P=x.find(function(j){return j.req.limit===T.limit&&j.req.values===T.values&&Oi(j.req.query.range,T.query.range)});return P?[P,!0,O,x]:[x.find(function(j){return("limit"in j.req?j.req.limit:1/0)>=T.limit&&(!T.values||j.req.values)&&ts(j.req.query.range,T.query.range)}),!1,O,x];case"count":return P=x.find(function(j){return Oi(j.req.query.range,T.query.range)}),[P,!!P,O,x]}})(e,r,"query",c),k=v[0],D=v[2],w=v[3],k&&v[1]?k.obsSet=c.obsSet:(v=a.query(c).then(function(E){var _=E.result;if(k&&(k.res=_),f){for(var y=0,T=_.length;y<T;++y)Object.freeze(_[y]);Object.freeze(_)}else E.result=jt(_);return E}).catch(function(E){return w&&k&&Ut(w,k),Promise.reject(E)}),k={obsSet:c.obsSet,promise:v,subscribers:new Set,type:"query",req:c,dirty:!1},w?w.push(k):(w=[k],(D=D||(Re["idb://".concat(e,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[c.query.index.name||""]=w)),es(k,w,h,b),k.promise.then(function(E){return{result:Ti(E.result,c,D==null?void 0:D.optimisticOps,a,k,f)}})):a.query(c)}})}})}};function hr(t,e){return new Proxy(t,{get:function(r,a,l){return a==="db"?e:Reflect.get(r,a,l)}})}Tt.prototype.version=function(t){if(isNaN(t)||t<.1)throw new Q.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new Q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,r=e.filter(function(a){return a._cfg.version===t})[0];return r||(r=new this.Version(t),e.push(r),e.sort(za),r.stores({}),this._state.autoSchema=!1),r},Tt.prototype._whenReady=function(t){var e=this;return this.idbdb&&(this._state.openComplete||G.letThrough||this._vip)?t():new F(function(r,a){if(e._state.openComplete)return a(new Q.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return void a(new Q.DatabaseClosed);e.open().catch(vt)}e._state.dbReadyPromise.then(r,a)}).then(t)},Tt.prototype.use=function(l){var e=l.stack,r=l.create,a=l.level,l=l.name,c=(l&&this.unuse({stack:e,name:l}),this._middlewares[e]||(this._middlewares[e]=[]));return c.push({stack:e,create:r,level:a??10,name:l}),c.sort(function(f,h){return f.level-h.level}),this},Tt.prototype.unuse=function(t){var e=t.stack,r=t.name,a=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(l){return a?l.create!==a:!!r&&l.name!==r})),this},Tt.prototype.open=function(){var t=this;return je(we,function(){return Xa(t)})},Tt.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var t=this._state,e=tn.indexOf(this);if(0<=e&&tn.splice(e,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new F(function(r){t.dbReadyResolve=r}),t.openCanceller=new F(function(r,a){t.cancelOpen=a}))},Tt.prototype.close=function(e){var e=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,r=this._state;e?(r.isBeingOpened&&r.cancelOpen(new Q.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new Q.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},Tt.prototype.delete=function(t){var e=this,r=(t===void 0&&(t={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),a=this._state;return new F(function(l,c){function f(){e.close(t);var h=e._deps.indexedDB.deleteDatabase(e.name);h.onsuccess=bt(function(){var b,D,w;b=e._deps,D=e.name,io(w=b.indexedDB)||D===Zn||oo(w,b.IDBKeyRange).delete(D).catch(vt),l()}),h.onerror=le(c),h.onblocked=e._fireOnBlocked}if(r)throw new Q.InvalidArgument("Invalid closeOptions argument to db.delete()");a.isBeingOpened?a.dbReadyPromise.then(f):f()})},Tt.prototype.backendDB=function(){return this.idbdb},Tt.prototype.isOpen=function(){return this.idbdb!==null},Tt.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},Tt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Tt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Tt.prototype,"tables",{get:function(){var t=this;return p(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!1,configurable:!0}),Tt.prototype.transaction=function(){var t=(function(e,r,a){var l=arguments.length;if(l<2)throw new Q.InvalidArgument("Too few arguments");for(var c=new Array(l-1);--l;)c[l-1]=arguments[l];return a=c.pop(),[e,ie(c),a]}).apply(this,arguments);return this._transaction.apply(this,t)},Tt.prototype._transaction=function(t,e,r){var a,l,c=this,f=G.trans,h=(f&&f.db===this&&t.indexOf("!")===-1||(f=null),t.indexOf("?")!==-1);t=t.replace("!","").replace("?","");try{if(l=e.map(function(D){if(D=D instanceof c.Table?D.name:D,typeof D!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return D}),t=="r"||t===Hr)a=Hr;else{if(t!="rw"&&t!=Vr)throw new Q.InvalidArgument("Invalid transaction mode: "+t);a=Vr}if(f){if(f.mode===Hr&&a===Vr){if(!h)throw new Q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");f=null}f&&l.forEach(function(D){if(f&&f.storeNames.indexOf(D)===-1){if(!h)throw new Q.SubTransaction("Table "+D+" not included in parent transaction.");f=null}}),h&&f&&!f.active&&(f=null)}}catch(D){return f?f._promise(null,function(w,v){v(D)}):It(D)}var b=(function D(w,v,k,E,_){return F.resolve().then(function(){var x=G.transless||G,y=w._createTransaction(v,k,w._dbSchema,E),x=(y.explicit=!0,{trans:y,transless:x});if(E)y.idbtrans=E.idbtrans;else try{y.create(),y.idbtrans._explicit=!0,w._state.PR1398_maxLoop=3}catch(P){return P.name===Br.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return D(w,v,k,null,_)})):It(P)}var T,O=Ve(_),x=(O&&Ze(),F.follow(function(){var P;(T=_.call(y,y))&&(O?(P=ke.bind(null,null),T.then(P,P)):typeof T.next=="function"&&typeof T.throw=="function"&&(T=po(T)))},x));return(T&&typeof T.then=="function"?F.resolve(T).then(function(P){return y.active?P:It(new Q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):x.then(function(){return T})).then(function(P){return E&&y._resolve(),y._completion.then(function(){return P})}).catch(function(P){return y._reject(P),It(P)})})}).bind(null,this,a,l,f,r);return f?f._promise(a,b,"lock"):G.trans?je(G.transless,function(){return c._whenReady(b)}):this._whenReady(b)},Tt.prototype.table=function(t){if(I(this._allTables,t))return this._allTables[t];throw new Q.InvalidTable("Table ".concat(t," does not exist"))};var me=Tt;function Tt(t,e){var r,a,l,c,f,h=this,b=(this._middlewares={},this.verno=0,Tt.dependencies),b=(this._options=e=s({addons:Tt.addons,autoOpen:!0,indexedDB:b.indexedDB,IDBKeyRange:b.IDBKeyRange,cache:"cloned"},e),this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange},e.addons),D=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:vt,dbReadyPromise:null,cancelOpen:vt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:e.autoOpen}),w=(D.dbReadyPromise=new F(function(v){D.dbReadyResolve=v}),D.openCanceller=new F(function(v,k){D.cancelOpen=k}),this._state=D,this.name=t,this.on=xn(this,"populate","blocked","versionchange","close",{ready:[Rr,vt]}),this.once=function(v,k){var E=function(){for(var _=[],y=0;y<arguments.length;y++)_[y]=arguments[y];h.on(v).unsubscribe(E),k.apply(h,_)};return h.on(v,E)},this.on.ready.subscribe=X(this.on.ready.subscribe,function(v){return function(k,E){Tt.vip(function(){var _,y=h._state;y.openComplete?(y.dbOpenError||F.resolve().then(k),E&&v(k)):y.onReadyBeingFired?(y.onReadyBeingFired.push(k),E&&v(k)):(v(k),_=h,E||v(function T(){_.on.ready.unsubscribe(k),_.on.ready.unsubscribe(T)}))})}}),this.Collection=(r=this,Dn(Ra.prototype,function(T,y){this.db=r;var E=oi,_=null;if(y)try{E=y()}catch(x){_=x}var y=T._ctx,T=y.table,O=T.hook.reading.fire;this._ctx={table:T,index:y.index,isPrimKey:!y.index||T.schema.primKey.keyPath&&y.index===T.schema.primKey.name,range:E,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:_,or:y.or,valueMapper:O!==bn?O:null}})),this.Table=(a=this,Dn(ci.prototype,function(v,k,E){this.db=a,this._tx=E,this.name=v,this.schema=k,this.hook=a._allTables[v]?a._allTables[v].hook:xn(null,{creating:[Oa,vt],reading:[Ta,bn],updating:[Ca,vt],deleting:[Aa,vt]})})),this.Transaction=(l=this,Dn(qa.prototype,function(v,k,E,_,y){var T=this;v!=="readonly"&&k.forEach(function(O){O=(O=E[O])==null?void 0:O.yProps,O&&(k=k.concat(O.map(function(x){return x.updatesTable})))}),this.db=l,this.mode=v,this.storeNames=k,this.schema=E,this.chromeTransactionDurability=_,this.idbtrans=null,this.on=xn(this,"complete","error","abort"),this.parent=y||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new F(function(O,x){T._resolve=O,T._reject=x}),this._completion.then(function(){T.active=!1,T.on.complete.fire()},function(O){var x=T.active;return T.active=!1,T.on.error.fire(O),T.parent?T.parent._reject(O):x&&T.idbtrans&&T.idbtrans.abort(),It(O)})})),this.Version=(c=this,Dn(Va.prototype,function(v){this.db=c,this._cfg={version:v,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(f=this,Dn(mi.prototype,function(v,k,E){if(this.db=f,this._ctx={table:v,index:k===":id"?null:k,or:E},this._cmp=this._ascending=st,this._descending=function(_,y){return st(y,_)},this._max=function(_,y){return 0<st(_,y)?_:y},this._min=function(_,y){return st(_,y)<0?_:y},this._IDBKeyRange=f._deps.IDBKeyRange,!this._IDBKeyRange)throw new Q.MissingAPI})),this.on("versionchange",function(v){0<v.newVersion?console.warn("Another connection wants to upgrade database '".concat(h.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(h.name,"'. Closing db now to resume the delete request.")),h.close({disableAutoOpen:!1})}),this.on("blocked",function(v){!v.newVersion||v.newVersion<v.oldVersion?console.warn("Dexie.delete('".concat(h.name,"') was blocked")):console.warn("Upgrade '".concat(h.name,"' blocked by other connection holding version ").concat(v.oldVersion/10))}),this._maxKey=On(e.IDBKeyRange),this._createTransaction=function(v,k,E,_){return new h.Transaction(v,k,E,h._options.chromeTransactionDurability,_)},this._fireOnBlocked=function(v){h.on("blocked").fire(v),tn.filter(function(k){return k.name===h.name&&k!==h&&!k._state.vcFired}).map(function(k){return k.on("versionchange").fire(v)})},this.use(Ja),this.use(ns),this.use(Za),this.use(Ga),this.use(Qa),new Proxy(this,{get:function(v,k,E){var _;return k==="_vip"||(k==="table"?function(y){return hr(h.table(y),w)}:(_=Reflect.get(v,k,E))instanceof ci?hr(_,w):k==="tables"?_.map(function(y){return hr(y,w)}):k==="_createTransaction"?function(){return hr(_.apply(this,arguments),w)}:_)}}));this.vip=w,b.forEach(function(v){return v(h)})}var mr,on=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",rs=(vo.prototype.subscribe=function(t,e,r){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:e,complete:r})},vo.prototype[on]=function(){return this},vo);function vo(t){this._subscribe=t}try{mr={indexedDB:d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,IDBKeyRange:d.IDBKeyRange||d.webkitIDBKeyRange}}catch{mr={indexedDB:null,IDBKeyRange:null}}function Ai(t){var e,r=!1,a=new rs(function(l){var c=Ve(t),f,h=!1,b={},D={},w={get closed(){return h},unsubscribe:function(){h||(h=!0,f&&f.abort(),v&&xe.storagemutated.unsubscribe(E))}},v=(l.start&&l.start(w),!1),k=function(){return Yr(_)},E=function(y){dr(b,y),lo(D,b)&&k()},_=function(){var y,T,O;!h&&mr.indexedDB&&(b={},y={},f&&f.abort(),f=new AbortController,O=(x=>{var P=Qe();try{c&&Ze();var j=_e(t,x);return j=c?j.finally(ke):j}finally{P&&Je()}})(T={subscr:y,signal:f.signal,requery:k,querier:t,trans:null}),Promise.resolve(O).then(function(x){r=!0,e=x,h||T.signal.aborted||(b={},(P=>{for(var j in P)if(I(P,j))return;return 1})(D=y)||v||(xe(Tn,E),v=!0),Yr(function(){return!h&&l.next&&l.next(x)}))},function(x){r=!1,["DatabaseClosedError","AbortError"].includes(x==null?void 0:x.name)||h||Yr(function(){h||l.error&&l.error(x)})}))};return setTimeout(k,0),w});return a.hasValue=function(){return r},a.getValue=function(){return e},a}var Ne=me;function yo(t){var e=De;try{De=!0,xe.storagemutated.fire(t),fo(t,!0)}finally{De=e}}A(Ne,s(s({},ee),{delete:function(t){return new Ne(t,{addons:[]}).delete()},exists:function(t){return new Ne(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return e=Ne.dependencies,r=e.indexedDB,e=e.IDBKeyRange,(io(r)?Promise.resolve(r.databases()).then(function(a){return a.map(function(l){return l.name}).filter(function(l){return l!==Zn})}):oo(r,e).toCollection().primaryKeys()).then(t)}catch{return It(new Q.MissingAPI)}var e,r},defineClass:function(){return function(t){g(this,t)}},ignoreTransaction:function(t){return G.trans?je(G.transless,t):t()},vip:ao,async:function(t){return function(){try{var e=po(t.apply(this,arguments));return e&&typeof e.then=="function"?e:F.resolve(e)}catch(r){return It(r)}}},spawn:function(t,e,r){try{var a=po(t.apply(r,e||[]));return a&&typeof a.then=="function"?a:F.resolve(a)}catch(l){return It(l)}},currentTransaction:{get:function(){return G.trans||null}},waitFor:function(t,e){return t=F.resolve(typeof t=="function"?Ne.ignoreTransaction(t):t).timeout(e||6e4),G.trans?G.trans.waitFor(t):t},Promise:F,debug:{get:function(){return se},set:function(t){Qo(t)}},derive:q,extend:g,props:A,override:X,Events:xn,on:xe,liveQuery:Ai,extendObservabilitySet:dr,getByKeyPath:gt,setByKeyPath:dt,delByKeyPath:function(t,e){typeof e=="string"?dt(t,e,void 0):"length"in e&&[].map.call(e,function(r){dt(t,r,void 0)})},shallowClone:ht,deepClone:jt,getObjectDiff:ho,cmp:st,asap:ct,minKey:-1/0,addons:[],connections:tn,errnames:Br,dependencies:mr,cache:Re,semVer:"4.3.0",version:"4.3.0".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,r){return t+e/Math.pow(10,2*r)})})),Ne.maxKey=On(Ne.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(xe(Tn,function(t){De||(t=new CustomEvent(Qr,{detail:t}),De=!0,dispatchEvent(t),De=!1)}),addEventListener(Qr,function(t){t=t.detail,De||yo(t)}));var an,De=!1,Ci=function(){};return typeof BroadcastChannel<"u"&&((Ci=function(){(an=new BroadcastChannel(Qr)).onmessage=function(t){return t.data&&yo(t.data)}})(),typeof an.unref=="function"&&an.unref(),xe(Tn,function(t){De||an.postMessage(t)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(t){if(!me.disableBfCache&&t.persisted){se&&console.debug("Dexie: handling persisted pagehide"),an!=null&&an.close();for(var e=0,r=tn;e<r.length;e++)r[e].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(t){!me.disableBfCache&&t.persisted&&(se&&console.debug("Dexie: handling persisted pageshow"),Ci(),yo({all:new Bt(-1/0,[[]])}))})),F.rejectionMapper=function(t,e){return!t||t instanceof Xe||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Go[t.name]?t:(e=new Go[t.name](e||t.message,t),"stack"in t&&L(e,"stack",{get:function(){return this.inner.stack}}),e)},Qo(se),s(me,Object.freeze({__proto__:null,Dexie:me,Entity:ii,PropModification:Sn,RangeSet:Bt,add:function(t){return new Sn({add:t})},cmp:st,default:me,liveQuery:Ai,mergeRanges:Pn,rangesOverlap:wi,remove:function(t){return new Sn({remove:t})},replacePrefix:function(t,e){return new Sn({replacePrefix:[t,e]})}}),{default:me}),me})})(Gi);var ss=Gi.exports;const Po=as(ss),$i=Symbol.for("Dexie"),Tr=globalThis[$i]||(globalThis[$i]=Po);if(Po.semVer!==Tr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Po.semVer} and ${Tr.semVer}`);const{liveQuery:cl,mergeRanges:dl,rangesOverlap:fl,RangeSet:pl,cmp:hl,Entity:ml,PropModification:gl,replacePrefix:vl,add:yl,remove:bl,DexieYProvider:wl}=Tr;class ls extends Tr{constructor(){super("GymDatabase");ne(this,"workouts");ne(this,"logs");ne(this,"workoutTypes");ne(this,"profile");this.version(1).stores({workouts:"id, status, startTime, updatedAt, isDeleted",logs:"id, workoutId, workoutTypeId, date, updatedAt, isDeleted",workoutTypes:"id, updatedAt, isDeleted",profile:"id, updatedAt, isDeleted"})}}const J=new ls,Ko="gym_web_auth";function qo(){const i=localStorage.getItem(Ko);try{return i?JSON.parse(i):null}catch{return null}}function Qi(i){localStorage.setItem(Ko,JSON.stringify(i))}function us(){localStorage.removeItem(Ko)}function $o(){const i=qo();if(!i)return null;const n=new URLSearchParams;return Object.entries(i).forEach(([o,s])=>{s!=null&&n.append(o,String(s))}),n.toString()}var Hi;const gr=(Hi=window.Telegram)==null?void 0:Hi.WebApp,Li="https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4";class wo{static getHeaders(){const n={"Content-Type":"application/json"};if(gr!=null&&gr.initData)localStorage.getItem("skip_tma_auth")==="true"||(n["X-Telegram-Init-Data"]=gr.initData);else{const o=$o();o&&(n["X-Telegram-Init-Data"]=o)}return n}static async sync(){if(!navigator.onLine)throw new Error("Offline");const n=this.getHeaders(),o=await fetch(Li,{headers:n});if(!o.ok)throw o.status===401?new Error("Unauthorized"):new Error("Sync failed");const s=await o.json();await this.mergeData(s);const u=await this.readAll();await fetch(Li,{method:"POST",headers:n,body:JSON.stringify(u)})}static async mergeData(n){await J.transaction("rw",J.workouts,J.logs,J.workoutTypes,J.profile,async()=>{if(await this.mergeTable(J.workouts,n.workouts),await this.mergeTable(J.logs,n.logs),await this.mergeTable(J.workoutTypes,n.workoutTypes),n.profile){const o={...n.profile,id:"me"};await this.mergeTable(J.profile,[o])}})}static async mergeTable(n,o=[]){const s=await n.toArray(),u=new Map(s.map(d=>[d.id,d]));for(const d of o){const p=u.get(d.id);if(!p)await n.put(d);else{const m=new Date(d.updatedAt).getTime(),g=new Date(p.updatedAt).getTime();m>g&&await n.put(d)}}}static async readAll(){return{workouts:await J.workouts.toArray(),logs:await J.logs.toArray(),workoutTypes:await J.workoutTypes.toArray(),profile:(await J.profile.toArray())[0]}}}const cs="gym_twa_data";var Vi;const sn=(Vi=window.Telegram)==null?void 0:Vi.WebApp,_o={workoutTypes:[{id:"1",name:"ÐÐ¸Ð¼ Ð»ÐµÐ¶Ð°",updatedAt:new Date().toISOString()},{id:"2",name:"ÐÑÐ¸ÑÐµÐ´Ð°Ð½Ð¸Ñ",updatedAt:new Date().toISOString()},{id:"3",name:"Ð¡ÑÐ°Ð½Ð¾Ð²Ð°Ñ ÑÑÐ³Ð°",updatedAt:new Date().toISOString()}],logs:[],workouts:[]};class ds{constructor(){ne(this,"onUpdateCallback");ne(this,"onSyncStatusChangeCallback");ne(this,"onUnauthorizedCallback");ne(this,"status","idle");ne(this,"cache",{..._o});ne(this,"SERVER_URL","https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4");this.init()}async init(){await this.migrateFromLocalStorage(),this.sync().catch(console.error)}async migrateFromLocalStorage(){const n=localStorage.getItem(cs);if(n)try{const o=JSON.parse(n);if(await J.workoutTypes.count()===0){console.log("Migrating from localStorage to IDB...");const u=new Date().toISOString(),d=(o.workoutTypes||_o.workoutTypes).map(g=>({...g,updatedAt:u}));await J.workoutTypes.bulkPut(d);const p=(o.logs||[]).map(g=>({...g,updatedAt:u,workoutId:g.workoutId||"legacy"}));await J.logs.bulkPut(p);const m=(o.workouts||[]).map(g=>({...g,updatedAt:u}));if(await J.workouts.bulkPut(m),o.profile){const g={...o.profile,id:"me",updatedAt:u};await J.profile.put(g)}}}catch(o){console.error("Migration failed",o)}else await J.workoutTypes.count()===0&&await J.workoutTypes.bulkPut(_o.workoutTypes)}onUpdate(n){this.onUpdateCallback=n}onSyncStatusChange(n){this.onSyncStatusChangeCallback=n}onUnauthorized(n){this.onUnauthorizedCallback=n}setStatus(n){var o;this.status=n,(o=this.onSyncStatusChangeCallback)==null||o.call(this,n),n==="success"&&setTimeout(()=>{this.status==="success"&&this.setStatus("idle")},2e3)}async sync(){var o,s,u;const n=localStorage.getItem("skip_tma_auth")==="true";if(n&&!$o()){this.setStatus("idle");return}try{this.setStatus("saving"),await wo.sync(),this.setStatus("success"),(o=this.onUpdateCallback)==null||o.call(this)}catch(d){if(console.error("Sync failed",d),(d instanceof Error?d.message:String(d)).toLowerCase().includes("unauthorized")){if(n){this.setStatus("error"),(s=this.onUnauthorizedCallback)==null||s.call(this);return}localStorage.setItem("skip_tma_auth","true"),us(),(u=this.onUnauthorizedCallback)==null||u.call(this),location.reload();return}d instanceof Error&&d.message==="Offline"?this.setStatus("idle"):this.setStatus("error")}}async reloadCache(){var n;this.cache=await wo.readAll(),(n=this.onUpdateCallback)==null||n.call(this)}getWorkoutTypes(){return this.cache.workoutTypes.filter(o=>!o.isDeleted).sort((o,s)=>(o.order??1/0)-(s.order??1/0))}getLogs(){return this.cache.logs.filter(n=>!n.isDeleted)}getWorkouts(){return this.cache.workouts.filter(n=>!n.isDeleted)}getActiveWorkout(){return this.cache.workouts.find(n=>!n.isDeleted&&(n.status==="active"||n.status==="paused"))}getProfile(){return this.cache.profile}async addWorkoutType(n,o="strength"){const s=this.getWorkoutTypes(),u=s.length>0?Math.max(...s.map(p=>p.order??0)):0,d={id:Date.now().toString(),name:n,category:o,order:u+1,updatedAt:new Date().toISOString()};return await J.workoutTypes.put(d),await this.reloadCache(),this.sync().catch(()=>{}),d}async deleteWorkoutType(n){const o=await J.workoutTypes.get(n);o&&(o.isDeleted=!0,o.updatedAt=new Date().toISOString(),await J.workoutTypes.put(o),await this.reloadCache(),this.sync().catch(()=>{}))}async updateWorkoutType(n,o,s){const u=await J.workoutTypes.get(n);u&&(u.name=o,s&&(u.category=s),u.updatedAt=new Date().toISOString(),await J.workoutTypes.put(u),await this.reloadCache(),this.sync().catch(()=>{}))}async startWorkout(n){this.getActiveWorkout()&&await this.finishWorkout();const s={id:Date.now().toString(),startTime:new Date().toISOString(),status:"active",name:n,isManual:!0,pauseIntervals:[],updatedAt:new Date().toISOString()};return await J.workouts.put(s),await this.reloadCache(),this.sync().catch(()=>{}),s}async pauseWorkout(){const n=this.getActiveWorkout();n&&n.status==="active"&&(n.status="paused",n.pauseIntervals.push({start:new Date().toISOString()}),n.updatedAt=new Date().toISOString(),await J.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{}))}async resumeWorkout(){const n=this.getActiveWorkout();if(n&&n.status==="paused"){n.status="active";const o=n.pauseIntervals[n.pauseIntervals.length-1];o&&!o.end&&(o.end=new Date().toISOString()),n.updatedAt=new Date().toISOString(),await J.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}async finishWorkout(){const n=this.getActiveWorkout();if(n){n.status="finished",n.endTime=new Date().toISOString();const o=n.pauseIntervals[n.pauseIntervals.length-1];o&&!o.end&&(o.end=n.endTime),n.updatedAt=new Date().toISOString(),await J.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}getWorkoutDuration(n){const o=new Date(n.startTime).getTime(),s=n.endTime?new Date(n.endTime).getTime():Date.now();let u=s-o;n.pauseIntervals.forEach(g=>{const S=new Date(g.start).getTime(),$=g.end?new Date(g.end).getTime():n.status==="paused"?Date.now():s;$>S&&(u-=$-S)});const d=Math.floor(Math.max(0,u)/6e4),m=this.cache.logs.filter(g=>g.workoutId===n.id&&!g.isDeleted).reduce((g,S)=>g+(S.duration||0),0);return Math.max(d,m)}async ensureActiveWorkout(){const n=this.getActiveWorkout();if(n)return n.id;const o=new Date().toISOString().split("T")[0],d=this.getWorkouts().filter(g=>g.startTime.startsWith(o)).sort((g,S)=>new Date(S.startTime).getTime()-new Date(g.startTime).getTime())[0];if(d&&!d.isManual&&d.status==="finished")return d.endTime=new Date().toISOString(),d.updatedAt=new Date().toISOString(),await J.workouts.put(d),await this.reloadCache(),d.id;const p=`implicit_${o}_${Date.now()}`,m={id:p,startTime:new Date().toISOString(),endTime:new Date().toISOString(),status:"finished",isManual:!1,pauseIntervals:[],updatedAt:new Date().toISOString()};return await J.workouts.put(m),await this.reloadCache(),p}async updateImplicitWorkoutBounds(n){const o=await J.workouts.get(n);if(!o||o.isManual)return;const u=(await J.logs.where("workoutId").equals(n).toArray()).filter(p=>!p.isDeleted);if(u.length===0)return;const d=u.sort((p,m)=>new Date(p.date).getTime()-new Date(m.date).getTime());o.startTime=d[0].date,o.endTime=d[d.length-1].date,o.status="finished",o.updatedAt=new Date().toISOString(),await J.workouts.put(o)}async addLog(n){const o=await this.ensureActiveWorkout(),s={...n,id:Date.now().toString(),date:new Date().toISOString(),workoutId:o,updatedAt:new Date().toISOString()};return await J.logs.put(s),await this.updateImplicitWorkoutBounds(o),await this.reloadCache(),this.sync().catch(()=>{}),s}async deleteLog(n){const o=await J.logs.get(n);if(o){const s=o.workoutId;o.isDeleted=!0,o.updatedAt=new Date().toISOString(),await J.logs.put(o),s&&await this.updateImplicitWorkoutBounds(s),await this.reloadCache(),this.sync().catch(()=>{})}}async updateLog(n){const o={...n,updatedAt:new Date().toISOString()};await J.logs.put(o),await this.reloadCache(),this.sync().catch(()=>{})}getProfileIdentifier(){var s,u;const n=this.cache.profile;if(n!=null&&n.telegramUsername)return n.telegramUsername;if(n!=null&&n.telegramUserId)return`id_${n.telegramUserId}`;const o=(u=(s=sn==null?void 0:sn.initDataUnsafe)==null?void 0:s.user)==null?void 0:u.id;return o?`id_${o}`:""}async updateProfileSettings(n){var p;const o=(p=sn==null?void 0:sn.initDataUnsafe)==null?void 0:p.user,s=o==null?void 0:o.id;let u=this.cache.profile;u?o!=null&&o.photo_url&&(u.photoUrl=o.photo_url):u={id:"me",isPublic:!1,showFullHistory:!1,telegramUserId:s||0,telegramUsername:o==null?void 0:o.username,photoUrl:o==null?void 0:o.photo_url,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),friends:[]};const d={...u,...n,updatedAt:new Date().toISOString()};await J.profile.put(d),await this.reloadCache(),this.sync().catch(()=>{})}async addFriend(n){const o=this.cache.profile;if(!o)return;const s=o.friends||[];if(s.some(d=>d.identifier===n.identifier))return;const u={...n,addedAt:new Date().toISOString()};await this.updateProfileSettings({friends:[...s,u]})}async removeFriend(n){const o=this.cache.profile;if(!o||!o.friends)return;const s=o.friends.filter(u=>u.identifier!==n);await this.updateProfileSettings({friends:s})}isFriend(n){var s;const o=this.cache.profile;return((s=o==null?void 0:o.friends)==null?void 0:s.some(u=>u.identifier===n))??!1}async updateWorkoutTypeOrder(n){const o=n.map((s,u)=>{const d=this.cache.workoutTypes.find(p=>p.id===s);return d?{...d,order:u,updatedAt:new Date().toISOString()}:null}).filter(Boolean);o.length>0&&(await J.workoutTypes.bulkPut(o),await this.reloadCache(),this.sync().catch(()=>{}))}async getPublicProfile(n){try{const o=await fetch(`${this.SERVER_URL}?profile=${encodeURIComponent(n)}`);return o.ok?await o.json():null}catch{return null}}async getAIRecommendation(n,o){const s=$o();if(!s)throw new Error("Unauthorized");const u=await fetch(`${this.SERVER_URL}?action=ai`,{method:"POST",headers:{"X-Telegram-Init-Data":s,"Content-Type":"application/json"},body:JSON.stringify({type:n,options:o})});if(!u.ok)throw new Error("AI Generation Failed");return(await u.json()).recommendation}async exportData(){return await wo.readAll()}async importData(n){if(!n.logs||!n.workoutTypes)throw new Error("Invalid data format");await J.transaction("rw",J.workouts,J.logs,J.workoutTypes,J.profile,async()=>{var o,s,u;await J.workouts.clear(),await J.logs.clear(),await J.workoutTypes.clear(),await J.profile.clear(),(o=n.workouts)!=null&&o.length&&await J.workouts.bulkAdd(n.workouts),(s=n.logs)!=null&&s.length&&await J.logs.bulkAdd(n.logs),(u=n.workoutTypes)!=null&&u.length&&await J.workoutTypes.bulkAdd(n.workoutTypes),n.profile&&await J.profile.put({...n.profile,id:"me"})}),await this.reloadCache(),this.sync().catch(()=>{})}}const H=new ds;H.reloadCache().then(()=>{});function fs(i=0,n=0){return n===1?i:Math.round(i*(1+n/30))}function ps(i,n){const o=new Map;return i.filter(u=>u.workoutTypeId===n).forEach(u=>{const d=u.date.split("T")[0],p=fs(u.weight||0,u.reps||0),m=o.get(d)||0;p>m&&o.set(d,p)}),o}function hs(i,n){const o=new Set;return i.forEach(s=>o.add(s.startTime.split("T")[0])),n.forEach(s=>o.add(s.date.split("T")[0])),o}function ms(i){const n=i.filter(d=>d.endTime&&d.status==="finished");if(n.length===0)return{averageMinutes:0,totalMinutes:0,count:0};let o=0;n.forEach(d=>{const p=new Date(d.startTime).getTime(),m=new Date(d.endTime).getTime();let g=m-p;d.pauseIntervals&&d.pauseIntervals.forEach(S=>{const $=new Date(S.start).getTime(),I=S.end?new Date(S.end).getTime():m;g-=I-$}),o+=g});const s=Math.round(o/1e3/60);return{averageMinutes:Math.round(s/n.length),totalMinutes:s,count:n.length}}function Ji(i,n=6){const o=new Date,s=new Date(o);s.setMonth(o.getMonth()-n),s.setDate(s.getDate()-s.getDay());let u='<div class="heatmap-container"><div class="heatmap-grid">';const d=new Date(s),p=new Date(o);for(;d<=p;){const m=d.toISOString().split("T")[0],g=i.has(m),$=`heatmap-cell level-${g?4:0}`,I=`${m}: ${g?"Workout":"No workout"}`;u+=`<div class="${$}" title="${I}"></div>`,d.setDate(d.getDate()+1)}return u+="</div>",u+=`
        <div class="heatmap-legend">
            Less <div class="heatmap-cell level-0"></div>
            <div class="heatmap-cell level-4"></div> More
        </div>
    `,u+="</div>",u}function ji(i){const n=new Map;i.forEach(u=>{const d=u.date.split("T")[0],p=(u.weight||0)*(u.reps||0);n.set(d,(n.get(d)||0)+p)});const o=Array.from(n.keys()).sort().slice(-10);if(o.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¾Ð±ÑÐµÐ¼Ð°</p>';const s=o.map(u=>({label:new Date(u).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:n.get(u)}));return ys(s,"ÐºÐ³")}function gs(i){const n=Array.from(i.keys()).sort();if(n.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° 1RM</p>';const o=n.map(s=>({label:new Date(s).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:i.get(s)}));return Zi(o,"ÐºÐ³")}function vs(i){const n=i.filter(s=>s.status==="finished"&&s.endTime).sort((s,u)=>new Date(s.startTime).getTime()-new Date(u.startTime).getTime()).slice(-10);if(n.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÐ¸</p>';const o=n.map(s=>{const u=new Date(s.startTime).getTime(),d=new Date(s.endTime).getTime();let p=(d-u)/1e3/60;return s.pauseIntervals&&s.pauseIntervals.forEach(m=>{const g=new Date(m.start).getTime(),S=m.end?new Date(m.end).getTime():d;p-=(S-g)/1e3/60}),{label:new Date(s.startTime).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:Math.round(p)}});return Zi(o,"Ð¼Ð¸Ð½")}function ys(i,n){const u=Math.max(...i.map(p=>p.value))*1.1;return`
        <svg width="100%" height="150" preserveAspectRatio="none">
            ${i.map((p,m)=>{const g=p.value/u*100,S=m/i.length*100,$=1/i.length*80;return`
            <rect x="${S+5}%" y="${100-g}%" width="${$}%" height="${g}%" fill="var(--color-button)" rx="2" opacity="0.8">
               <title>${p.label}: ${p.value}${n}</title>
            </rect>
            <text x="${S+5+$/2}%" y="95%" font-size="10" text-anchor="middle" fill="var(--color-text)" style="pointer-events: none;">
                ${p.label}
            </text>
        `}).join("")}
        </svg>
    `}function Zi(i,n){const d=i.map(C=>C.value),p=Math.min(...d),m=Math.max(...d),g=m-p||1,S=C=>20+C/(i.length-1)*(400-2*20),$=C=>130-(C-p)/g*(150-2*20),I=i.map((C,L)=>`${S(L)},${$(C.value)}`).join(" "),A=i.map((C,L)=>`
        <circle cx="${S(L)}" cy="${$(C.value)}" r="4" fill="var(--color-bg)" stroke="var(--color-button)" stroke-width="2">
            <title>${C.label}: ${C.value}${n}</title>
        </circle>
    `).join("");return`
        <svg viewBox="0 0 400 150" class="chart">
             <polyline
                fill="none"
                stroke="var(--color-button)"
                stroke-width="3"
                stroke-linejoin="round"
                stroke-linecap="round"
                points="${I}"
            />
            ${A}
        </svg>
        <div style="display: flex; justify-content: space-between; margin-top: 4px; font-size: 12px; color: var(--color-hint);">
            <span>${Math.round(p)}${n}</span>
            <span>${Math.round(m)}${n}</span>
        </div>
    `}function ta(i,n){i.innerHTML=`
        <div class="page-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 24px;">ðï¸</div>
            <h1 class="title" style="margin-bottom: 12px;">ÐÐ¸Ð¼-Ð¶Ð¸Ð¼ 21</h1>
            <p class="subtitle" style="margin-bottom: 32px; opacity: 0.7;">ÐÐ¾Ð¹Ð´Ð¸ÑÐµ ÑÐµÑÐµÐ· Telegram, ÑÑÐ¾Ð±Ñ ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</p>
            <div id="telegram-login-container"></div>
        </div>
    `,window.onTelegramAuth=u=>{console.log("Telegram auth callback received:",u),Qi(u),localStorage.removeItem("skip_tma_auth"),n()};const o=document.createElement("script");o.src="https://telegram.org/js/telegram-widget.js?22",o.async=!0,o.setAttribute("data-telegram-login","gymgym21bot"),o.setAttribute("data-size","large"),o.setAttribute("data-radius","12"),o.setAttribute("data-onauth","onTelegramAuth(user)"),o.setAttribute("data-request-access","write");const s=document.getElementById("telegram-login-container");s&&s.appendChild(o)}const bs="modulepreload",ws=function(i,n){return new URL(i,n).href},Mi={},_s=function(n,o,s){let u=Promise.resolve();if(o&&o.length>0){const p=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),g=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));u=Promise.allSettled(o.map(S=>{if(S=ws(S,s),S in Mi)return;Mi[S]=!0;const $=S.endsWith(".css"),I=$?'[rel="stylesheet"]':"";if(!!s)for(let L=p.length-1;L>=0;L--){const q=p[L];if(q.href===S&&(!$||q.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${S}"]${I}`))return;const C=document.createElement("link");if(C.rel=$?"stylesheet":bs,$||(C.as="script"),C.crossOrigin="",C.href=S,g&&C.setAttribute("nonce",g),document.head.appendChild(C),$)return new Promise((L,q)=>{C.addEventListener("load",L),C.addEventListener("error",()=>q(new Error(`Unable to preload CSS for ${S}`)))})}))}function d(p){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=p,window.dispatchEvent(m),!m.defaultPrevented)throw p}return u.then(p=>{for(const m of p||[])m.status==="rejected"&&d(m.reason);return n().catch(d)})};function ks(i={}){const{immediate:n=!1,onNeedRefresh:o,onOfflineReady:s,onRegistered:u,onRegisteredSW:d,onRegisterError:p}=i;let m,g;const S=async(I=!0)=>{await g};async function $(){if("serviceWorker"in navigator){if(m=await _s(async()=>{const{Workbox:I}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:I}},[],import.meta.url).then(({Workbox:I})=>new I("./sw.js",{scope:"./",type:"classic"})).catch(I=>{p==null||p(I)}),!m)return;m.addEventListener("activated",I=>{(I.isUpdate||I.isExternal)&&window.location.reload()}),m.addEventListener("installed",I=>{I.isUpdate||s==null||s()}),m.register({immediate:n}).then(I=>{d?d("./sw.js",I):u==null||u(I)}).catch(I=>{p==null||p(I)})}}return g=$(),S}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Bi(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable})),o.push.apply(o,s)}return o}function de(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Bi(Object(o),!0).forEach(function(s){Es(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Bi(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function _r(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_r=function(n){return typeof n}:_r=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_r(i)}function Es(i,n,o){return n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function ve(){return ve=Object.assign||function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},ve.apply(this,arguments)}function Ss(i,n){if(i==null)return{};var o={},s=Object.keys(i),u,d;for(d=0;d<s.length;d++)u=s[d],!(n.indexOf(u)>=0)&&(o[u]=i[u]);return o}function xs(i,n){if(i==null)return{};var o=Ss(i,n),s,u;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(u=0;u<d.length;u++)s=d[u],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}var Ds="1.15.6";function ge(i){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(i)}var ye=ge(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Fn=ge(/Edge/i),Ri=ge(/firefox/i),Bn=ge(/safari/i)&&!ge(/chrome/i)&&!ge(/android/i),Fo=ge(/iP(ad|od|hone)/i),ea=ge(/chrome/i)&&ge(/android/i),na={capture:!1,passive:!1};function lt(i,n,o){i.addEventListener(n,o,!ye&&na)}function at(i,n,o){i.removeEventListener(n,o,!ye&&na)}function Or(i,n){if(n){if(n[0]===">"&&(n=n.substring(1)),i)try{if(i.matches)return i.matches(n);if(i.msMatchesSelector)return i.msMatchesSelector(n);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(n)}catch{return!1}return!1}}function ra(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function oe(i,n,o,s){if(i){o=o||document;do{if(n!=null&&(n[0]===">"?i.parentNode===o&&Or(i,n):Or(i,n))||s&&i===o)return i;if(i===o)break}while(i=ra(i))}return null}var Ni=/\s+/g;function Ht(i,n,o){if(i&&n)if(i.classList)i.classList[o?"add":"remove"](n);else{var s=(" "+i.className+" ").replace(Ni," ").replace(" "+n+" "," ");i.className=(s+(o?" "+n:"")).replace(Ni," ")}}function nt(i,n,o){var s=i&&i.style;if(s){if(o===void 0)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(o=i.currentStyle),n===void 0?o:o[n];!(n in s)&&n.indexOf("webkit")===-1&&(n="-webkit-"+n),s[n]=o+(typeof o=="string"?"":"px")}}function gn(i,n){var o="";if(typeof i=="string")o=i;else do{var s=nt(i,"transform");s&&s!=="none"&&(o=s+" "+o)}while(!n&&(i=i.parentNode));var u=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return u&&new u(o)}function oa(i,n,o){if(i){var s=i.getElementsByTagName(n),u=0,d=s.length;if(o)for(;u<d;u++)o(s[u],u);return s}return[]}function ce(){var i=document.scrollingElement;return i||document.documentElement}function At(i,n,o,s,u){if(!(!i.getBoundingClientRect&&i!==window)){var d,p,m,g,S,$,I;if(i!==window&&i.parentNode&&i!==ce()?(d=i.getBoundingClientRect(),p=d.top,m=d.left,g=d.bottom,S=d.right,$=d.height,I=d.width):(p=0,m=0,g=window.innerHeight,S=window.innerWidth,$=window.innerHeight,I=window.innerWidth),(n||o)&&i!==window&&(u=u||i.parentNode,!ye))do if(u&&u.getBoundingClientRect&&(nt(u,"transform")!=="none"||o&&nt(u,"position")!=="static")){var A=u.getBoundingClientRect();p-=A.top+parseInt(nt(u,"border-top-width")),m-=A.left+parseInt(nt(u,"border-left-width")),g=p+d.height,S=m+d.width;break}while(u=u.parentNode);if(s&&i!==window){var C=gn(u||i),L=C&&C.a,q=C&&C.d;C&&(p/=q,m/=L,I/=L,$/=q,g=p+$,S=m+I)}return{top:p,left:m,bottom:g,right:S,width:I,height:$}}}function Ki(i,n,o){for(var s=Ae(i,!0),u=At(i)[n];s;){var d=At(s)[o],p=void 0;if(p=u>=d,!p)return s;if(s===ce())break;s=Ae(s,!1)}return!1}function vn(i,n,o,s){for(var u=0,d=0,p=i.children;d<p.length;){if(p[d].style.display!=="none"&&p[d]!==rt.ghost&&(s||p[d]!==rt.dragged)&&oe(p[d],o.draggable,i,!1)){if(u===n)return p[d];u++}d++}return null}function Wo(i,n){for(var o=i.lastElementChild;o&&(o===rt.ghost||nt(o,"display")==="none"||n&&!Or(o,n));)o=o.previousElementSibling;return o||null}function Qt(i,n){var o=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==rt.clone&&(!n||Or(i,n))&&o++;return o}function qi(i){var n=0,o=0,s=ce();if(i)do{var u=gn(i),d=u.a,p=u.d;n+=i.scrollLeft*d,o+=i.scrollTop*p}while(i!==s&&(i=i.parentNode));return[n,o]}function Is(i,n){for(var o in i)if(i.hasOwnProperty(o)){for(var s in n)if(n.hasOwnProperty(s)&&n[s]===i[o][s])return Number(o)}return-1}function Ae(i,n){if(!i||!i.getBoundingClientRect)return ce();var o=i,s=!1;do if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var u=nt(o);if(o.clientWidth<o.scrollWidth&&(u.overflowX=="auto"||u.overflowX=="scroll")||o.clientHeight<o.scrollHeight&&(u.overflowY=="auto"||u.overflowY=="scroll")){if(!o.getBoundingClientRect||o===document.body)return ce();if(s||n)return o;s=!0}}while(o=o.parentNode);return ce()}function Ts(i,n){if(i&&n)for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o]);return i}function ko(i,n){return Math.round(i.top)===Math.round(n.top)&&Math.round(i.left)===Math.round(n.left)&&Math.round(i.height)===Math.round(n.height)&&Math.round(i.width)===Math.round(n.width)}var Rn;function ia(i,n){return function(){if(!Rn){var o=arguments,s=this;o.length===1?i.call(s,o[0]):i.apply(s,o),Rn=setTimeout(function(){Rn=void 0},n)}}}function Os(){clearTimeout(Rn),Rn=void 0}function aa(i,n,o){i.scrollLeft+=n,i.scrollTop+=o}function sa(i){var n=window.Polymer,o=window.jQuery||window.Zepto;return n&&n.dom?n.dom(i).cloneNode(!0):o?o(i).clone(!0)[0]:i.cloneNode(!0)}function la(i,n,o){var s={};return Array.from(i.children).forEach(function(u){var d,p,m,g;if(!(!oe(u,n.draggable,i,!1)||u.animated||u===o)){var S=At(u);s.left=Math.min((d=s.left)!==null&&d!==void 0?d:1/0,S.left),s.top=Math.min((p=s.top)!==null&&p!==void 0?p:1/0,S.top),s.right=Math.max((m=s.right)!==null&&m!==void 0?m:-1/0,S.right),s.bottom=Math.max((g=s.bottom)!==null&&g!==void 0?g:-1/0,S.bottom)}}),s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}var Ft="Sortable"+new Date().getTime();function As(){var i=[],n;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var s=[].slice.call(this.el.children);s.forEach(function(u){if(!(nt(u,"display")==="none"||u===rt.ghost)){i.push({target:u,rect:At(u)});var d=de({},i[i.length-1].rect);if(u.thisAnimationDuration){var p=gn(u,!0);p&&(d.top-=p.f,d.left-=p.e)}u.fromRect=d}})}},addAnimationState:function(s){i.push(s)},removeAnimationState:function(s){i.splice(Is(i,{target:s}),1)},animateAll:function(s){var u=this;if(!this.options.animation){clearTimeout(n),typeof s=="function"&&s();return}var d=!1,p=0;i.forEach(function(m){var g=0,S=m.target,$=S.fromRect,I=At(S),A=S.prevFromRect,C=S.prevToRect,L=m.rect,q=gn(S,!0);q&&(I.top-=q.f,I.left-=q.e),S.toRect=I,S.thisAnimationDuration&&ko(A,I)&&!ko($,I)&&(L.top-I.top)/(L.left-I.left)===($.top-I.top)/($.left-I.left)&&(g=Ps(L,A,C,u.options)),ko(I,$)||(S.prevFromRect=$,S.prevToRect=I,g||(g=u.options.animation),u.animate(S,L,I,g)),g&&(d=!0,p=Math.max(p,g),clearTimeout(S.animationResetTimer),S.animationResetTimer=setTimeout(function(){S.animationTime=0,S.prevFromRect=null,S.fromRect=null,S.prevToRect=null,S.thisAnimationDuration=null},g),S.thisAnimationDuration=g)}),clearTimeout(n),d?n=setTimeout(function(){typeof s=="function"&&s()},p):typeof s=="function"&&s(),i=[]},animate:function(s,u,d,p){if(p){nt(s,"transition",""),nt(s,"transform","");var m=gn(this.el),g=m&&m.a,S=m&&m.d,$=(u.left-d.left)/(g||1),I=(u.top-d.top)/(S||1);s.animatingX=!!$,s.animatingY=!!I,nt(s,"transform","translate3d("+$+"px,"+I+"px,0)"),this.forRepaintDummy=Cs(s),nt(s,"transition","transform "+p+"ms"+(this.options.easing?" "+this.options.easing:"")),nt(s,"transform","translate3d(0,0,0)"),typeof s.animated=="number"&&clearTimeout(s.animated),s.animated=setTimeout(function(){nt(s,"transition",""),nt(s,"transform",""),s.animated=!1,s.animatingX=!1,s.animatingY=!1},p)}}}}function Cs(i){return i.offsetWidth}function Ps(i,n,o,s){return Math.sqrt(Math.pow(n.top-i.top,2)+Math.pow(n.left-i.left,2))/Math.sqrt(Math.pow(n.top-o.top,2)+Math.pow(n.left-o.left,2))*s.animation}var ln=[],Eo={initializeByDefault:!0},Wn={mount:function(n){for(var o in Eo)Eo.hasOwnProperty(o)&&!(o in n)&&(n[o]=Eo[o]);ln.forEach(function(s){if(s.pluginName===n.pluginName)throw"Sortable: Cannot mount plugin ".concat(n.pluginName," more than once")}),ln.push(n)},pluginEvent:function(n,o,s){var u=this;this.eventCanceled=!1,s.cancel=function(){u.eventCanceled=!0};var d=n+"Global";ln.forEach(function(p){o[p.pluginName]&&(o[p.pluginName][d]&&o[p.pluginName][d](de({sortable:o},s)),o.options[p.pluginName]&&o[p.pluginName][n]&&o[p.pluginName][n](de({sortable:o},s)))})},initializePlugins:function(n,o,s,u){ln.forEach(function(m){var g=m.pluginName;if(!(!n.options[g]&&!m.initializeByDefault)){var S=new m(n,o,n.options);S.sortable=n,S.options=n.options,n[g]=S,ve(s,S.defaults)}});for(var d in n.options)if(n.options.hasOwnProperty(d)){var p=this.modifyOption(n,d,n.options[d]);typeof p<"u"&&(n.options[d]=p)}},getEventProperties:function(n,o){var s={};return ln.forEach(function(u){typeof u.eventProperties=="function"&&ve(s,u.eventProperties.call(o[u.pluginName],n))}),s},modifyOption:function(n,o,s){var u;return ln.forEach(function(d){n[d.pluginName]&&d.optionListeners&&typeof d.optionListeners[o]=="function"&&(u=d.optionListeners[o].call(n[d.pluginName],s))}),u}};function $s(i){var n=i.sortable,o=i.rootEl,s=i.name,u=i.targetEl,d=i.cloneEl,p=i.toEl,m=i.fromEl,g=i.oldIndex,S=i.newIndex,$=i.oldDraggableIndex,I=i.newDraggableIndex,A=i.originalEvent,C=i.putSortable,L=i.extraEventProperties;if(n=n||o&&o[Ft],!!n){var q,V=n.options,tt="on"+s.charAt(0).toUpperCase()+s.substr(1);window.CustomEvent&&!ye&&!Fn?q=new CustomEvent(s,{bubbles:!0,cancelable:!0}):(q=document.createEvent("Event"),q.initEvent(s,!0,!0)),q.to=p||o,q.from=m||o,q.item=u||o,q.clone=d,q.oldIndex=g,q.newIndex=S,q.oldDraggableIndex=$,q.newDraggableIndex=I,q.originalEvent=A,q.pullMode=C?C.lastPutMode:void 0;var z=de(de({},L),Wn.getEventProperties(s,n));for(var X in z)q[X]=z[X];o&&o.dispatchEvent(q),V[tt]&&V[tt].call(n,q)}}var Ls=["evt"],Kt=function(n,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=s.evt,d=xs(s,Ls);Wn.pluginEvent.bind(rt)(n,o,de({dragEl:K,parentEl:Dt,ghostEl:ot,rootEl:wt,nextEl:Ue,lastDownEl:kr,cloneEl:kt,cloneHidden:Te,dragStarted:$n,putSortable:Mt,activeSortable:rt.active,originalEvent:u,oldIndex:fn,oldDraggableIndex:Nn,newIndex:Vt,newDraggableIndex:Ie,hideGhostForTarget:fa,unhideGhostForTarget:pa,cloneNowHidden:function(){Te=!0},cloneNowShown:function(){Te=!1},dispatchSortableEvent:function(m){Nt({sortable:o,name:m,originalEvent:u})}},d))};function Nt(i){$s(de({putSortable:Mt,cloneEl:kt,targetEl:K,rootEl:wt,oldIndex:fn,oldDraggableIndex:Nn,newIndex:Vt,newDraggableIndex:Ie},i))}var K,Dt,ot,wt,Ue,kr,kt,Te,fn,Vt,Nn,Ie,vr,Mt,dn=!1,Ar=!1,Cr=[],qe,re,So,xo,Fi,Wi,$n,un,Kn,qn=!1,yr=!1,Er,Rt,Do=[],Lo=!1,Pr=[],Mr=typeof document<"u",br=Fo,Ui=Fn||ye?"cssFloat":"float",js=Mr&&!ea&&!Fo&&"draggable"in document.createElement("div"),ua=function(){if(Mr){if(ye)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),ca=function(n,o){var s=nt(n),u=parseInt(s.width)-parseInt(s.paddingLeft)-parseInt(s.paddingRight)-parseInt(s.borderLeftWidth)-parseInt(s.borderRightWidth),d=vn(n,0,o),p=vn(n,1,o),m=d&&nt(d),g=p&&nt(p),S=m&&parseInt(m.marginLeft)+parseInt(m.marginRight)+At(d).width,$=g&&parseInt(g.marginLeft)+parseInt(g.marginRight)+At(p).width;if(s.display==="flex")return s.flexDirection==="column"||s.flexDirection==="column-reverse"?"vertical":"horizontal";if(s.display==="grid")return s.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(d&&m.float&&m.float!=="none"){var I=m.float==="left"?"left":"right";return p&&(g.clear==="both"||g.clear===I)?"vertical":"horizontal"}return d&&(m.display==="block"||m.display==="flex"||m.display==="table"||m.display==="grid"||S>=u&&s[Ui]==="none"||p&&s[Ui]==="none"&&S+$>u)?"vertical":"horizontal"},Ms=function(n,o,s){var u=s?n.left:n.top,d=s?n.right:n.bottom,p=s?n.width:n.height,m=s?o.left:o.top,g=s?o.right:o.bottom,S=s?o.width:o.height;return u===m||d===g||u+p/2===m+S/2},Bs=function(n,o){var s;return Cr.some(function(u){var d=u[Ft].options.emptyInsertThreshold;if(!(!d||Wo(u))){var p=At(u),m=n>=p.left-d&&n<=p.right+d,g=o>=p.top-d&&o<=p.bottom+d;if(m&&g)return s=u}}),s},da=function(n){function o(d,p){return function(m,g,S,$){var I=m.options.group.name&&g.options.group.name&&m.options.group.name===g.options.group.name;if(d==null&&(p||I))return!0;if(d==null||d===!1)return!1;if(p&&d==="clone")return d;if(typeof d=="function")return o(d(m,g,S,$),p)(m,g,S,$);var A=(p?m:g).options.group.name;return d===!0||typeof d=="string"&&d===A||d.join&&d.indexOf(A)>-1}}var s={},u=n.group;(!u||_r(u)!="object")&&(u={name:u}),s.name=u.name,s.checkPull=o(u.pull,!0),s.checkPut=o(u.put),s.revertClone=u.revertClone,n.group=s},fa=function(){!ua&&ot&&nt(ot,"display","none")},pa=function(){!ua&&ot&&nt(ot,"display","")};Mr&&!ea&&document.addEventListener("click",function(i){if(Ar)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),Ar=!1,!1},!0);var Fe=function(n){if(K){n=n.touches?n.touches[0]:n;var o=Bs(n.clientX,n.clientY);if(o){var s={};for(var u in n)n.hasOwnProperty(u)&&(s[u]=n[u]);s.target=s.rootEl=o,s.preventDefault=void 0,s.stopPropagation=void 0,o[Ft]._onDragOver(s)}}},Rs=function(n){K&&K.parentNode[Ft]._isOutsideThisEl(n.target)};function rt(i,n){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=n=ve({},n),i[Ft]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return ca(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(p,m){p.setData("Text",m.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:rt.supportPointer!==!1&&"PointerEvent"in window&&(!Bn||Fo),emptyInsertThreshold:5};Wn.initializePlugins(this,i,o);for(var s in o)!(s in n)&&(n[s]=o[s]);da(n);for(var u in this)u.charAt(0)==="_"&&typeof this[u]=="function"&&(this[u]=this[u].bind(this));this.nativeDraggable=n.forceFallback?!1:js,this.nativeDraggable&&(this.options.touchStartThreshold=1),n.supportPointer?lt(i,"pointerdown",this._onTapStart):(lt(i,"mousedown",this._onTapStart),lt(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(lt(i,"dragover",this),lt(i,"dragenter",this)),Cr.push(this.el),n.store&&n.store.get&&this.sort(n.store.get(this)||[]),ve(this,As())}rt.prototype={constructor:rt,_isOutsideThisEl:function(n){!this.el.contains(n)&&n!==this.el&&(un=null)},_getDirection:function(n,o){return typeof this.options.direction=="function"?this.options.direction.call(this,n,o,K):this.options.direction},_onTapStart:function(n){if(n.cancelable){var o=this,s=this.el,u=this.options,d=u.preventOnFilter,p=n.type,m=n.touches&&n.touches[0]||n.pointerType&&n.pointerType==="touch"&&n,g=(m||n).target,S=n.target.shadowRoot&&(n.path&&n.path[0]||n.composedPath&&n.composedPath()[0])||g,$=u.filter;if(Ys(s),!K&&!(/mousedown|pointerdown/.test(p)&&n.button!==0||u.disabled)&&!S.isContentEditable&&!(!this.nativeDraggable&&Bn&&g&&g.tagName.toUpperCase()==="SELECT")&&(g=oe(g,u.draggable,s,!1),!(g&&g.animated)&&kr!==g)){if(fn=Qt(g),Nn=Qt(g,u.draggable),typeof $=="function"){if($.call(this,n,g,this)){Nt({sortable:o,rootEl:S,name:"filter",targetEl:g,toEl:s,fromEl:s}),Kt("filter",o,{evt:n}),d&&n.preventDefault();return}}else if($&&($=$.split(",").some(function(I){if(I=oe(S,I.trim(),s,!1),I)return Nt({sortable:o,rootEl:I,name:"filter",targetEl:g,fromEl:s,toEl:s}),Kt("filter",o,{evt:n}),!0}),$)){d&&n.preventDefault();return}u.handle&&!oe(S,u.handle,s,!1)||this._prepareDragStart(n,m,g)}}},_prepareDragStart:function(n,o,s){var u=this,d=u.el,p=u.options,m=d.ownerDocument,g;if(s&&!K&&s.parentNode===d){var S=At(s);if(wt=d,K=s,Dt=K.parentNode,Ue=K.nextSibling,kr=s,vr=p.group,rt.dragged=K,qe={target:K,clientX:(o||n).clientX,clientY:(o||n).clientY},Fi=qe.clientX-S.left,Wi=qe.clientY-S.top,this._lastX=(o||n).clientX,this._lastY=(o||n).clientY,K.style["will-change"]="all",g=function(){if(Kt("delayEnded",u,{evt:n}),rt.eventCanceled){u._onDrop();return}u._disableDelayedDragEvents(),!Ri&&u.nativeDraggable&&(K.draggable=!0),u._triggerDragStart(n,o),Nt({sortable:u,name:"choose",originalEvent:n}),Ht(K,p.chosenClass,!0)},p.ignore.split(",").forEach(function($){oa(K,$.trim(),Io)}),lt(m,"dragover",Fe),lt(m,"mousemove",Fe),lt(m,"touchmove",Fe),p.supportPointer?(lt(m,"pointerup",u._onDrop),!this.nativeDraggable&&lt(m,"pointercancel",u._onDrop)):(lt(m,"mouseup",u._onDrop),lt(m,"touchend",u._onDrop),lt(m,"touchcancel",u._onDrop)),Ri&&this.nativeDraggable&&(this.options.touchStartThreshold=4,K.draggable=!0),Kt("delayStart",this,{evt:n}),p.delay&&(!p.delayOnTouchOnly||o)&&(!this.nativeDraggable||!(Fn||ye))){if(rt.eventCanceled){this._onDrop();return}p.supportPointer?(lt(m,"pointerup",u._disableDelayedDrag),lt(m,"pointercancel",u._disableDelayedDrag)):(lt(m,"mouseup",u._disableDelayedDrag),lt(m,"touchend",u._disableDelayedDrag),lt(m,"touchcancel",u._disableDelayedDrag)),lt(m,"mousemove",u._delayedDragTouchMoveHandler),lt(m,"touchmove",u._delayedDragTouchMoveHandler),p.supportPointer&&lt(m,"pointermove",u._delayedDragTouchMoveHandler),u._dragStartTimer=setTimeout(g,p.delay)}else g()}},_delayedDragTouchMoveHandler:function(n){var o=n.touches?n.touches[0]:n;Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){K&&Io(K),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var n=this.el.ownerDocument;at(n,"mouseup",this._disableDelayedDrag),at(n,"touchend",this._disableDelayedDrag),at(n,"touchcancel",this._disableDelayedDrag),at(n,"pointerup",this._disableDelayedDrag),at(n,"pointercancel",this._disableDelayedDrag),at(n,"mousemove",this._delayedDragTouchMoveHandler),at(n,"touchmove",this._delayedDragTouchMoveHandler),at(n,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(n,o){o=o||n.pointerType=="touch"&&n,!this.nativeDraggable||o?this.options.supportPointer?lt(document,"pointermove",this._onTouchMove):o?lt(document,"touchmove",this._onTouchMove):lt(document,"mousemove",this._onTouchMove):(lt(K,"dragend",this),lt(wt,"dragstart",this._onDragStart));try{document.selection?Sr(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(n,o){if(dn=!1,wt&&K){Kt("dragStarted",this,{evt:o}),this.nativeDraggable&&lt(document,"dragover",Rs);var s=this.options;!n&&Ht(K,s.dragClass,!1),Ht(K,s.ghostClass,!0),rt.active=this,n&&this._appendGhost(),Nt({sortable:this,name:"start",originalEvent:o})}else this._nulling()},_emulateDragOver:function(){if(re){this._lastX=re.clientX,this._lastY=re.clientY,fa();for(var n=document.elementFromPoint(re.clientX,re.clientY),o=n;n&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(re.clientX,re.clientY),n!==o);)o=n;if(K.parentNode[Ft]._isOutsideThisEl(n),o)do{if(o[Ft]){var s=void 0;if(s=o[Ft]._onDragOver({clientX:re.clientX,clientY:re.clientY,target:n,rootEl:o}),s&&!this.options.dragoverBubble)break}n=o}while(o=ra(o));pa()}},_onTouchMove:function(n){if(qe){var o=this.options,s=o.fallbackTolerance,u=o.fallbackOffset,d=n.touches?n.touches[0]:n,p=ot&&gn(ot,!0),m=ot&&p&&p.a,g=ot&&p&&p.d,S=br&&Rt&&qi(Rt),$=(d.clientX-qe.clientX+u.x)/(m||1)+(S?S[0]-Do[0]:0)/(m||1),I=(d.clientY-qe.clientY+u.y)/(g||1)+(S?S[1]-Do[1]:0)/(g||1);if(!rt.active&&!dn){if(s&&Math.max(Math.abs(d.clientX-this._lastX),Math.abs(d.clientY-this._lastY))<s)return;this._onDragStart(n,!0)}if(ot){p?(p.e+=$-(So||0),p.f+=I-(xo||0)):p={a:1,b:0,c:0,d:1,e:$,f:I};var A="matrix(".concat(p.a,",").concat(p.b,",").concat(p.c,",").concat(p.d,",").concat(p.e,",").concat(p.f,")");nt(ot,"webkitTransform",A),nt(ot,"mozTransform",A),nt(ot,"msTransform",A),nt(ot,"transform",A),So=$,xo=I,re=d}n.cancelable&&n.preventDefault()}},_appendGhost:function(){if(!ot){var n=this.options.fallbackOnBody?document.body:wt,o=At(K,!0,br,!0,n),s=this.options;if(br){for(Rt=n;nt(Rt,"position")==="static"&&nt(Rt,"transform")==="none"&&Rt!==document;)Rt=Rt.parentNode;Rt!==document.body&&Rt!==document.documentElement?(Rt===document&&(Rt=ce()),o.top+=Rt.scrollTop,o.left+=Rt.scrollLeft):Rt=ce(),Do=qi(Rt)}ot=K.cloneNode(!0),Ht(ot,s.ghostClass,!1),Ht(ot,s.fallbackClass,!0),Ht(ot,s.dragClass,!0),nt(ot,"transition",""),nt(ot,"transform",""),nt(ot,"box-sizing","border-box"),nt(ot,"margin",0),nt(ot,"top",o.top),nt(ot,"left",o.left),nt(ot,"width",o.width),nt(ot,"height",o.height),nt(ot,"opacity","0.8"),nt(ot,"position",br?"absolute":"fixed"),nt(ot,"zIndex","100000"),nt(ot,"pointerEvents","none"),rt.ghost=ot,n.appendChild(ot),nt(ot,"transform-origin",Fi/parseInt(ot.style.width)*100+"% "+Wi/parseInt(ot.style.height)*100+"%")}},_onDragStart:function(n,o){var s=this,u=n.dataTransfer,d=s.options;if(Kt("dragStart",this,{evt:n}),rt.eventCanceled){this._onDrop();return}Kt("setupClone",this),rt.eventCanceled||(kt=sa(K),kt.removeAttribute("id"),kt.draggable=!1,kt.style["will-change"]="",this._hideClone(),Ht(kt,this.options.chosenClass,!1),rt.clone=kt),s.cloneId=Sr(function(){Kt("clone",s),!rt.eventCanceled&&(s.options.removeCloneOnHide||wt.insertBefore(kt,K),s._hideClone(),Nt({sortable:s,name:"clone"}))}),!o&&Ht(K,d.dragClass,!0),o?(Ar=!0,s._loopId=setInterval(s._emulateDragOver,50)):(at(document,"mouseup",s._onDrop),at(document,"touchend",s._onDrop),at(document,"touchcancel",s._onDrop),u&&(u.effectAllowed="move",d.setData&&d.setData.call(s,u,K)),lt(document,"drop",s),nt(K,"transform","translateZ(0)")),dn=!0,s._dragStartId=Sr(s._dragStarted.bind(s,o,n)),lt(document,"selectstart",s),$n=!0,window.getSelection().removeAllRanges(),Bn&&nt(document.body,"user-select","none")},_onDragOver:function(n){var o=this.el,s=n.target,u,d,p,m=this.options,g=m.group,S=rt.active,$=vr===g,I=m.sort,A=Mt||S,C,L=this,q=!1;if(Lo)return;function V(Ut,be){Kt(Ut,L,de({evt:n,isOwner:$,axis:C?"vertical":"horizontal",revert:p,dragRect:u,targetRect:d,canSort:I,fromSortable:A,target:s,completed:z,onMove:function(Ve,ee){return wr(wt,o,K,u,Ve,At(Ve),n,ee)},changed:X},be))}function tt(){V("dragOverAnimationCapture"),L.captureAnimationState(),L!==A&&A.captureAnimationState()}function z(Ut){return V("dragOverCompleted",{insertion:Ut}),Ut&&($?S._hideClone():S._showClone(L),L!==A&&(Ht(K,Mt?Mt.options.ghostClass:S.options.ghostClass,!1),Ht(K,m.ghostClass,!0)),Mt!==L&&L!==rt.active?Mt=L:L===rt.active&&Mt&&(Mt=null),A===L&&(L._ignoreWhileAnimating=s),L.animateAll(function(){V("dragOverAnimationComplete"),L._ignoreWhileAnimating=null}),L!==A&&(A.animateAll(),A._ignoreWhileAnimating=null)),(s===K&&!K.animated||s===o&&!s.animated)&&(un=null),!m.dragoverBubble&&!n.rootEl&&s!==document&&(K.parentNode[Ft]._isOutsideThisEl(n.target),!Ut&&Fe(n)),!m.dragoverBubble&&n.stopPropagation&&n.stopPropagation(),q=!0}function X(){Vt=Qt(K),Ie=Qt(K,m.draggable),Nt({sortable:L,name:"change",toEl:o,newIndex:Vt,newDraggableIndex:Ie,originalEvent:n})}if(n.preventDefault!==void 0&&n.cancelable&&n.preventDefault(),s=oe(s,m.draggable,o,!0),V("dragOver"),rt.eventCanceled)return q;if(K.contains(n.target)||s.animated&&s.animatingX&&s.animatingY||L._ignoreWhileAnimating===s)return z(!1);if(Ar=!1,S&&!m.disabled&&($?I||(p=Dt!==wt):Mt===this||(this.lastPutMode=vr.checkPull(this,S,K,n))&&g.checkPut(this,S,K,n))){if(C=this._getDirection(n,s)==="vertical",u=At(K),V("dragOverValid"),rt.eventCanceled)return q;if(p)return Dt=wt,tt(),this._hideClone(),V("revert"),rt.eventCanceled||(Ue?wt.insertBefore(K,Ue):wt.appendChild(K)),z(!0);var et=Wo(o,m.draggable);if(!et||Fs(n,C,this)&&!et.animated){if(et===K)return z(!1);if(et&&o===n.target&&(s=et),s&&(d=At(s)),wr(wt,o,K,u,s,d,n,!!s)!==!1)return tt(),et&&et.nextSibling?o.insertBefore(K,et.nextSibling):o.appendChild(K),Dt=o,X(),z(!0)}else if(et&&qs(n,C,this)){var ct=vn(o,0,m,!0);if(ct===K)return z(!1);if(s=ct,d=At(s),wr(wt,o,K,u,s,d,n,!1)!==!1)return tt(),o.insertBefore(K,ct),Dt=o,X(),z(!0)}else if(s.parentNode===o){d=At(s);var gt=0,dt,ht=K.parentNode!==o,Lt=!Ms(K.animated&&K.toRect||u,s.animated&&s.toRect||d,C),ie=C?"top":"left",Zt=Ki(s,"top","top")||Ki(K,"top","top"),te=Zt?Zt.scrollTop:void 0;un!==s&&(dt=d[ie],qn=!1,yr=!Lt&&m.invertSwap||ht),gt=Ws(n,s,d,C,Lt?1:m.swapThreshold,m.invertedSwapThreshold==null?m.swapThreshold:m.invertedSwapThreshold,yr,un===s);var jt;if(gt!==0){var fe=Qt(K);do fe-=gt,jt=Dt.children[fe];while(jt&&(nt(jt,"display")==="none"||jt===ot))}if(gt===0||jt===s)return z(!1);un=s,Kn=gt;var pe=s.nextElementSibling,Xt=!1;Xt=gt===1;var He=wr(wt,o,K,u,s,d,n,Xt);if(He!==!1)return(He===1||He===-1)&&(Xt=He===1),Lo=!0,setTimeout(Ks,30),tt(),Xt&&!pe?o.appendChild(K):s.parentNode.insertBefore(K,Xt?pe:s),Zt&&aa(Zt,0,te-Zt.scrollTop),Dt=K.parentNode,dt!==void 0&&!yr&&(Er=Math.abs(dt-At(s)[ie])),X(),z(!0)}if(o.contains(K))return z(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){at(document,"mousemove",this._onTouchMove),at(document,"touchmove",this._onTouchMove),at(document,"pointermove",this._onTouchMove),at(document,"dragover",Fe),at(document,"mousemove",Fe),at(document,"touchmove",Fe)},_offUpEvents:function(){var n=this.el.ownerDocument;at(n,"mouseup",this._onDrop),at(n,"touchend",this._onDrop),at(n,"pointerup",this._onDrop),at(n,"pointercancel",this._onDrop),at(n,"touchcancel",this._onDrop),at(document,"selectstart",this)},_onDrop:function(n){var o=this.el,s=this.options;if(Vt=Qt(K),Ie=Qt(K,s.draggable),Kt("drop",this,{evt:n}),Dt=K&&K.parentNode,Vt=Qt(K),Ie=Qt(K,s.draggable),rt.eventCanceled){this._nulling();return}dn=!1,yr=!1,qn=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),jo(this.cloneId),jo(this._dragStartId),this.nativeDraggable&&(at(document,"drop",this),at(o,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Bn&&nt(document.body,"user-select",""),nt(K,"transform",""),n&&($n&&(n.cancelable&&n.preventDefault(),!s.dropBubble&&n.stopPropagation()),ot&&ot.parentNode&&ot.parentNode.removeChild(ot),(wt===Dt||Mt&&Mt.lastPutMode!=="clone")&&kt&&kt.parentNode&&kt.parentNode.removeChild(kt),K&&(this.nativeDraggable&&at(K,"dragend",this),Io(K),K.style["will-change"]="",$n&&!dn&&Ht(K,Mt?Mt.options.ghostClass:this.options.ghostClass,!1),Ht(K,this.options.chosenClass,!1),Nt({sortable:this,name:"unchoose",toEl:Dt,newIndex:null,newDraggableIndex:null,originalEvent:n}),wt!==Dt?(Vt>=0&&(Nt({rootEl:Dt,name:"add",toEl:Dt,fromEl:wt,originalEvent:n}),Nt({sortable:this,name:"remove",toEl:Dt,originalEvent:n}),Nt({rootEl:Dt,name:"sort",toEl:Dt,fromEl:wt,originalEvent:n}),Nt({sortable:this,name:"sort",toEl:Dt,originalEvent:n})),Mt&&Mt.save()):Vt!==fn&&Vt>=0&&(Nt({sortable:this,name:"update",toEl:Dt,originalEvent:n}),Nt({sortable:this,name:"sort",toEl:Dt,originalEvent:n})),rt.active&&((Vt==null||Vt===-1)&&(Vt=fn,Ie=Nn),Nt({sortable:this,name:"end",toEl:Dt,originalEvent:n}),this.save()))),this._nulling()},_nulling:function(){Kt("nulling",this),wt=K=Dt=ot=Ue=kt=kr=Te=qe=re=$n=Vt=Ie=fn=Nn=un=Kn=Mt=vr=rt.dragged=rt.ghost=rt.clone=rt.active=null,Pr.forEach(function(n){n.checked=!0}),Pr.length=So=xo=0},handleEvent:function(n){switch(n.type){case"drop":case"dragend":this._onDrop(n);break;case"dragenter":case"dragover":K&&(this._onDragOver(n),Ns(n));break;case"selectstart":n.preventDefault();break}},toArray:function(){for(var n=[],o,s=this.el.children,u=0,d=s.length,p=this.options;u<d;u++)o=s[u],oe(o,p.draggable,this.el,!1)&&n.push(o.getAttribute(p.dataIdAttr)||zs(o));return n},sort:function(n,o){var s={},u=this.el;this.toArray().forEach(function(d,p){var m=u.children[p];oe(m,this.options.draggable,u,!1)&&(s[d]=m)},this),o&&this.captureAnimationState(),n.forEach(function(d){s[d]&&(u.removeChild(s[d]),u.appendChild(s[d]))}),o&&this.animateAll()},save:function(){var n=this.options.store;n&&n.set&&n.set(this)},closest:function(n,o){return oe(n,o||this.options.draggable,this.el,!1)},option:function(n,o){var s=this.options;if(o===void 0)return s[n];var u=Wn.modifyOption(this,n,o);typeof u<"u"?s[n]=u:s[n]=o,n==="group"&&da(s)},destroy:function(){Kt("destroy",this);var n=this.el;n[Ft]=null,at(n,"mousedown",this._onTapStart),at(n,"touchstart",this._onTapStart),at(n,"pointerdown",this._onTapStart),this.nativeDraggable&&(at(n,"dragover",this),at(n,"dragenter",this)),Array.prototype.forEach.call(n.querySelectorAll("[draggable]"),function(o){o.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Cr.splice(Cr.indexOf(this.el),1),this.el=n=null},_hideClone:function(){if(!Te){if(Kt("hideClone",this),rt.eventCanceled)return;nt(kt,"display","none"),this.options.removeCloneOnHide&&kt.parentNode&&kt.parentNode.removeChild(kt),Te=!0}},_showClone:function(n){if(n.lastPutMode!=="clone"){this._hideClone();return}if(Te){if(Kt("showClone",this),rt.eventCanceled)return;K.parentNode==wt&&!this.options.group.revertClone?wt.insertBefore(kt,K):Ue?wt.insertBefore(kt,Ue):wt.appendChild(kt),this.options.group.revertClone&&this.animate(K,kt),nt(kt,"display",""),Te=!1}}};function Ns(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function wr(i,n,o,s,u,d,p,m){var g,S=i[Ft],$=S.options.onMove,I;return window.CustomEvent&&!ye&&!Fn?g=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(g=document.createEvent("Event"),g.initEvent("move",!0,!0)),g.to=n,g.from=i,g.dragged=o,g.draggedRect=s,g.related=u||n,g.relatedRect=d||At(n),g.willInsertAfter=m,g.originalEvent=p,i.dispatchEvent(g),$&&(I=$.call(S,g,p)),I}function Io(i){i.draggable=!1}function Ks(){Lo=!1}function qs(i,n,o){var s=At(vn(o.el,0,o.options,!0)),u=la(o.el,o.options,ot),d=10;return n?i.clientX<u.left-d||i.clientY<s.top&&i.clientX<s.right:i.clientY<u.top-d||i.clientY<s.bottom&&i.clientX<s.left}function Fs(i,n,o){var s=At(Wo(o.el,o.options.draggable)),u=la(o.el,o.options,ot),d=10;return n?i.clientX>u.right+d||i.clientY>s.bottom&&i.clientX>s.left:i.clientY>u.bottom+d||i.clientX>s.right&&i.clientY>s.top}function Ws(i,n,o,s,u,d,p,m){var g=s?i.clientY:i.clientX,S=s?o.height:o.width,$=s?o.top:o.left,I=s?o.bottom:o.right,A=!1;if(!p){if(m&&Er<S*u){if(!qn&&(Kn===1?g>$+S*d/2:g<I-S*d/2)&&(qn=!0),qn)A=!0;else if(Kn===1?g<$+Er:g>I-Er)return-Kn}else if(g>$+S*(1-u)/2&&g<I-S*(1-u)/2)return Us(n)}return A=A||p,A&&(g<$+S*d/2||g>I-S*d/2)?g>$+S/2?1:-1:0}function Us(i){return Qt(K)<Qt(i)?1:-1}function zs(i){for(var n=i.tagName+i.className+i.src+i.href+i.textContent,o=n.length,s=0;o--;)s+=n.charCodeAt(o);return s.toString(36)}function Ys(i){Pr.length=0;for(var n=i.getElementsByTagName("input"),o=n.length;o--;){var s=n[o];s.checked&&Pr.push(s)}}function Sr(i){return setTimeout(i,0)}function jo(i){return clearTimeout(i)}Mr&&lt(document,"touchmove",function(i){(rt.active||dn)&&i.cancelable&&i.preventDefault()});rt.utils={on:lt,off:at,css:nt,find:oa,is:function(n,o){return!!oe(n,o,n,!1)},extend:Ts,throttle:ia,closest:oe,toggleClass:Ht,clone:sa,index:Qt,nextTick:Sr,cancelNextTick:jo,detectDirection:ca,getChild:vn,expando:Ft};rt.get=function(i){return i[Ft]};rt.mount=function(){for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];n[0].constructor===Array&&(n=n[0]),n.forEach(function(s){if(!s.prototype||!s.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(s));s.utils&&(rt.utils=de(de({},rt.utils),s.utils)),Wn.mount(s)})};rt.create=function(i,n){return new rt(i,n)};rt.version=Ds;var Ot=[],Ln,Mo,Bo=!1,To,Oo,$r,jn;function Hs(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this))}return i.prototype={dragStarted:function(o){var s=o.originalEvent;this.sortable.nativeDraggable?lt(document,"dragover",this._handleAutoScroll):this.options.supportPointer?lt(document,"pointermove",this._handleFallbackAutoScroll):s.touches?lt(document,"touchmove",this._handleFallbackAutoScroll):lt(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(o){var s=o.originalEvent;!this.options.dragOverBubble&&!s.rootEl&&this._handleAutoScroll(s)},drop:function(){this.sortable.nativeDraggable?at(document,"dragover",this._handleAutoScroll):(at(document,"pointermove",this._handleFallbackAutoScroll),at(document,"touchmove",this._handleFallbackAutoScroll),at(document,"mousemove",this._handleFallbackAutoScroll)),zi(),xr(),Os()},nulling:function(){$r=Mo=Ln=Bo=jn=To=Oo=null,Ot.length=0},_handleFallbackAutoScroll:function(o){this._handleAutoScroll(o,!0)},_handleAutoScroll:function(o,s){var u=this,d=(o.touches?o.touches[0]:o).clientX,p=(o.touches?o.touches[0]:o).clientY,m=document.elementFromPoint(d,p);if($r=o,s||this.options.forceAutoScrollFallback||Fn||ye||Bn){Ao(o,this.options,m,s);var g=Ae(m,!0);Bo&&(!jn||d!==To||p!==Oo)&&(jn&&zi(),jn=setInterval(function(){var S=Ae(document.elementFromPoint(d,p),!0);S!==g&&(g=S,xr()),Ao(o,u.options,S,s)},10),To=d,Oo=p)}else{if(!this.options.bubbleScroll||Ae(m,!0)===ce()){xr();return}Ao(o,this.options,Ae(m,!1),!1)}}},ve(i,{pluginName:"scroll",initializeByDefault:!0})}function xr(){Ot.forEach(function(i){clearInterval(i.pid)}),Ot=[]}function zi(){clearInterval(jn)}var Ao=ia(function(i,n,o,s){if(n.scroll){var u=(i.touches?i.touches[0]:i).clientX,d=(i.touches?i.touches[0]:i).clientY,p=n.scrollSensitivity,m=n.scrollSpeed,g=ce(),S=!1,$;Mo!==o&&(Mo=o,xr(),Ln=n.scroll,$=n.scrollFn,Ln===!0&&(Ln=Ae(o,!0)));var I=0,A=Ln;do{var C=A,L=At(C),q=L.top,V=L.bottom,tt=L.left,z=L.right,X=L.width,et=L.height,ct=void 0,gt=void 0,dt=C.scrollWidth,ht=C.scrollHeight,Lt=nt(C),ie=C.scrollLeft,Zt=C.scrollTop;C===g?(ct=X<dt&&(Lt.overflowX==="auto"||Lt.overflowX==="scroll"||Lt.overflowX==="visible"),gt=et<ht&&(Lt.overflowY==="auto"||Lt.overflowY==="scroll"||Lt.overflowY==="visible")):(ct=X<dt&&(Lt.overflowX==="auto"||Lt.overflowX==="scroll"),gt=et<ht&&(Lt.overflowY==="auto"||Lt.overflowY==="scroll"));var te=ct&&(Math.abs(z-u)<=p&&ie+X<dt)-(Math.abs(tt-u)<=p&&!!ie),jt=gt&&(Math.abs(V-d)<=p&&Zt+et<ht)-(Math.abs(q-d)<=p&&!!Zt);if(!Ot[I])for(var fe=0;fe<=I;fe++)Ot[fe]||(Ot[fe]={});(Ot[I].vx!=te||Ot[I].vy!=jt||Ot[I].el!==C)&&(Ot[I].el=C,Ot[I].vx=te,Ot[I].vy=jt,clearInterval(Ot[I].pid),(te!=0||jt!=0)&&(S=!0,Ot[I].pid=setInterval((function(){s&&this.layer===0&&rt.active._onTouchMove($r);var pe=Ot[this.layer].vy?Ot[this.layer].vy*m:0,Xt=Ot[this.layer].vx?Ot[this.layer].vx*m:0;typeof $=="function"&&$.call(rt.dragged.parentNode[Ft],Xt,pe,i,$r,Ot[this.layer].el)!=="continue"||aa(Ot[this.layer].el,Xt,pe)}).bind({layer:I}),24))),I++}while(n.bubbleScroll&&A!==g&&(A=Ae(A,!1)));Bo=S}},30),ha=function(n){var o=n.originalEvent,s=n.putSortable,u=n.dragEl,d=n.activeSortable,p=n.dispatchSortableEvent,m=n.hideGhostForTarget,g=n.unhideGhostForTarget;if(o){var S=s||d;m();var $=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:o,I=document.elementFromPoint($.clientX,$.clientY);g(),S&&!S.el.contains(I)&&(p("spill"),this.onSpill({dragEl:u,putSortable:s}))}};function Uo(){}Uo.prototype={startIndex:null,dragStart:function(n){var o=n.oldDraggableIndex;this.startIndex=o},onSpill:function(n){var o=n.dragEl,s=n.putSortable;this.sortable.captureAnimationState(),s&&s.captureAnimationState();var u=vn(this.sortable.el,this.startIndex,this.options);u?this.sortable.el.insertBefore(o,u):this.sortable.el.appendChild(o),this.sortable.animateAll(),s&&s.animateAll()},drop:ha};ve(Uo,{pluginName:"revertOnSpill"});function zo(){}zo.prototype={onSpill:function(n){var o=n.dragEl,s=n.putSortable,u=s||this.sortable;u.captureAnimationState(),o.parentNode&&o.parentNode.removeChild(o),u.animateAll()},drop:ha};ve(zo,{pluginName:"removeOnSpill"});rt.mount(new Hs);rt.mount(zo,Uo);function Lr(i,n,o){const s=new Blob([i],{type:o}),u=URL.createObjectURL(s),d=document.createElement("a");d.href=u,d.download=n,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(u)}function ma(i){const{profile:n,workoutTypes:o,workouts:s,logs:u}=i,d=[];d.push("# ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº"),n&&(d.push(`
## ÐÑÐ¾ÑÐ¸Ð»Ñ`),d.push(`- **ÐÐ¼Ñ:** ${n.displayName||"ÐÐµ ÑÐºÐ°Ð·Ð°Ð½Ð¾"}`),n.telegramUsername&&d.push(`- **Username:** @${n.telegramUsername}`),d.push(`- **ID:** ${n.id}`),d.push(`- **ÐÐ°ÑÐ° ÑÐµÐ³Ð¸ÑÑÑÐ°ÑÐ¸Ð¸:** ${new Date(n.createdAt).toLocaleDateString()}`)),d.push(`
## Ð¢Ð¸Ð¿Ñ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹`);const p=o.filter(S=>!S.isDeleted);if(p.length>0?p.sort((S,$)=>(S.order??0)-($.order??0)).forEach(S=>{d.push(`- ${S.name} (${S.category==="time"?"ÐÐ° Ð²ÑÐµÐ¼Ñ":"Ð¡Ð¸Ð»Ð¾Ð²Ð¾Ðµ"})`)}):d.push("_ÐÐµÑ Ð°ÐºÑÐ¸Ð²Ð½ÑÑ ÑÐ¸Ð¿Ð¾Ð² ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹_"),d.push(`
## ÐÑÑÐ¾ÑÐ¸Ñ`),u.length===0)return d.push("_ÐÑÑÐ¾ÑÐ¸Ñ Ð¿ÑÑÑÐ°_"),d.join(`
`);const m=new Map;return[...u].filter(S=>!S.isDeleted).sort((S,$)=>new Date($.date).getTime()-new Date(S.date).getTime()).forEach(S=>{const $=new Date(S.date).toLocaleDateString();m.has($)||m.set($,[]),m.get($).push(S)}),m.forEach((S,$)=>{d.push(`
### ${$}`),Array.from(new Set(S.map(A=>A.workoutId).filter(Boolean))).forEach(A=>{const C=s.find(V=>V.id===A),L=S.filter(V=>V.workoutId===A);C&&C.name&&d.push(`
#### ${C.name}`);const q=new Map;L.forEach(V=>{q.has(V.workoutTypeId)||q.set(V.workoutTypeId,[]),q.get(V.workoutTypeId).push(V)}),q.forEach((V,tt)=>{const z=o.find(et=>et.id===tt),X=(z==null?void 0:z.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑÐ½Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ";d.push(`- **${X}**: ${V.map(et=>Vs(et)).join(", ")}`)})})}),d.join(`
`)}function Vs(i){return i.duration!==void 0?`${i.duration} Ð¼Ð¸Ð½`:`${i.weight}ÐºÐ³ Ã ${i.reps}`}function ga(i,n){const o=i.totalVolume;let s="";return o<1e3?s=`${Math.round(o)}ÐºÐ³`:o<1e4?s=`${(o/1e3).toFixed(1)}Ñ`:s=`${Math.round(o/1e3)}Ñ`,`
      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-value">${i.totalWorkouts}</div>
          <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${s}</div>
          <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
        </div>
        ${i.favoriteExercise?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${i.favoriteExercise}</div>
            <div class="stat-label">ÐÑÐ±Ð¸Ð¼Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</div>
          </div>
        `:""}
        ${i.lastWorkoutDate?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${new Date(i.lastWorkoutDate).toLocaleDateString()}</div>
            <div class="stat-label">ÐÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</div>
          </div>
        `:""}
      </div>

      ${n&&n.size>0?`
        <div class="activity-list">
          <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          ${Ji(n)}
        </div>
      `:""}
    `}const yn=i=>`https://tadatuta.github.io/21/?startapp=profile_${i}`;ks({immediate:!0});var Xi;const mt=(Xi=window.Telegram)==null?void 0:Xi.WebApp;mt&&(mt.ready(),mt.expand());let qt="main",pn="all",Et=null,va=null,jr=null,Ro=!1,Mn=null,Jt=null,Dr="overview",Ye="ai",Yo=!1,hn={general:null,plan:null},mn="idle",Ir=!1;function Xs(i){qt=i,$t()}let Co=null;function St(i){let n=document.querySelector(".toast");n||(n=document.createElement("div"),n.className="toast",document.body.appendChild(n)),n.textContent=i,n.classList.add("visible"),Co&&clearTimeout(Co),Co=setTimeout(()=>{n==null||n.classList.remove("visible")},2e3)}function $t(){const i=document.getElementById("app");if(!i)return;const n=localStorage.getItem("skip_tma_auth")==="true",o=!!(mt!=null&&mt.initData)&&!n,u=!!qo();!o&&!u||(i.innerHTML=`
    <main class="content">
      ${Gs()}
    </main>
    <nav class="navigation">
      <button class="navigation__item ${qt==="main"?"navigation__item_active":""}" data-page="main">
        <span class="navigation__icon">ðï¸</span>
        <span class="navigation__label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</span>
      </button>
      <button class="navigation__item ${qt==="stats"?"navigation__item_active":""}" data-page="stats">
        <span class="navigation__icon">ð</span>
        <span class="navigation__label">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</span>
      </button>
      <button class="navigation__item ${qt==="profile-settings"?"navigation__item_active":""}" data-page="profile-settings">
        <span class="navigation__icon">ð¤</span>
        <span class="navigation__label">ÐÑÐ¾ÑÐ¸Ð»Ñ</span>
      </button>
      <button class="navigation__item ${qt==="settings"?"navigation__item_active":""}" data-page="settings">
        <span class="navigation__icon">âï¸</span>
        <span class="navigation__label">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</span>
      </button>
    </nav>
    <div id="sync-status" class="sync-status"></div>
  `,i.querySelectorAll(".navigation__item").forEach(d=>{d.addEventListener("click",()=>{const p=d.getAttribute("data-page");Xs(p)})}),al(),wa())}let ya="idle";H.onSyncStatusChange(i=>{ya=i,Ho()});H.onUnauthorized(()=>{const i=document.getElementById("app");i&&ta(i,()=>{location.reload()})});function Ho(){const i=document.getElementById("sync-status");if(!i)return;i.className="sync-status";let n="",o="";switch(ya){case"saving":n="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...",o="ð",i.classList.add("sync-status_saving");break;case"success":n="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾",o="â",i.classList.add("sync-status_success");break;case"error":n="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸",o="â ï¸",i.classList.add("sync-status_error");break;case"idle":if(!navigator.onLine)n="ÐÑÑÐ»Ð°Ð¹Ð½",o="ð¡",i.classList.add("sync-status_offline");else return;break}i.innerHTML=`${o} ${n}`}window.addEventListener("online",()=>{H.sync(),Ho()});window.addEventListener("offline",()=>Ho());function Gs(){switch(qt){case"main":return Qs();case"stats":return ol();case"settings":return Zs();case"profile-settings":return tl();case"public-profile":return rl();default:return""}}function ba(){const i=H.getActiveWorkout();if(i){const n=i.status==="paused";return`
      <div class="workout-controls card">
        <div class="workout-controls__header">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span class="workout-status ${n?"workout-status_paused":""}">
              ${n?"â¸ï¸ ÐÐ°ÑÐ·Ð°":"ð¥ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° Ð°ÐºÑÐ¸Ð²Ð½Ð°"}
            </span>
            <span class="workout-timer">00:00</span>
          </div>
          ${i.name?`<span class="workout-name">${i.name}</span>`:""}
        </div>
        <div class="workout-controls__actions">
          ${n?'<button class="button" id="resume-workout-btn">ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ</button>':'<button class="button button_secondary" id="pause-workout-btn">ÐÐ°ÑÐ·Ð°</button>'}
          <button class="button button_destructive" id="finish-workout-btn">ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ</button>
        </div>
      </div>
    `}return Ir?`
      <div class="workout-controls card">
        <h3 class="subtitle" style="margin-top: 0">ÐÐ°ÑÐ°Ð»Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</h3>
        <form id="start-workout-form" style="display: flex; flex-direction: column; gap: 12px;">
          <input class="input" type="text" name="workoutName" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð¾Ð¿ÑÐ¸Ð¾Ð½Ð°Ð»ÑÐ½Ð¾)">
          <div style="display: flex; gap: 8px;">
            <button class="button" type="submit">ÐÐ°ÑÐ°ÑÑ</button>
            <button class="button button_secondary" type="button" id="cancel-start-workout-btn">ÐÑÐ¼ÐµÐ½Ð°</button>
          </div>
        </form>
      </div>
    `:`
    <button class="button" id="start-workout-btn" style="margin-bottom: 24px;">â¶ï¸ ÐÐ°ÑÐ°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ</button>
  `}let Oe=null;function Yi(){const i=H.getActiveWorkout(),n=document.querySelector(".workout-timer");if(!i||!n){Oe&&(clearInterval(Oe),Oe=null);return}const o=new Date(i.startTime).getTime(),s=Date.now();let u=s-o;i.pauseIntervals.forEach(g=>{const S=new Date(g.start).getTime(),$=g.end?new Date(g.end).getTime():(i.status==="paused",s);$>S&&(u-=$-S)});const d=Math.floor(Math.max(0,u)/1e3),p=Math.floor(d/60),m=d%60;n.textContent=`${p.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`}function wa(){const i=H.getActiveWorkout();Yi(),i&&i.status==="active"?Oe||(Oe=setInterval(Yi,1e3)):Oe&&(clearInterval(Oe),Oe=null)}let Wt=0,No="";function Vo(i){const n=new Date;n.setHours(0,0,0,0);const o=new Date(n);o.setDate(n.getDate()-i*7),o.setHours(23,59,59,999);const s=new Date(o);return s.setDate(o.getDate()-6),s.setHours(0,0,0,0),{start:s,end:o,label:`${s.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})} - ${o.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}`}}function Qs(){var p;const i=H.getWorkoutTypes(),n=H.getLogs(),o=n[n.length-1],s=o==null?void 0:o.workoutTypeId,u=Et?n.find(m=>m.id===Et):null,{label:d}=Vo(Wt);return`
    <div class="page-content" id="main-content">
      ${ba()}
      <h1 class="title">${Et?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´ÑÐ¾Ð´Ð°":"ÐÐ¾Ð²ÑÐ¹ Ð¿Ð¾Ð´ÑÐ¾Ð´"}</h1>
      <form class="workout-form" id="log-form">
        <div class="form-group">
          <label class="label">Ð¢Ð¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</label>
          <select class="select" name="typeId" id="workout-type-select" required>
            ${i.map(m=>`<option value="${m.id}" ${(Et?u&&m.id===u.workoutTypeId:m.id===s)?"selected":""}>${m.name}</option>`).join("")}
          </select>
        </div>
        
        <div id="strength-inputs" style="display: none;">
            <div class="form-row">
              <div class="form-group">
                <label class="label">ÐÐµÑ (ÐºÐ³)</label>
                <input class="input" type="number" name="weight" step="0.5" placeholder="0" value="${Et&&u?u.weight??"":""}">

              </div>
              <div class="form-group">
                <label class="label">ÐÐ¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</label>
                <input class="input" type="number" name="reps" placeholder="0" value="${Et&&u?u.reps??"":""}">

              </div>
            </div>
        </div>

        <div id="time-inputs" style="display: none;">
            <div class="form-row">
                <div class="form-group">
                    <label class="label">Ð§Ð°ÑÑ</label>
                    <input class="input" type="number" name="duration_hours" placeholder="0" value="${Et&&u&&u.duration?Math.floor(u.duration/60):""}">
                </div>
                <div class="form-group">
                    <label class="label">ÐÐ¸Ð½ÑÑÑ</label>
                    <input class="input" type="number" name="duration_minutes" placeholder="0" value="${Et&&u&&u.duration?u.duration%60:""}">
                </div>
            </div>
        </div>

        ${Et&&u?`
        <div class="form-group">
          <label class="label">ÐÐ°ÑÐ°</label>
          <input class="input" type="date" name="date" required value="${u.date.split("T")[0]}">
        </div>
        `:""}

        <button class="button" type="submit">${Et?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ":"ÐÐ°ÑÐ¸ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ"}</button>
        ${Et?'<button class="button button_secondary" type="button" id="cancel-edit-btn" style="margin-top: 12px;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        ${!Et&&o?`<button class="button button_secondary" type="button" id="duplicate-last-btn" style="margin-top: 12px;">ÐÐ¾Ð²ÑÐ¾ÑÐ¸ÑÑ: ${(p=i.find(m=>m.id===o.workoutTypeId))==null?void 0:p.name} ${o.weight!==void 0?`${o.weight}ÐºÐ³ Ã ${o.reps}`:`${o.duration} Ð¼Ð¸Ð½`}</button>`:""}

      </form>
      <div class="recent-logs">
        <div class="recent-logs__header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
           <button class="icon-btn" id="prev-week-btn">âï¸</button>
           <div id="week-label-container" style="display: flex; align-items: center; gap: 8px; position: relative;">
             <span style="font-size: 18px; position: relative; display: inline-block;">
               ð
               <input type="date" id="calendar-input" value="${No}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
             </span>
             <h2 class="subtitle" style="margin: 0;">${Wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":d}</h2>
             <label class="filter-toggle" title="Ð¤Ð¸Ð»ÑÑÑ Ð¿Ð¾ ÑÐ¸Ð¿Ñ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ">
               <input type="checkbox" id="filter-toggle-input" ${Yo?"checked":""}>
               <span class="filter-toggle__icon">ð</span>
             </label>
           </div>
           <button class="icon-btn" id="next-week-btn" ${Wt===0?"disabled":""} style="${Wt===0?"opacity: 0.3; cursor: default;":""}">â¶ï¸</button>
        </div>
        <div id="logs-list">
          ${_a()}
        </div>
      </div>
    </div>
  `}function _a(){var d;const i=H.getLogs(),n=H.getWorkoutTypes(),{start:o,end:s}=Vo(Wt);let u=i.filter(p=>{const m=new Date(p.date);return m>=o&&m<=s});if(Yo){const p=(d=document.querySelector('select[name="typeId"]'))==null?void 0:d.value;p&&(u=u.filter(m=>m.workoutTypeId===p))}return ka(u,n,!0)}function We(){const i=document.getElementById("logs-list"),n=document.querySelector("#week-label-container .subtitle");if(i&&(i.innerHTML=_a(),Js()),n){const{label:s}=Vo(Wt);n.textContent=Wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":s}const o=document.getElementById("next-week-btn");o&&(o.disabled=Wt===0,o.style.opacity=Wt===0?"0.3":"",o.style.cursor=Wt===0?"default":"")}function Js(){document.querySelectorAll(".log-set__delete").forEach(i=>{i.addEventListener("click",async()=>{const n=i.getAttribute("data-id");n&&(Et===n&&(Et=null),await H.deleteLog(n),$t())})}),document.querySelectorAll(".log-set__edit").forEach(i=>{i.addEventListener("click",()=>{Et=i.getAttribute("data-id"),$t(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(i=>{i.addEventListener("click",()=>{const n=i.getAttribute("data-date");n&&xa(n)})})}function ka(i,n,o){if(i.length===0)return'<p class="hint">ÐÐµÑ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð·Ð° ÑÑÐ¾Ñ Ð¿ÐµÑÐ¸Ð¾Ð´</p>';const s=new Map;[...i].sort((p,m)=>new Date(m.date).getTime()-new Date(p.date).getTime()).forEach(p=>{const g=new Date(p.date).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"});s.has(g)||s.set(g,[]),s.get(g).push(p)});const u=H.getWorkouts();let d="";return s.forEach((p,m)=>{var q;const g=((q=p[0])==null?void 0:q.date.split("T")[0])||"",S=new Set;p.forEach(V=>{V.workoutId&&S.add(V.workoutId)});const $=Array.from(S).sort((V,tt)=>{var gt,dt;const z=u.find(ht=>ht.id===V),X=u.find(ht=>ht.id===tt),et=(z==null?void 0:z.startTime)||((gt=p.find(ht=>ht.workoutId===V))==null?void 0:gt.date)||"",ct=(X==null?void 0:X.startTime)||((dt=p.find(ht=>ht.workoutId===tt))==null?void 0:dt.date)||"";return new Date(ct).getTime()-new Date(et).getTime()}),I=$.length===1?$[0]:null,A=I?u.find(V=>V.id===I):null,C=A&&A.name,L=A?Math.round(H.getWorkoutDuration(A)):0;d+='<div class="log-day">',d+=`<div class="log-day__header">
      <span>${m}${C?` â¢ ${A.name}`:""}${A?` â¢ ${L} Ð¼Ð¸Ð½`:""}</span>
      ${o?`<button class="share-btn" data-date="${g}" title="ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ">ð¤</button>`:""}
    </div>`,$.forEach(V=>{const tt=u.find(ct=>ct.id===V),z=p.filter(ct=>ct.workoutId===V);if(!($.length===1&&(C||!(tt!=null&&tt.name)))){const ct=tt?Math.round(H.getWorkoutDuration(tt)):0;d+=`<h3 class="workout-subheader">
                ${(tt==null?void 0:tt.name)||"Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°"} 
                <span class="workout-subheader__time">${ct} Ð¼Ð¸Ð½</span>
            </h3>`}const et=new Map;z.forEach(ct=>{et.has(ct.workoutTypeId)||et.set(ct.workoutTypeId,[]),et.get(ct.workoutTypeId).push(ct)}),et.forEach((ct,gt)=>{const dt=n.find(ht=>ht.id===gt);d+=`
            <div class="log-exercise">
              <div class="log-exercise__name">${(dt==null?void 0:dt.name)||"Ð£Ð´Ð°Ð»ÐµÐ½Ð¾"}</div>
              <div class="log-exercise__sets">
                ${ct.map(ht=>`
                  <div class="log-set ${ht.id===Et?"log-set_active-edit":""} ${ht.id===Mn?"log-set_new":""}">
                    <div class="log-set__info">
                      ${ht.weight!==void 0&&ht.reps!==void 0?`
                        <span class="log-set__weight">${ht.weight} ÐºÐ³</span>
                        <span class="log-set__times">Ã</span>
                        <span class="log-set__reps">${ht.reps}</span>
                      `:`
                        <span class="log-set__reps">â± ${ht.duration} Ð¼Ð¸Ð½</span>
                      `}
                    </div>
                    ${o?`
                    <div class="log-set__actions">
                      <button class="log-set__edit" data-id="${ht.id}">âï¸</button>
                      <button class="log-set__delete" data-id="${ht.id}">Ã</button>
                    </div>
                    `:""}
                  </div>
                `).join("")}
              </div>
            </div>
          `})}),d+="</div>"}),d}function Zs(){const i=H.getWorkoutTypes(),n=Jt?i.find(o=>o.id===Jt):null;return`
    <div class="page-content">
      <h1 class="title">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</h1>
      <div class="settings-section">
        <h2 class="subtitle">${Jt?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¿Ð°":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸"}</h2>
        <form class="add-type-form" id="add-type-form" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 8px; flex-direction: column;">
            <input class="input" type="text" id="new-type-name" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð½Ð°Ð¿Ñ. ÐÐ¸Ð¼ Ð³Ð°Ð½ÑÐµÐ»ÐµÐ¹)" required value="${n?n.name:""}">
            
            <div class="category-switch" style="display: flex; gap: 12px; margin-bottom: 8px;">
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="strength" ${!n||n.category!=="time"?"checked":""}>
                    Ð¡Ð¸Ð»Ð¾Ð²Ð¾Ðµ
                </label>
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="time" ${n&&n.category==="time"?"checked":""}>
                    ÐÐ° Ð²ÑÐµÐ¼Ñ
                </label>
            </div>

            <button class="button" type="submit">${Jt?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ"}</button>
          </div>
          ${Jt?'<button class="button button_secondary" type="button" id="cancel-edit-type-btn" style="margin-top: 8px; width: 100%;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        </form>

        <h2 class="subtitle">Ð¢Ð¸Ð¿Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
        <div class="type-list" id="workout-type-list">
          ${i.map(o=>`
            <div class="type-item" data-id="${o.id}">
              <span class="drag-handle" style="cursor: grab; margin-right: 12px; opacity: 0.5;">â®â®</span>
              <span style="flex-grow: 1;">${o.name}</span>
              <div style="display: flex; gap: 8px;">
                <button class="type-item__edit icon-btn" data-id="${o.id}" title="Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ">âï¸</button>
                <button class="type-item__delete icon-btn" data-id="${o.id}" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">Ã</button>
              </div>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `}function Ea(i){var p,m;const n=H.getProfile(),o=(n==null?void 0:n.isPublic)??!1,s=(n==null?void 0:n.displayName)||((m=(p=mt==null?void 0:mt.initDataUnsafe)==null?void 0:p.user)==null?void 0:m.first_name)||"",u=H.getProfileIdentifier(),d=u?yn(u):"";return i==="public"?`
      <div class="settings-section">
        <div class="settings-section-title">ÐÐ¸Ð´Ð¸Ð¼Ð¾ÑÑÑ</div>
        <div class="toggle-row">
          <div class="toggle-label">
            <span class="toggle-label-text">ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</span>
            <span class="toggle-label-hint">ÐÑÑÐ³Ð¸Ðµ ÑÐ¼Ð¾Ð³ÑÑ Ð²Ð¸Ð´ÐµÑÑ Ð²Ð°ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÑ</span>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="profile-public-toggle" ${o?"checked":""}>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="toggle-row" style="margin-top: 12px;">
          <div class="toggle-label">
            <span class="toggle-label-text">ÐÐ¾ÐºÐ°Ð·ÑÐ²Ð°ÑÑ Ð²ÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ</span>
            <span class="toggle-label-hint">ÐÐ¾Ð´ÑÐ¾Ð±Ð½ÑÐ¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð² Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ð¼ Ð¿ÑÐ¾ÑÐ¸Ð»Ðµ</span>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="profile-history-toggle" ${n!=null&&n.showFullHistory?"checked":""}>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-section-title">ÐÐ¼Ñ</div>
        <input class="input" type="text" id="profile-display-name" value="${s}" placeholder="ÐÐ°ÑÐµ Ð¸Ð¼Ñ">
      </div>

      ${o&&u?`
        <div class="settings-section">
          <div class="settings-section-title">Ð¡ÑÑÐ»ÐºÐ° Ð½Ð° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</div>
          <div class="profile-link-section">
            <a href="${d}" target="_blank" class="profile-link-url">${d}</a>
            <div class="profile-link-actions">
              <button class="button button_secondary" id="copy-profile-link">ÐÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ</button>
              <button class="button" id="share-profile-link">ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ</button>
            </div>
          </div>
        </div>
      `:""}

      <div class="settings-section">
        <div class="settings-section-title">ÐÑÐµÐ²ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</div>
        ${function(){const g=H.getLogs(),S=H.getWorkoutTypes(),$=g.reduce((z,X)=>z+(X.weight||0)*(X.reps||0),0),I=new Set(g.map(z=>z.date.split("T")[0])),A=I.size,C=g.length>0?[...g].sort((z,X)=>new Date(X.date).getTime()-new Date(z.date).getTime())[0].date:void 0,L=new Map;g.forEach(z=>{L.set(z.workoutTypeId,(L.get(z.workoutTypeId)||0)+1)});let q,V=0;return L.forEach((z,X)=>{if(z>V){V=z;const et=S.find(ct=>ct.id===X);et&&(q=et.name)}}),ga({totalWorkouts:A,totalVolume:$,favoriteExercise:q,lastWorkoutDate:C},I)}()}
      </div>

      ${n!=null&&n.friends&&n.friends.length>0?`
      <div class="settings-section">
          <div class="settings-section-title">ÐÑÑÐ·ÑÑ (${n.friends.length})</div>
          <div class="friends-list">
              ${n.friends.map(g=>`
                  <a href="${yn(g.identifier)}" class="friend-item" style="display: flex; align-items: center; gap: 12px; padding: 8px 0; border-bottom: 1px solid var(--border-color); cursor: pointer; text-decoration: none; color: inherit;">
                      <div class="friend-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--surface-color-alt); display: flex; align-items: center; justify-content: center; overflow: hidden;">
                          ${g.photoUrl?`<img src="${g.photoUrl}" style="width: 100%; height: 100%; object-fit: cover;">`:g.displayName.charAt(0).toUpperCase()}
                      </div>
                      <div class="friend-info" style="flex-grow: 1;">
                          <div class="friend-name" style="font-weight: 500;">${g.displayName}</div>
                      </div>
                      <div class="friend-arrow">âº</div>
                  </a>
              `).join("")}
          </div>
      </div>
      `:""}

      <button class="button" id="save-profile-btn" style="margin-top: 12px;">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
    `:i==="ai"?`
      <div class="settings-section">
            <div class="settings-section-title">AI Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°ÑÐ¸Ð¸</div>
            
            <div class="ai-controls" style="display: flex; flex-direction: column; gap: 12px;">
                <button class="button" id="ai-general-btn" ${mn!=="idle"?"disabled":""}>
                    ${mn==="general"?"ÐÐ½Ð°Ð»Ð¸Ð·...":"â¨ ÐÐ±ÑÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·"}
                </button>

                <div id="ai-general-result" class="ai-result" style="margin-top: 24px; background: var(--surface-color-alt); padding: 16px; border-radius: 12px; ${hn.general?"":"display: none;"}">
                    <div class="markdown-body" style="white-space: pre-wrap; font-family: inherit;">${hn.general||""}</div>
                </div>

                <div class="ai-plan-section">
                    <h3 class="workout-subheader" style="margin-bottom: 8px;">ÐÐ»Ð°Ð½ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h3>
                    <div class="form-group">
                        <select class="select" id="ai-plan-period">
                            <option value="day">ÐÐ° ÑÐµÐ³Ð¾Ð´Ð½Ñ</option>
                            <option value="week">ÐÐ° Ð½ÐµÐ´ÐµÐ»Ñ</option>
                        </select>
                    </div>
                      
                    <div class="toggle-row toggle-row--clean" style="margin-top: 12px;">
                      <div class="toggle-label">
                          <span class="toggle-label-text">Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°ÑÑ Ð½Ð¾Ð²ÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ</span>
                      </div>
                      <label class="toggle-switch">
                          <input type="checkbox" id="ai-allow-new">
                          <span class="toggle-slider"></span>
                      </label>
                    </div>
                    <button class="button" id="ai-plan-btn" ${mn!=="idle"?"disabled":""} style="margin-top: 8px;">
                        ${mn==="plan"?"ÐÐµÐ½ÐµÑÐ°ÑÐ¸Ñ...":"ð Ð¡Ð¾Ð·Ð´Ð°ÑÑ Ð¿Ð»Ð°Ð½"}
                    </button>

                    <div id="ai-plan-result" class="ai-result" style="margin-top: 12px; background: var(--surface-color-alt); padding: 16px; border-radius: 12px; ${hn.plan?"":"display: none;"}">
                        <div class="markdown-body" style="white-space: pre-wrap; font-family: inherit;">${hn.plan||""}</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-section-title">ÐÐ¸ÑÐ½ÑÐµ Ð´Ð°Ð½Ð½ÑÐµ (ÐÑÐ¸Ð²Ð°ÑÐ½Ð¾)</div>
            <p class="hint" style="margin-bottom: 12px; font-size: 0.9em;">Ð­ÑÐ¸ Ð´Ð°Ð½Ð½ÑÐµ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·ÑÑÑÑÑ ÑÐ¾Ð»ÑÐºÐ¾ Ð´Ð»Ñ Ð¿ÐµÑÑÐ¾Ð½Ð°Ð»Ð¸Ð·Ð°ÑÐ¸Ð¸ ÑÐ¾Ð²ÐµÑÐ¾Ð² Ð¾Ñ AI Ð¸ Ð½Ðµ Ð²Ð¸Ð´Ð½Ñ Ð´ÑÑÐ³Ð¸Ð¼ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»ÑÐ¼.</p>
            
            <div class="form-row">
              <div class="form-group">
                  <label class="label">ÐÐ¾Ð»</label>
                  <select class="select" id="profile-gender">
                      <option value="" ${n!=null&&n.gender?"":"selected"}>ÐÐµ ÑÐºÐ°Ð·Ð°Ð½Ð¾</option>
                      <option value="male" ${(n==null?void 0:n.gender)==="male"?"selected":""}>ÐÑÐ¶ÑÐºÐ¾Ð¹</option>
                      <option value="female" ${(n==null?void 0:n.gender)==="female"?"selected":""}>ÐÐµÐ½ÑÐºÐ¸Ð¹</option>
                  </select>
              </div>
              <div class="form-group">
                  <label class="label">ÐÐ°ÑÐ° ÑÐ¾Ð¶Ð´ÐµÐ½Ð¸Ñ</label>
                  <input class="input" type="date" id="profile-birthdate" value="${(n==null?void 0:n.birthDate)||""}">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                  <label class="label">Ð Ð¾ÑÑ (ÑÐ¼)</label>
                  <input class="input" type="number" id="profile-height" placeholder="180" value="${(n==null?void 0:n.height)||""}">
              </div>
              <div class="form-group">
                  <label class="label">ÐÐµÑ (ÐºÐ³)</label>
                  <input class="input" type="number" id="profile-weight" placeholder="75" value="${(n==null?void 0:n.weight)||""}">
              </div>
            </div>

            <div class="form-group">
               <label class="label">ÐÐ¾Ð¿Ð¾Ð»Ð½Ð¸ÑÐµÐ»ÑÐ½Ð°Ñ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ</label>
               <textarea class="input" id="profile-additional-info" rows="3" placeholder="Ð£ÐºÐ°Ð¶Ð¸ÑÐµ ÑÑÐ°Ð²Ð¼Ñ, Ð¾Ð³ÑÐ°Ð½Ð¸ÑÐµÐ½Ð¸Ñ, ÑÐµÐ»Ð¸ Ð¸Ð»Ð¸ Ð»ÑÐ±ÑÑ Ð´ÑÑÐ³ÑÑ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ, ÐºÐ¾ÑÐ¾ÑÐ°Ñ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ AI Ð´Ð°Ð²Ð°ÑÑ Ð±Ð¾Ð»ÐµÐµ ÑÐ¾ÑÐ½ÑÐµ ÑÐ¾Ð²ÐµÑÑ...">${(n==null?void 0:n.additionalInfo)||""}</textarea>
            </div>
            <button class="button" id="save-profile-btn" style="margin-top: 12px;">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
        </div>
    `:i==="data"?`
      <div class="settings-section">
        <div class="settings-section-title">Ð£Ð¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸</div>
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <button class="button button_secondary" id="export-json-btn">Ð­ÐºÑÐ¿Ð¾ÑÑ JSON (Backup)</button>
          <button class="button button_secondary" id="export-md-btn">Ð­ÐºÑÐ¿Ð¾ÑÑ Markdown</button>
          <button class="button button_secondary" id="import-json-btn">ÐÐ¼Ð¿Ð¾ÑÑ JSON (Restore)</button>
          <input type="file" id="import-file-input" style="display: none" accept=".json">
        </div>
      </div>
    `:""}function tl(){var s,u;const i=H.getProfile(),n=(i==null?void 0:i.isPublic)??!1,o=(i==null?void 0:i.displayName)||((u=(s=mt==null?void 0:mt.initDataUnsafe)==null?void 0:s.user)==null?void 0:u.first_name)||"";return`
    <div class="page-content profile-page">
      <h1 class="title">ÐÑÐ¾ÑÐ¸Ð»Ñ</h1>
      
      <div class="profile-header">
        <div class="profile-avatar">
          ${i!=null&&i.photoUrl?`<img src="${i.photoUrl}" alt="${o}" class="profile-avatar-img">`:o.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${o}</div>
        <div class="profile-subtitle">${n?"ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ":"ÐÑÐ¸Ð²Ð°ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ"}</div>
      </div>

      <div class="stats-tabs">
        <button class="stats-tab profile-tab ${Ye==="ai"?"active":""}" data-tab="ai">AI</button>
        <button class="stats-tab profile-tab ${Ye==="public"?"active":""}" data-tab="public">ÐÑÐ±Ð»Ð¸ÑÐ½Ð¾Ðµ</button>
        <button class="stats-tab profile-tab ${Ye==="data"?"active":""}" data-tab="data">ÐÐ°Ð½Ð½ÑÐµ</button>
      </div>

      <div class="profile-settings" id="profile-tab-content">
        ${Ea(Ye)}
      </div>
    </div>
  `}function el(){const i=document.getElementById("profile-tab-content");i&&(i.innerHTML=Ea(Ye),nl()),document.querySelectorAll(".profile-tab").forEach(n=>{const o=n.getAttribute("data-tab");n.classList.toggle("active",o===Ye)})}function cn(){var s,u;const i=document.getElementById("main-content");if(!i)return;const n=ba(),o=i.firstElementChild;if(o){const d=document.createElement("div");d.innerHTML=n;const p=d.firstElementChild;p&&(o.classList.contains("workout-controls")||o.id==="start-workout-btn"?o.replaceWith(p):i.querySelector(".workout-controls")?(s=i.querySelector(".workout-controls"))==null||s.replaceWith(p):i.querySelector("#start-workout-btn")?(u=i.querySelector("#start-workout-btn"))==null||u.replaceWith(p):i.insertBefore(p,i.firstChild),Sa())}wa()}function Sa(){const i=document.getElementById("start-workout-btn");i==null||i.addEventListener("click",()=>{Ir=!0,cn()});const n=document.getElementById("cancel-start-workout-btn");n==null||n.addEventListener("click",()=>{Ir=!1,cn()});const o=document.getElementById("start-workout-form");o==null||o.addEventListener("submit",async p=>{p.preventDefault();const g=new FormData(o).get("workoutName");await H.startWorkout(g),Ir=!1,cn()});const s=document.getElementById("pause-workout-btn");s==null||s.addEventListener("click",async()=>{await H.pauseWorkout(),cn()});const u=document.getElementById("resume-workout-btn");u==null||u.addEventListener("click",async()=>{await H.resumeWorkout(),cn()});const d=document.getElementById("finish-workout-btn");d==null||d.addEventListener("click",async()=>{confirm("ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ?")&&(await H.finishWorkout(),cn())})}function nl(){var m,g,S,$;const i=document.getElementById("save-profile-btn");i==null||i.addEventListener("click",async()=>{const I=document.getElementById("profile-public-toggle"),A=document.getElementById("profile-history-toggle"),C=document.getElementById("profile-display-name"),L=document.getElementById("profile-gender"),q=document.getElementById("profile-birthdate"),V=document.getElementById("profile-height"),tt=document.getElementById("profile-weight"),z=document.getElementById("profile-additional-info"),X={};I&&(X.isPublic=I.checked),A&&(X.showFullHistory=A.checked),C&&(X.displayName=C.value),L&&(X.gender=L.value||void 0),q&&(X.birthDate=q.value),V&&(X.height=V.value?Number(V.value):void 0),tt&&(X.weight=tt.value?Number(tt.value):void 0),z&&(X.additionalInfo=z.value),await H.updateProfileSettings(X),St("ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐ¾ÑÑÐ°Ð½ÐµÐ½")});const n=document.getElementById("ai-general-btn"),o=document.getElementById("ai-plan-btn"),s=I=>{mn=I,n&&(n.disabled=I!=="idle",n.textContent=I==="general"?"ÐÐ½Ð°Ð»Ð¸Ð·...":"â¨ ÐÐ±ÑÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·"),o&&(o.disabled=I!=="idle",o.textContent=I==="plan"?"ÐÐµÐ½ÐµÑÐ°ÑÐ¸Ñ...":"ð Ð¡Ð¾Ð·Ð´Ð°ÑÑ Ð¿Ð»Ð°Ð½")},u=(I,A)=>{hn[I]=A;const C=I==="general"?"ai-general-result":"ai-plan-result",L=document.getElementById(C);if(L){L.style.display="";const q=L.querySelector(".markdown-body");q&&(q.textContent=A)}};n&&n.addEventListener("click",async()=>{s("general");try{const I=await H.getAIRecommendation("general");u("general",I)}catch(I){St("ÐÑÐ¸Ð±ÐºÐ°: "+(I instanceof Error?I.message:String(I)))}finally{s("idle")}}),o&&o.addEventListener("click",async()=>{const I=document.getElementById("ai-plan-period").value,A=document.getElementById("ai-allow-new").checked;s("plan");try{const C=await H.getAIRecommendation("plan",{period:I,allowNewExercises:A});u("plan",C)}catch(C){St("ÐÑÐ¸Ð±ÐºÐ°: "+(C instanceof Error?C.message:String(C)))}finally{s("idle")}});const d=document.getElementById("copy-profile-link");d==null||d.addEventListener("click",()=>{const I=H.getProfileIdentifier();if(I){const A=yn(I);navigator.clipboard.writeText(A).then(()=>{St("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})}});const p=document.getElementById("share-profile-link");p==null||p.addEventListener("click",()=>{const I=H.getProfileIdentifier();if(I){const A=yn(I);if(mt!=null&&mt.openTelegramLink){const C=`https://t.me/share/url?url=${encodeURIComponent(A)}&text=${encodeURIComponent("ÐÐ¾Ð¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº ðª")}`;mt.openTelegramLink(C)}else navigator.clipboard.writeText(A).then(()=>{St("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})}}),(m=document.getElementById("export-json-btn"))==null||m.addEventListener("click",async()=>{try{const I=await H.exportData(),A=`gym_backup_${new Date().toISOString().split("T")[0]}.json`;Lr(JSON.stringify(I,null,2),A,"application/json"),St("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(I){console.error(I),St("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(g=document.getElementById("export-md-btn"))==null||g.addEventListener("click",async()=>{try{const I=await H.exportData(),A=ma(I),C=`gym_history_${new Date().toISOString().split("T")[0]}.md`;Lr(A,C,"text/markdown"),St("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(I){console.error(I),St("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(S=document.getElementById("import-json-btn"))==null||S.addEventListener("click",()=>{var I;(I=document.getElementById("import-file-input"))==null||I.click()}),($=document.getElementById("import-file-input"))==null||$.addEventListener("change",I=>{var L;const A=(L=I.target.files)==null?void 0:L[0];if(!A)return;const C=new FileReader;C.onload=async q=>{var V;try{const tt=(V=q.target)==null?void 0:V.result,z=JSON.parse(tt);confirm("ÐÐ½Ð¸Ð¼Ð°Ð½Ð¸Ðµ! ÐÑÐµ ÑÐµÐºÑÑÐ¸Ðµ Ð´Ð°Ð½Ð½ÑÐµ Ð±ÑÐ´ÑÑ Ð·Ð°Ð¼ÐµÐ½ÐµÐ½Ñ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸ Ð¸Ð· ÑÐ°Ð¹Ð»Ð°. ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ?")&&(await H.importData(z),St("ÐÐ°Ð½Ð½ÑÐµ ÑÑÐ¿ÐµÑÐ½Ð¾ Ð¸Ð¼Ð¿Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°Ð½Ñ"),setTimeout(()=>location.reload(),1e3))}catch(tt){console.error(tt),St("ÐÑÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾ÑÑÐ°: ÐÐµÐ²ÐµÑÐ½ÑÐ¹ ÑÐ¾ÑÐ¼Ð°Ñ ÑÐ°Ð¹Ð»Ð°")}},C.readAsText(A),I.target.value=""})}function rl(){if(!va)return`
      <div class="page-content">
        <div class="profile-not-found">
          <div class="profile-not-found-icon">ð</div>
          <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½</div>
        </div>
      </div>
    `;if(!jr)return Ro?`
        <div class="page-content">
          <div class="profile-not-found">
            <div class="profile-not-found-icon">ð</div>
            <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐºÑÑÑ Ð¸Ð»Ð¸ Ð½Ðµ ÑÑÑÐµÑÑÐ²ÑÐµÑ</div>
          </div>
        </div>
      `:`
      <div class="page-content">
        <div class="profile-loading">ÐÐ°Ð³ÑÑÐ·ÐºÐ° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ...</div>
      </div>
    `;const i=jr;return i.logs&&(i.logs=i.logs.filter(n=>!n.isDeleted)),i.workoutTypes&&(i.workoutTypes=i.workoutTypes.filter(n=>!n.isDeleted)),`
    <div class="page-content profile-page">
      <div class="profile-header">
        <div class="profile-avatar">
          ${i.photoUrl?`<img src="${i.photoUrl}" alt="${i.displayName}" class="profile-avatar-img">`:i.displayName.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${i.displayName}</div>
        <div class="profile-subtitle">@${i.identifier}</div>
        ${function(){const n=H.getProfile();if(n&&(n.telegramUsername===i.identifier||`id_${n.telegramUserId}`===i.identifier))return"";const s=H.isFriend(i.identifier);return`
                <button class="button ${s?"button_secondary":""}" id="friend-action-btn" data-id="${i.identifier}" data-name="${i.displayName}" data-photo="${i.photoUrl||""}" style="margin-top: 12px; height: 36px; font-size: 14px; display: flex; align-items: center; justify-content: center;">
                    ${s?"Ð£Ð´Ð°Ð»Ð¸ÑÑ Ð¸Ð· Ð´ÑÑÐ·ÐµÐ¹":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ Ð² Ð´ÑÑÐ·ÑÑ"}
                </button>
            `}()}
      </div>

      ${function(){let n=0;i.logs&&(n=i.logs.reduce((d,p)=>d+(p.weight||0)*(p.reps||0),0));const o=Math.max(i.stats.totalVolume,n),s={...i.stats,totalVolume:o},u=i.logs?new Set(i.logs.map(d=>d.date.split("T")[0])):new Set;return ga(s,u)}()}

      ${i.recentActivity.length>0?`
        <div class="activity-list">
          <h2 class="subtitle">ÐÐµÐ´Ð°Ð²Ð½ÑÑ Ð°ÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          ${i.recentActivity.map(n=>`
            <div class="activity-item">
              <span class="activity-date">${new Date(n.date).toLocaleDateString()}</span>
              <span class="activity-count">${n.exerciseCount} ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹</span>
            </div>
          `).join("")}
        </div>
      `:""}

      ${i.logs&&i.logs.length>0&&i.workoutTypes?`
        <div class="recent-logs">
          <h2 class="subtitle">ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
          <div id="logs-list">
            ${ka(i.logs,i.workoutTypes,!1)}
          </div>
        </div>
      `:""}
    </div>
  `}function ol(){const i=H.getLogs(),n=H.getWorkouts(),o=H.getWorkoutTypes();if(i.length===0)return`
      <div class="page-content">
        <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
        <p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</p>
      </div>
    `;const s=i.reduce((m,g)=>m+(g.weight||0)*(g.reps||0),0),u=i.reduce((m,g)=>m+(g.reps||0),0),d=ms(n);let p=`
    <div class="page-content">
      <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
      <div class="stats-tabs">
        <button class="stats-tab ${Dr==="overview"?"active":""}" data-tab="overview">ÐÐ±Ð·Ð¾Ñ</button>
        <button class="stats-tab ${Dr==="progress"?"active":""}" data-tab="progress">ÐÑÐ¾Ð³ÑÐµÑÑ</button>
      </div>
  `;if(Dr==="overview"){const m=hs(n,i);p+=`
        <div class="stats-section">
            <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
            ${Ji(m)}
        </div>

        <div class="stats-summary">
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
                <div class="stat-metric__value">${m.size}</div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">Ð¡ÑÐµÐ´. Ð´Ð»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ</div>
                <div class="stat-metric__value">${d.averageMinutes}<span class="stat-metric__unit">Ð¼Ð¸Ð½</span></div>
            </div>
             <div class="stat-metric">
                <div class="stat-metric__label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼</div>
                <div class="stat-metric__value">${Math.round(s/1e3)}<span class="stat-metric__unit">Ñ</span></div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ Ð¿Ð¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</div>
                <div class="stat-metric__value">${u}</div>
            </div>
        </div>

        <div class="charts-section">
            <h2 class="subtitle">ÐÐ»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
            <div class="chart-container">
                ${vs(n)}
            </div>
        </div>
     `}else if(p+=`
        <div class="form-group">
            <label class="label">Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</label>
            <select class="select" id="stat-type-select">
                <option value="all">ÐÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ (ÐÐ±ÑÐµÐ¼)</option>
                ${o.map(m=>`<option value="${m.id}" ${pn===m.id?"selected":""}>${m.name}</option>`).join("")}
            </select>
        </div>
    `,pn==="all")p+=`
            <div class="charts-section">
                <h2 class="subtitle">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼ Ð¿Ð¾ Ð´Ð½ÑÐ¼</h2>
                <div class="chart-container">
                    ${ji(i)}
                </div>
            </div>
        `;else{const m=i.filter(S=>S.workoutTypeId===pn),g=ps(m,pn);p+=`
             <div class="charts-section">
                <h2 class="subtitle">ÐÑÐ¾Ð³ÑÐµÑÑ ÑÐ¸Ð»Ð¾Ð²ÑÑ (1RM)</h2>
                <div class="chart-container">
                    ${gs(g)}
                </div>
            </div>
            
            <div class="charts-section" style="margin-top: 24px;">
                <h2 class="subtitle">ÐÐ±ÑÐµÐ¼ Ð½Ð°Ð³ÑÑÐ·ÐºÐ¸</h2>
                 <div class="chart-container">
                    ${ji(m)}
                </div>
            </div>
        `}return p+="</div>",p}function il(i){const n=H.getLogs(),o=H.getWorkoutTypes(),s=n.filter(S=>S.date.startsWith(i));if(s.length===0)return"";const d=new Date(s[0].date).toLocaleDateString("ru-RU",{day:"numeric",month:"long"}),p=new Map;s.forEach(S=>{p.has(S.workoutTypeId)||p.set(S.workoutTypeId,[]),p.get(S.workoutTypeId).push(S)});let m=`ðï¸ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° ${d}

`;p.forEach((S,$)=>{const I=o.find(A=>A.id===$);m+=`${(I==null?void 0:I.name)||"Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ"}:
`,S.forEach(A=>{A.duration?m+=`  â± ${A.duration} Ð¼Ð¸Ð½
`:m+=`  ${A.weight} ÐºÐ³ Ã ${A.reps}
`}),m+=`
`});const g=s.reduce((S,$)=>S+($.weight&&$.reps?$.weight*$.reps:0),0);return g&&(m+=`ðª ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼: ${Math.round(g)} ÐºÐ³`),m}function xa(i){const n=il(i);if(n)if(mt!=null&&mt.openTelegramLink){const o=`https://t.me/share/url?url=${encodeURIComponent("https://t.me/gymgym21bot")}&text=${encodeURIComponent(n)}`;mt.openTelegramLink(o)}else navigator.clipboard.writeText(n).then(()=>{alert("Ð¢ÐµÐºÑÑ ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½ Ð² Ð±ÑÑÐµÑ Ð¾Ð±Ð¼ÐµÐ½Ð°")})}function al(){var i,n,o,s;if(qt==="main"){Sa();const u=document.getElementById("log-form"),d=()=>{const C=document.getElementById("workout-type-select"),L=H.getWorkoutTypes(),q=C==null?void 0:C.value,V=L.find(X=>X.id===q),tt=document.getElementById("strength-inputs"),z=document.getElementById("time-inputs");V&&V.category==="time"?(tt&&(tt.style.display="none"),z&&(z.style.display="block"),u.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(X=>X.removeAttribute("required")),u.querySelectorAll('input[name="duration_hours"], input[name="duration_minutes"]').forEach(X=>X.removeAttribute("required"))):(tt&&(tt.style.display="block"),z&&(z.style.display="none"),u.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(X=>X.setAttribute("required","true")),u.querySelectorAll('input[name="duration_hours"], input[name="duration_minutes"]').forEach(X=>X.removeAttribute("required")))};d();const p=document.getElementById("workout-type-select");p==null||p.addEventListener("change",d),u==null||u.addEventListener("submit",async C=>{C.preventDefault();const L=new FormData(u),q=L.get("typeId"),tt=H.getWorkoutTypes().find(X=>X.id===q),z={workoutTypeId:q};if((tt==null?void 0:tt.category)==="time"){const X=parseInt(L.get("duration_hours"),10)||0,et=parseInt(L.get("duration_minutes"),10)||0;z.duration=X*60+et}else z.weight=parseFloat(L.get("weight")),z.reps=parseInt(L.get("reps"),10);if(Et){const et=H.getLogs().find(ct=>ct.id===Et);if(et){const ct=L.get("date");let gt=et.date;if(ct){const dt=new Date(et.date),[ht,Lt,ie]=ct.split("-").map(Number);dt.setFullYear(ht,Lt-1,ie),gt=dt.toISOString()}await H.updateLog({...et,...z,date:gt}),Et=null,$t()}}else Mn=(await H.addLog(z)).id,We(),Mn=null});const m=document.getElementById("duplicate-last-btn");m==null||m.addEventListener("click",async()=>{const C=H.getLogs(),L=C[C.length-1];L&&(Mn=(await H.addLog({workoutTypeId:L.workoutTypeId,weight:L.weight,reps:L.reps,duration:L.duration})).id,We(),Mn=null)});const g=document.getElementById("cancel-edit-btn");g==null||g.addEventListener("click",()=>{Et=null,$t()}),document.querySelectorAll(".log-set__delete").forEach(C=>{C.addEventListener("click",async()=>{const L=C.getAttribute("data-id");L&&(Et===L&&(Et=null),await H.deleteLog(L),We())})}),document.querySelectorAll(".log-set__edit").forEach(C=>{C.addEventListener("click",()=>{Et=C.getAttribute("data-id"),$t(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(C=>{C.addEventListener("click",()=>{const L=C.getAttribute("data-date");L&&xa(L)})});const S=document.getElementById("prev-week-btn");S==null||S.addEventListener("click",()=>{Wt++,We()});const $=document.getElementById("next-week-btn");$==null||$.addEventListener("click",()=>{Wt>0&&(Wt--,We())});const I=document.getElementById("calendar-input");I==null||I.addEventListener("change",()=>{if(!I.value||I.value===No)return;No=I.value;const C=new Date(I.value),L=new Date;L.setHours(0,0,0,0);const q=L.getTime()-C.getTime(),V=Math.floor(q/(1e3*60*60*24));Wt=Math.max(0,Math.floor(V/7)),We()});const A=document.getElementById("filter-toggle-input");A==null||A.addEventListener("change",()=>{Yo=A.checked,We()})}if(qt==="settings"){const u=document.getElementById("add-type-form");u==null||u.addEventListener("submit",async p=>{var S;p.preventDefault();const m=document.getElementById("new-type-name"),g=(S=document.querySelector('input[name="new-type-category"]:checked'))==null?void 0:S.value;m.value&&(Jt?(await H.updateWorkoutType(Jt,m.value,g),Jt=null):await H.addWorkoutType(m.value,g),$t())});const d=document.getElementById("cancel-edit-type-btn");d==null||d.addEventListener("click",()=>{Jt=null,$t()}),document.querySelectorAll(".type-item__edit").forEach(p=>{p.addEventListener("click",()=>{Jt=p.getAttribute("data-id"),$t();const m=document.getElementById("new-type-name");m==null||m.focus()})}),document.querySelectorAll(".type-item__delete").forEach(p=>{p.addEventListener("click",async()=>{const m=p.getAttribute("data-id");m&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(Jt===m&&(Jt=null),await H.deleteWorkoutType(m),$t())})})}if(qt==="settings"){const u=document.getElementById("workout-type-list");u&&rt.create(u,{animation:150,handle:".drag-handle",onEnd:async()=>{const d=Array.from(u.children).map(p=>p.getAttribute("data-id")||"").filter(Boolean);await H.updateWorkoutTypeOrder(d)}})}if(qt==="stats"){const u=document.getElementById("stat-type-select");u==null||u.addEventListener("change",()=>{pn=u.value,$t()})}if(qt==="profile-settings"){document.querySelectorAll(".profile-tab").forEach(A=>{A.addEventListener("click",()=>{const C=A.getAttribute("data-tab");(C==="ai"||C==="public"||C==="data")&&(Ye=C,el())})});const d=document.getElementById("save-profile-btn");d==null||d.addEventListener("click",async()=>{const A=document.getElementById("profile-public-toggle"),C=document.getElementById("profile-history-toggle"),L=document.getElementById("profile-display-name"),q=document.getElementById("profile-gender"),V=document.getElementById("profile-birthdate"),tt=document.getElementById("profile-height"),z=document.getElementById("profile-weight"),X=document.getElementById("profile-additional-info"),et={};A&&(et.isPublic=A.checked),C&&(et.showFullHistory=C.checked),L&&(et.displayName=L.value),q&&(et.gender=q.value||void 0),V&&(et.birthDate=V.value),tt&&(et.height=tt.value?Number(tt.value):void 0),z&&(et.weight=z.value?Number(z.value):void 0),X&&(et.additionalInfo=X.value),await H.updateProfileSettings(et),St("ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐ¾ÑÑÐ°Ð½ÐµÐ½")});const p=document.getElementById("ai-general-btn"),m=document.getElementById("ai-plan-btn"),g=A=>{mn=A,p&&(p.disabled=A!=="idle",p.textContent=A==="general"?"ÐÐ½Ð°Ð»Ð¸Ð·...":"â¨ ÐÐ±ÑÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·"),m&&(m.disabled=A!=="idle",m.textContent=A==="plan"?"ÐÐµÐ½ÐµÑÐ°ÑÐ¸Ñ...":"ð Ð¡Ð¾Ð·Ð´Ð°ÑÑ Ð¿Ð»Ð°Ð½")},S=(A,C)=>{hn[A]=C;const L=A==="general"?"ai-general-result":"ai-plan-result",q=document.getElementById(L);if(q){q.style.display="";const V=q.querySelector(".markdown-body");V&&(V.textContent=C)}};p&&p.addEventListener("click",async()=>{g("general");try{const A=await H.getAIRecommendation("general");S("general",A)}catch(A){St("ÐÑÐ¸Ð±ÐºÐ°: "+(A instanceof Error?A.message:String(A)))}finally{g("idle")}}),m&&m.addEventListener("click",async()=>{const A=document.getElementById("ai-plan-period").value,C=document.getElementById("ai-allow-new").checked;g("plan");try{const L=await H.getAIRecommendation("plan",{period:A,allowNewExercises:C});S("plan",L)}catch(L){St("ÐÑÐ¸Ð±ÐºÐ°: "+(L instanceof Error?L.message:String(L)))}finally{g("idle")}});const $=document.getElementById("copy-profile-link");$==null||$.addEventListener("click",()=>{const A=H.getProfileIdentifier();if(A){const C=yn(A);navigator.clipboard.writeText(C).then(()=>{St("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})}});const I=document.getElementById("share-profile-link");I==null||I.addEventListener("click",()=>{const A=H.getProfileIdentifier();if(A){const C=yn(A);if(mt!=null&&mt.openTelegramLink){const L=`https://t.me/share/url?url=${encodeURIComponent(C)}&text=${encodeURIComponent("ÐÐ¾Ð¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº ðª")}`;mt.openTelegramLink(L)}else navigator.clipboard.writeText(C).then(()=>{St("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})}}),(i=document.getElementById("export-json-btn"))==null||i.addEventListener("click",async()=>{try{const A=await H.exportData(),C=`gym_backup_${new Date().toISOString().split("T")[0]}.json`;Lr(JSON.stringify(A,null,2),C,"application/json"),St("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(A){console.error(A),St("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(n=document.getElementById("export-md-btn"))==null||n.addEventListener("click",async()=>{try{const A=await H.exportData(),C=ma(A),L=`gym_history_${new Date().toISOString().split("T")[0]}.md`;Lr(C,L,"text/markdown"),St("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(A){console.error(A),St("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(o=document.getElementById("import-json-btn"))==null||o.addEventListener("click",()=>{var A;(A=document.getElementById("import-file-input"))==null||A.click()}),(s=document.getElementById("import-file-input"))==null||s.addEventListener("change",A=>{var q;const C=(q=A.target.files)==null?void 0:q[0];if(!C)return;const L=new FileReader;L.onload=async V=>{var tt;try{const z=(tt=V.target)==null?void 0:tt.result,X=JSON.parse(z);confirm("ÐÐ½Ð¸Ð¼Ð°Ð½Ð¸Ðµ! ÐÑÐµ ÑÐµÐºÑÑÐ¸Ðµ Ð´Ð°Ð½Ð½ÑÐµ Ð±ÑÐ´ÑÑ Ð·Ð°Ð¼ÐµÐ½ÐµÐ½Ñ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸ Ð¸Ð· ÑÐ°Ð¹Ð»Ð°. ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ?")&&(await H.importData(X),St("ÐÐ°Ð½Ð½ÑÐµ ÑÑÐ¿ÐµÑÐ½Ð¾ Ð¸Ð¼Ð¿Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°Ð½Ñ"),setTimeout(()=>location.reload(),1e3))}catch(z){console.error(z),St("ÐÑÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾ÑÑÐ°: ÐÐµÐ²ÐµÑÐ½ÑÐ¹ ÑÐ¾ÑÐ¼Ð°Ñ ÑÐ°Ð¹Ð»Ð°")}},L.readAsText(C),A.target.value=""})}if(qt==="stats"){document.querySelectorAll(".stats-tab").forEach(p=>{p.addEventListener("click",()=>{const m=p.getAttribute("data-tab");(m==="overview"||m==="progress")&&(Dr=m,$t())})});const d=document.getElementById("stat-type-select");d==null||d.addEventListener("change",p=>{pn=p.target.value,$t()})}if(qt==="public-profile"){const u=document.getElementById("friend-action-btn");u==null||u.addEventListener("click",async()=>{const d=u.getAttribute("data-id"),p=u.getAttribute("data-name"),m=u.getAttribute("data-photo");d&&p&&(H.isFriend(d)?confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ Ð¸Ð· Ð´ÑÑÐ·ÐµÐ¹?")&&await H.removeFriend(d):(await H.addFriend({identifier:d,displayName:p,photoUrl:m||void 0}),St("ÐÐ¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² Ð´ÑÑÐ·ÑÑ")),$t())})}}const ze=document.createElement("div");ze.className="sync-status";document.body.appendChild(ze);function sl(i){switch(ze.className="sync-status visible "+i,i){case"saving":ze.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...";break;case"success":ze.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð¾";break;case"error":ze.textContent="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸";break;default:ze.className="sync-status"}}H.onUpdate(()=>$t());H.onSyncStatusChange(sl);async function ll(){var m;const i=new URLSearchParams(window.location.search);if(i.has("hash")&&i.has("id")){const g={id:parseInt(i.get("id")||"0",10),first_name:i.get("first_name")||"",last_name:i.get("last_name")||void 0,username:i.get("username")||void 0,photo_url:i.get("photo_url")||void 0,auth_date:parseInt(i.get("auth_date")||"0",10),hash:i.get("hash")||""};Qi(g),i.delete("hash"),i.delete("id"),i.delete("first_name"),i.delete("last_name"),i.delete("username"),i.delete("photo_url"),i.delete("auth_date"),i.delete("auth");const S=i.toString(),$=window.location.pathname+(S?"?"+S:"");window.history.replaceState({},document.title,$),location.reload();return}const n=localStorage.getItem("skip_tma_auth")==="true",o=!!(mt!=null&&mt.initData)&&!n,u=!!qo();if(!o&&!u){ta(document.getElementById("app"),()=>{location.reload()});return}const p=new URLSearchParams(window.location.search).get("startapp")||((m=mt==null?void 0:mt.initDataUnsafe)==null?void 0:m.start_param);if(p&&p.startsWith("profile_")){const g=p.replace("profile_","");va=g,qt="public-profile",Ro=!1,$t(),jr=await H.getPublicProfile(g),jr||(Ro=!0),$t()}else $t()}ll();
