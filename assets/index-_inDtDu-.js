var hs=Object.defineProperty;var ms=(o,n,r)=>n in o?hs(o,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[n]=r;var tt=(o,n,r)=>ms(o,typeof n!="symbol"?n+"":n,r);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))a(u);new MutationObserver(u=>{for(const d of u)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function r(u){const d={};return u.integrity&&(d.integrity=u.integrity),u.referrerPolicy&&(d.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?d.credentials="include":u.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(u){if(u.ep)return;u.ep=!0;const d=r(u);fetch(u.href,d)}})();function gs(o,n){const r=o.toLowerCase(),a=n.toLowerCase(),u=[];let d=0;for(let p=0;p<r.length&&d<a.length;p++)r[p]===a[d]&&(u.push(p),d++);return d===a.length?u:null}function vs(o,n){if(n.length===0)return ct(o);const r=new Set(n);let a="",u=!1;for(let d=0;d<o.length;d++)r.has(d)?(u||(a+='<mark class="typeahead__highlight">',u=!0),a+=ct(o[d])):(u&&(a+="</mark>",u=!1),a+=ct(o[d]));return u&&(a+="</mark>"),a}function ct(o){return o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function ys(o){var S,C;const{items:n,selectedId:r,name:a,placeholder:u,inputId:d}=o,p=n.find(D=>D.id===r),m=p?p.id:((S=n[0])==null?void 0:S.id)||"",g=p?p.name:((C=n[0])==null?void 0:C.name)||"";return`
    <div class="typeahead" data-typeahead>
      <input
        type="text"
        class="typeahead__input"
        autocomplete="off"
        value="${ct(g)}"
        placeholder="${ct(u||"Поиск...")}"
        data-typeahead-input
      >
      <input
        type="hidden"
        name="${ct(a)}"
        ${d?`id="${ct(d)}"`:""}
        value="${ct(m)}"
        data-typeahead-value
        required
      >
      <div class="typeahead__dropdown" data-typeahead-dropdown></div>
    </div>
  `}function Zo(o=document){const n=o.querySelector("[data-typeahead-value]");if(n)return n.value;const r=o.querySelector('select[name="typeId"]');return(r==null?void 0:r.value)||""}function bs(o=document){const n=o.querySelector("[data-typeahead]");if(!n)return;const r=n.querySelector("[data-typeahead-input]"),a=n.querySelector("[data-typeahead-value]"),u=n.querySelector("[data-typeahead-dropdown]"),p=ea.get(n)||[];let m=-1,g=[],S=!1;function C($){if($.trim()==="")g=p.map(U=>({item:U,indices:[]}));else{g=[];for(const U of p){const H=gs(U.name,$);H&&g.push({item:U,indices:H})}}g.length===0?u.innerHTML='<div class="typeahead__empty">Ничего не найдено</div>':u.innerHTML=g.map((U,H)=>{const F=U.indices.length>0?vs(U.item.name,U.indices):ct(U.item.name);return`<div class="typeahead__option ${H===m?"typeahead__option_active":""}" data-typeahead-option-index="${H}" data-id="${ct(U.item.id)}">${F}</div>`}).join("")}function D(){S||(S=!0,m=-1,C(r.value),u.classList.add("typeahead__dropdown_open"))}function A(){S&&(S=!1,u.classList.remove("typeahead__dropdown_open"),m=-1)}function L($){r.value=$.name,a.value=$.id,A(),a.dispatchEvent(new Event("change",{bubbles:!0}))}function M(){u.querySelectorAll(".typeahead__option").forEach((U,H)=>{U.classList.toggle("typeahead__option_active",H===m)});const $=u.querySelector(".typeahead__option_active");$&&$.scrollIntoView({block:"nearest"})}r.addEventListener("focus",()=>{r.select(),D()}),r.addEventListener("input",()=>{m=-1,D(),C(r.value)}),r.addEventListener("keydown",$=>{if(!S){if($.key==="ArrowDown"||$.key==="ArrowUp"){D();return}return}switch($.key){case"ArrowDown":$.preventDefault(),g.length>0&&(m=(m+1)%g.length,M());break;case"ArrowUp":$.preventDefault(),g.length>0&&(m=m<=0?g.length-1:m-1,M());break;case"Enter":$.preventDefault(),m>=0&&m<g.length?L(g[m].item):g.length===1&&L(g[0].item);break;case"Escape":A(),r.blur();break}}),r.addEventListener("blur",()=>{setTimeout(()=>{if(!S)return;const $=p.find(U=>U.id===a.value);$&&(r.value=$.name),A()},200)}),u.addEventListener("click",$=>{const U=$.target.closest("[data-typeahead-option-index]");if(!U)return;const H=parseInt(U.getAttribute("data-typeahead-option-index")||"-1",10);H>=0&&H<g.length&&L(g[H].item)}),document.addEventListener("click",$=>{if(!n.contains($.target)){const U=p.find(H=>H.id===a.value);U&&(r.value=U.name),A()}})}const ea=new WeakMap;function ws(o,n){const r=o.querySelector("[data-typeahead]");r&&ea.set(r,n)}var Mo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _s(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ta={exports:{}};(function(o,n){((r,a)=>{o.exports=a()})(Mo,function(){var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(i,s){i.__proto__=s}:function(i,s){for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(i[l]=s[l])}))(e,t)},a=function(){return(a=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var l in t=arguments[i])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)};function u(e,t,i){for(var s,l=0,c=t.length;l<c;l++)!s&&l in t||((s=s||Array.prototype.slice.call(t,0,l))[l]=t[l]);return e.concat(s||Array.prototype.slice.call(t))}var d=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Mo,p=Object.keys,m=Array.isArray;function g(e,t){return typeof t=="object"&&p(t).forEach(function(i){e[i]=t[i]}),e}typeof Promise>"u"||d.Promise||(d.Promise=Promise);var S=Object.getPrototypeOf,C={}.hasOwnProperty;function D(e,t){return C.call(e,t)}function A(e,t){typeof t=="function"&&(t=t(S(e))),(typeof Reflect>"u"?p:Reflect.ownKeys)(t).forEach(function(i){M(e,i,t[i])})}var L=Object.defineProperty;function M(e,t,i,s){L(e,t,g(i&&D(i,"get")&&typeof i.get=="function"?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},s))}function $(e){return{from:function(t){return e.prototype=Object.create(t.prototype),M(e.prototype,"constructor",e),{extend:A.bind(null,e.prototype)}}}}var U=Object.getOwnPropertyDescriptor,H=[].slice;function F(e,t,i){return H.call(e,t,i)}function G(e,t){return t(e)}function te(e){if(!e)throw new Error("Assertion Failed")}function se(e){d.setImmediate?setImmediate(e):setTimeout(e,0)}function oe(e,t){if(typeof t=="string"&&D(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var i=[],s=0,l=t.length;s<l;++s){var c=oe(e,t[s]);i.push(c)}return i}var f,h=t.indexOf(".");return h===-1||(f=e[t.substr(0,h)])==null?void 0:oe(f,t.substr(h+1))}function ge(e,t,i){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){te(typeof i!="string"&&"length"in i);for(var s=0,l=t.length;s<l;++s)ge(e,t[s],i[s])}else{var c,f,h=t.indexOf(".");h!==-1?(c=t.substr(0,h),(h=t.substr(h+1))===""?i===void 0?m(e)&&!isNaN(parseInt(c))?e.splice(c,1):delete e[c]:e[c]=i:ge(f=(f=e[c])&&D(e,c)?f:e[c]={},h,i)):i===void 0?m(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=i}}function Ce(e){var t,i={};for(t in e)D(e,t)&&(i[t]=e[t]);return i}var le=[].concat;function ot(e){return le.apply([],e)}var et="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ot([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return d[e]}),Fe=new Set(et.map(function(e){return d[e]})),Ze=null;function Le(e){return Ze=new WeakMap,e=function t(i){if(!i||typeof i!="object")return i;var s=Ze.get(i);if(s)return s;if(m(i)){s=[],Ze.set(i,s);for(var l=0,c=i.length;l<c;++l)s.push(t(i[l]))}else if(Fe.has(i.constructor))s=i;else{var f,h=S(i);for(f in s=h===Object.prototype?{}:Object.create(h),Ze.set(i,s),i)D(i,f)&&(s[f]=t(i[f]))}return s}(e),Ze=null,e}var pt={}.toString;function ht(e){return pt.call(e).slice(8,-1)}var Xe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Vt=typeof Xe=="symbol"?function(e){var t;return e!=null&&(t=e[Xe])&&t.apply(e)}:function(){return null};function Ue(e,t){t=e.indexOf(t),0<=t&&e.splice(t,1)}var wt={};function at(e){var t,i,s,l;if(arguments.length===1){if(m(e))return e.slice();if(this===wt&&typeof e=="string")return[e];if(l=Vt(e))for(i=[];!(s=l.next()).done;)i.push(s.value);else{if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(i=new Array(t);t--;)i[t]=e[t]}}else for(t=arguments.length,i=new Array(t);t--;)i[t]=arguments[t];return i}var Xt=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},et=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],We=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(et),ja={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Gt(e,t){this.name=e,this.message=t}function Qi(e,t){return e+". Errors: "+Object.keys(t).map(function(i){return t[i].toString()}).filter(function(i,s,l){return l.indexOf(i)===s}).join(`
`)}function Hn(e,t,i,s){this.failures=t,this.failedKeys=s,this.successCount=i,this.message=Qi(e,t)}function Qt(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(i){return t[i]}),this.failuresByPos=t,this.message=Qi(e,this.failures)}$(Gt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),$(Hn).from(Gt),$(Qt).from(Gt);var Rr=We.reduce(function(e,t){return e[t]=t+"Error",e},{}),Ba=Gt,J=We.reduce(function(e,t){var i=t+"Error";function s(l,c){this.name=i,l?typeof l=="string"?(this.message="".concat(l).concat(c?`
 `+c:""),this.inner=c||null):typeof l=="object"&&(this.message="".concat(l.name," ").concat(l.message),this.inner=l):(this.message=ja[t]||i,this.inner=null)}return $(s).from(Ba),e[t]=s,e},{}),Ji=(J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError,et.reduce(function(e,t){return e[t+"Error"]=J[t],e},{}));et=We.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=J[t]),e},{});function ve(){}function wn(e){return e}function Na(e,t){return e==null||e===wn?t:function(i){return t(e(i))}}function $t(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Ra(e,t){return e===ve?t:function(){var i=e.apply(this,arguments),s=(i!==void 0&&(arguments[0]=i),this.onsuccess),l=this.onerror,c=(this.onsuccess=null,this.onerror=null,t.apply(this,arguments));return s&&(this.onsuccess=this.onsuccess?$t(s,this.onsuccess):s),l&&(this.onerror=this.onerror?$t(l,this.onerror):l),c!==void 0?c:i}}function qa(e,t){return e===ve?t:function(){e.apply(this,arguments);var i=this.onsuccess,s=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?$t(i,this.onsuccess):i),s&&(this.onerror=this.onerror?$t(s,this.onerror):s)}}function Ka(e,t){return e===ve?t:function(l){var s=e.apply(this,arguments),l=(g(l,s),this.onsuccess),c=this.onerror,f=(this.onsuccess=null,this.onerror=null,t.apply(this,arguments));return l&&(this.onsuccess=this.onsuccess?$t(l,this.onsuccess):l),c&&(this.onerror=this.onerror?$t(c,this.onerror):c),s===void 0?f===void 0?void 0:f:g(s,f)}}function Fa(e,t){return e===ve?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function qr(e,t){return e===ve?t:function(){var i=e.apply(this,arguments);if(i&&typeof i.then=="function"){for(var s=this,l=arguments.length,c=new Array(l);l--;)c[l]=arguments[l];return i.then(function(){return t.apply(s,c)})}return t.apply(this,arguments)}}et.ModifyError=Hn,et.DexieError=Gt,et.BulkError=Qt;var st=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Zi(e){st=e}var _n={},eo=100,kn=typeof Promise>"u"?[]:(We=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[kn=crypto.subtle.digest("SHA-512",new Uint8Array([0])),S(kn),We]:[We,S(We),We]),We=kn[0],an=kn[1],an=an&&an.then,Lt=We&&We.constructor,Kr=!!kn[2],En=function(e,t){Sn.push([e,t]),Yn&&(queueMicrotask(Wa),Yn=!1)},Fr=!0,Yn=!0,Mt=[],Vn=[],Ur=wn,_t={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ve,pgp:!1,env:{},finalize:ve},Q=_t,Sn=[],jt=0,Xn=[];function W(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=Q;if(typeof e!="function"){if(e!==_n)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&zr(this,this._value)}else this._state=null,this._value=null,++t.ref,function i(s,l){try{l(function(c){if(s._state===null){if(c===s)throw new TypeError("A promise cannot be resolved with itself.");var f=s._lib&&Jt();c&&typeof c.then=="function"?i(s,function(h,b){c instanceof W?c._then(h,b):c.then(h,b)}):(s._state=!0,s._value=c,no(s)),f&&Zt()}},zr.bind(null,s))}catch(c){zr(s,c)}}(this,e)}var Wr={get:function(){var e=Q,t=Zn;function i(s,l){var c=this,f=!e.global&&(e!==Q||t!==Zn),h=f&&!Et(),b=new W(function(I,w){Hr(c,new to(io(s,e,f,h),io(l,e,f,h),I,w,e))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return i.prototype=_n,i},set:function(e){M(this,"then",e&&e.prototype===_n?Wr:{get:function(){return e},set:Wr.set})}};function to(e,t,i,s,l){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=i,this.reject=s,this.psd=l}function zr(e,t){var i,s;Vn.push(t),e._state===null&&(i=e._lib&&Jt(),t=Ur(t),e._state=!1,e._value=t,s=e,Mt.some(function(l){return l._value===s._value})||Mt.push(s),no(e),i)&&Zt()}function no(e){var t=e._listeners;e._listeners=[];for(var i=0,s=t.length;i<s;++i)Hr(e,t[i]);var l=e._PSD;--l.ref||l.finalize(),jt===0&&(++jt,En(function(){--jt==0&&Yr()},[]))}function Hr(e,t){if(e._state===null)e._listeners.push(t);else{var i=e._state?t.onFulfilled:t.onRejected;if(i===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++jt,En(Ua,[i,e,t])}}function Ua(e,t,i){try{var s,l=t._value;!t._state&&Vn.length&&(Vn=[]),s=st&&t._consoleTask?t._consoleTask.run(function(){return e(l)}):e(l),t._state||Vn.indexOf(l)!==-1||(c=>{for(var f=Mt.length;f;)if(Mt[--f]._value===c._value)return Mt.splice(f,1)})(t),i.resolve(s)}catch(c){i.reject(c)}finally{--jt==0&&Yr(),--i.psd.ref||i.psd.finalize()}}function Wa(){Bt(_t,function(){Jt()&&Zt()})}function Jt(){var e=Fr;return Yn=Fr=!1,e}function Zt(){var e,t,i;do for(;0<Sn.length;)for(e=Sn,Sn=[],i=e.length,t=0;t<i;++t){var s=e[t];s[0].apply(null,s[1])}while(0<Sn.length);Yn=Fr=!0}function Yr(){for(var e=Mt,t=(Mt=[],e.forEach(function(s){s._PSD.onunhandled.call(null,s._value,s)}),Xn.slice(0)),i=t.length;i;)t[--i]()}function Gn(e){return new W(_n,!1,e)}function we(e,t){var i=Q;return function(){var s=Jt(),l=Q;try{return St(i,!0),e.apply(this,arguments)}catch(c){t&&t(c)}finally{St(l,!1),s&&Zt()}}}A(W.prototype,{then:Wr,_then:function(e,t){Hr(this,new to(null,null,e,t,Q))},catch:function(e){var t,i;return arguments.length===1?this.then(null,e):(t=e,i=arguments[1],typeof t=="function"?this.then(null,function(s){return(s instanceof t?i:Gn)(s)}):this.then(null,function(s){return(s&&s.name===t?i:Gn)(s)}))},finally:function(e){return this.then(function(t){return W.resolve(e()).then(function(){return t})},function(t){return W.resolve(e()).then(function(){return Gn(t)})})},timeout:function(e,t){var i=this;return e<1/0?new W(function(s,l){var c=setTimeout(function(){return l(new J.Timeout(t))},e);i.then(s,l).finally(clearTimeout.bind(null,c))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&M(W.prototype,Symbol.toStringTag,"Dexie.Promise"),_t.env=ro(),A(W,{all:function(){var e=at.apply(null,arguments).map(er);return new W(function(t,i){e.length===0&&t([]);var s=e.length;e.forEach(function(l,c){return W.resolve(l).then(function(f){e[c]=f,--s||t(e)},i)})})},resolve:function(e){return e instanceof W?e:e&&typeof e.then=="function"?new W(function(t,i){e.then(t,i)}):new W(_n,!0,e)},reject:Gn,race:function(){var e=at.apply(null,arguments).map(er);return new W(function(t,i){e.map(function(s){return W.resolve(s).then(t,i)})})},PSD:{get:function(){return Q},set:function(e){return Q=e}},totalEchoes:{get:function(){return Zn}},newPSD:kt,usePSD:Bt,scheduler:{get:function(){return En},set:function(e){En=e}},rejectionMapper:{get:function(){return Ur},set:function(e){Ur=e}},follow:function(e,t){return new W(function(i,s){return kt(function(l,c){var f=Q;f.unhandleds=[],f.onunhandled=c,f.finalize=$t(function(){var h,b=this;h=function(){b.unhandleds.length===0?l():c(b.unhandleds[0])},Xn.push(function I(){h(),Xn.splice(Xn.indexOf(I),1)}),++jt,En(function(){--jt==0&&Yr()},[])},f.finalize),e()},t,i,s)})}}),Lt&&(Lt.allSettled&&M(W,"allSettled",function(){var e=at.apply(null,arguments).map(er);return new W(function(t){e.length===0&&t([]);var i=e.length,s=new Array(i);e.forEach(function(l,c){return W.resolve(l).then(function(f){return s[c]={status:"fulfilled",value:f}},function(f){return s[c]={status:"rejected",reason:f}}).then(function(){return--i||t(s)})})})}),Lt.any&&typeof AggregateError<"u"&&M(W,"any",function(){var e=at.apply(null,arguments).map(er);return new W(function(t,i){e.length===0&&i(new AggregateError([]));var s=e.length,l=new Array(s);e.forEach(function(c,f){return W.resolve(c).then(function(h){return t(h)},function(h){l[f]=h,--s||i(new AggregateError(l))})})})}),Lt.withResolvers)&&(W.withResolvers=Lt.withResolvers);var Pe={awaits:0,echoes:0,id:0},za=0,Qn=[],Jn=0,Zn=0,Ha=0;function kt(e,f,i,s){var l=Q,c=Object.create(l),f=(c.parent=l,c.ref=0,c.global=!1,c.id=++Ha,_t.env,c.env=Kr?{Promise:W,PromiseProp:{value:W,configurable:!0,writable:!0},all:W.all,race:W.race,allSettled:W.allSettled,any:W.any,resolve:W.resolve,reject:W.reject}:{},f&&g(c,f),++l.ref,c.finalize=function(){--this.parent.ref||this.parent.finalize()},Bt(c,e,i,s));return c.ref===0&&c.finalize(),f}function en(){return Pe.id||(Pe.id=++za),++Pe.awaits,Pe.echoes+=eo,Pe.id}function Et(){return!!Pe.awaits&&(--Pe.awaits==0&&(Pe.id=0),Pe.echoes=Pe.awaits*eo,!0)}function er(e){return Pe.echoes&&e&&e.constructor===Lt?(en(),e.then(function(t){return Et(),t},function(t){return Et(),Ie(t)})):e}function Ya(){var e=Qn[Qn.length-1];Qn.pop(),St(e,!1)}function St(e,t){var i,s,l=Q;(t?!Pe.echoes||Jn++&&e===Q:!Jn||--Jn&&e===Q)||queueMicrotask(t?(function(c){++Zn,Pe.echoes&&--Pe.echoes!=0||(Pe.echoes=Pe.awaits=Pe.id=0),Qn.push(Q),St(c,!0)}).bind(null,e):Ya),e!==Q&&(Q=e,l===_t&&(_t.env=ro()),Kr)&&(i=_t.env.Promise,s=e.env,l.global||e.global)&&(Object.defineProperty(d,"Promise",s.PromiseProp),i.all=s.all,i.race=s.race,i.resolve=s.resolve,i.reject=s.reject,s.allSettled&&(i.allSettled=s.allSettled),s.any)&&(i.any=s.any)}function ro(){var e=d.Promise;return Kr?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(d,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Bt(e,t,i,s,l){var c=Q;try{return St(e,!0),t(i,s,l)}finally{St(c,!1)}}function io(e,t,i,s){return typeof e!="function"?e:function(){var l=Q;i&&en(),St(t,!0);try{return e.apply(this,arguments)}finally{St(l,!1),s&&queueMicrotask(Et)}}}function Vr(e){Promise===Lt&&Pe.echoes===0?Jn===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+an).indexOf("[native code]")===-1&&(en=Et=ve);var Ie=W.reject,Nt="￿",mt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",oo="String expected.",tn=[],tr="__dbnames",Xr="readonly",Gr="readwrite";function Rt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var ao={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function nr(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=Le(t))[e],t}}function so(){throw J.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ce(e,t){try{var i=lo(e),s=lo(t);if(i!==s)return i==="Array"?1:s==="Array"?-1:i==="binary"?1:s==="binary"?-1:i==="string"?1:s==="string"?-1:i==="Date"?1:s!=="Date"?NaN:-1;switch(i){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":for(var l=uo(e),c=uo(t),f=l.length,h=c.length,b=f<h?f:h,I=0;I<b;++I)if(l[I]!==c[I])return l[I]<c[I]?-1:1;return f===h?0:f<h?-1:1;case"Array":for(var w=e,v=t,k=w.length,E=v.length,_=k<E?k:E,y=0;y<_;++y){var T=ce(w[y],v[y]);if(T!==0)return T}return k===E?0:k<E?-1:1}}catch{}return NaN}function lo(e){var t=typeof e;return t=="object"&&(ArrayBuffer.isView(e)||(t=ht(e))==="ArrayBuffer")?"binary":t}function uo(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function rr(e,t,i){var s=e.schema.yProps;return s?(t&&0<i.numFailures&&(t=t.filter(function(l,c){return!i.failures[c]})),Promise.all(s.map(function(l){return l=l.updatesTable,t?e.db.table(l).where("k").anyOf(t).delete():e.db.table(l).clear()})).then(function(){return i})):i}co.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var i=t.add;if(m(i))return u(u([],m(e)?e:[],!0),i).sort();if(typeof i=="number")return(Number(e)||0)+i;if(typeof i=="bigint")try{return BigInt(e)+i}catch{return BigInt(0)+i}throw new TypeError("Invalid term ".concat(i))}if(t.remove!==void 0){var s=t.remove;if(m(s))return m(e)?e.filter(function(l){return!s.includes(l)}).sort():[];if(typeof s=="number")return Number(e)-s;if(typeof s=="bigint")try{return BigInt(e)-s}catch{return BigInt(0)-s}throw new TypeError("Invalid subtrahend ".concat(s))}return i=(i=t.replacePrefix)==null?void 0:i[0],i&&typeof e=="string"&&e.startsWith(i)?t.replacePrefix[1]+e.substring(i.length):e};var xn=co;function co(e){this["@@propmod"]=e}function fo(e,t){for(var i=p(t),s=i.length,l=!1,c=0;c<s;++c){var f=i[c],h=t[f],b=oe(e,f);h instanceof xn?(ge(e,f,h.execute(b)),l=!0):b!==h&&(ge(e,f,h),l=!0)}return l}ye.prototype._trans=function(e,t,i){var s=this._tx||Q.trans,l=this.name,c=st&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function f(I,w,v){if(v.schema[l])return t(v.idbtrans,v);throw new J.NotFound("Table "+l+" not part of transaction")}var h=Jt();try{var b=s&&s.db._novip===this.db._novip?s===Q.trans?s._promise(e,f,i):kt(function(){return s._promise(e,f,i)},{trans:s,transless:Q.transless||Q}):function I(w,v,k,E){if(w.idbdb&&(w._state.openComplete||Q.letThrough||w._vip)){var _=w._createTransaction(v,k,w._dbSchema);try{_.create(),w._state.PR1398_maxLoop=3}catch(y){return y.name===Rr.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return I(w,v,k,E)})):Ie(y)}return _._promise(v,function(y,T){return kt(function(){return Q.trans=_,E(y,T,_)})}).then(function(y){if(v==="readwrite")try{_.idbtrans.commit()}catch{}return v==="readonly"?y:_._completion.then(function(){return y})})}if(w._state.openComplete)return Ie(new J.DatabaseClosed(w._state.dbOpenError));if(!w._state.isBeingOpened){if(!w._state.autoOpen)return Ie(new J.DatabaseClosed);w.open().catch(ve)}return w._state.dbReadyPromise.then(function(){return I(w,v,k,E)})}(this.db,e,[this.name],f);return c&&(b._consoleTask=c,b=b.catch(function(I){return console.trace(I),Ie(I)})),b}finally{h&&Zt()}},ye.prototype.get=function(e,t){var i=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?Ie(new J.Type("Invalid argument to Table.get()")):this._trans("readonly",function(s){return i.core.get({trans:s,key:e}).then(function(l){return i.hook.reading.fire(l)})}).then(t)},ye.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(m(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=p(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var i=this.schema.indexes.concat(this.schema.primKey).filter(function(h){if(h.compound&&t.every(function(I){return 0<=h.keyPath.indexOf(I)})){for(var b=0;b<t.length;++b)if(t.indexOf(h.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(h,b){return h.keyPath.length-b.keyPath.length})[0];if(i&&this.db._maxKey!==Nt)return f=i.keyPath.slice(0,t.length),this.where(f).equals(f.map(function(h){return e[h]}));!i&&st&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var s=this.schema.idxByName;function l(h,b){return ce(h,b)===0}var f=t.reduce(function(w,b){var I=w[0],w=w[1],v=s[b],k=e[b];return[I||v,I||!v?Rt(w,v&&v.multi?function(E){return E=oe(E,b),m(E)&&E.some(function(_){return l(k,_)})}:function(E){return l(k,oe(E,b))}):w]},[null,null]),c=f[0],f=f[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(f):i?this.filter(f):this.where(t).equals("")},ye.prototype.filter=function(e){return this.toCollection().and(e)},ye.prototype.count=function(e){return this.toCollection().count(e)},ye.prototype.offset=function(e){return this.toCollection().offset(e)},ye.prototype.limit=function(e){return this.toCollection().limit(e)},ye.prototype.each=function(e){return this.toCollection().each(e)},ye.prototype.toArray=function(e){return this.toCollection().toArray(e)},ye.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ye.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,m(e)?"[".concat(e.join("+"),"]"):e))},ye.prototype.reverse=function(){return this.toCollection().reverse()},ye.prototype.mapToClass=function(e){for(var t=this.db,i=this.name,s=((this.schema.mappedClass=e).prototype instanceof so&&(e=(f=>{var h=w,b=f;if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function I(){this.constructor=h}function w(){return f!==null&&f.apply(this,arguments)||this}return r(h,b),h.prototype=b===null?Object.create(b):(I.prototype=b.prototype,new I),Object.defineProperty(w.prototype,"db",{get:function(){return t},enumerable:!1,configurable:!0}),w.prototype.table=function(){return i},w})(e)),new Set),l=e.prototype;l;l=S(l))Object.getOwnPropertyNames(l).forEach(function(f){return s.add(f)});function c(f){if(!f)return f;var h,b=Object.create(e.prototype);for(h in f)if(!s.has(h))try{b[h]=f[h]}catch{}return b}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=c,this.hook("reading",c),e},ye.prototype.defineClass=function(){return this.mapToClass(function(e){g(this,e)})},ye.prototype.add=function(e,t){var i=this,s=this.schema.primKey,l=s.auto,c=s.keyPath,f=e;return c&&l&&(f=nr(c)(e)),this._trans("readwrite",function(h){return i.core.mutate({trans:h,type:"add",keys:t!=null?[t]:null,values:[f]})}).then(function(h){return h.numFailures?W.reject(h.failures[0]):h.lastResult}).then(function(h){if(c)try{ge(e,c,h)}catch{}return h})},ye.prototype.upsert=function(e,t){var i=this,s=this.schema.primKey.keyPath;return this._trans("readwrite",function(l){return i.core.get({trans:l,key:e}).then(function(c){var f=c??{};return fo(f,t),s&&ge(f,s,e),i.core.mutate({trans:l,type:"put",values:[f],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(h){return h.numFailures?W.reject(h.failures[0]):!!c})})})},ye.prototype.update=function(e,t){return typeof e!="object"||m(e)?this.where(":id").equals(e).modify(t):(e=oe(e,this.schema.primKey.keyPath))===void 0?Ie(new J.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t)},ye.prototype.put=function(e,t){var i=this,s=this.schema.primKey,l=s.auto,c=s.keyPath,f=e;return c&&l&&(f=nr(c)(e)),this._trans("readwrite",function(h){return i.core.mutate({trans:h,type:"put",values:[f],keys:t!=null?[t]:null})}).then(function(h){return h.numFailures?W.reject(h.failures[0]):h.lastResult}).then(function(h){if(c)try{ge(e,c,h)}catch{}return h})},ye.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(i){return t.core.mutate({trans:i,type:"delete",keys:[e]}).then(function(s){return rr(t,[e],s)}).then(function(s){return s.numFailures?W.reject(s.failures[0]):void 0})})},ye.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:ao}).then(function(i){return rr(e,null,i)})}).then(function(t){return t.numFailures?W.reject(t.failures[0]):void 0})},ye.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(i){return t.core.getMany({keys:e,trans:i}).then(function(s){return s.map(function(l){return t.hook.reading.fire(l)})})})},ye.prototype.bulkAdd=function(e,t,i){var s=this,l=Array.isArray(t)?t:void 0,c=(i=i||(l?void 0:t))?i.allKeys:void 0;return this._trans("readwrite",function(f){var h=s.schema.primKey,I=h.auto,h=h.keyPath;if(h&&l)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(l&&l.length!==e.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var b=e.length,I=h&&I?e.map(nr(h)):e;return s.core.mutate({trans:f,type:"add",keys:l,values:I,wantResults:c}).then(function(w){var v=w.numFailures,k=w.failures;if(v===0)return c?w.results:w.lastResult;throw new Qt("".concat(s.name,".bulkAdd(): ").concat(v," of ").concat(b," operations failed"),k)})})},ye.prototype.bulkPut=function(e,t,i){var s=this,l=Array.isArray(t)?t:void 0,c=(i=i||(l?void 0:t))?i.allKeys:void 0;return this._trans("readwrite",function(f){var h=s.schema.primKey,I=h.auto,h=h.keyPath;if(h&&l)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(l&&l.length!==e.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var b=e.length,I=h&&I?e.map(nr(h)):e;return s.core.mutate({trans:f,type:"put",keys:l,values:I,wantResults:c}).then(function(w){var v=w.numFailures,k=w.failures;if(v===0)return c?w.results:w.lastResult;throw new Qt("".concat(s.name,".bulkPut(): ").concat(v," of ").concat(b," operations failed"),k)})})},ye.prototype.bulkUpdate=function(e){var t=this,i=this.core,s=e.map(function(f){return f.key}),l=e.map(function(f){return f.changes}),c=[];return this._trans("readwrite",function(f){return i.getMany({trans:f,keys:s,cache:"clone"}).then(function(h){var b=[],I=[],w=(e.forEach(function(v,k){var E=v.key,_=v.changes,y=h[k];if(y){for(var T=0,O=Object.keys(_);T<O.length;T++){var x=O[T],P=_[x];if(x===t.schema.primKey.keyPath){if(ce(P,E)!==0)throw new J.Constraint("Cannot update primary key in bulkUpdate()")}else ge(y,x,P)}c.push(k),b.push(E),I.push(y)}}),b.length);return i.mutate({trans:f,type:"put",keys:b,values:I,updates:{keys:s,changeSpecs:l}}).then(function(v){var k=v.numFailures,E=v.failures;if(k===0)return w;for(var _=0,y=Object.keys(E);_<y.length;_++){var T,O=y[_],x=c[Number(O)];x!=null&&(T=E[O],delete E[O],E[x]=T)}throw new Qt("".concat(t.name,".bulkUpdate(): ").concat(k," of ").concat(w," operations failed"),E)})})})},ye.prototype.bulkDelete=function(e){var t=this,i=e.length;return this._trans("readwrite",function(s){return t.core.mutate({trans:s,type:"delete",keys:e}).then(function(l){return rr(t,e,l)})}).then(function(s){var l=s.numFailures,c=s.failures;if(l===0)return s.lastResult;throw new Qt("".concat(t.name,".bulkDelete(): ").concat(l," of ").concat(i," operations failed"),c)})};var po=ye;function ye(){}function Dn(e){function t(f,h){if(h){for(var b=arguments.length,I=new Array(b-1);--b;)I[b-1]=arguments[b];return i[f].subscribe.apply(null,I),e}if(typeof f=="string")return i[f]}var i={};t.addEventType=c;for(var s=1,l=arguments.length;s<l;++s)c(arguments[s]);return t;function c(f,h,b){var I,w;if(typeof f!="object")return h=h||Fa,w={subscribers:[],fire:b=b||ve,subscribe:function(v){w.subscribers.indexOf(v)===-1&&(w.subscribers.push(v),w.fire=h(w.fire,v))},unsubscribe:function(v){w.subscribers=w.subscribers.filter(function(k){return k!==v}),w.fire=w.subscribers.reduce(h,b)}},i[f]=t[f]=w;p(I=f).forEach(function(v){var k=I[v];if(m(k))c(v,I[v][0],I[v][1]);else{if(k!=="asap")throw new J.InvalidArgument("Invalid event config");var E=c(v,wn,function(){for(var _=arguments.length,y=new Array(_);_--;)y[_]=arguments[_];E.subscribers.forEach(function(T){se(function(){T.apply(null,y)})})})}})}}function In(e,t){return $(t).from({prototype:e}),t}function nn(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Qr(e,t){e.filter=Rt(e.filter,t)}function Jr(e,t,i){var s=e.replayFilter;e.replayFilter=s?function(){return Rt(s(),t())}:t,e.justLimit=i&&!s}function ir(e,t){if(e.isPrimKey)return t.primaryKey;var i=t.getIndexByKeyPath(e.index);if(i)return i;throw new J.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed")}function ho(e,t,i){var s=ir(e,t.schema);return t.openCursor({trans:i,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:s,range:e.range}})}function or(e,t,i,s){var l,c,f=e.replayFilter?Rt(e.filter,e.replayFilter()):e.filter;return e.or?(l={},c=function(h,b,I){var w,v;f&&!f(b,I,function(k){return b.stop(k)},function(k){return b.fail(k)})||((v=""+(w=b.primaryKey))=="[object ArrayBuffer]"&&(v=""+new Uint8Array(w)),D(l,v))||(l[v]=!0,t(h,b,I))},Promise.all([e.or._iterate(c,i),mo(ho(e,s,i),e.algorithm,c,!e.keysOnly&&e.valueMapper)])):mo(ho(e,s,i),Rt(e.algorithm,f),t,!e.keysOnly&&e.valueMapper)}function mo(e,t,i,s){var l=we(s?function(c,f,h){return i(s(c),f,h)}:i);return e.then(function(c){if(c)return c.start(function(){var f=function(){return c.continue()};t&&!t(c,function(h){return f=h},function(h){c.stop(h),f=ve},function(h){c.fail(h),f=ve})||l(c.value,c,function(h){return f=h}),f()})})}he.prototype._read=function(e,t){var i=this._ctx;return i.error?i.table._trans(null,Ie.bind(null,i.error)):i.table._trans("readonly",e).then(t)},he.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,Ie.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},he.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Rt(t.algorithm,e)},he.prototype._iterate=function(e,t){return or(this._ctx,e,t,this._ctx.table.core)},he.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),i=Object.create(this._ctx);return e&&g(i,e),t._ctx=i,t},he.prototype.raw=function(){return this._ctx.valueMapper=null,this},he.prototype.each=function(e){var t=this._ctx;return this._read(function(i){return or(t,e,i,t.table.core)})},he.prototype.count=function(e){var t=this;return this._read(function(i){var s,l=t._ctx,c=l.table.core;return nn(l,!0)?c.count({trans:i,query:{index:ir(l,c.schema),range:l.range}}).then(function(f){return Math.min(f,l.limit)}):(s=0,or(l,function(){return++s,!1},i,c).then(function(){return s}))}).then(e)},he.prototype.sortBy=function(e,t){var i=e.split(".").reverse(),s=i[0],l=i.length-1;function c(b,I){return I?c(b[i[I]],I-1):b[s]}var f=this._ctx.dir==="next"?1:-1;function h(b,I){return ce(c(b,l),c(I,l))*f}return this.toArray(function(b){return b.sort(h)}).then(t)},he.prototype.toArray=function(e){var t=this;return this._read(function(i){var s,l,c,f=t._ctx;return f.dir==="next"&&nn(f,!0)&&0<f.limit?(s=f.valueMapper,l=ir(f,f.table.core.schema),f.table.core.query({trans:i,limit:f.limit,values:!0,query:{index:l,range:f.range}}).then(function(h){return h=h.result,s?h.map(s):h})):(c=[],or(f,function(h){return c.push(h)},i,f.table.core).then(function(){return c}))},e)},he.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,nn(t)?Jr(t,function(){var i=e;return function(s,l){return i===0||(i===1?--i:l(function(){s.advance(i),i=0}),!1)}}):Jr(t,function(){var i=e;return function(){return--i<0}})),this},he.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Jr(this._ctx,function(){var t=e;return function(i,s,l){return--t<=0&&s(l),0<=t}},!0),this},he.prototype.until=function(e,t){return Qr(this._ctx,function(i,s,l){return!e(i.value)||(s(l),t)}),this},he.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},he.prototype.last=function(e){return this.reverse().first(e)},he.prototype.filter=function(e){var t;return Qr(this._ctx,function(i){return e(i.value)}),(t=this._ctx).isMatch=Rt(t.isMatch,e),this},he.prototype.and=function(e){return this.filter(e)},he.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},he.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},he.prototype.desc=function(){return this.reverse()},he.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(i,s){e(s.key,s)})},he.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},he.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(i,s){e(s.primaryKey,s)})},he.prototype.keys=function(e){var t=this._ctx,i=(t.keysOnly=!t.isMatch,[]);return this.each(function(s,l){i.push(l.key)}).then(function(){return i}).then(e)},he.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&nn(t,!0)&&0<t.limit)return this._read(function(s){var l=ir(t,t.table.core.schema);return t.table.core.query({trans:s,values:!1,limit:t.limit,query:{index:l,range:t.range}})}).then(function(s){return s.result}).then(e);t.keysOnly=!t.isMatch;var i=[];return this.each(function(s,l){i.push(l.primaryKey)}).then(function(){return i}).then(e)},he.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},he.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},he.prototype.lastKey=function(e){return this.reverse().firstKey(e)},he.prototype.distinct=function(){var e,t=this._ctx,t=t.index&&t.table.schema.idxByName[t.index];return t&&t.multi&&(e={},Qr(this._ctx,function(s){var s=s.primaryKey.toString(),l=D(e,s);return e[s]=!0,!l})),this},he.prototype.modify=function(e){var t=this,i=this._ctx;return this._write(function(s){function l(y,T){var O=T.failures;k+=y-T.numFailures;for(var x=0,P=p(O);x<P.length;x++){var j=P[x];v.push(O[j])}}var c=typeof e=="function"?e:function(y){return fo(y,e)},f=i.table.core,w=f.schema.primaryKey,h=w.outbound,b=w.extractKey,I=200,w=t.db._options.modifyChunkSize,v=(w&&(I=typeof w=="object"?w[f.name]||w["*"]||200:w),[]),k=0,E=[],_=e===go;return t.clone().primaryKeys().then(function(y){function T(x){var P=Math.min(I,y.length-x),j=y.slice(x,x+P);return(_?Promise.resolve([]):f.getMany({trans:s,keys:j,cache:"immutable"})).then(function(R){var q=[],B=[],Y=h?[]:null,z=_?j:[];if(!_)for(var N=0;N<P;++N){var X=R[N],fe={value:Le(X),primKey:y[x+N]};c.call(fe,fe.value,fe)!==!1&&(fe.value==null?z.push(y[x+N]):h||ce(b(X),b(fe.value))===0?(B.push(fe.value),h&&Y.push(y[x+N])):(z.push(y[x+N]),q.push(fe.value)))}return Promise.resolve(0<q.length&&f.mutate({trans:s,type:"add",values:q}).then(function(me){for(var ee in me.failures)z.splice(parseInt(ee),1);l(q.length,me)})).then(function(){return(0<B.length||O&&typeof e=="object")&&f.mutate({trans:s,type:"put",keys:Y,values:B,criteria:O,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<x}).then(function(me){return l(B.length,me)})}).then(function(){return(0<z.length||O&&_)&&f.mutate({trans:s,type:"delete",keys:z,criteria:O,isAdditionalChunk:0<x}).then(function(me){return rr(i.table,z,me)}).then(function(me){return l(z.length,me)})}).then(function(){return y.length>x+P&&T(x+I)})})}var O=nn(i)&&i.limit===1/0&&(typeof e!="function"||_)&&{index:i.index,range:i.range};return T(0).then(function(){if(0<v.length)throw new Hn("Error modifying one or more objects",v,k,E);return y.length})})})},he.prototype.delete=function(){var e=this._ctx,t=e.range;return!nn(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(go):this._write(function(i){var s=e.table.core.schema.primaryKey,l=t;return e.table.core.count({trans:i,query:{index:s,range:l}}).then(function(c){return e.table.core.mutate({trans:i,type:"deleteRange",range:l}).then(function(b){var h=b.failures,b=b.numFailures;if(b)throw new Hn("Could not delete some values",Object.keys(h).map(function(I){return h[I]}),c-b);return c-b})})})};var Va=he;function he(){}var go=function(e,t){return t.value=null};function Xa(e,t){return e<t?-1:e===t?0:1}function Ga(e,t){return t<e?-1:e===t?0:1}function ze(e,t,i){return e=e instanceof yo?new e.Collection(e):e,e._ctx.error=new(i||TypeError)(t),e}function rn(e){return new e.Collection(e,function(){return vo("")}).limit(0)}function ar(E,t,i,s){var l,c,f,h,b,I,w,v=i.length;if(!i.every(function(y){return typeof y=="string"}))return ze(E,oo);function k(y){l=y==="next"?function(O){return O.toUpperCase()}:function(O){return O.toLowerCase()},c=y==="next"?function(O){return O.toLowerCase()}:function(O){return O.toUpperCase()},f=y==="next"?Xa:Ga;var T=i.map(function(O){return{lower:c(O),upper:l(O)}}).sort(function(O,x){return f(O.lower,x.lower)});h=T.map(function(O){return O.upper}),b=T.map(function(O){return O.lower}),w=(I=y)==="next"?"":s}k("next");var E=new E.Collection(E,function(){return xt(h[0],b[v-1]+s)}),_=(E._ondirectionchange=function(y){k(y)},0);return E._addAlgorithm(function(y,T,O){var x=y.key;if(typeof x=="string"){var P=c(x);if(t(P,b,_))return!0;for(var j=null,R=_;R<v;++R){var q=((B,Y,z,N,X,fe)=>{for(var me=Math.min(B.length,N.length),ee=-1,ae=0;ae<me;++ae){var ke=Y[ae];if(ke!==N[ae])return X(B[ae],z[ae])<0?B.substr(0,ae)+z[ae]+z.substr(ae+1):X(B[ae],N[ae])<0?B.substr(0,ae)+N[ae]+z.substr(ae+1):0<=ee?B.substr(0,ee)+Y[ee]+z.substr(ee+1):null;X(B[ae],ke)<0&&(ee=ae)}return me<N.length&&fe==="next"?B+z.substr(B.length):me<B.length&&fe==="prev"?B.substr(0,z.length):ee<0?null:B.substr(0,ee)+N[ee]+z.substr(ee+1)})(x,P,h[R],b[R],f,I);q===null&&j===null?_=R+1:(j===null||0<f(j,q))&&(j=q)}T(j!==null?function(){y.continue(j+w)}:O)}return!1}),E}function xt(e,t,i,s){return{type:2,lower:e,upper:t,lowerOpen:i,upperOpen:s}}function vo(e){return{type:1,lower:e,upper:e}}Object.defineProperty($e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),$e.prototype.between=function(e,t,i,s){i=i!==!1,s=s===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(i||s)&&(!i||!s)?rn(this):new this.Collection(this,function(){return xt(e,t,!i,!s)})}catch{return ze(this,mt)}},$e.prototype.equals=function(e){return e==null?ze(this,mt):new this.Collection(this,function(){return vo(e)})},$e.prototype.above=function(e){return e==null?ze(this,mt):new this.Collection(this,function(){return xt(e,void 0,!0)})},$e.prototype.aboveOrEqual=function(e){return e==null?ze(this,mt):new this.Collection(this,function(){return xt(e,void 0,!1)})},$e.prototype.below=function(e){return e==null?ze(this,mt):new this.Collection(this,function(){return xt(void 0,e,!1,!0)})},$e.prototype.belowOrEqual=function(e){return e==null?ze(this,mt):new this.Collection(this,function(){return xt(void 0,e)})},$e.prototype.startsWith=function(e){return typeof e!="string"?ze(this,oo):this.between(e,e+Nt,!0,!0)},$e.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):ar(this,function(t,i){return t.indexOf(i[0])===0},[e],Nt)},$e.prototype.equalsIgnoreCase=function(e){return ar(this,function(t,i){return t===i[0]},[e],"")},$e.prototype.anyOfIgnoreCase=function(){var e=at.apply(wt,arguments);return e.length===0?rn(this):ar(this,function(t,i){return i.indexOf(t)!==-1},e,"")},$e.prototype.startsWithAnyOfIgnoreCase=function(){var e=at.apply(wt,arguments);return e.length===0?rn(this):ar(this,function(t,i){return i.some(function(s){return t.indexOf(s)===0})},e,Nt)},$e.prototype.anyOf=function(){var e,t,i=this,s=at.apply(wt,arguments),l=this._cmp;try{s.sort(l)}catch{return ze(this,mt)}return s.length===0?rn(this):((e=new this.Collection(this,function(){return xt(s[0],s[s.length-1])}))._ondirectionchange=function(c){l=c==="next"?i._ascending:i._descending,s.sort(l)},t=0,e._addAlgorithm(function(c,f,h){for(var b=c.key;0<l(b,s[t]);)if(++t===s.length)return f(h),!1;return l(b,s[t])===0||(f(function(){c.continue(s[t])}),!1)}),e)},$e.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},$e.prototype.noneOf=function(){var e=at.apply(wt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ze(this,mt)}var t=e.reduce(function(i,s){return i?i.concat([[i[i.length-1][1],s]]):[[-1/0,s]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},$e.prototype.inAnyRange=function(e,O){var i=this,s=this._cmp,l=this._ascending,c=this._descending,f=this._min,h=this._max;if(e.length===0)return rn(this);if(!e.every(function(x){return x[0]!==void 0&&x[1]!==void 0&&l(x[0],x[1])<=0}))return ze(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);var b=!O||O.includeLowers!==!1,I=O&&O.includeUppers===!0,w,v=l;function k(x,P){return v(x[0],P[0])}try{(w=e.reduce(function(x,P){for(var j=0,R=x.length;j<R;++j){var q=x[j];if(s(P[0],q[1])<0&&0<s(P[1],q[0])){q[0]=f(q[0],P[0]),q[1]=h(q[1],P[1]);break}}return j===R&&x.push(P),x},[])).sort(k)}catch{return ze(this,mt)}var E=0,_=I?function(x){return 0<l(x,w[E][1])}:function(x){return 0<=l(x,w[E][1])},y=b?function(x){return 0<c(x,w[E][0])}:function(x){return 0<=c(x,w[E][0])},T=_,O=new this.Collection(this,function(){return xt(w[0][0],w[w.length-1][1],!b,!I)});return O._ondirectionchange=function(x){v=x==="next"?(T=_,l):(T=y,c),w.sort(k)},O._addAlgorithm(function(x,P,j){for(var R,q=x.key;T(q);)if(++E===w.length)return P(j),!1;return!_(R=q)&&!y(R)||(i._cmp(q,w[E][1])===0||i._cmp(q,w[E][0])===0||P(function(){v===l?x.continue(w[E][0]):x.continue(w[E][1])}),!1)}),O},$e.prototype.startsWithAnyOf=function(){var e=at.apply(wt,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?rn(this):this.inAnyRange(e.map(function(t){return[t,t+Nt]})):ze(this,"startsWithAnyOf() only works with strings")};var yo=$e;function $e(){}function lt(e){return we(function(t){return Tn(t),e(t.target.error),!1})}function Tn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var On="storagemutated",Zr="x-storagemutated-1",Dt=Dn(null,On),Qa=(ut.prototype._lock=function(){return te(!Q.global),++this._reculock,this._reculock!==1||Q.global||(Q.lockOwnerFor=this),this},ut.prototype._unlock=function(){if(te(!Q.global),--this._reculock==0)for(Q.global||(Q.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{Bt(e[1],e[0])}catch{}}return this},ut.prototype._locked=function(){return this._reculock&&Q.lockOwnerFor!==this},ut.prototype.create=function(e){var t=this;if(this.mode){var i=this.db.idbdb,s=this.db._state.dbOpenError;if(te(!this.idbtrans),!e&&!i)switch(s&&s.name){case"DatabaseClosedError":throw new J.DatabaseClosed(s);case"MissingAPIError":throw new J.MissingAPI(s.message,s);default:throw new J.OpenFailed(s)}if(!this.active)throw new J.TransactionInactive;te(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||i).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=we(function(l){Tn(l),t._reject(e.error)}),e.onabort=we(function(l){Tn(l),t.active&&t._reject(new J.Abort(e.error)),t.active=!1,t.on("abort").fire(l)}),e.oncomplete=we(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Dt.storagemutated.fire(e.mutatedParts)})}return this},ut.prototype._promise=function(e,t,i){var s,l=this;return e==="readwrite"&&this.mode!=="readwrite"?Ie(new J.ReadOnly("Transaction is readonly")):this.active?this._locked()?new W(function(c,f){l._blockedFuncs.push([function(){l._promise(e,t,i).then(c,f)},Q])}):i?kt(function(){var c=new W(function(f,h){l._lock();var b=t(f,h,l);b&&b.then&&b.then(f,h)});return c.finally(function(){return l._unlock()}),c._lib=!0,c}):((s=new W(function(c,f){var h=t(c,f,l);h&&h.then&&h.then(c,f)}))._lib=!0,s):Ie(new J.TransactionInactive)},ut.prototype._root=function(){return this.parent?this.parent._root():this},ut.prototype.waitFor=function(e){var t,i=this._root(),s=W.resolve(e),l=(i._waitingFor?i._waitingFor=i._waitingFor.then(function(){return s}):(i._waitingFor=s,i._waitingQueue=[],t=i.idbtrans.objectStore(i.storeNames[0]),function c(){for(++i._spinCount;i._waitingQueue.length;)i._waitingQueue.shift()();i._waitingFor&&(t.get(-1/0).onsuccess=c)}()),i._waitingFor);return new W(function(c,f){s.then(function(h){return i._waitingQueue.push(we(c.bind(null,h)))},function(h){return i._waitingQueue.push(we(f.bind(null,h)))}).finally(function(){i._waitingFor===l&&(i._waitingFor=null)})})},ut.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},ut.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(D(t,e))return t[e];var i=this.schema[e];if(i)return(i=new this.db.Table(e,i,this)).core=this.db.core.table(e),t[e]=i;throw new J.NotFound("Table "+e+" not part of transaction")},ut);function ut(){}function ei(e,t,i,s,l,c,f,h){return{name:e,keyPath:t,unique:i,multi:s,auto:l,compound:c,src:(i&&!f?"&":"")+(s?"*":"")+(l?"++":"")+bo(t),type:h}}function bo(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function ti(e,t,i){return{name:e,primKey:t,indexes:i,mappedClass:null,idxByName:(s=function(l){return[l.name,l]},i.reduce(function(l,c,f){return c=s(c,f),c&&(l[c[0]]=c[1]),l},{}))};var s}var An=function(e){try{return e.only([[]]),An=function(){return[[]]},[[]]}catch{return An=function(){return Nt},Nt}};function ni(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(i){return i[t]}:function(i){return oe(i,t)}:function(i){return oe(i,e)};var t}function wo(e){return[].slice.call(e)}var Ja=0;function Cn(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Za(e,t,b){function s(_){if(_.type===3)return null;if(_.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var v=_.lower,k=_.upper,E=_.lowerOpen,_=_.upperOpen;return v===void 0?k===void 0?null:t.upperBound(k,!!_):k===void 0?t.lowerBound(v,!!E):t.bound(v,k,!!E,!!_)}function l(w){var v,k=w.name;return{name:k,schema:w,mutate:function(E){var _=E.trans,y=E.type,T=E.keys,O=E.values,x=E.range;return new Promise(function(P,j){P=we(P);var R=_.objectStore(k),q=R.keyPath==null,B=y==="put"||y==="add";if(!B&&y!=="delete"&&y!=="deleteRange")throw new Error("Invalid operation type: "+y);var Y,z=(T||O||{length:1}).length;if(T&&O&&T.length!==O.length)throw new Error("Given keys array must have same length as given values array.");if(z===0)return P({numFailures:0,failures:{},results:[],lastResult:void 0});function N(xe){++me,Tn(xe)}var X=[],fe=[],me=0;if(y==="deleteRange"){if(x.type===4)return P({numFailures:me,failures:fe,results:[],lastResult:void 0});x.type===3?X.push(Y=R.clear()):X.push(Y=R.delete(s(x)))}else{var q=B?q?[O,T]:[O,null]:[T,null],ee=q[0],ae=q[1];if(B)for(var ke=0;ke<z;++ke)X.push(Y=ae&&ae[ke]!==void 0?R[y](ee[ke],ae[ke]):R[y](ee[ke])),Y.onerror=N;else for(ke=0;ke<z;++ke)X.push(Y=R[y](ee[ke])),Y.onerror=N}function Ge(xe){xe=xe.target.result,X.forEach(function(Ft,wi){return Ft.error!=null&&(fe[wi]=Ft.error)}),P({numFailures:me,failures:fe,results:y==="delete"?T:X.map(function(Ft){return Ft.result}),lastResult:xe})}Y.onerror=function(xe){N(xe),Ge(xe)},Y.onsuccess=Ge})},getMany:function(E){var _=E.trans,y=E.keys;return new Promise(function(T,O){T=we(T);for(var x,P=_.objectStore(k),j=y.length,R=new Array(j),q=0,B=0,Y=function(X){X=X.target,R[X._pos]=X.result,++B===q&&T(R)},z=lt(O),N=0;N<j;++N)y[N]!=null&&((x=P.get(y[N]))._pos=N,x.onsuccess=Y,x.onerror=z,++q);q===0&&T(R)})},get:function(E){var _=E.trans,y=E.key;return new Promise(function(T,O){T=we(T);var x=_.objectStore(k).get(y);x.onsuccess=function(P){return T(P.target.result)},x.onerror=lt(O)})},query:(v=h,function(E){return new Promise(function(_,y){_=we(_);var T,O,x,B=E.trans,P=E.values,j=E.limit,q=E.query,R=j===1/0?void 0:j,Y=q.index,q=q.range,B=B.objectStore(k),B=Y.isPrimaryKey?B:B.index(Y.name),Y=s(q);if(j===0)return _({result:[]});v?((q=P?B.getAll(Y,R):B.getAllKeys(Y,R)).onsuccess=function(z){return _({result:z.target.result})},q.onerror=lt(y)):(T=0,O=!P&&"openKeyCursor"in B?B.openKeyCursor(Y):B.openCursor(Y),x=[],O.onsuccess=function(z){var N=O.result;return!N||(x.push(P?N.value:N.primaryKey),++T===j)?_({result:x}):void N.continue()},O.onerror=lt(y))})}),openCursor:function(E){var _=E.trans,y=E.values,T=E.query,O=E.reverse,x=E.unique;return new Promise(function(P,j){P=we(P);var B=T.index,R=T.range,q=_.objectStore(k),q=B.isPrimaryKey?q:q.index(B.name),B=O?x?"prevunique":"prev":x?"nextunique":"next",Y=!y&&"openKeyCursor"in q?q.openKeyCursor(s(R),B):q.openCursor(s(R),B);Y.onerror=lt(j),Y.onsuccess=we(function(z){var N,X,fe,me,ee=Y.result;ee?(ee.___id=++Ja,ee.done=!1,N=ee.continue.bind(ee),X=(X=ee.continuePrimaryKey)&&X.bind(ee),fe=ee.advance.bind(ee),me=function(){throw new Error("Cursor not stopped")},ee.trans=_,ee.stop=ee.continue=ee.continuePrimaryKey=ee.advance=function(){throw new Error("Cursor not started")},ee.fail=we(j),ee.next=function(){var ae=this,ke=1;return this.start(function(){return ke--?ae.continue():ae.stop()}).then(function(){return ae})},ee.start=function(ae){function ke(){if(Y.result)try{ae()}catch(xe){ee.fail(xe)}else ee.done=!0,ee.start=function(){throw new Error("Cursor behind last entry")},ee.stop()}var Ge=new Promise(function(xe,Ft){xe=we(xe),Y.onerror=lt(Ft),ee.fail=Ft,ee.stop=function(wi){ee.stop=ee.continue=ee.continuePrimaryKey=ee.advance=me,xe(wi)}});return Y.onsuccess=we(function(xe){Y.onsuccess=ke,ke()}),ee.continue=N,ee.continuePrimaryKey=X,ee.advance=fe,ke(),Ge},P(ee)):P(null)},j)})},count:function(E){var _=E.query,y=E.trans,T=_.index,O=_.range;return new Promise(function(x,P){var j=y.objectStore(k),j=T.isPrimaryKey?j:j.index(T.name),R=s(O),R=R?j.count(R):j.count();R.onsuccess=we(function(q){return x(q.target.result)}),R.onerror=lt(P)})}}}c=b,f=wo((b=e).objectStoreNames);var c,b={schema:{name:b.name,tables:f.map(function(w){return c.objectStore(w)}).map(function(w){var v=w.keyPath,k=w.autoIncrement,_=m(v),E={},_={name:w.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:v==null,compound:_,keyPath:v,autoIncrement:k,unique:!0,extractKey:ni(v)},indexes:wo(w.indexNames).map(function(y){return w.index(y)}).map(function(x){var P=x.name,T=x.unique,O=x.multiEntry,x=x.keyPath,P={name:P,compound:m(x),keyPath:x,unique:T,multiEntry:O,extractKey:ni(x)};return E[Cn(x)]=P}),getIndexByKeyPath:function(y){return E[Cn(y)]}};return E[":id"]=_.primaryKey,v!=null&&(E[Cn(v)]=_.primaryKey),_})},hasGetAll:0<f.length&&"getAll"in c.objectStore(f[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},f=b.schema,h=b.hasGetAll,b=f.tables.map(l),I={};return b.forEach(function(w){return I[w.name]=w}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(w){if(I[w])return I[w];throw new Error("Table '".concat(w,"' not found"))},MIN_KEY:-1/0,MAX_KEY:An(t),schema:f}}function es(e,t,i,s){return i=i.IDBKeyRange,t=Za(t,i,s),{dbcore:e.dbcore.reduce(function(l,c){return c=c.create,a(a({},l),c(l))},t)}}function sr(e,t){var i=t.db,i=es(e._middlewares,i,e._deps,t);e.core=i.dbcore,e.tables.forEach(function(s){var l=s.name;e.core.schema.tables.some(function(c){return c.name===l})&&(s.core=e.core.table(l),e[l]instanceof e.Table)&&(e[l].core=s.core)})}function lr(e,t,i,s){i.forEach(function(l){var c=s[l];t.forEach(function(f){var h=function b(I,w){return U(I,w)||(I=S(I))&&b(I,w)}(f,l);(!h||"value"in h&&h.value===void 0)&&(f===e.Transaction.prototype||f instanceof e.Transaction?M(f,l,{get:function(){return this.table(l)},set:function(b){L(this,l,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):f[l]=new e.Table(l,c))})})}function ri(e,t){t.forEach(function(i){for(var s in i)i[s]instanceof e.Table&&delete i[s]})}function ts(e,t){return e._cfg.version-t._cfg.version}function ns(e,t,i,s){var l=e._dbSchema,c=(i.objectStoreNames.contains("$meta")&&!l.$meta&&(l.$meta=ti("$meta",ko("")[0],[]),e._storeNames.push("$meta")),e._createTransaction("readwrite",e._storeNames,l)),f=(c.create(i),c._completion.catch(s),c._reject.bind(c)),h=Q.transless||Q;kt(function(){if(Q.trans=c,Q.transless=h,t!==0)return sr(e,i),I=t,((b=c).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(w){return w??I}):W.resolve(I)).then(function(T){var v=e,k=T,E=c,_=i,y=[],T=v._versions,O=v._dbSchema=cr(0,v.idbdb,_);return(T=T.filter(function(x){return x._cfg.version>=k})).length===0?W.resolve():(T.forEach(function(x){y.push(function(){var P,j,R,q=O,B=x._cfg.dbschema,Y=(dr(v,q,_),dr(v,B,_),O=v._dbSchema=B,ii(q,B)),z=(Y.add.forEach(function(N){oi(_,N[0],N[1].primKey,N[1].indexes)}),Y.change.forEach(function(N){if(N.recreate)throw new J.Upgrade("Not yet support for changing primary key");var X=_.objectStore(N.name);N.add.forEach(function(fe){return ur(X,fe)}),N.change.forEach(function(fe){X.deleteIndex(fe.name),ur(X,fe)}),N.del.forEach(function(fe){return X.deleteIndex(fe)})}),x._cfg.contentUpgrade);if(z&&x._cfg.version>k)return sr(v,_),E._memoizedTables={},P=Ce(B),Y.del.forEach(function(N){P[N]=q[N]}),ri(v,[v.Transaction.prototype]),lr(v,[v.Transaction.prototype],p(P),P),E.schema=P,(j=Xt(z))&&en(),B=W.follow(function(){var N;(R=z(E))&&j&&(N=Et.bind(null,null),R.then(N,N))}),R&&typeof R.then=="function"?W.resolve(R):B.then(function(){return R})}),y.push(function(P){var j,R,q=x._cfg.dbschema;j=q,R=P,[].slice.call(R.db.objectStoreNames).forEach(function(B){return j[B]==null&&R.db.deleteObjectStore(B)}),ri(v,[v.Transaction.prototype]),lr(v,[v.Transaction.prototype],v._storeNames,v._dbSchema),E.schema=v._dbSchema}),y.push(function(P){v.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(v.idbdb.version/10)===x._cfg.version?(v.idbdb.deleteObjectStore("$meta"),delete v._dbSchema.$meta,v._storeNames=v._storeNames.filter(function(j){return j!=="$meta"})):P.objectStore("$meta").put(x._cfg.version,"version"))})}),function x(){return y.length?W.resolve(y.shift()(E.idbtrans)).then(x):W.resolve()}().then(function(){_o(O,_)}))}).catch(f);var b,I;p(l).forEach(function(w){oi(i,w,l[w].primKey,l[w].indexes)}),sr(e,i),W.follow(function(){return e.on.populate.fire(c)}).catch(f)})}function rs(e,t){_o(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var i=cr(0,e.idbdb,t);dr(e,e._dbSchema,t);for(var s=0,l=ii(i,e._dbSchema).change;s<l.length;s++){var c=(f=>{if(f.change.length||f.recreate)return console.warn("Unable to patch indexes of table ".concat(f.name," because it has changes on the type of index or primary key.")),{value:void 0};var h=t.objectStore(f.name);f.add.forEach(function(b){st&&console.debug("Dexie upgrade patch: Creating missing index ".concat(f.name,".").concat(b.src)),ur(h,b)})})(l[s]);if(typeof c=="object")return c.value}}function ii(e,t){var i,s={del:[],add:[],change:[]};for(i in e)t[i]||s.del.push(i);for(i in t){var l=e[i],c=t[i];if(l){var f={name:i,def:c,recreate:!1,del:[],add:[],change:[]};if(""+(l.primKey.keyPath||"")!=""+(c.primKey.keyPath||"")||l.primKey.auto!==c.primKey.auto)f.recreate=!0,s.change.push(f);else{var h=l.idxByName,b=c.idxByName,I=void 0;for(I in h)b[I]||f.del.push(I);for(I in b){var w=h[I],v=b[I];w?w.src!==v.src&&f.change.push(v):f.add.push(v)}(0<f.del.length||0<f.add.length||0<f.change.length)&&s.change.push(f)}}else s.add.push([i,c])}return s}function oi(e,t,i,s){var l=e.db.createObjectStore(t,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});s.forEach(function(c){return ur(l,c)})}function _o(e,t){p(e).forEach(function(i){t.db.objectStoreNames.contains(i)||(st&&console.debug("Dexie: Creating missing table",i),oi(t,i,e[i].primKey,e[i].indexes))})}function ur(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function cr(e,t,i){var s={};return F(t.objectStoreNames,0).forEach(function(l){for(var c=i.objectStore(l),f=ei(bo(I=c.keyPath),I||"",!0,!1,!!c.autoIncrement,I&&typeof I!="string",!0),h=[],b=0;b<c.indexNames.length;++b){var w=c.index(c.indexNames[b]),I=w.keyPath,w=ei(w.name,I,!!w.unique,!!w.multiEntry,!1,I&&typeof I!="string",!1);h.push(w)}s[l]=ti(l,f,h)}),s}function dr(e,t,i){for(var s=i.db.objectStoreNames,l=0;l<s.length;++l){var c=s[l],f=i.objectStore(c);e._hasGetAll="getAll"in f;for(var h=0;h<f.indexNames.length;++h){var b,I=f.indexNames[h],w=f.index(I).keyPath,w=typeof w=="string"?w:"["+F(w).join("+")+"]";t[c]&&(b=t[c].idxByName[w])&&(b.name=I,delete t[c].idxByName[w],t[c].idxByName[I]=b)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&d.WorkerGlobalScope&&d instanceof d.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function ko(e){return e.split(",").map(function(t,i){var l=t.split(":"),s=(s=l[1])==null?void 0:s.trim(),l=(t=l[0].trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return ei(l,c||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),m(c),i===0,s)})}on.prototype._createTableSchema=ti,on.prototype._parseIndexSyntax=ko,on.prototype._parseStoresSpec=function(e,t){var i=this;p(e).forEach(function(s){if(e[s]!==null){var l=i._parseIndexSyntax(e[s]),c=l.shift();if(!c)throw new J.Schema("Invalid schema for table "+s+": "+e[s]);if(c.unique=!0,c.multi)throw new J.Schema("Primary key cannot be multiEntry*");l.forEach(function(f){if(f.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),c=i._createTableSchema(s,c,l),t[s]=c}})},on.prototype.stores=function(i){var t=this.db,i=(this._cfg.storesSource=this._cfg.storesSource?g(this._cfg.storesSource,i):i,t._versions),s={},l={};return i.forEach(function(c){g(s,c._cfg.storesSource),l=c._cfg.dbschema={},c._parseStoresSpec(s,l)}),t._dbSchema=l,ri(t,[t._allTables,t,t.Transaction.prototype]),lr(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],p(l),l),t._storeNames=p(l),this},on.prototype.upgrade=function(e){return this._cfg.contentUpgrade=qr(this._cfg.contentUpgrade||ve,e),this};var is=on;function on(){}function ai(e,t){var i=e._dbNamesDB;return i||(i=e._dbNamesDB=new gt(tr,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),i.table("dbnames")}function si(e){return e&&typeof e.databases=="function"}function li(e){return kt(function(){return Q.letThrough=!0,e()})}function ui(e){return!("from"in e)}var je=function(e,t){var i;if(!this)return i=new je,e&&"d"in e&&g(i,e),i;g(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Pn(e,t,i){var s=ce(t,i);if(!isNaN(s)){if(0<s)throw RangeError();if(ui(e))return g(e,{from:t,to:i,d:1});var s=e.l,l=e.r;if(ce(i,e.from)<0)return s?Pn(s,t,i):e.l={from:t,to:i,d:1,l:null,r:null},So(e);if(0<ce(t,e.to))return l?Pn(l,t,i):e.r={from:t,to:i,d:1,l:null,r:null},So(e);ce(t,e.from)<0&&(e.from=t,e.l=null,e.d=l?l.d+1:1),0<ce(i,e.to)&&(e.to=i,e.r=null,e.d=e.l?e.l.d+1:1),t=!e.r,s&&!e.l&&$n(e,s),l&&t&&$n(e,l)}}function $n(e,t){ui(t)||function i(s,l){var c=l.from,f=l.l,h=l.r;Pn(s,c,l.to),f&&i(s,f),h&&i(s,h)}(e,t)}function Eo(e,t){var i=fr(t),s=i.next();if(!s.done)for(var l=s.value,c=fr(e),f=c.next(l.from),h=f.value;!s.done&&!f.done;){if(ce(h.from,l.to)<=0&&0<=ce(h.to,l.from))return!0;ce(l.from,h.from)<0?l=(s=i.next(h.from)).value:h=(f=c.next(l.from)).value}return!1}function fr(e){var t=ui(e)?null:{s:0,n:e};return{next:function(i){for(var s=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,s)for(;t.n.l&&ce(i,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!s||ce(i,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function So(e){var t,i,s,l=(((l=e.r)==null?void 0:l.d)||0)-(((l=e.l)==null?void 0:l.d)||0),l=1<l?"r":l<-1?"l":"";l&&(t=l=="r"?"l":"r",i=a({},e),s=e[l],e.from=s.from,e.to=s.to,e[l]=s[l],i[l]=s[t],(e[t]=i).d=xo(i)),e.d=xo(e)}function xo(i){var t=i.r,i=i.l;return(t?i?Math.max(t.d,i.d):t.d:i?i.d:0)+1}function pr(e,t){return p(t).forEach(function(i){e[i]?$n(e[i],t[i]):e[i]=function s(l){var c,f,h={};for(c in l)D(l,c)&&(f=l[c],h[c]=!f||typeof f!="object"||Fe.has(f.constructor)?f:s(f));return h}(t[i])}),e}function ci(e,t){return e.all||t.all||Object.keys(e).some(function(i){return t[i]&&Eo(t[i],e[i])})}A(je.prototype,((We={add:function(e){return $n(this,e),this},addKey:function(e){return Pn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(i){return Pn(t,i,i)}),this},hasKey:function(e){var t=fr(this).next(e).value;return t&&ce(t.from,e)<=0&&0<=ce(t.to,e)}})[Xe]=function(){return fr(this)},We));var qt={},di={},fi=!1;function hr(e){pr(di,e),fi||(fi=!0,setTimeout(function(){fi=!1,pi(di,!(di={}))},0))}function pi(e,t){t===void 0&&(t=!1);var i=new Set;if(e.all)for(var s=0,l=Object.values(qt);s<l.length;s++)Do(h=l[s],e,i,t);else for(var c in e){var f,h,c=/^idb\:\/\/(.*)\/(.*)\//.exec(c);c&&(f=c[1],c=c[2],h=qt["idb://".concat(f,"/").concat(c)])&&Do(h,e,i,t)}i.forEach(function(b){return b()})}function Do(e,t,i,s){for(var l=[],c=0,f=Object.entries(e.queries.query);c<f.length;c++){for(var h=f[c],b=h[0],I=[],w=0,v=h[1];w<v.length;w++){var k=v[w];ci(t,k.obsSet)?k.subscribers.forEach(function(T){return i.add(T)}):s&&I.push(k)}s&&l.push([b,I])}if(s)for(var E=0,_=l;E<_.length;E++){var y=_[E],b=y[0],I=y[1];e.queries.query[b]=I}}function os(e){var t=e._state,i=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?Ie(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var s=t.openCanceller,l=Math.round(10*e.verno),c=!1;function f(){if(t.openCanceller!==s)throw new J.DatabaseClosed("db.open() was cancelled")}function h(){return new W(function(k,E){if(f(),!i)throw new J.MissingAPI;var _=e.name,y=t.autoSchema||!l?i.open(_):i.open(_,l);if(!y)throw new J.MissingAPI;y.onerror=lt(E),y.onblocked=we(e._fireOnBlocked),y.onupgradeneeded=we(function(T){var O;w=y.transaction,t.autoSchema&&!e._options.allowEmptyDB?(y.onerror=Tn,w.abort(),y.result.close(),(O=i.deleteDatabase(_)).onsuccess=O.onerror=we(function(){E(new J.NoSuchDatabase("Database ".concat(_," doesnt exist")))})):(w.onerror=lt(E),O=T.oldVersion>Math.pow(2,62)?0:T.oldVersion,v=O<1,e.idbdb=y.result,c&&rs(e,w),ns(e,O/10,w,E))},E),y.onsuccess=we(function(){w=null;var T,O,x,P,j,R,q=e.idbdb=y.result,B=F(q.objectStoreNames);if(0<B.length)try{var Y=q.transaction((j=B).length===1?j[0]:j,"readonly");if(t.autoSchema)R=q,P=Y,(x=e).verno=R.version/10,P=x._dbSchema=cr(0,R,P),x._storeNames=F(R.objectStoreNames,0),lr(x,[x._allTables],p(P),P);else if(dr(e,e._dbSchema,Y),O=Y,((O=ii(cr(0,(T=e).idbdb,O),T._dbSchema)).add.length||O.change.some(function(z){return z.add.length||z.change.length}))&&!c)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),q.close(),l=q.version+1,c=!0,k(h());sr(e,Y)}catch{}tn.push(e),q.onversionchange=we(function(z){t.vcFired=!0,e.on("versionchange").fire(z)}),q.onclose=we(function(){e.close({disableAutoOpen:!1})}),v&&(B=e._deps,j=_,si(R=B.indexedDB)||j===tr||ai(R,B.IDBKeyRange).put({name:j}).catch(ve)),k()},E)}).catch(function(k){switch(k==null?void 0:k.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),h();break;case"VersionError":if(0<l)return l=0,h()}return W.reject(k)})}var b,I=t.dbReadyResolve,w=null,v=!1;return W.race([s,(typeof navigator>"u"?W.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(k){function E(){return indexedDB.databases().finally(k)}b=setInterval(E,100),E()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(h)]).then(function(){return f(),t.onReadyBeingFired=[],W.resolve(li(function(){return e.on.ready.fire(e.vip)})).then(function k(){var E;if(0<t.onReadyBeingFired.length)return E=t.onReadyBeingFired.reduce(qr,ve),t.onReadyBeingFired=[],W.resolve(li(function(){return E(e.vip)})).then(k)})}).finally(function(){t.openCanceller===s&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(k){t.dbOpenError=k;try{w&&w.abort()}catch{}return s===t.openCanceller&&e._close(),Ie(k)}).finally(function(){t.openComplete=!0,I()}).then(function(){var k;return v&&(k={},e.tables.forEach(function(E){E.schema.indexes.forEach(function(_){_.name&&(k["idb://".concat(e.name,"/").concat(E.name,"/").concat(_.name)]=new je(-1/0,[[[]]]))}),k["idb://".concat(e.name,"/").concat(E.name,"/")]=k["idb://".concat(e.name,"/").concat(E.name,"/:dels")]=new je(-1/0,[[[]]])}),Dt(On).fire(k),pi(k,!0)),e})}function hi(e){function t(c){return e.next(c)}var i=l(t),s=l(function(c){return e.throw(c)});function l(c){return function(h){var h=c(h),b=h.value;return h.done?b:b&&typeof b.then=="function"?b.then(i,s):m(b)?Promise.all(b).then(i,s):i(b)}}return l(t)()}function mr(e,t,i){for(var s=m(e)?e.slice():[e],l=0;l<i;++l)s.push(t);return s}var as={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return a(a({},e),{table:function(s){var i=e.table(s),s=i.schema,l={},c=[];function f(k,E,_){var x=Cn(k),y=l[x]=l[x]||[],T=k==null?0:typeof k=="string"?1:k.length,O=0<E,x=a(a({},_),{name:O?"".concat(x,"(virtual-from:").concat(_.name,")"):_.name,lowLevelIndex:_,isVirtual:O,keyTail:E,keyLength:T,extractKey:ni(k),unique:!O&&_.unique});return y.push(x),x.isPrimaryKey||c.push(x),1<T&&f(T===2?k[0]:k.slice(0,T-1),E+1,_),y.sort(function(P,j){return P.keyTail-j.keyTail}),x}var h=f(s.primaryKey.keyPath,0,s.primaryKey);l[":id"]=[h];for(var b=0,I=s.indexes;b<I.length;b++){var w=I[b];f(w.keyPath,0,w)}function v(k){var E,_=k.query.index;return _.isVirtual?a(a({},k),{query:{index:_.lowLevelIndex,range:(E=k.query.range,_=_.keyTail,{type:E.type===1?2:E.type,lower:mr(E.lower,E.lowerOpen?e.MAX_KEY:e.MIN_KEY,_),lowerOpen:!0,upper:mr(E.upper,E.upperOpen?e.MIN_KEY:e.MAX_KEY,_),upperOpen:!0})}}):k}return a(a({},i),{schema:a(a({},s),{primaryKey:h,indexes:c,getIndexByKeyPath:function(k){return(k=l[Cn(k)])&&k[0]}}),count:function(k){return i.count(v(k))},query:function(k){return i.query(v(k))},openCursor:function(k){var E=k.query.index,_=E.keyTail,y=E.keyLength;return E.isVirtual?i.openCursor(v(k)).then(function(O){return O&&T(O)}):i.openCursor(k);function T(O){return Object.create(O,{continue:{value:function(x){x!=null?O.continue(mr(x,k.reverse?e.MAX_KEY:e.MIN_KEY,_)):k.unique?O.continue(O.key.slice(0,y).concat(k.reverse?e.MIN_KEY:e.MAX_KEY,_)):O.continue()}},continuePrimaryKey:{value:function(x,P){O.continuePrimaryKey(mr(x,e.MAX_KEY,_),P)}},primaryKey:{get:function(){return O.primaryKey}},key:{get:function(){var x=O.key;return y===1?x[0]:x.slice(0,y)}},value:{get:function(){return O.value}}})}}})}})}};function mi(e,t,i,s){return i=i||{},s=s||"",p(e).forEach(function(l){var c,f,h;D(t,l)?(c=e[l],f=t[l],typeof c=="object"&&typeof f=="object"&&c&&f?(h=ht(c))!==ht(f)?i[s+l]=t[l]:h==="Object"?mi(c,f,i,s+l+"."):c!==f&&(i[s+l]=t[l]):c!==f&&(i[s+l]=t[l])):i[s+l]=void 0}),p(t).forEach(function(l){D(e,l)||(i[s+l]=t[l])}),i}function gi(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var ss={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return a(a({},e),{table:function(t){var i=e.table(t),s=i.schema.primaryKey;return a(a({},i),{mutate:function(l){var c=Q.trans,f=c.table(t).hook,h=f.deleting,b=f.creating,I=f.updating;switch(l.type){case"add":if(b.fire===ve)break;return c._promise("readwrite",function(){return w(l)},!0);case"put":if(b.fire===ve&&I.fire===ve)break;return c._promise("readwrite",function(){return w(l)},!0);case"delete":if(h.fire===ve)break;return c._promise("readwrite",function(){return w(l)},!0);case"deleteRange":if(h.fire===ve)break;return c._promise("readwrite",function(){return function v(k,E,_){return i.query({trans:k,values:!1,query:{index:s,range:E},limit:_}).then(function(y){var T=y.result;return w({type:"delete",keys:T,trans:k}).then(function(O){return 0<O.numFailures?Promise.reject(O.failures[0]):T.length<_?{failures:[],numFailures:0,lastResult:void 0}:v(k,a(a({},E),{lower:T[T.length-1],lowerOpen:!0}),_)})})}(l.trans,l.range,1e4)},!0)}return i.mutate(l);function w(v){var k,E,_,y=Q.trans,T=v.keys||gi(s,v);if(T)return(v=v.type==="add"||v.type==="put"?a(a({},v),{keys:T}):a({},v)).type!=="delete"&&(v.values=u([],v.values)),v.keys&&(v.keys=u([],v.keys)),k=i,_=T,((E=v).type==="add"?Promise.resolve([]):k.getMany({trans:E.trans,keys:_,cache:"immutable"})).then(function(O){var x=T.map(function(P,j){var R,q,B,Y=O[j],z={onerror:null,onsuccess:null};return v.type==="delete"?h.fire.call(z,P,Y,y):v.type==="add"||Y===void 0?(R=b.fire.call(z,P,v.values[j],y),P==null&&R!=null&&(v.keys[j]=P=R,s.outbound||ge(v.values[j],s.keyPath,P))):(R=mi(Y,v.values[j]),(q=I.fire.call(z,R,P,Y,y))&&(B=v.values[j],Object.keys(q).forEach(function(N){D(B,N)?B[N]=q[N]:ge(B,N,q[N])}))),z});return i.mutate(v).then(function(P){for(var j=P.failures,R=P.results,q=P.numFailures,P=P.lastResult,B=0;B<T.length;++B){var Y=(R||T)[B],z=x[B];Y==null?z.onerror&&z.onerror(j[B]):z.onsuccess&&z.onsuccess(v.type==="put"&&O[B]?v.values[B]:Y)}return{failures:j,results:R,numFailures:q,lastResult:P}}).catch(function(P){return x.forEach(function(j){return j.onerror&&j.onerror(P)}),Promise.reject(P)})});throw new Error("Keys missing")}}})}})}};function Io(e,t,i){try{if(!t||t.keys.length<e.length)return null;for(var s=[],l=0,c=0;l<t.keys.length&&c<e.length;++l)ce(t.keys[l],e[c])===0&&(s.push(i?Le(t.values[l]):t.values[l]),++c);return s.length===e.length?s:null}catch{return null}}var ls={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var i=e.table(t);return a(a({},i),{getMany:function(s){var l;return s.cache?(l=Io(s.keys,s.trans._cache,s.cache==="clone"))?W.resolve(l):i.getMany(s).then(function(c){return s.trans._cache={keys:s.keys,values:s.cache==="clone"?Le(c):c},c}):i.getMany(s)},mutate:function(s){return s.type!=="add"&&(s.trans._cache=null),i.mutate(s)}})}}}};function To(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function Oo(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var us={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,i=new je(e.MIN_KEY,e.MAX_KEY);return a(a({},e),{transaction:function(s,l,c){if(Q.subscr&&l!=="readonly")throw new J.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Q.querier));return e.transaction(s,l,c)},table:function(s){function l(T){var y,T=T.query;return[y=T.index,new je((y=(T=T.range).lower)!=null?y:e.MIN_KEY,(y=T.upper)!=null?y:e.MAX_KEY)]}var c=e.table(s),f=c.schema,h=f.primaryKey,b=f.indexes,I=h.extractKey,w=h.outbound,v=h.autoIncrement&&b.filter(function(_){return _.compound&&_.keyPath.includes(h.keyPath)}),k=a(a({},c),{mutate:function(_){function y(X){return X="idb://".concat(t,"/").concat(s,"/").concat(X),j[X]||(j[X]=new je)}var T,O,x,P=_.trans,j=_.mutatedParts||(_.mutatedParts={}),R=y(""),q=y(":dels"),B=_.type,z=_.type==="deleteRange"?[_.range]:_.type==="delete"?[_.keys]:_.values.length<50?[gi(h,_).filter(function(X){return X}),_.values]:[],Y=z[0],z=z[1],N=_.trans._cache;return m(Y)?(R.addKeys(Y),(B=B==="delete"||Y.length===z.length?Io(Y,N):null)||q.addKeys(Y),(B||z)&&(T=y,O=B,x=z,f.indexes.forEach(function(X){var fe=T(X.name||"");function me(ae){return ae!=null?X.extractKey(ae):null}function ee(ae){X.multiEntry&&m(ae)?ae.forEach(function(ke){return fe.addKey(ke)}):fe.addKey(ae)}(O||x).forEach(function(ae,xe){var Ge=O&&me(O[xe]),xe=x&&me(x[xe]);ce(Ge,xe)!==0&&(Ge!=null&&ee(Ge),xe!=null)&&ee(xe)})}))):Y?(z={from:(N=Y.lower)!=null?N:e.MIN_KEY,to:(B=Y.upper)!=null?B:e.MAX_KEY},q.add(z),R.add(z)):(R.add(i),q.add(i),f.indexes.forEach(function(X){return y(X.name).add(i)})),c.mutate(_).then(function(X){return!Y||_.type!=="add"&&_.type!=="put"||(R.addKeys(X.results),v&&v.forEach(function(fe){for(var me=_.values.map(function(Ge){return fe.extractKey(Ge)}),ee=fe.keyPath.findIndex(function(Ge){return Ge===h.keyPath}),ae=0,ke=X.results.length;ae<ke;++ae)me[ae][ee]=X.results[ae];y(fe.name).addKeys(me)})),P.mutatedParts=pr(P.mutatedParts||{},j),X})}}),E={get:function(_){return[h,new je(_.key)]},getMany:function(_){return[h,new je().addKeys(_.keys)]},count:l,query:l,openCursor:l};return p(E).forEach(function(_){k[_]=function(y){var T=Q.subscr,O=!!T,x=To(Q,c)&&Oo(_,y)?y.obsSet={}:T;if(O){var P,T=function(z){return z="idb://".concat(t,"/").concat(s,"/").concat(z),x[z]||(x[z]=new je)},j=T(""),R=T(":dels"),O=E[_](y),q=O[0],O=O[1];if((_==="query"&&q.isPrimaryKey&&!y.values?R:T(q.name||"")).add(O),!q.isPrimaryKey){if(_!=="count")return P=_==="query"&&w&&y.values&&c.query(a(a({},y),{values:!1})),c[_].apply(this,arguments).then(function(z){if(_==="query"){if(w&&y.values)return P.then(function(me){return me=me.result,j.addKeys(me),z});var N=y.values?z.result.map(I):z.result;(y.values?j:R).addKeys(N)}else{var X,fe;if(_==="openCursor")return fe=y.values,(X=z)&&Object.create(X,{key:{get:function(){return R.addKey(X.primaryKey),X.key}},primaryKey:{get:function(){var me=X.primaryKey;return R.addKey(me),me}},value:{get:function(){return fe&&j.addKey(X.primaryKey),X.value}}})}return z});R.add(i)}}return c[_].apply(this,arguments)}}),k}})}};function Ao(e,t,i){var s;return i.numFailures===0?t:t.type==="deleteRange"||(s=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1,i.numFailures===s)?null:(s=a({},t),m(s.keys)&&(s.keys=s.keys.filter(function(l,c){return!(c in i.failures)})),"values"in s&&m(s.values)&&(s.values=s.values.filter(function(l,c){return!(c in i.failures)})),s)}function vi(e,t){return i=e,((s=t).lower===void 0||(s.lowerOpen?0<ce(i,s.lower):0<=ce(i,s.lower)))&&(i=e,(s=t).upper===void 0||(s.upperOpen?ce(i,s.upper)<0:ce(i,s.upper)<=0));var i,s}function Co(e,t,i,s,l,c){var f,h,b,I,w,v;return!i||i.length===0||(f=t.query.index,h=f.multiEntry,b=t.query.range,I=s.schema.primaryKey.extractKey,w=f.extractKey,v=(f.lowLevelIndex||f).extractKey,(s=i.reduce(function(k,E){var _=k,y=[];if(E.type==="add"||E.type==="put")for(var T=new je,O=E.values.length-1;0<=O;--O){var x,P=E.values[O],j=I(P);!T.hasKey(j)&&(x=w(P),h&&m(x)?x.some(function(z){return vi(z,b)}):vi(x,b))&&(T.addKey(j),y.push(P))}switch(E.type){case"add":var R=new je().addKeys(t.values?k.map(function(N){return I(N)}):k),_=k.concat(t.values?y.filter(function(N){return N=I(N),!R.hasKey(N)&&(R.addKey(N),!0)}):y.map(function(N){return I(N)}).filter(function(N){return!R.hasKey(N)&&(R.addKey(N),!0)}));break;case"put":var q=new je().addKeys(E.values.map(function(N){return I(N)}));_=k.filter(function(N){return!q.hasKey(t.values?I(N):N)}).concat(t.values?y:y.map(function(N){return I(N)}));break;case"delete":var B=new je().addKeys(E.keys);_=k.filter(function(N){return!B.hasKey(t.values?I(N):N)});break;case"deleteRange":var Y=E.range;_=k.filter(function(N){return!vi(I(N),Y)})}return _},e))===e)?e:(s.sort(function(k,E){return ce(v(k),v(E))||ce(I(k),I(E))}),t.limit&&t.limit<1/0&&(s.length>t.limit?s.length=t.limit:e.length===t.limit&&s.length<t.limit&&(l.dirty=!0)),c?Object.freeze(s):s)}function Po(e,t){return ce(e.lower,t.lower)===0&&ce(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function cs(e,t){return((i,s,l,c)=>{if(i===void 0)return s!==void 0?-1:0;if(s===void 0)return 1;if((i=ce(i,s))===0){if(l&&c)return 0;if(l)return 1;if(c)return-1}return i})(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=((i,s,l,c)=>{if(i===void 0)return s!==void 0?1:0;if(s===void 0)return-1;if((i=ce(i,s))===0){if(l&&c)return 0;if(l)return-1;if(c)return 1}return i})(e.upper,t.upper,e.upperOpen,t.upperOpen)}function ds(e,t,i,s){e.subscribers.add(i),s.addEventListener("abort",function(){var l,c;e.subscribers.delete(i),e.subscribers.size===0&&(l=e,c=t,setTimeout(function(){l.subscribers.size===0&&Ue(c,l)},3e3))})}var fs={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return a(a({},e),{transaction:function(i,s,l){var c,f,h=e.transaction(i,s,l);return s==="readwrite"&&(l=(c=new AbortController).signal,h.addEventListener("abort",(f=function(b){return function(){if(c.abort(),s==="readwrite"){for(var I=new Set,w=0,v=i;w<v.length;w++){var k=v[w],E=qt["idb://".concat(t,"/").concat(k)];if(E){var _=e.table(k),y=E.optimisticOps.filter(function(X){return X.trans===h});if(h._explicit&&b&&h.mutatedParts)for(var T=0,O=Object.values(E.queries.query);T<O.length;T++)for(var x=0,P=(q=O[T]).slice();x<P.length;x++)ci((B=P[x]).obsSet,h.mutatedParts)&&(Ue(q,B),B.subscribers.forEach(function(X){return I.add(X)}));else if(0<y.length){E.optimisticOps=E.optimisticOps.filter(function(X){return X.trans!==h});for(var j=0,R=Object.values(E.queries.query);j<R.length;j++)for(var q,B,Y,z=0,N=(q=R[j]).slice();z<N.length;z++)(B=N[z]).res!=null&&h.mutatedParts&&(b&&!B.dirty?(Y=Object.isFrozen(B.res),Y=Co(B.res,B.req,y,_,B,Y),B.dirty?(Ue(q,B),B.subscribers.forEach(function(X){return I.add(X)})):Y!==B.res&&(B.res=Y,B.promise=W.resolve({result:Y}))):(B.dirty&&Ue(q,B),B.subscribers.forEach(function(X){return I.add(X)})))}}}I.forEach(function(X){return X()})}}})(!1),{signal:l}),h.addEventListener("error",f(!1),{signal:l}),h.addEventListener("complete",f(!0),{signal:l})),h},table:function(i){var s=e.table(i),l=s.schema.primaryKey;return a(a({},s),{mutate:function(c){var f,h=Q.trans;return!l.outbound&&h.db._options.cache!=="disabled"&&!h.explicit&&h.idbtrans.mode==="readwrite"&&(f=qt["idb://".concat(t,"/").concat(i)])?(h=s.mutate(c),c.type!=="add"&&c.type!=="put"||!(50<=c.values.length||gi(l,c).some(function(b){return b==null}))?(f.optimisticOps.push(c),c.mutatedParts&&hr(c.mutatedParts),h.then(function(b){0<b.numFailures&&(Ue(f.optimisticOps,c),(b=Ao(0,c,b))&&f.optimisticOps.push(b),c.mutatedParts)&&hr(c.mutatedParts)}),h.catch(function(){Ue(f.optimisticOps,c),c.mutatedParts&&hr(c.mutatedParts)})):h.then(function(b){var I=Ao(0,a(a({},c),{values:c.values.map(function(w,v){var k;return b.failures[v]?w:(ge(k=(k=l.keyPath)!=null&&k.includes(".")?Le(w):a({},w),l.keyPath,b.results[v]),k)})}),b);f.optimisticOps.push(I),queueMicrotask(function(){return c.mutatedParts&&hr(c.mutatedParts)})}),h):s.mutate(c)},query:function(c){var f,h,b,I,w,v,k;return To(Q,s)&&Oo("query",c)?(f=((b=Q.trans)==null?void 0:b.db._options.cache)==="immutable",h=(b=Q).requery,b=b.signal,v=((E,_,y,T)=>{var O=qt["idb://".concat(E,"/").concat(_)];if(!O)return[];if(!(E=O.queries[y]))return[null,!1,O,null];var x=E[(T.query?T.query.index.name:null)||""];if(!x)return[null,!1,O,null];switch(y){case"query":var P=x.find(function(j){return j.req.limit===T.limit&&j.req.values===T.values&&Po(j.req.query.range,T.query.range)});return P?[P,!0,O,x]:[x.find(function(j){return("limit"in j.req?j.req.limit:1/0)>=T.limit&&(!T.values||j.req.values)&&cs(j.req.query.range,T.query.range)}),!1,O,x];case"count":return P=x.find(function(j){return Po(j.req.query.range,T.query.range)}),[P,!!P,O,x]}})(t,i,"query",c),k=v[0],I=v[2],w=v[3],k&&v[1]?k.obsSet=c.obsSet:(v=s.query(c).then(function(E){var _=E.result;if(k&&(k.res=_),f){for(var y=0,T=_.length;y<T;++y)Object.freeze(_[y]);Object.freeze(_)}else E.result=Le(_);return E}).catch(function(E){return w&&k&&Ue(w,k),Promise.reject(E)}),k={obsSet:c.obsSet,promise:v,subscribers:new Set,type:"query",req:c,dirty:!1},w?w.push(k):(w=[k],(I=I||(qt["idb://".concat(t,"/").concat(i)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[c.query.index.name||""]=w)),ds(k,w,h,b),k.promise.then(function(E){return{result:Co(E.result,c,I==null?void 0:I.optimisticOps,s,k,f)}})):s.query(c)}})}})}};function gr(e,t){return new Proxy(e,{get:function(i,s,l){return s==="db"?t:Reflect.get(i,s,l)}})}Te.prototype.version=function(e){if(isNaN(e)||e<.1)throw new J.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,i=t.filter(function(s){return s._cfg.version===e})[0];return i||(i=new this.Version(e),t.push(i),t.sort(ts),i.stores({}),this._state.autoSchema=!1),i},Te.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||Q.letThrough||this._vip)?e():new W(function(i,s){if(t._state.openComplete)return s(new J.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void s(new J.DatabaseClosed);t.open().catch(ve)}t._state.dbReadyPromise.then(i,s)}).then(e)},Te.prototype.use=function(l){var t=l.stack,i=l.create,s=l.level,l=l.name,c=(l&&this.unuse({stack:t,name:l}),this._middlewares[t]||(this._middlewares[t]=[]));return c.push({stack:t,create:i,level:s??10,name:l}),c.sort(function(f,h){return f.level-h.level}),this},Te.prototype.unuse=function(e){var t=e.stack,i=e.name,s=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(l){return s?l.create!==s:!!i&&l.name!==i})),this},Te.prototype.open=function(){var e=this;return Bt(_t,function(){return os(e)})},Te.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=tn.indexOf(this);if(0<=t&&tn.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new W(function(i){e.dbReadyResolve=i}),e.openCanceller=new W(function(i,s){e.cancelOpen=s}))},Te.prototype.close=function(t){var t=(t===void 0?{disableAutoOpen:!0}:t).disableAutoOpen,i=this._state;t?(i.isBeingOpened&&i.cancelOpen(new J.DatabaseClosed),this._close(),i.autoOpen=!1,i.dbOpenError=new J.DatabaseClosed):(this._close(),i.autoOpen=this._options.autoOpen||i.isBeingOpened,i.openComplete=!1,i.dbOpenError=null)},Te.prototype.delete=function(e){var t=this,i=(e===void 0&&(e={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),s=this._state;return new W(function(l,c){function f(){t.close(e);var h=t._deps.indexedDB.deleteDatabase(t.name);h.onsuccess=we(function(){var b,I,w;b=t._deps,I=t.name,si(w=b.indexedDB)||I===tr||ai(w,b.IDBKeyRange).delete(I).catch(ve),l()}),h.onerror=lt(c),h.onblocked=t._fireOnBlocked}if(i)throw new J.InvalidArgument("Invalid closeOptions argument to db.delete()");s.isBeingOpened?s.dbReadyPromise.then(f):f()})},Te.prototype.backendDB=function(){return this.idbdb},Te.prototype.isOpen=function(){return this.idbdb!==null},Te.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},Te.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Te.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Te.prototype,"tables",{get:function(){var e=this;return p(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),Te.prototype.transaction=function(){var e=(function(t,i,s){var l=arguments.length;if(l<2)throw new J.InvalidArgument("Too few arguments");for(var c=new Array(l-1);--l;)c[l-1]=arguments[l];return s=c.pop(),[t,ot(c),s]}).apply(this,arguments);return this._transaction.apply(this,e)},Te.prototype._transaction=function(e,t,i){var s,l,c=this,f=Q.trans,h=(f&&f.db===this&&e.indexOf("!")===-1||(f=null),e.indexOf("?")!==-1);e=e.replace("!","").replace("?","");try{if(l=t.map(function(I){if(I=I instanceof c.Table?I.name:I,typeof I!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return I}),e=="r"||e===Xr)s=Xr;else{if(e!="rw"&&e!=Gr)throw new J.InvalidArgument("Invalid transaction mode: "+e);s=Gr}if(f){if(f.mode===Xr&&s===Gr){if(!h)throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");f=null}f&&l.forEach(function(I){if(f&&f.storeNames.indexOf(I)===-1){if(!h)throw new J.SubTransaction("Table "+I+" not included in parent transaction.");f=null}}),h&&f&&!f.active&&(f=null)}}catch(I){return f?f._promise(null,function(w,v){v(I)}):Ie(I)}var b=(function I(w,v,k,E,_){return W.resolve().then(function(){var x=Q.transless||Q,y=w._createTransaction(v,k,w._dbSchema,E),x=(y.explicit=!0,{trans:y,transless:x});if(E)y.idbtrans=E.idbtrans;else try{y.create(),y.idbtrans._explicit=!0,w._state.PR1398_maxLoop=3}catch(P){return P.name===Rr.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return I(w,v,k,null,_)})):Ie(P)}var T,O=Xt(_),x=(O&&en(),W.follow(function(){var P;(T=_.call(y,y))&&(O?(P=Et.bind(null,null),T.then(P,P)):typeof T.next=="function"&&typeof T.throw=="function"&&(T=hi(T)))},x));return(T&&typeof T.then=="function"?W.resolve(T).then(function(P){return y.active?P:Ie(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):x.then(function(){return T})).then(function(P){return E&&y._resolve(),y._completion.then(function(){return P})}).catch(function(P){return y._reject(P),Ie(P)})})}).bind(null,this,s,l,f,i);return f?f._promise(s,b,"lock"):Q.trans?Bt(Q.transless,function(){return c._whenReady(b)}):this._whenReady(b)},Te.prototype.table=function(e){if(D(this._allTables,e))return this._allTables[e];throw new J.InvalidTable("Table ".concat(e," does not exist"))};var gt=Te;function Te(e,t){var i,s,l,c,f,h=this,b=(this._middlewares={},this.verno=0,Te.dependencies),b=(this._options=t=a({addons:Te.addons,autoOpen:!0,indexedDB:b.indexedDB,IDBKeyRange:b.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},t.addons),I=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ve,dbReadyPromise:null,cancelOpen:ve,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen}),w=(I.dbReadyPromise=new W(function(v){I.dbReadyResolve=v}),I.openCanceller=new W(function(v,k){I.cancelOpen=k}),this._state=I,this.name=e,this.on=Dn(this,"populate","blocked","versionchange","close",{ready:[qr,ve]}),this.once=function(v,k){var E=function(){for(var _=[],y=0;y<arguments.length;y++)_[y]=arguments[y];h.on(v).unsubscribe(E),k.apply(h,_)};return h.on(v,E)},this.on.ready.subscribe=G(this.on.ready.subscribe,function(v){return function(k,E){Te.vip(function(){var _,y=h._state;y.openComplete?(y.dbOpenError||W.resolve().then(k),E&&v(k)):y.onReadyBeingFired?(y.onReadyBeingFired.push(k),E&&v(k)):(v(k),_=h,E||v(function T(){_.on.ready.unsubscribe(k),_.on.ready.unsubscribe(T)}))})}}),this.Collection=(i=this,In(Va.prototype,function(T,y){this.db=i;var E=ao,_=null;if(y)try{E=y()}catch(x){_=x}var y=T._ctx,T=y.table,O=T.hook.reading.fire;this._ctx={table:T,index:y.index,isPrimKey:!y.index||T.schema.primKey.keyPath&&y.index===T.schema.primKey.name,range:E,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:_,or:y.or,valueMapper:O!==wn?O:null}})),this.Table=(s=this,In(po.prototype,function(v,k,E){this.db=s,this._tx=E,this.name=v,this.schema=k,this.hook=s._allTables[v]?s._allTables[v].hook:Dn(null,{creating:[Ra,ve],reading:[Na,wn],updating:[Ka,ve],deleting:[qa,ve]})})),this.Transaction=(l=this,In(Qa.prototype,function(v,k,E,_,y){var T=this;v!=="readonly"&&k.forEach(function(O){O=(O=E[O])==null?void 0:O.yProps,O&&(k=k.concat(O.map(function(x){return x.updatesTable})))}),this.db=l,this.mode=v,this.storeNames=k,this.schema=E,this.chromeTransactionDurability=_,this.idbtrans=null,this.on=Dn(this,"complete","error","abort"),this.parent=y||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new W(function(O,x){T._resolve=O,T._reject=x}),this._completion.then(function(){T.active=!1,T.on.complete.fire()},function(O){var x=T.active;return T.active=!1,T.on.error.fire(O),T.parent?T.parent._reject(O):x&&T.idbtrans&&T.idbtrans.abort(),Ie(O)})})),this.Version=(c=this,In(is.prototype,function(v){this.db=c,this._cfg={version:v,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(f=this,In(yo.prototype,function(v,k,E){if(this.db=f,this._ctx={table:v,index:k===":id"?null:k,or:E},this._cmp=this._ascending=ce,this._descending=function(_,y){return ce(y,_)},this._max=function(_,y){return 0<ce(_,y)?_:y},this._min=function(_,y){return ce(_,y)<0?_:y},this._IDBKeyRange=f._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})),this.on("versionchange",function(v){0<v.newVersion?console.warn("Another connection wants to upgrade database '".concat(h.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(h.name,"'. Closing db now to resume the delete request.")),h.close({disableAutoOpen:!1})}),this.on("blocked",function(v){!v.newVersion||v.newVersion<v.oldVersion?console.warn("Dexie.delete('".concat(h.name,"') was blocked")):console.warn("Upgrade '".concat(h.name,"' blocked by other connection holding version ").concat(v.oldVersion/10))}),this._maxKey=An(t.IDBKeyRange),this._createTransaction=function(v,k,E,_){return new h.Transaction(v,k,E,h._options.chromeTransactionDurability,_)},this._fireOnBlocked=function(v){h.on("blocked").fire(v),tn.filter(function(k){return k.name===h.name&&k!==h&&!k._state.vcFired}).map(function(k){return k.on("versionchange").fire(v)})},this.use(ls),this.use(fs),this.use(us),this.use(as),this.use(ss),new Proxy(this,{get:function(v,k,E){var _;return k==="_vip"||(k==="table"?function(y){return gr(h.table(y),w)}:(_=Reflect.get(v,k,E))instanceof po?gr(_,w):k==="tables"?_.map(function(y){return gr(y,w)}):k==="_createTransaction"?function(){return gr(_.apply(this,arguments),w)}:_)}}));this.vip=w,b.forEach(function(v){return v(h)})}var vr,an=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",ps=(yi.prototype.subscribe=function(e,t,i){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:i})},yi.prototype[an]=function(){return this},yi);function yi(e){this._subscribe=e}try{vr={indexedDB:d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,IDBKeyRange:d.IDBKeyRange||d.webkitIDBKeyRange}}catch{vr={indexedDB:null,IDBKeyRange:null}}function $o(e){var t,i=!1,s=new ps(function(l){var c=Xt(e),f,h=!1,b={},I={},w={get closed(){return h},unsubscribe:function(){h||(h=!0,f&&f.abort(),v&&Dt.storagemutated.unsubscribe(E))}},v=(l.start&&l.start(w),!1),k=function(){return Vr(_)},E=function(y){pr(b,y),ci(I,b)&&k()},_=function(){var y,T,O;!h&&vr.indexedDB&&(b={},y={},f&&f.abort(),f=new AbortController,O=(x=>{var P=Jt();try{c&&en();var j=kt(e,x);return j=c?j.finally(Et):j}finally{P&&Zt()}})(T={subscr:y,signal:f.signal,requery:k,querier:e,trans:null}),Promise.resolve(O).then(function(x){i=!0,t=x,h||T.signal.aborted||(b={},(P=>{for(var j in P)if(D(P,j))return;return 1})(I=y)||v||(Dt(On,E),v=!0),Vr(function(){return!h&&l.next&&l.next(x)}))},function(x){i=!1,["DatabaseClosedError","AbortError"].includes(x==null?void 0:x.name)||h||Vr(function(){h||l.error&&l.error(x)})}))};return setTimeout(k,0),w});return s.hasValue=function(){return i},s.getValue=function(){return t},s}var Kt=gt;function bi(e){var t=It;try{It=!0,Dt.storagemutated.fire(e),pi(e,!0)}finally{It=t}}A(Kt,a(a({},et),{delete:function(e){return new Kt(e,{addons:[]}).delete()},exists:function(e){return new Kt(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=Kt.dependencies,i=t.indexedDB,t=t.IDBKeyRange,(si(i)?Promise.resolve(i.databases()).then(function(s){return s.map(function(l){return l.name}).filter(function(l){return l!==tr})}):ai(i,t).toCollection().primaryKeys()).then(e)}catch{return Ie(new J.MissingAPI)}var t,i},defineClass:function(){return function(e){g(this,e)}},ignoreTransaction:function(e){return Q.trans?Bt(Q.transless,e):e()},vip:li,async:function(e){return function(){try{var t=hi(e.apply(this,arguments));return t&&typeof t.then=="function"?t:W.resolve(t)}catch(i){return Ie(i)}}},spawn:function(e,t,i){try{var s=hi(e.apply(i,t||[]));return s&&typeof s.then=="function"?s:W.resolve(s)}catch(l){return Ie(l)}},currentTransaction:{get:function(){return Q.trans||null}},waitFor:function(e,t){return e=W.resolve(typeof e=="function"?Kt.ignoreTransaction(e):e).timeout(t||6e4),Q.trans?Q.trans.waitFor(e):e},Promise:W,debug:{get:function(){return st},set:function(e){Zi(e)}},derive:$,extend:g,props:A,override:G,Events:Dn,on:Dt,liveQuery:$o,extendObservabilitySet:pr,getByKeyPath:oe,setByKeyPath:ge,delByKeyPath:function(e,t){typeof t=="string"?ge(e,t,void 0):"length"in t&&[].map.call(t,function(i){ge(e,i,void 0)})},shallowClone:Ce,deepClone:Le,getObjectDiff:mi,cmp:ce,asap:se,minKey:-1/0,addons:[],connections:tn,errnames:Rr,dependencies:vr,cache:qt,semVer:"4.3.0",version:"4.3.0".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,i){return e+t/Math.pow(10,2*i)})})),Kt.maxKey=An(Kt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Dt(On,function(e){It||(e=new CustomEvent(Zr,{detail:e}),It=!0,dispatchEvent(e),It=!1)}),addEventListener(Zr,function(e){e=e.detail,It||bi(e)}));var sn,It=!1,Lo=function(){};return typeof BroadcastChannel<"u"&&((Lo=function(){(sn=new BroadcastChannel(Zr)).onmessage=function(e){return e.data&&bi(e.data)}})(),typeof sn.unref=="function"&&sn.unref(),Dt(On,function(e){It||sn.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!gt.disableBfCache&&e.persisted){st&&console.debug("Dexie: handling persisted pagehide"),sn!=null&&sn.close();for(var t=0,i=tn;t<i.length;t++)i[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!gt.disableBfCache&&e.persisted&&(st&&console.debug("Dexie: handling persisted pageshow"),Lo(),bi({all:new je(-1/0,[[]])}))})),W.rejectionMapper=function(e,t){return!e||e instanceof Gt||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ji[e.name]?e:(t=new Ji[e.name](t||e.message,e),"stack"in e&&M(t,"stack",{get:function(){return this.inner.stack}}),t)},Zi(st),a(gt,Object.freeze({__proto__:null,Dexie:gt,Entity:so,PropModification:xn,RangeSet:je,add:function(e){return new xn({add:e})},cmp:ce,default:gt,liveQuery:$o,mergeRanges:$n,rangesOverlap:Eo,remove:function(e){return new xn({remove:e})},replacePrefix:function(e,t){return new xn({replacePrefix:[e,t]})}}),{default:gt}),gt})})(ta);var ks=ta.exports;const $i=_s(ks),jo=Symbol.for("Dexie"),Ar=globalThis[jo]||(globalThis[jo]=$i);if($i.semVer!==Ar.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${$i.semVer} and ${Ar.semVer}`);const{liveQuery:kl,mergeRanges:El,rangesOverlap:Sl,RangeSet:xl,cmp:Dl,Entity:Il,PropModification:Tl,replacePrefix:Ol,add:Al,remove:Cl,DexieYProvider:Pl}=Ar;class Es extends Ar{constructor(){super("GymDatabase");tt(this,"workouts");tt(this,"logs");tt(this,"workoutTypes");tt(this,"profile");this.version(1).stores({workouts:"id, status, startTime, updatedAt, isDeleted",logs:"id, workoutId, workoutTypeId, date, updatedAt, isDeleted",workoutTypes:"id, updatedAt, isDeleted",profile:"id, updatedAt, isDeleted"})}}const Z=new Es,Fi="gym_web_auth";function Ui(){const o=localStorage.getItem(Fi);try{return o?JSON.parse(o):null}catch{return null}}function na(o){localStorage.setItem(Fi,JSON.stringify(o))}function Ss(){localStorage.removeItem(Fi)}function Li(){const o=Ui();if(!o)return null;const n=new URLSearchParams;return Object.entries(o).forEach(([r,a])=>{a!=null&&n.append(r,String(a))}),n.toString()}var Go;const yr=(Go=window.Telegram)==null?void 0:Go.WebApp,Bo="https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4";class _i{static getHeaders(){const n={"Content-Type":"application/json"};if(yr!=null&&yr.initData)localStorage.getItem("skip_tma_auth")==="true"||(n["X-Telegram-Init-Data"]=yr.initData);else{const r=Li();r&&(n["X-Telegram-Init-Data"]=r)}return n}static async sync(){if(!navigator.onLine)throw new Error("Offline");const n=this.getHeaders(),r=await fetch(Bo,{headers:n});if(!r.ok)throw r.status===401?new Error("Unauthorized"):new Error("Sync failed");const a=await r.json();await this.mergeData(a);const u=await this.readAll();await fetch(Bo,{method:"POST",headers:n,body:JSON.stringify(u)})}static async mergeData(n){await Z.transaction("rw",Z.workouts,Z.logs,Z.workoutTypes,Z.profile,async()=>{if(await this.mergeTable(Z.workouts,n.workouts),await this.mergeTable(Z.logs,n.logs),await this.mergeTable(Z.workoutTypes,n.workoutTypes),n.profile){const r={...n.profile,id:"me"};await this.mergeTable(Z.profile,[r])}})}static async mergeTable(n,r=[]){const a=await n.toArray(),u=new Map(a.map(d=>[d.id,d]));for(const d of r){const p=u.get(d.id);if(!p)await n.put(d);else{const m=new Date(d.updatedAt).getTime(),g=new Date(p.updatedAt).getTime();m>g&&await n.put(d)}}}static async readAll(){return{workouts:await Z.workouts.toArray(),logs:await Z.logs.toArray(),workoutTypes:await Z.workoutTypes.toArray(),profile:(await Z.profile.toArray())[0]}}}const xs="gym_twa_data";var Qo;const ln=(Qo=window.Telegram)==null?void 0:Qo.WebApp,ki={workoutTypes:[{id:"1",name:"Жим лежа",updatedAt:new Date().toISOString()},{id:"2",name:"Приседания",updatedAt:new Date().toISOString()},{id:"3",name:"Становая тяга",updatedAt:new Date().toISOString()}],logs:[],workouts:[]};class Ds{constructor(){tt(this,"onUpdateCallback");tt(this,"onSyncStatusChangeCallback");tt(this,"onUnauthorizedCallback");tt(this,"status","idle");tt(this,"cache",{...ki});tt(this,"SERVER_URL","https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4");this.init()}async init(){await this.migrateFromLocalStorage(),this.sync().catch(console.error)}async migrateFromLocalStorage(){const n=localStorage.getItem(xs);if(n)try{const r=JSON.parse(n);if(await Z.workoutTypes.count()===0){console.log("Migrating from localStorage to IDB...");const u=new Date().toISOString(),d=(r.workoutTypes||ki.workoutTypes).map(g=>({...g,updatedAt:u}));await Z.workoutTypes.bulkPut(d);const p=(r.logs||[]).map(g=>({...g,updatedAt:u,workoutId:g.workoutId||"legacy"}));await Z.logs.bulkPut(p);const m=(r.workouts||[]).map(g=>({...g,updatedAt:u}));if(await Z.workouts.bulkPut(m),r.profile){const g={...r.profile,id:"me",updatedAt:u};await Z.profile.put(g)}}}catch(r){console.error("Migration failed",r)}else await Z.workoutTypes.count()===0&&await Z.workoutTypes.bulkPut(ki.workoutTypes)}onUpdate(n){this.onUpdateCallback=n}onSyncStatusChange(n){this.onSyncStatusChangeCallback=n}onUnauthorized(n){this.onUnauthorizedCallback=n}setStatus(n){var r;this.status=n,(r=this.onSyncStatusChangeCallback)==null||r.call(this,n),n==="success"&&setTimeout(()=>{this.status==="success"&&this.setStatus("idle")},2e3)}async sync(){var r,a,u;const n=localStorage.getItem("skip_tma_auth")==="true";if(n&&!Li()){this.setStatus("idle");return}try{this.setStatus("saving"),await _i.sync(),this.setStatus("success"),(r=this.onUpdateCallback)==null||r.call(this)}catch(d){if(console.error("Sync failed",d),(d instanceof Error?d.message:String(d)).toLowerCase().includes("unauthorized")){if(n){this.setStatus("error"),(a=this.onUnauthorizedCallback)==null||a.call(this);return}localStorage.setItem("skip_tma_auth","true"),Ss(),(u=this.onUnauthorizedCallback)==null||u.call(this),location.reload();return}d instanceof Error&&d.message==="Offline"?this.setStatus("idle"):this.setStatus("error")}}async reloadCache(){var n;this.cache=await _i.readAll(),(n=this.onUpdateCallback)==null||n.call(this)}getWorkoutTypes(){return this.cache.workoutTypes.filter(r=>!r.isDeleted).sort((r,a)=>(r.order??1/0)-(a.order??1/0))}getLogs(){return this.cache.logs.filter(n=>!n.isDeleted)}getWorkouts(){return this.cache.workouts.filter(n=>!n.isDeleted)}getActiveWorkout(){return this.cache.workouts.find(n=>!n.isDeleted&&(n.status==="active"||n.status==="paused"))}getProfile(){return this.cache.profile}async addWorkoutType(n,r="strength"){const a=this.getWorkoutTypes(),u=a.length>0?Math.max(...a.map(p=>p.order??0)):0,d={id:Date.now().toString(),name:n,category:r,order:u+1,updatedAt:new Date().toISOString()};return await Z.workoutTypes.put(d),await this.reloadCache(),this.sync().catch(()=>{}),d}async deleteWorkoutType(n){const r=await Z.workoutTypes.get(n);r&&(r.isDeleted=!0,r.updatedAt=new Date().toISOString(),await Z.workoutTypes.put(r),await this.reloadCache(),this.sync().catch(()=>{}))}async updateWorkoutType(n,r,a){const u=await Z.workoutTypes.get(n);u&&(u.name=r,a&&(u.category=a),u.updatedAt=new Date().toISOString(),await Z.workoutTypes.put(u),await this.reloadCache(),this.sync().catch(()=>{}))}async startWorkout(n){this.getActiveWorkout()&&await this.finishWorkout();const a={id:Date.now().toString(),startTime:new Date().toISOString(),status:"active",name:n,isManual:!0,pauseIntervals:[],updatedAt:new Date().toISOString()};return await Z.workouts.put(a),await this.reloadCache(),this.sync().catch(()=>{}),a}async pauseWorkout(){const n=this.getActiveWorkout();n&&n.status==="active"&&(n.status="paused",n.pauseIntervals.push({start:new Date().toISOString()}),n.updatedAt=new Date().toISOString(),await Z.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{}))}async resumeWorkout(){const n=this.getActiveWorkout();if(n&&n.status==="paused"){n.status="active";const r=n.pauseIntervals[n.pauseIntervals.length-1];r&&!r.end&&(r.end=new Date().toISOString()),n.updatedAt=new Date().toISOString(),await Z.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}async finishWorkout(){const n=this.getActiveWorkout();if(n){n.status="finished",n.endTime=new Date().toISOString();const r=n.pauseIntervals[n.pauseIntervals.length-1];r&&!r.end&&(r.end=n.endTime),n.updatedAt=new Date().toISOString(),await Z.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}getWorkoutDuration(n){const r=new Date(n.startTime).getTime(),a=n.endTime?new Date(n.endTime).getTime():Date.now();let u=a-r;n.pauseIntervals.forEach(g=>{const S=new Date(g.start).getTime(),C=g.end?new Date(g.end).getTime():n.status==="paused"?Date.now():a;C>S&&(u-=C-S)});const d=Math.floor(Math.max(0,u)/6e4),m=this.cache.logs.filter(g=>g.workoutId===n.id&&!g.isDeleted).reduce((g,S)=>g+(S.duration||0),0);return Math.max(d,m)}async ensureActiveWorkout(){const n=this.getActiveWorkout();if(n)return n.id;const r=new Date().toISOString().split("T")[0],d=this.getWorkouts().filter(g=>g.startTime.startsWith(r)).sort((g,S)=>new Date(S.startTime).getTime()-new Date(g.startTime).getTime())[0];if(d&&!d.isManual&&d.status==="finished")return d.endTime=new Date().toISOString(),d.updatedAt=new Date().toISOString(),await Z.workouts.put(d),await this.reloadCache(),d.id;const p=`implicit_${r}_${Date.now()}`,m={id:p,startTime:new Date().toISOString(),endTime:new Date().toISOString(),status:"finished",isManual:!1,pauseIntervals:[],updatedAt:new Date().toISOString()};return await Z.workouts.put(m),await this.reloadCache(),p}async updateImplicitWorkoutBounds(n){const r=await Z.workouts.get(n);if(!r||r.isManual)return;const u=(await Z.logs.where("workoutId").equals(n).toArray()).filter(p=>!p.isDeleted);if(u.length===0)return;const d=u.sort((p,m)=>new Date(p.date).getTime()-new Date(m.date).getTime());r.startTime=d[0].date,r.endTime=d[d.length-1].date,r.status="finished",r.updatedAt=new Date().toISOString(),await Z.workouts.put(r)}async addLog(n){const r=await this.ensureActiveWorkout(),a={...n,id:Date.now().toString(),date:new Date().toISOString(),workoutId:r,updatedAt:new Date().toISOString()};return await Z.logs.put(a),await this.updateImplicitWorkoutBounds(r),await this.reloadCache(),this.sync().catch(()=>{}),a}async deleteLog(n){const r=await Z.logs.get(n);if(r){const a=r.workoutId;r.isDeleted=!0,r.updatedAt=new Date().toISOString(),await Z.logs.put(r),a&&await this.updateImplicitWorkoutBounds(a),await this.reloadCache(),this.sync().catch(()=>{})}}async updateLog(n){const r={...n,updatedAt:new Date().toISOString()};await Z.logs.put(r),await this.reloadCache(),this.sync().catch(()=>{})}getProfileIdentifier(){var a,u;const n=this.cache.profile;if(n!=null&&n.telegramUsername)return n.telegramUsername;if(n!=null&&n.telegramUserId)return`id_${n.telegramUserId}`;const r=(u=(a=ln==null?void 0:ln.initDataUnsafe)==null?void 0:a.user)==null?void 0:u.id;return r?`id_${r}`:""}async updateProfileSettings(n){var p;const r=(p=ln==null?void 0:ln.initDataUnsafe)==null?void 0:p.user,a=r==null?void 0:r.id;let u=this.cache.profile;u?r!=null&&r.photo_url&&(u.photoUrl=r.photo_url):u={id:"me",isPublic:!1,showFullHistory:!1,telegramUserId:a||0,telegramUsername:r==null?void 0:r.username,photoUrl:r==null?void 0:r.photo_url,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),friends:[]};const d={...u,...n,updatedAt:new Date().toISOString()};await Z.profile.put(d),await this.reloadCache(),this.sync().catch(()=>{})}async addFriend(n){const r=this.cache.profile;if(!r)return;const a=r.friends||[];if(a.some(d=>d.identifier===n.identifier))return;const u={...n,addedAt:new Date().toISOString()};await this.updateProfileSettings({friends:[...a,u]})}async removeFriend(n){const r=this.cache.profile;if(!r||!r.friends)return;const a=r.friends.filter(u=>u.identifier!==n);await this.updateProfileSettings({friends:a})}isFriend(n){var a;const r=this.cache.profile;return((a=r==null?void 0:r.friends)==null?void 0:a.some(u=>u.identifier===n))??!1}async updateWorkoutTypeOrder(n){const r=n.map((a,u)=>{const d=this.cache.workoutTypes.find(p=>p.id===a);return d?{...d,order:u,updatedAt:new Date().toISOString()}:null}).filter(Boolean);r.length>0&&(await Z.workoutTypes.bulkPut(r),await this.reloadCache(),this.sync().catch(()=>{}))}async getPublicProfile(n){try{const r=await fetch(`${this.SERVER_URL}?profile=${encodeURIComponent(n)}`);return r.ok?await r.json():null}catch{return null}}async getAIRecommendation(n,r){const a=Li();if(!a)throw new Error("Unauthorized");const u=await fetch(`${this.SERVER_URL}?action=ai`,{method:"POST",headers:{"X-Telegram-Init-Data":a,"Content-Type":"application/json"},body:JSON.stringify({type:n,options:r})});if(!u.ok)throw new Error("AI Generation Failed");return(await u.json()).recommendation}async exportData(){return await _i.readAll()}async importData(n){if(!n.logs||!n.workoutTypes)throw new Error("Invalid data format");await Z.transaction("rw",Z.workouts,Z.logs,Z.workoutTypes,Z.profile,async()=>{var r,a,u;await Z.workouts.clear(),await Z.logs.clear(),await Z.workoutTypes.clear(),await Z.profile.clear(),(r=n.workouts)!=null&&r.length&&await Z.workouts.bulkAdd(n.workouts),(a=n.logs)!=null&&a.length&&await Z.logs.bulkAdd(n.logs),(u=n.workoutTypes)!=null&&u.length&&await Z.workoutTypes.bulkAdd(n.workoutTypes),n.profile&&await Z.profile.put({...n.profile,id:"me"})}),await this.reloadCache(),this.sync().catch(()=>{})}}const V=new Ds;V.reloadCache().then(()=>{});function Is(o=0,n=0){return n===1?o:Math.round(o*(1+n/30))}function Ts(o,n){const r=new Map;return o.filter(u=>u.workoutTypeId===n).forEach(u=>{const d=u.date.split("T")[0],p=Is(u.weight||0,u.reps||0),m=r.get(d)||0;p>m&&r.set(d,p)}),r}function Os(o,n){const r=new Set;return o.forEach(a=>r.add(a.startTime.split("T")[0])),n.forEach(a=>r.add(a.date.split("T")[0])),r}function As(o){const n=o.filter(d=>d.endTime&&d.status==="finished");if(n.length===0)return{averageMinutes:0,totalMinutes:0,count:0};let r=0;n.forEach(d=>{const p=new Date(d.startTime).getTime(),m=new Date(d.endTime).getTime();let g=m-p;d.pauseIntervals&&d.pauseIntervals.forEach(S=>{const C=new Date(S.start).getTime(),D=S.end?new Date(S.end).getTime():m;g-=D-C}),r+=g});const a=Math.round(r/1e3/60);return{averageMinutes:Math.round(a/n.length),totalMinutes:a,count:n.length}}function ra(o,n=6){const r=new Date,a=new Date(r);a.setMonth(r.getMonth()-n),a.setDate(a.getDate()-a.getDay());let u='<div class="heatmap-container"><div class="heatmap-grid">';const d=new Date(a),p=new Date(r);for(;d<=p;){const m=d.toISOString().split("T")[0],g=o.has(m),C=`heatmap-cell level-${g?4:0}`,D=`${m}: ${g?"Workout":"No workout"}`;u+=`<div class="${C}" title="${D}"></div>`,d.setDate(d.getDate()+1)}return u+="</div>",u+=`
        <div class="heatmap-legend">
            Less <div class="heatmap-cell level-0"></div>
            <div class="heatmap-cell level-4"></div> More
        </div>
    `,u+="</div>",u}function No(o){const n=new Map;o.forEach(u=>{const d=u.date.split("T")[0],p=(u.weight||0)*(u.reps||0);n.set(d,(n.get(d)||0)+p)});const r=Array.from(n.keys()).sort().slice(-10);if(r.length<2)return'<p class="hint">Недостаточно данных для графика объема</p>';const a=r.map(u=>({label:new Date(u).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:n.get(u)}));return $s(a,"кг")}function Cs(o){const n=Array.from(o.keys()).sort();if(n.length<2)return'<p class="hint">Недостаточно данных для графика 1RM</p>';const r=n.map(a=>({label:new Date(a).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:o.get(a)}));return ia(r,"кг")}function Ps(o){const n=o.filter(a=>a.status==="finished"&&a.endTime).sort((a,u)=>new Date(a.startTime).getTime()-new Date(u.startTime).getTime()).slice(-10);if(n.length<2)return'<p class="hint">Недостаточно данных для графика продолжительности</p>';const r=n.map(a=>{const u=new Date(a.startTime).getTime(),d=new Date(a.endTime).getTime();let p=(d-u)/1e3/60;return a.pauseIntervals&&a.pauseIntervals.forEach(m=>{const g=new Date(m.start).getTime(),S=m.end?new Date(m.end).getTime():d;p-=(S-g)/1e3/60}),{label:new Date(a.startTime).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:Math.round(p)}});return ia(r,"мин")}function $s(o,n){const u=Math.max(...o.map(p=>p.value))*1.1;return`
        <svg width="100%" height="150" preserveAspectRatio="none">
            ${o.map((p,m)=>{const g=p.value/u*100,S=m/o.length*100,C=1/o.length*80;return`
            <rect x="${S+5}%" y="${100-g}%" width="${C}%" height="${g}%" fill="var(--color-button)" rx="2" opacity="0.8">
               <title>${p.label}: ${p.value}${n}</title>
            </rect>
            <text x="${S+5+C/2}%" y="95%" font-size="10" text-anchor="middle" fill="var(--color-text)" style="pointer-events: none;">
                ${p.label}
            </text>
        `}).join("")}
        </svg>
    `}function ia(o,n){const d=o.map(L=>L.value),p=Math.min(...d),m=Math.max(...d),g=m-p||1,S=L=>20+L/(o.length-1)*(400-2*20),C=L=>130-(L-p)/g*(150-2*20),D=o.map((L,M)=>`${S(M)},${C(L.value)}`).join(" "),A=o.map((L,M)=>`
        <circle cx="${S(M)}" cy="${C(L.value)}" r="4" fill="var(--color-bg)" stroke="var(--color-button)" stroke-width="2">
            <title>${L.label}: ${L.value}${n}</title>
        </circle>
    `).join("");return`
        <svg viewBox="0 0 400 150" class="chart">
             <polyline
                fill="none"
                stroke="var(--color-button)"
                stroke-width="3"
                stroke-linejoin="round"
                stroke-linecap="round"
                points="${D}"
            />
            ${A}
        </svg>
        <div style="display: flex; justify-content: space-between; margin-top: 4px; font-size: 12px; color: var(--color-hint);">
            <span>${Math.round(p)}${n}</span>
            <span>${Math.round(m)}${n}</span>
        </div>
    `}function oa(o,n){o.innerHTML=`
        <div class="page-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 24px;">🏋️</div>
            <h1 class="title" style="margin-bottom: 12px;">Жим-жим 21</h1>
            <p class="subtitle" style="margin-bottom: 32px; opacity: 0.7;">Войдите через Telegram, чтобы синхронизировать тренировки</p>
            <div id="telegram-login-container"></div>
        </div>
    `,window.onTelegramAuth=u=>{console.log("Telegram auth callback received:",u),na(u),localStorage.removeItem("skip_tma_auth"),n()};const r=document.createElement("script");r.src="https://telegram.org/js/telegram-widget.js?22",r.async=!0,r.setAttribute("data-telegram-login","gymgym21bot"),r.setAttribute("data-size","large"),r.setAttribute("data-radius","12"),r.setAttribute("data-onauth","onTelegramAuth(user)"),r.setAttribute("data-request-access","write");const a=document.getElementById("telegram-login-container");a&&a.appendChild(r)}const Ls="modulepreload",Ms=function(o,n){return new URL(o,n).href},Ro={},js=function(n,r,a){let u=Promise.resolve();if(r&&r.length>0){const p=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),g=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));u=Promise.allSettled(r.map(S=>{if(S=Ms(S,a),S in Ro)return;Ro[S]=!0;const C=S.endsWith(".css"),D=C?'[rel="stylesheet"]':"";if(!!a)for(let M=p.length-1;M>=0;M--){const $=p[M];if($.href===S&&(!C||$.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${S}"]${D}`))return;const L=document.createElement("link");if(L.rel=C?"stylesheet":Ls,C||(L.as="script"),L.crossOrigin="",L.href=S,g&&L.setAttribute("nonce",g),document.head.appendChild(L),C)return new Promise((M,$)=>{L.addEventListener("load",M),L.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${S}`)))})}))}function d(p){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=p,window.dispatchEvent(m),!m.defaultPrevented)throw p}return u.then(p=>{for(const m of p||[])m.status==="rejected"&&d(m.reason);return n().catch(d)})};function Bs(o={}){const{immediate:n=!1,onNeedRefresh:r,onOfflineReady:a,onRegistered:u,onRegisteredSW:d,onRegisterError:p}=o;let m,g;const S=async(D=!0)=>{await g};async function C(){if("serviceWorker"in navigator){if(m=await js(async()=>{const{Workbox:D}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:D}},[],import.meta.url).then(({Workbox:D})=>new D("./sw.js",{scope:"./",type:"classic"})).catch(D=>{p==null||p(D)}),!m)return;m.addEventListener("activated",D=>{(D.isUpdate||D.isExternal)&&window.location.reload()}),m.addEventListener("installed",D=>{D.isUpdate||a==null||a()}),m.register({immediate:n}).then(D=>{d?d("./sw.js",D):u==null||u(D)}).catch(D=>{p==null||p(D)})}}return g=C(),S}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function qo(o,n){var r=Object.keys(o);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(o);n&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(o,u).enumerable})),r.push.apply(r,a)}return r}function ft(o){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?qo(Object(r),!0).forEach(function(a){Ns(o,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):qo(Object(r)).forEach(function(a){Object.defineProperty(o,a,Object.getOwnPropertyDescriptor(r,a))})}return o}function Er(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Er=function(n){return typeof n}:Er=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Er(o)}function Ns(o,n,r){return n in o?Object.defineProperty(o,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):o[n]=r,o}function yt(){return yt=Object.assign||function(o){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(o[a]=r[a])}return o},yt.apply(this,arguments)}function Rs(o,n){if(o==null)return{};var r={},a=Object.keys(o),u,d;for(d=0;d<a.length;d++)u=a[d],!(n.indexOf(u)>=0)&&(r[u]=o[u]);return r}function qs(o,n){if(o==null)return{};var r=Rs(o,n),a,u;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(o);for(u=0;u<d.length;u++)a=d[u],!(n.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(o,a)&&(r[a]=o[a])}return r}var Ks="1.15.6";function vt(o){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(o)}var bt=vt(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Wn=vt(/Edge/i),Ko=vt(/firefox/i),Rn=vt(/safari/i)&&!vt(/chrome/i)&&!vt(/android/i),Wi=vt(/iP(ad|od|hone)/i),aa=vt(/chrome/i)&&vt(/android/i),sa={capture:!1,passive:!1};function de(o,n,r){o.addEventListener(n,r,!bt&&sa)}function ue(o,n,r){o.removeEventListener(n,r,!bt&&sa)}function Cr(o,n){if(n){if(n[0]===">"&&(n=n.substring(1)),o)try{if(o.matches)return o.matches(n);if(o.msMatchesSelector)return o.msMatchesSelector(n);if(o.webkitMatchesSelector)return o.webkitMatchesSelector(n)}catch{return!1}return!1}}function la(o){return o.host&&o!==document&&o.host.nodeType?o.host:o.parentNode}function rt(o,n,r,a){if(o){r=r||document;do{if(n!=null&&(n[0]===">"?o.parentNode===r&&Cr(o,n):Cr(o,n))||a&&o===r)return o;if(o===r)break}while(o=la(o))}return null}var Fo=/\s+/g;function He(o,n,r){if(o&&n)if(o.classList)o.classList[r?"add":"remove"](n);else{var a=(" "+o.className+" ").replace(Fo," ").replace(" "+n+" "," ");o.className=(a+(r?" "+n:"")).replace(Fo," ")}}function ne(o,n,r){var a=o&&o.style;if(a){if(r===void 0)return document.defaultView&&document.defaultView.getComputedStyle?r=document.defaultView.getComputedStyle(o,""):o.currentStyle&&(r=o.currentStyle),n===void 0?r:r[n];!(n in a)&&n.indexOf("webkit")===-1&&(n="-webkit-"+n),a[n]=r+(typeof r=="string"?"":"px")}}function vn(o,n){var r="";if(typeof o=="string")r=o;else do{var a=ne(o,"transform");a&&a!=="none"&&(r=a+" "+r)}while(!n&&(o=o.parentNode));var u=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return u&&new u(r)}function ua(o,n,r){if(o){var a=o.getElementsByTagName(n),u=0,d=a.length;if(r)for(;u<d;u++)r(a[u],u);return a}return[]}function dt(){var o=document.scrollingElement;return o||document.documentElement}function Ae(o,n,r,a,u){if(!(!o.getBoundingClientRect&&o!==window)){var d,p,m,g,S,C,D;if(o!==window&&o.parentNode&&o!==dt()?(d=o.getBoundingClientRect(),p=d.top,m=d.left,g=d.bottom,S=d.right,C=d.height,D=d.width):(p=0,m=0,g=window.innerHeight,S=window.innerWidth,C=window.innerHeight,D=window.innerWidth),(n||r)&&o!==window&&(u=u||o.parentNode,!bt))do if(u&&u.getBoundingClientRect&&(ne(u,"transform")!=="none"||r&&ne(u,"position")!=="static")){var A=u.getBoundingClientRect();p-=A.top+parseInt(ne(u,"border-top-width")),m-=A.left+parseInt(ne(u,"border-left-width")),g=p+d.height,S=m+d.width;break}while(u=u.parentNode);if(a&&o!==window){var L=vn(u||o),M=L&&L.a,$=L&&L.d;L&&(p/=$,m/=M,D/=M,C/=$,g=p+C,S=m+D)}return{top:p,left:m,bottom:g,right:S,width:D,height:C}}}function Uo(o,n,r){for(var a=Pt(o,!0),u=Ae(o)[n];a;){var d=Ae(a)[r],p=void 0;if(p=u>=d,!p)return a;if(a===dt())break;a=Pt(a,!1)}return!1}function yn(o,n,r,a){for(var u=0,d=0,p=o.children;d<p.length;){if(p[d].style.display!=="none"&&p[d]!==re.ghost&&(a||p[d]!==re.dragged)&&rt(p[d],r.draggable,o,!1)){if(u===n)return p[d];u++}d++}return null}function zi(o,n){for(var r=o.lastElementChild;r&&(r===re.ghost||ne(r,"display")==="none"||n&&!Cr(r,n));)r=r.previousElementSibling;return r||null}function Qe(o,n){var r=0;if(!o||!o.parentNode)return-1;for(;o=o.previousElementSibling;)o.nodeName.toUpperCase()!=="TEMPLATE"&&o!==re.clone&&(!n||Cr(o,n))&&r++;return r}function Wo(o){var n=0,r=0,a=dt();if(o)do{var u=vn(o),d=u.a,p=u.d;n+=o.scrollLeft*d,r+=o.scrollTop*p}while(o!==a&&(o=o.parentNode));return[n,r]}function Fs(o,n){for(var r in o)if(o.hasOwnProperty(r)){for(var a in n)if(n.hasOwnProperty(a)&&n[a]===o[r][a])return Number(r)}return-1}function Pt(o,n){if(!o||!o.getBoundingClientRect)return dt();var r=o,a=!1;do if(r.clientWidth<r.scrollWidth||r.clientHeight<r.scrollHeight){var u=ne(r);if(r.clientWidth<r.scrollWidth&&(u.overflowX=="auto"||u.overflowX=="scroll")||r.clientHeight<r.scrollHeight&&(u.overflowY=="auto"||u.overflowY=="scroll")){if(!r.getBoundingClientRect||r===document.body)return dt();if(a||n)return r;a=!0}}while(r=r.parentNode);return dt()}function Us(o,n){if(o&&n)for(var r in n)n.hasOwnProperty(r)&&(o[r]=n[r]);return o}function Ei(o,n){return Math.round(o.top)===Math.round(n.top)&&Math.round(o.left)===Math.round(n.left)&&Math.round(o.height)===Math.round(n.height)&&Math.round(o.width)===Math.round(n.width)}var qn;function ca(o,n){return function(){if(!qn){var r=arguments,a=this;r.length===1?o.call(a,r[0]):o.apply(a,r),qn=setTimeout(function(){qn=void 0},n)}}}function Ws(){clearTimeout(qn),qn=void 0}function da(o,n,r){o.scrollLeft+=n,o.scrollTop+=r}function fa(o){var n=window.Polymer,r=window.jQuery||window.Zepto;return n&&n.dom?n.dom(o).cloneNode(!0):r?r(o).clone(!0)[0]:o.cloneNode(!0)}function pa(o,n,r){var a={};return Array.from(o.children).forEach(function(u){var d,p,m,g;if(!(!rt(u,n.draggable,o,!1)||u.animated||u===r)){var S=Ae(u);a.left=Math.min((d=a.left)!==null&&d!==void 0?d:1/0,S.left),a.top=Math.min((p=a.top)!==null&&p!==void 0?p:1/0,S.top),a.right=Math.max((m=a.right)!==null&&m!==void 0?m:-1/0,S.right),a.bottom=Math.max((g=a.bottom)!==null&&g!==void 0?g:-1/0,S.bottom)}}),a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}var qe="Sortable"+new Date().getTime();function zs(){var o=[],n;return{captureAnimationState:function(){if(o=[],!!this.options.animation){var a=[].slice.call(this.el.children);a.forEach(function(u){if(!(ne(u,"display")==="none"||u===re.ghost)){o.push({target:u,rect:Ae(u)});var d=ft({},o[o.length-1].rect);if(u.thisAnimationDuration){var p=vn(u,!0);p&&(d.top-=p.f,d.left-=p.e)}u.fromRect=d}})}},addAnimationState:function(a){o.push(a)},removeAnimationState:function(a){o.splice(Fs(o,{target:a}),1)},animateAll:function(a){var u=this;if(!this.options.animation){clearTimeout(n),typeof a=="function"&&a();return}var d=!1,p=0;o.forEach(function(m){var g=0,S=m.target,C=S.fromRect,D=Ae(S),A=S.prevFromRect,L=S.prevToRect,M=m.rect,$=vn(S,!0);$&&(D.top-=$.f,D.left-=$.e),S.toRect=D,S.thisAnimationDuration&&Ei(A,D)&&!Ei(C,D)&&(M.top-D.top)/(M.left-D.left)===(C.top-D.top)/(C.left-D.left)&&(g=Ys(M,A,L,u.options)),Ei(D,C)||(S.prevFromRect=C,S.prevToRect=D,g||(g=u.options.animation),u.animate(S,M,D,g)),g&&(d=!0,p=Math.max(p,g),clearTimeout(S.animationResetTimer),S.animationResetTimer=setTimeout(function(){S.animationTime=0,S.prevFromRect=null,S.fromRect=null,S.prevToRect=null,S.thisAnimationDuration=null},g),S.thisAnimationDuration=g)}),clearTimeout(n),d?n=setTimeout(function(){typeof a=="function"&&a()},p):typeof a=="function"&&a(),o=[]},animate:function(a,u,d,p){if(p){ne(a,"transition",""),ne(a,"transform","");var m=vn(this.el),g=m&&m.a,S=m&&m.d,C=(u.left-d.left)/(g||1),D=(u.top-d.top)/(S||1);a.animatingX=!!C,a.animatingY=!!D,ne(a,"transform","translate3d("+C+"px,"+D+"px,0)"),this.forRepaintDummy=Hs(a),ne(a,"transition","transform "+p+"ms"+(this.options.easing?" "+this.options.easing:"")),ne(a,"transform","translate3d(0,0,0)"),typeof a.animated=="number"&&clearTimeout(a.animated),a.animated=setTimeout(function(){ne(a,"transition",""),ne(a,"transform",""),a.animated=!1,a.animatingX=!1,a.animatingY=!1},p)}}}}function Hs(o){return o.offsetWidth}function Ys(o,n,r,a){return Math.sqrt(Math.pow(n.top-o.top,2)+Math.pow(n.left-o.left,2))/Math.sqrt(Math.pow(n.top-r.top,2)+Math.pow(n.left-r.left,2))*a.animation}var un=[],Si={initializeByDefault:!0},zn={mount:function(n){for(var r in Si)Si.hasOwnProperty(r)&&!(r in n)&&(n[r]=Si[r]);un.forEach(function(a){if(a.pluginName===n.pluginName)throw"Sortable: Cannot mount plugin ".concat(n.pluginName," more than once")}),un.push(n)},pluginEvent:function(n,r,a){var u=this;this.eventCanceled=!1,a.cancel=function(){u.eventCanceled=!0};var d=n+"Global";un.forEach(function(p){r[p.pluginName]&&(r[p.pluginName][d]&&r[p.pluginName][d](ft({sortable:r},a)),r.options[p.pluginName]&&r[p.pluginName][n]&&r[p.pluginName][n](ft({sortable:r},a)))})},initializePlugins:function(n,r,a,u){un.forEach(function(m){var g=m.pluginName;if(!(!n.options[g]&&!m.initializeByDefault)){var S=new m(n,r,n.options);S.sortable=n,S.options=n.options,n[g]=S,yt(a,S.defaults)}});for(var d in n.options)if(n.options.hasOwnProperty(d)){var p=this.modifyOption(n,d,n.options[d]);typeof p<"u"&&(n.options[d]=p)}},getEventProperties:function(n,r){var a={};return un.forEach(function(u){typeof u.eventProperties=="function"&&yt(a,u.eventProperties.call(r[u.pluginName],n))}),a},modifyOption:function(n,r,a){var u;return un.forEach(function(d){n[d.pluginName]&&d.optionListeners&&typeof d.optionListeners[r]=="function"&&(u=d.optionListeners[r].call(n[d.pluginName],a))}),u}};function Vs(o){var n=o.sortable,r=o.rootEl,a=o.name,u=o.targetEl,d=o.cloneEl,p=o.toEl,m=o.fromEl,g=o.oldIndex,S=o.newIndex,C=o.oldDraggableIndex,D=o.newDraggableIndex,A=o.originalEvent,L=o.putSortable,M=o.extraEventProperties;if(n=n||r&&r[qe],!!n){var $,U=n.options,H="on"+a.charAt(0).toUpperCase()+a.substr(1);window.CustomEvent&&!bt&&!Wn?$=new CustomEvent(a,{bubbles:!0,cancelable:!0}):($=document.createEvent("Event"),$.initEvent(a,!0,!0)),$.to=p||r,$.from=m||r,$.item=u||r,$.clone=d,$.oldIndex=g,$.newIndex=S,$.oldDraggableIndex=C,$.newDraggableIndex=D,$.originalEvent=A,$.pullMode=L?L.lastPutMode:void 0;var F=ft(ft({},M),zn.getEventProperties(a,n));for(var G in F)$[G]=F[G];r&&r.dispatchEvent($),U[H]&&U[H].call(n,$)}}var Xs=["evt"],Re=function(n,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=a.evt,d=qs(a,Xs);zn.pluginEvent.bind(re)(n,r,ft({dragEl:K,parentEl:De,ghostEl:ie,rootEl:_e,nextEl:zt,lastDownEl:Sr,cloneEl:Ee,cloneHidden:At,dragStarted:Ln,putSortable:Me,activeSortable:re.active,originalEvent:u,oldIndex:pn,oldDraggableIndex:Kn,newIndex:Ye,newDraggableIndex:Ot,hideGhostForTarget:va,unhideGhostForTarget:ya,cloneNowHidden:function(){At=!0},cloneNowShown:function(){At=!1},dispatchSortableEvent:function(m){Ne({sortable:r,name:m,originalEvent:u})}},d))};function Ne(o){Vs(ft({putSortable:Me,cloneEl:Ee,targetEl:K,rootEl:_e,oldIndex:pn,oldDraggableIndex:Kn,newIndex:Ye,newDraggableIndex:Ot},o))}var K,De,ie,_e,zt,Sr,Ee,At,pn,Ye,Kn,Ot,br,Me,fn=!1,Pr=!1,$r=[],Ut,nt,xi,Di,zo,Ho,Ln,cn,Fn,Un=!1,wr=!1,xr,Be,Ii=[],Mi=!1,Lr=[],Nr=typeof document<"u",_r=Wi,Yo=Wn||bt?"cssFloat":"float",Gs=Nr&&!aa&&!Wi&&"draggable"in document.createElement("div"),ha=function(){if(Nr){if(bt)return!1;var o=document.createElement("x");return o.style.cssText="pointer-events:auto",o.style.pointerEvents==="auto"}}(),ma=function(n,r){var a=ne(n),u=parseInt(a.width)-parseInt(a.paddingLeft)-parseInt(a.paddingRight)-parseInt(a.borderLeftWidth)-parseInt(a.borderRightWidth),d=yn(n,0,r),p=yn(n,1,r),m=d&&ne(d),g=p&&ne(p),S=m&&parseInt(m.marginLeft)+parseInt(m.marginRight)+Ae(d).width,C=g&&parseInt(g.marginLeft)+parseInt(g.marginRight)+Ae(p).width;if(a.display==="flex")return a.flexDirection==="column"||a.flexDirection==="column-reverse"?"vertical":"horizontal";if(a.display==="grid")return a.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(d&&m.float&&m.float!=="none"){var D=m.float==="left"?"left":"right";return p&&(g.clear==="both"||g.clear===D)?"vertical":"horizontal"}return d&&(m.display==="block"||m.display==="flex"||m.display==="table"||m.display==="grid"||S>=u&&a[Yo]==="none"||p&&a[Yo]==="none"&&S+C>u)?"vertical":"horizontal"},Qs=function(n,r,a){var u=a?n.left:n.top,d=a?n.right:n.bottom,p=a?n.width:n.height,m=a?r.left:r.top,g=a?r.right:r.bottom,S=a?r.width:r.height;return u===m||d===g||u+p/2===m+S/2},Js=function(n,r){var a;return $r.some(function(u){var d=u[qe].options.emptyInsertThreshold;if(!(!d||zi(u))){var p=Ae(u),m=n>=p.left-d&&n<=p.right+d,g=r>=p.top-d&&r<=p.bottom+d;if(m&&g)return a=u}}),a},ga=function(n){function r(d,p){return function(m,g,S,C){var D=m.options.group.name&&g.options.group.name&&m.options.group.name===g.options.group.name;if(d==null&&(p||D))return!0;if(d==null||d===!1)return!1;if(p&&d==="clone")return d;if(typeof d=="function")return r(d(m,g,S,C),p)(m,g,S,C);var A=(p?m:g).options.group.name;return d===!0||typeof d=="string"&&d===A||d.join&&d.indexOf(A)>-1}}var a={},u=n.group;(!u||Er(u)!="object")&&(u={name:u}),a.name=u.name,a.checkPull=r(u.pull,!0),a.checkPut=r(u.put),a.revertClone=u.revertClone,n.group=a},va=function(){!ha&&ie&&ne(ie,"display","none")},ya=function(){!ha&&ie&&ne(ie,"display","")};Nr&&!aa&&document.addEventListener("click",function(o){if(Pr)return o.preventDefault(),o.stopPropagation&&o.stopPropagation(),o.stopImmediatePropagation&&o.stopImmediatePropagation(),Pr=!1,!1},!0);var Wt=function(n){if(K){n=n.touches?n.touches[0]:n;var r=Js(n.clientX,n.clientY);if(r){var a={};for(var u in n)n.hasOwnProperty(u)&&(a[u]=n[u]);a.target=a.rootEl=r,a.preventDefault=void 0,a.stopPropagation=void 0,r[qe]._onDragOver(a)}}},Zs=function(n){K&&K.parentNode[qe]._isOutsideThisEl(n.target)};function re(o,n){if(!(o&&o.nodeType&&o.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(o));this.el=o,this.options=n=yt({},n),o[qe]=this;var r={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(o.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return ma(o,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(p,m){p.setData("Text",m.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:re.supportPointer!==!1&&"PointerEvent"in window&&(!Rn||Wi),emptyInsertThreshold:5};zn.initializePlugins(this,o,r);for(var a in r)!(a in n)&&(n[a]=r[a]);ga(n);for(var u in this)u.charAt(0)==="_"&&typeof this[u]=="function"&&(this[u]=this[u].bind(this));this.nativeDraggable=n.forceFallback?!1:Gs,this.nativeDraggable&&(this.options.touchStartThreshold=1),n.supportPointer?de(o,"pointerdown",this._onTapStart):(de(o,"mousedown",this._onTapStart),de(o,"touchstart",this._onTapStart)),this.nativeDraggable&&(de(o,"dragover",this),de(o,"dragenter",this)),$r.push(this.el),n.store&&n.store.get&&this.sort(n.store.get(this)||[]),yt(this,zs())}re.prototype={constructor:re,_isOutsideThisEl:function(n){!this.el.contains(n)&&n!==this.el&&(cn=null)},_getDirection:function(n,r){return typeof this.options.direction=="function"?this.options.direction.call(this,n,r,K):this.options.direction},_onTapStart:function(n){if(n.cancelable){var r=this,a=this.el,u=this.options,d=u.preventOnFilter,p=n.type,m=n.touches&&n.touches[0]||n.pointerType&&n.pointerType==="touch"&&n,g=(m||n).target,S=n.target.shadowRoot&&(n.path&&n.path[0]||n.composedPath&&n.composedPath()[0])||g,C=u.filter;if(sl(a),!K&&!(/mousedown|pointerdown/.test(p)&&n.button!==0||u.disabled)&&!S.isContentEditable&&!(!this.nativeDraggable&&Rn&&g&&g.tagName.toUpperCase()==="SELECT")&&(g=rt(g,u.draggable,a,!1),!(g&&g.animated)&&Sr!==g)){if(pn=Qe(g),Kn=Qe(g,u.draggable),typeof C=="function"){if(C.call(this,n,g,this)){Ne({sortable:r,rootEl:S,name:"filter",targetEl:g,toEl:a,fromEl:a}),Re("filter",r,{evt:n}),d&&n.preventDefault();return}}else if(C&&(C=C.split(",").some(function(D){if(D=rt(S,D.trim(),a,!1),D)return Ne({sortable:r,rootEl:D,name:"filter",targetEl:g,fromEl:a,toEl:a}),Re("filter",r,{evt:n}),!0}),C)){d&&n.preventDefault();return}u.handle&&!rt(S,u.handle,a,!1)||this._prepareDragStart(n,m,g)}}},_prepareDragStart:function(n,r,a){var u=this,d=u.el,p=u.options,m=d.ownerDocument,g;if(a&&!K&&a.parentNode===d){var S=Ae(a);if(_e=d,K=a,De=K.parentNode,zt=K.nextSibling,Sr=a,br=p.group,re.dragged=K,Ut={target:K,clientX:(r||n).clientX,clientY:(r||n).clientY},zo=Ut.clientX-S.left,Ho=Ut.clientY-S.top,this._lastX=(r||n).clientX,this._lastY=(r||n).clientY,K.style["will-change"]="all",g=function(){if(Re("delayEnded",u,{evt:n}),re.eventCanceled){u._onDrop();return}u._disableDelayedDragEvents(),!Ko&&u.nativeDraggable&&(K.draggable=!0),u._triggerDragStart(n,r),Ne({sortable:u,name:"choose",originalEvent:n}),He(K,p.chosenClass,!0)},p.ignore.split(",").forEach(function(C){ua(K,C.trim(),Ti)}),de(m,"dragover",Wt),de(m,"mousemove",Wt),de(m,"touchmove",Wt),p.supportPointer?(de(m,"pointerup",u._onDrop),!this.nativeDraggable&&de(m,"pointercancel",u._onDrop)):(de(m,"mouseup",u._onDrop),de(m,"touchend",u._onDrop),de(m,"touchcancel",u._onDrop)),Ko&&this.nativeDraggable&&(this.options.touchStartThreshold=4,K.draggable=!0),Re("delayStart",this,{evt:n}),p.delay&&(!p.delayOnTouchOnly||r)&&(!this.nativeDraggable||!(Wn||bt))){if(re.eventCanceled){this._onDrop();return}p.supportPointer?(de(m,"pointerup",u._disableDelayedDrag),de(m,"pointercancel",u._disableDelayedDrag)):(de(m,"mouseup",u._disableDelayedDrag),de(m,"touchend",u._disableDelayedDrag),de(m,"touchcancel",u._disableDelayedDrag)),de(m,"mousemove",u._delayedDragTouchMoveHandler),de(m,"touchmove",u._delayedDragTouchMoveHandler),p.supportPointer&&de(m,"pointermove",u._delayedDragTouchMoveHandler),u._dragStartTimer=setTimeout(g,p.delay)}else g()}},_delayedDragTouchMoveHandler:function(n){var r=n.touches?n.touches[0]:n;Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){K&&Ti(K),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var n=this.el.ownerDocument;ue(n,"mouseup",this._disableDelayedDrag),ue(n,"touchend",this._disableDelayedDrag),ue(n,"touchcancel",this._disableDelayedDrag),ue(n,"pointerup",this._disableDelayedDrag),ue(n,"pointercancel",this._disableDelayedDrag),ue(n,"mousemove",this._delayedDragTouchMoveHandler),ue(n,"touchmove",this._delayedDragTouchMoveHandler),ue(n,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(n,r){r=r||n.pointerType=="touch"&&n,!this.nativeDraggable||r?this.options.supportPointer?de(document,"pointermove",this._onTouchMove):r?de(document,"touchmove",this._onTouchMove):de(document,"mousemove",this._onTouchMove):(de(K,"dragend",this),de(_e,"dragstart",this._onDragStart));try{document.selection?Dr(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(n,r){if(fn=!1,_e&&K){Re("dragStarted",this,{evt:r}),this.nativeDraggable&&de(document,"dragover",Zs);var a=this.options;!n&&He(K,a.dragClass,!1),He(K,a.ghostClass,!0),re.active=this,n&&this._appendGhost(),Ne({sortable:this,name:"start",originalEvent:r})}else this._nulling()},_emulateDragOver:function(){if(nt){this._lastX=nt.clientX,this._lastY=nt.clientY,va();for(var n=document.elementFromPoint(nt.clientX,nt.clientY),r=n;n&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(nt.clientX,nt.clientY),n!==r);)r=n;if(K.parentNode[qe]._isOutsideThisEl(n),r)do{if(r[qe]){var a=void 0;if(a=r[qe]._onDragOver({clientX:nt.clientX,clientY:nt.clientY,target:n,rootEl:r}),a&&!this.options.dragoverBubble)break}n=r}while(r=la(r));ya()}},_onTouchMove:function(n){if(Ut){var r=this.options,a=r.fallbackTolerance,u=r.fallbackOffset,d=n.touches?n.touches[0]:n,p=ie&&vn(ie,!0),m=ie&&p&&p.a,g=ie&&p&&p.d,S=_r&&Be&&Wo(Be),C=(d.clientX-Ut.clientX+u.x)/(m||1)+(S?S[0]-Ii[0]:0)/(m||1),D=(d.clientY-Ut.clientY+u.y)/(g||1)+(S?S[1]-Ii[1]:0)/(g||1);if(!re.active&&!fn){if(a&&Math.max(Math.abs(d.clientX-this._lastX),Math.abs(d.clientY-this._lastY))<a)return;this._onDragStart(n,!0)}if(ie){p?(p.e+=C-(xi||0),p.f+=D-(Di||0)):p={a:1,b:0,c:0,d:1,e:C,f:D};var A="matrix(".concat(p.a,",").concat(p.b,",").concat(p.c,",").concat(p.d,",").concat(p.e,",").concat(p.f,")");ne(ie,"webkitTransform",A),ne(ie,"mozTransform",A),ne(ie,"msTransform",A),ne(ie,"transform",A),xi=C,Di=D,nt=d}n.cancelable&&n.preventDefault()}},_appendGhost:function(){if(!ie){var n=this.options.fallbackOnBody?document.body:_e,r=Ae(K,!0,_r,!0,n),a=this.options;if(_r){for(Be=n;ne(Be,"position")==="static"&&ne(Be,"transform")==="none"&&Be!==document;)Be=Be.parentNode;Be!==document.body&&Be!==document.documentElement?(Be===document&&(Be=dt()),r.top+=Be.scrollTop,r.left+=Be.scrollLeft):Be=dt(),Ii=Wo(Be)}ie=K.cloneNode(!0),He(ie,a.ghostClass,!1),He(ie,a.fallbackClass,!0),He(ie,a.dragClass,!0),ne(ie,"transition",""),ne(ie,"transform",""),ne(ie,"box-sizing","border-box"),ne(ie,"margin",0),ne(ie,"top",r.top),ne(ie,"left",r.left),ne(ie,"width",r.width),ne(ie,"height",r.height),ne(ie,"opacity","0.8"),ne(ie,"position",_r?"absolute":"fixed"),ne(ie,"zIndex","100000"),ne(ie,"pointerEvents","none"),re.ghost=ie,n.appendChild(ie),ne(ie,"transform-origin",zo/parseInt(ie.style.width)*100+"% "+Ho/parseInt(ie.style.height)*100+"%")}},_onDragStart:function(n,r){var a=this,u=n.dataTransfer,d=a.options;if(Re("dragStart",this,{evt:n}),re.eventCanceled){this._onDrop();return}Re("setupClone",this),re.eventCanceled||(Ee=fa(K),Ee.removeAttribute("id"),Ee.draggable=!1,Ee.style["will-change"]="",this._hideClone(),He(Ee,this.options.chosenClass,!1),re.clone=Ee),a.cloneId=Dr(function(){Re("clone",a),!re.eventCanceled&&(a.options.removeCloneOnHide||_e.insertBefore(Ee,K),a._hideClone(),Ne({sortable:a,name:"clone"}))}),!r&&He(K,d.dragClass,!0),r?(Pr=!0,a._loopId=setInterval(a._emulateDragOver,50)):(ue(document,"mouseup",a._onDrop),ue(document,"touchend",a._onDrop),ue(document,"touchcancel",a._onDrop),u&&(u.effectAllowed="move",d.setData&&d.setData.call(a,u,K)),de(document,"drop",a),ne(K,"transform","translateZ(0)")),fn=!0,a._dragStartId=Dr(a._dragStarted.bind(a,r,n)),de(document,"selectstart",a),Ln=!0,window.getSelection().removeAllRanges(),Rn&&ne(document.body,"user-select","none")},_onDragOver:function(n){var r=this.el,a=n.target,u,d,p,m=this.options,g=m.group,S=re.active,C=br===g,D=m.sort,A=Me||S,L,M=this,$=!1;if(Mi)return;function U(Ue,wt){Re(Ue,M,ft({evt:n,isOwner:C,axis:L?"vertical":"horizontal",revert:p,dragRect:u,targetRect:d,canSort:D,fromSortable:A,target:a,completed:F,onMove:function(Xt,et){return kr(_e,r,K,u,Xt,Ae(Xt),n,et)},changed:G},wt))}function H(){U("dragOverAnimationCapture"),M.captureAnimationState(),M!==A&&A.captureAnimationState()}function F(Ue){return U("dragOverCompleted",{insertion:Ue}),Ue&&(C?S._hideClone():S._showClone(M),M!==A&&(He(K,Me?Me.options.ghostClass:S.options.ghostClass,!1),He(K,m.ghostClass,!0)),Me!==M&&M!==re.active?Me=M:M===re.active&&Me&&(Me=null),A===M&&(M._ignoreWhileAnimating=a),M.animateAll(function(){U("dragOverAnimationComplete"),M._ignoreWhileAnimating=null}),M!==A&&(A.animateAll(),A._ignoreWhileAnimating=null)),(a===K&&!K.animated||a===r&&!a.animated)&&(cn=null),!m.dragoverBubble&&!n.rootEl&&a!==document&&(K.parentNode[qe]._isOutsideThisEl(n.target),!Ue&&Wt(n)),!m.dragoverBubble&&n.stopPropagation&&n.stopPropagation(),$=!0}function G(){Ye=Qe(K),Ot=Qe(K,m.draggable),Ne({sortable:M,name:"change",toEl:r,newIndex:Ye,newDraggableIndex:Ot,originalEvent:n})}if(n.preventDefault!==void 0&&n.cancelable&&n.preventDefault(),a=rt(a,m.draggable,r,!0),U("dragOver"),re.eventCanceled)return $;if(K.contains(n.target)||a.animated&&a.animatingX&&a.animatingY||M._ignoreWhileAnimating===a)return F(!1);if(Pr=!1,S&&!m.disabled&&(C?D||(p=De!==_e):Me===this||(this.lastPutMode=br.checkPull(this,S,K,n))&&g.checkPut(this,S,K,n))){if(L=this._getDirection(n,a)==="vertical",u=Ae(K),U("dragOverValid"),re.eventCanceled)return $;if(p)return De=_e,H(),this._hideClone(),U("revert"),re.eventCanceled||(zt?_e.insertBefore(K,zt):_e.appendChild(K)),F(!0);var te=zi(r,m.draggable);if(!te||rl(n,L,this)&&!te.animated){if(te===K)return F(!1);if(te&&r===n.target&&(a=te),a&&(d=Ae(a)),kr(_e,r,K,u,a,d,n,!!a)!==!1)return H(),te&&te.nextSibling?r.insertBefore(K,te.nextSibling):r.appendChild(K),De=r,G(),F(!0)}else if(te&&nl(n,L,this)){var se=yn(r,0,m,!0);if(se===K)return F(!1);if(a=se,d=Ae(a),kr(_e,r,K,u,a,d,n,!1)!==!1)return H(),r.insertBefore(K,se),De=r,G(),F(!0)}else if(a.parentNode===r){d=Ae(a);var oe=0,ge,Ce=K.parentNode!==r,le=!Qs(K.animated&&K.toRect||u,a.animated&&a.toRect||d,L),ot=L?"top":"left",Fe=Uo(a,"top","top")||Uo(K,"top","top"),Ze=Fe?Fe.scrollTop:void 0;cn!==a&&(ge=d[ot],Un=!1,wr=!le&&m.invertSwap||Ce),oe=il(n,a,d,L,le?1:m.swapThreshold,m.invertedSwapThreshold==null?m.swapThreshold:m.invertedSwapThreshold,wr,cn===a);var Le;if(oe!==0){var pt=Qe(K);do pt-=oe,Le=De.children[pt];while(Le&&(ne(Le,"display")==="none"||Le===ie))}if(oe===0||Le===a)return F(!1);cn=a,Fn=oe;var ht=a.nextElementSibling,Xe=!1;Xe=oe===1;var Vt=kr(_e,r,K,u,a,d,n,Xe);if(Vt!==!1)return(Vt===1||Vt===-1)&&(Xe=Vt===1),Mi=!0,setTimeout(tl,30),H(),Xe&&!ht?r.appendChild(K):a.parentNode.insertBefore(K,Xe?ht:a),Fe&&da(Fe,0,Ze-Fe.scrollTop),De=K.parentNode,ge!==void 0&&!wr&&(xr=Math.abs(ge-Ae(a)[ot])),G(),F(!0)}if(r.contains(K))return F(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){ue(document,"mousemove",this._onTouchMove),ue(document,"touchmove",this._onTouchMove),ue(document,"pointermove",this._onTouchMove),ue(document,"dragover",Wt),ue(document,"mousemove",Wt),ue(document,"touchmove",Wt)},_offUpEvents:function(){var n=this.el.ownerDocument;ue(n,"mouseup",this._onDrop),ue(n,"touchend",this._onDrop),ue(n,"pointerup",this._onDrop),ue(n,"pointercancel",this._onDrop),ue(n,"touchcancel",this._onDrop),ue(document,"selectstart",this)},_onDrop:function(n){var r=this.el,a=this.options;if(Ye=Qe(K),Ot=Qe(K,a.draggable),Re("drop",this,{evt:n}),De=K&&K.parentNode,Ye=Qe(K),Ot=Qe(K,a.draggable),re.eventCanceled){this._nulling();return}fn=!1,wr=!1,Un=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),ji(this.cloneId),ji(this._dragStartId),this.nativeDraggable&&(ue(document,"drop",this),ue(r,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Rn&&ne(document.body,"user-select",""),ne(K,"transform",""),n&&(Ln&&(n.cancelable&&n.preventDefault(),!a.dropBubble&&n.stopPropagation()),ie&&ie.parentNode&&ie.parentNode.removeChild(ie),(_e===De||Me&&Me.lastPutMode!=="clone")&&Ee&&Ee.parentNode&&Ee.parentNode.removeChild(Ee),K&&(this.nativeDraggable&&ue(K,"dragend",this),Ti(K),K.style["will-change"]="",Ln&&!fn&&He(K,Me?Me.options.ghostClass:this.options.ghostClass,!1),He(K,this.options.chosenClass,!1),Ne({sortable:this,name:"unchoose",toEl:De,newIndex:null,newDraggableIndex:null,originalEvent:n}),_e!==De?(Ye>=0&&(Ne({rootEl:De,name:"add",toEl:De,fromEl:_e,originalEvent:n}),Ne({sortable:this,name:"remove",toEl:De,originalEvent:n}),Ne({rootEl:De,name:"sort",toEl:De,fromEl:_e,originalEvent:n}),Ne({sortable:this,name:"sort",toEl:De,originalEvent:n})),Me&&Me.save()):Ye!==pn&&Ye>=0&&(Ne({sortable:this,name:"update",toEl:De,originalEvent:n}),Ne({sortable:this,name:"sort",toEl:De,originalEvent:n})),re.active&&((Ye==null||Ye===-1)&&(Ye=pn,Ot=Kn),Ne({sortable:this,name:"end",toEl:De,originalEvent:n}),this.save()))),this._nulling()},_nulling:function(){Re("nulling",this),_e=K=De=ie=zt=Ee=Sr=At=Ut=nt=Ln=Ye=Ot=pn=Kn=cn=Fn=Me=br=re.dragged=re.ghost=re.clone=re.active=null,Lr.forEach(function(n){n.checked=!0}),Lr.length=xi=Di=0},handleEvent:function(n){switch(n.type){case"drop":case"dragend":this._onDrop(n);break;case"dragenter":case"dragover":K&&(this._onDragOver(n),el(n));break;case"selectstart":n.preventDefault();break}},toArray:function(){for(var n=[],r,a=this.el.children,u=0,d=a.length,p=this.options;u<d;u++)r=a[u],rt(r,p.draggable,this.el,!1)&&n.push(r.getAttribute(p.dataIdAttr)||al(r));return n},sort:function(n,r){var a={},u=this.el;this.toArray().forEach(function(d,p){var m=u.children[p];rt(m,this.options.draggable,u,!1)&&(a[d]=m)},this),r&&this.captureAnimationState(),n.forEach(function(d){a[d]&&(u.removeChild(a[d]),u.appendChild(a[d]))}),r&&this.animateAll()},save:function(){var n=this.options.store;n&&n.set&&n.set(this)},closest:function(n,r){return rt(n,r||this.options.draggable,this.el,!1)},option:function(n,r){var a=this.options;if(r===void 0)return a[n];var u=zn.modifyOption(this,n,r);typeof u<"u"?a[n]=u:a[n]=r,n==="group"&&ga(a)},destroy:function(){Re("destroy",this);var n=this.el;n[qe]=null,ue(n,"mousedown",this._onTapStart),ue(n,"touchstart",this._onTapStart),ue(n,"pointerdown",this._onTapStart),this.nativeDraggable&&(ue(n,"dragover",this),ue(n,"dragenter",this)),Array.prototype.forEach.call(n.querySelectorAll("[draggable]"),function(r){r.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),$r.splice($r.indexOf(this.el),1),this.el=n=null},_hideClone:function(){if(!At){if(Re("hideClone",this),re.eventCanceled)return;ne(Ee,"display","none"),this.options.removeCloneOnHide&&Ee.parentNode&&Ee.parentNode.removeChild(Ee),At=!0}},_showClone:function(n){if(n.lastPutMode!=="clone"){this._hideClone();return}if(At){if(Re("showClone",this),re.eventCanceled)return;K.parentNode==_e&&!this.options.group.revertClone?_e.insertBefore(Ee,K):zt?_e.insertBefore(Ee,zt):_e.appendChild(Ee),this.options.group.revertClone&&this.animate(K,Ee),ne(Ee,"display",""),At=!1}}};function el(o){o.dataTransfer&&(o.dataTransfer.dropEffect="move"),o.cancelable&&o.preventDefault()}function kr(o,n,r,a,u,d,p,m){var g,S=o[qe],C=S.options.onMove,D;return window.CustomEvent&&!bt&&!Wn?g=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(g=document.createEvent("Event"),g.initEvent("move",!0,!0)),g.to=n,g.from=o,g.dragged=r,g.draggedRect=a,g.related=u||n,g.relatedRect=d||Ae(n),g.willInsertAfter=m,g.originalEvent=p,o.dispatchEvent(g),C&&(D=C.call(S,g,p)),D}function Ti(o){o.draggable=!1}function tl(){Mi=!1}function nl(o,n,r){var a=Ae(yn(r.el,0,r.options,!0)),u=pa(r.el,r.options,ie),d=10;return n?o.clientX<u.left-d||o.clientY<a.top&&o.clientX<a.right:o.clientY<u.top-d||o.clientY<a.bottom&&o.clientX<a.left}function rl(o,n,r){var a=Ae(zi(r.el,r.options.draggable)),u=pa(r.el,r.options,ie),d=10;return n?o.clientX>u.right+d||o.clientY>a.bottom&&o.clientX>a.left:o.clientY>u.bottom+d||o.clientX>a.right&&o.clientY>a.top}function il(o,n,r,a,u,d,p,m){var g=a?o.clientY:o.clientX,S=a?r.height:r.width,C=a?r.top:r.left,D=a?r.bottom:r.right,A=!1;if(!p){if(m&&xr<S*u){if(!Un&&(Fn===1?g>C+S*d/2:g<D-S*d/2)&&(Un=!0),Un)A=!0;else if(Fn===1?g<C+xr:g>D-xr)return-Fn}else if(g>C+S*(1-u)/2&&g<D-S*(1-u)/2)return ol(n)}return A=A||p,A&&(g<C+S*d/2||g>D-S*d/2)?g>C+S/2?1:-1:0}function ol(o){return Qe(K)<Qe(o)?1:-1}function al(o){for(var n=o.tagName+o.className+o.src+o.href+o.textContent,r=n.length,a=0;r--;)a+=n.charCodeAt(r);return a.toString(36)}function sl(o){Lr.length=0;for(var n=o.getElementsByTagName("input"),r=n.length;r--;){var a=n[r];a.checked&&Lr.push(a)}}function Dr(o){return setTimeout(o,0)}function ji(o){return clearTimeout(o)}Nr&&de(document,"touchmove",function(o){(re.active||fn)&&o.cancelable&&o.preventDefault()});re.utils={on:de,off:ue,css:ne,find:ua,is:function(n,r){return!!rt(n,r,n,!1)},extend:Us,throttle:ca,closest:rt,toggleClass:He,clone:fa,index:Qe,nextTick:Dr,cancelNextTick:ji,detectDirection:ma,getChild:yn,expando:qe};re.get=function(o){return o[qe]};re.mount=function(){for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];n[0].constructor===Array&&(n=n[0]),n.forEach(function(a){if(!a.prototype||!a.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(a));a.utils&&(re.utils=ft(ft({},re.utils),a.utils)),zn.mount(a)})};re.create=function(o,n){return new re(o,n)};re.version=Ks;var Oe=[],Mn,Bi,Ni=!1,Oi,Ai,Mr,jn;function ll(){function o(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this))}return o.prototype={dragStarted:function(r){var a=r.originalEvent;this.sortable.nativeDraggable?de(document,"dragover",this._handleAutoScroll):this.options.supportPointer?de(document,"pointermove",this._handleFallbackAutoScroll):a.touches?de(document,"touchmove",this._handleFallbackAutoScroll):de(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(r){var a=r.originalEvent;!this.options.dragOverBubble&&!a.rootEl&&this._handleAutoScroll(a)},drop:function(){this.sortable.nativeDraggable?ue(document,"dragover",this._handleAutoScroll):(ue(document,"pointermove",this._handleFallbackAutoScroll),ue(document,"touchmove",this._handleFallbackAutoScroll),ue(document,"mousemove",this._handleFallbackAutoScroll)),Vo(),Ir(),Ws()},nulling:function(){Mr=Bi=Mn=Ni=jn=Oi=Ai=null,Oe.length=0},_handleFallbackAutoScroll:function(r){this._handleAutoScroll(r,!0)},_handleAutoScroll:function(r,a){var u=this,d=(r.touches?r.touches[0]:r).clientX,p=(r.touches?r.touches[0]:r).clientY,m=document.elementFromPoint(d,p);if(Mr=r,a||this.options.forceAutoScrollFallback||Wn||bt||Rn){Ci(r,this.options,m,a);var g=Pt(m,!0);Ni&&(!jn||d!==Oi||p!==Ai)&&(jn&&Vo(),jn=setInterval(function(){var S=Pt(document.elementFromPoint(d,p),!0);S!==g&&(g=S,Ir()),Ci(r,u.options,S,a)},10),Oi=d,Ai=p)}else{if(!this.options.bubbleScroll||Pt(m,!0)===dt()){Ir();return}Ci(r,this.options,Pt(m,!1),!1)}}},yt(o,{pluginName:"scroll",initializeByDefault:!0})}function Ir(){Oe.forEach(function(o){clearInterval(o.pid)}),Oe=[]}function Vo(){clearInterval(jn)}var Ci=ca(function(o,n,r,a){if(n.scroll){var u=(o.touches?o.touches[0]:o).clientX,d=(o.touches?o.touches[0]:o).clientY,p=n.scrollSensitivity,m=n.scrollSpeed,g=dt(),S=!1,C;Bi!==r&&(Bi=r,Ir(),Mn=n.scroll,C=n.scrollFn,Mn===!0&&(Mn=Pt(r,!0)));var D=0,A=Mn;do{var L=A,M=Ae(L),$=M.top,U=M.bottom,H=M.left,F=M.right,G=M.width,te=M.height,se=void 0,oe=void 0,ge=L.scrollWidth,Ce=L.scrollHeight,le=ne(L),ot=L.scrollLeft,Fe=L.scrollTop;L===g?(se=G<ge&&(le.overflowX==="auto"||le.overflowX==="scroll"||le.overflowX==="visible"),oe=te<Ce&&(le.overflowY==="auto"||le.overflowY==="scroll"||le.overflowY==="visible")):(se=G<ge&&(le.overflowX==="auto"||le.overflowX==="scroll"),oe=te<Ce&&(le.overflowY==="auto"||le.overflowY==="scroll"));var Ze=se&&(Math.abs(F-u)<=p&&ot+G<ge)-(Math.abs(H-u)<=p&&!!ot),Le=oe&&(Math.abs(U-d)<=p&&Fe+te<Ce)-(Math.abs($-d)<=p&&!!Fe);if(!Oe[D])for(var pt=0;pt<=D;pt++)Oe[pt]||(Oe[pt]={});(Oe[D].vx!=Ze||Oe[D].vy!=Le||Oe[D].el!==L)&&(Oe[D].el=L,Oe[D].vx=Ze,Oe[D].vy=Le,clearInterval(Oe[D].pid),(Ze!=0||Le!=0)&&(S=!0,Oe[D].pid=setInterval((function(){a&&this.layer===0&&re.active._onTouchMove(Mr);var ht=Oe[this.layer].vy?Oe[this.layer].vy*m:0,Xe=Oe[this.layer].vx?Oe[this.layer].vx*m:0;typeof C=="function"&&C.call(re.dragged.parentNode[qe],Xe,ht,o,Mr,Oe[this.layer].el)!=="continue"||da(Oe[this.layer].el,Xe,ht)}).bind({layer:D}),24))),D++}while(n.bubbleScroll&&A!==g&&(A=Pt(A,!1)));Ni=S}},30),ba=function(n){var r=n.originalEvent,a=n.putSortable,u=n.dragEl,d=n.activeSortable,p=n.dispatchSortableEvent,m=n.hideGhostForTarget,g=n.unhideGhostForTarget;if(r){var S=a||d;m();var C=r.changedTouches&&r.changedTouches.length?r.changedTouches[0]:r,D=document.elementFromPoint(C.clientX,C.clientY);g(),S&&!S.el.contains(D)&&(p("spill"),this.onSpill({dragEl:u,putSortable:a}))}};function Hi(){}Hi.prototype={startIndex:null,dragStart:function(n){var r=n.oldDraggableIndex;this.startIndex=r},onSpill:function(n){var r=n.dragEl,a=n.putSortable;this.sortable.captureAnimationState(),a&&a.captureAnimationState();var u=yn(this.sortable.el,this.startIndex,this.options);u?this.sortable.el.insertBefore(r,u):this.sortable.el.appendChild(r),this.sortable.animateAll(),a&&a.animateAll()},drop:ba};yt(Hi,{pluginName:"revertOnSpill"});function Yi(){}Yi.prototype={onSpill:function(n){var r=n.dragEl,a=n.putSortable,u=a||this.sortable;u.captureAnimationState(),r.parentNode&&r.parentNode.removeChild(r),u.animateAll()},drop:ba};yt(Yi,{pluginName:"removeOnSpill"});re.mount(new ll);re.mount(Yi,Hi);function jr(o,n,r){const a=new Blob([o],{type:r}),u=URL.createObjectURL(a),d=document.createElement("a");d.href=u,d.download=n,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(u)}function wa(o){const{profile:n,workoutTypes:r,workouts:a,logs:u}=o,d=[];d.push("# История тренировок"),n&&(d.push(`
## Профиль`),d.push(`- **Имя:** ${n.displayName||"Не указано"}`),n.telegramUsername&&d.push(`- **Username:** @${n.telegramUsername}`),d.push(`- **ID:** ${n.id}`),d.push(`- **Дата регистрации:** ${new Date(n.createdAt).toLocaleDateString()}`)),d.push(`
## Типы упражнений`);const p=r.filter(S=>!S.isDeleted);if(p.length>0?p.sort((S,C)=>(S.order??0)-(C.order??0)).forEach(S=>{d.push(`- ${S.name} (${S.category==="time"?"На время":"Силовое"})`)}):d.push("_Нет активных типов упражнений_"),d.push(`
## История`),u.length===0)return d.push("_История пуста_"),d.join(`
`);const m=new Map;return[...u].filter(S=>!S.isDeleted).sort((S,C)=>new Date(C.date).getTime()-new Date(S.date).getTime()).forEach(S=>{const C=new Date(S.date).toLocaleDateString();m.has(C)||m.set(C,[]),m.get(C).push(S)}),m.forEach((S,C)=>{d.push(`
### ${C}`),Array.from(new Set(S.map(A=>A.workoutId).filter(Boolean))).forEach(A=>{const L=a.find(U=>U.id===A),M=S.filter(U=>U.workoutId===A);L&&L.name&&d.push(`
#### ${L.name}`);const $=new Map;M.forEach(U=>{$.has(U.workoutTypeId)||$.set(U.workoutTypeId,[]),$.get(U.workoutTypeId).push(U)}),$.forEach((U,H)=>{const F=r.find(te=>te.id===H),G=(F==null?void 0:F.name)||"Неизвестное упражнение";d.push(`- **${G}**: ${U.map(te=>ul(te)).join(", ")}`)})})}),d.join(`
`)}function ul(o){return o.duration!==void 0?`${o.duration} мин`:`${o.weight}кг × ${o.reps}`}function _a(o,n){const r=o.totalVolume;let a="";return r<1e3?a=`${Math.round(r)}кг`:r<1e4?a=`${(r/1e3).toFixed(1)}т`:a=`${Math.round(r/1e3)}т`,`
      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-value">${o.totalWorkouts}</div>
          <div class="stat-label">Тренировок</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${a}</div>
          <div class="stat-label">Общий объём</div>
        </div>
        ${o.favoriteExercise?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${o.favoriteExercise}</div>
            <div class="stat-label">Любимое упражнение</div>
          </div>
        `:""}
        ${o.lastWorkoutDate?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${new Date(o.lastWorkoutDate).toLocaleDateString()}</div>
            <div class="stat-label">Последняя тренировка</div>
          </div>
        `:""}
      </div>

      ${n&&n.size>0?`
        <div class="activity-list">
          <h2 class="subtitle">Активность</h2>
          ${ra(n)}
        </div>
      `:""}
    `}const bn=o=>`https://tadatuta.github.io/21/?startapp=profile_${o}`;Bs({immediate:!0});var Jo;const pe=(Jo=window.Telegram)==null?void 0:Jo.WebApp;pe&&(pe.ready(),pe.expand());let Ve="main",Bn="all",be=null,ka=null,Br=null,Ri=!1,hn=null,Je=null,Tr="overview",Yt="ai",Vi=!1,mn={general:null,plan:null},gn="idle",Or=!1;function cl(o){Ve=o,it()}let Pi=null;function Se(o){let n=document.querySelector(".toast");n||(n=document.createElement("div"),n.className="toast",document.body.appendChild(n)),n.textContent=o,n.classList.add("visible"),Pi&&clearTimeout(Pi),Pi=setTimeout(()=>{n==null||n.classList.remove("visible")},2e3)}function it(){const o=document.getElementById("app");if(!o)return;const n=localStorage.getItem("skip_tma_auth")==="true",r=!!(pe!=null&&pe.initData)&&!n,u=!!Ui();!r&&!u||(o.innerHTML=`
    <main class="content">
      ${dl()}
    </main>
    <nav class="navigation">
      <button class="navigation__item ${Ve==="main"?"navigation__item_active":""}" data-page="main">
        <span class="navigation__icon">🏋️</span>
        <span class="navigation__label">Тренировка</span>
      </button>
      <button class="navigation__item ${Ve==="stats"?"navigation__item_active":""}" data-page="stats">
        <span class="navigation__icon">📊</span>
        <span class="navigation__label">Статистика</span>
      </button>
      <button class="navigation__item ${Ve==="profile-settings"?"navigation__item_active":""}" data-page="profile-settings">
        <span class="navigation__icon">👤</span>
        <span class="navigation__label">Профиль</span>
      </button>
      <button class="navigation__item ${Ve==="settings"?"navigation__item_active":""}" data-page="settings">
        <span class="navigation__icon">⚙️</span>
        <span class="navigation__label">Настройки</span>
      </button>
    </nav>
    <div id="sync-status" class="sync-status"></div>
  `,o.querySelectorAll(".navigation__item").forEach(d=>{d.addEventListener("click",()=>{const p=d.getAttribute("data-page");cl(p)})}),yl(),xa())}let Ea="idle";V.onSyncStatusChange(o=>{Ea=o,Xi()});V.onUnauthorized(()=>{const o=document.getElementById("app");o&&oa(o,()=>{location.reload()})});function Xi(){const o=document.getElementById("sync-status");if(!o)return;o.className="sync-status";let n="",r="";switch(Ea){case"saving":n="Синхронизация...",r="🔄",o.classList.add("sync-status_saving");break;case"success":n="Сохранено",r="✅",o.classList.add("sync-status_success");break;case"error":n="Ошибка синхронизации",r="⚠️",o.classList.add("sync-status_error");break;case"idle":if(!navigator.onLine)n="Оффлайн",r="📡",o.classList.add("sync-status_offline");else return;break}o.innerHTML=`${r} ${n}`}window.addEventListener("online",()=>{V.sync(),Xi()});window.addEventListener("offline",()=>Xi());function dl(){switch(Ve){case"main":return fl();case"stats":return La();case"settings":return Ta();case"profile-settings":return hl();case"public-profile":return gl();default:return""}}function Sa(){const o=V.getActiveWorkout();if(o){const n=o.status==="paused";return`
      <div class="workout-controls card">
        <div class="workout-controls__header">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span class="workout-status ${n?"workout-status_paused":""}">
              ${n?"⏸️ Пауза":"🔥 Тренировка активна"}
            </span>
            <span class="workout-timer">00:00</span>
          </div>
          ${o.name?`<span class="workout-name">${o.name}</span>`:""}
        </div>
        <div class="workout-controls__actions">
          ${n?'<button class="button" id="resume-workout-btn">Продолжить</button>':'<button class="button button_secondary" id="pause-workout-btn">Пауза</button>'}
          <button class="button button_destructive" id="finish-workout-btn">Завершить</button>
        </div>
      </div>
    `}return Or?`
      <div class="workout-controls card">
        <h3 class="subtitle" style="margin-top: 0">Начало тренировки</h3>
        <form id="start-workout-form" style="display: flex; flex-direction: column; gap: 12px;">
          <input class="input" type="text" name="workoutName" placeholder="Название (опционально)">
          <div style="display: flex; gap: 8px;">
            <button class="button" type="submit">Начать</button>
            <button class="button button_secondary" type="button" id="cancel-start-workout-btn">Отмена</button>
          </div>
        </form>
      </div>
    `:`
    <button class="button" id="start-workout-btn" style="margin-bottom: 24px;">▶️ Начать тренировку</button>
  `}let Ct=null;function Xo(){const o=V.getActiveWorkout(),n=document.querySelector(".workout-timer");if(!o||!n){Ct&&(clearInterval(Ct),Ct=null);return}const r=new Date(o.startTime).getTime(),a=Date.now();let u=a-r;o.pauseIntervals.forEach(g=>{const S=new Date(g.start).getTime(),C=g.end?new Date(g.end).getTime():(o.status==="paused",a);C>S&&(u-=C-S)});const d=Math.floor(Math.max(0,u)/1e3),p=Math.floor(d/60),m=d%60;n.textContent=`${p.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`}function xa(){const o=V.getActiveWorkout();Xo(),o&&o.status==="active"?Ct||(Ct=setInterval(Xo,1e3)):Ct&&(clearInterval(Ct),Ct=null)}let Ke=0,qi="";function Gi(o){const n=new Date;n.setHours(0,0,0,0);const r=new Date(n);r.setDate(n.getDate()-o*7),r.setHours(23,59,59,999);const a=new Date(r);return a.setDate(r.getDate()-6),a.setHours(0,0,0,0),{start:a,end:r,label:`${a.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})} - ${r.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}`}}function fl(){var p;const o=V.getWorkoutTypes(),n=V.getLogs(),r=n[n.length-1],a=r==null?void 0:r.workoutTypeId,u=be?n.find(m=>m.id===be):null,{label:d}=Gi(Ke);return`
    <div class="page-content" id="main-content">
      ${Sa()}
      <h1 class="title">${be?"Редактирование подхода":"Новый подход"}</h1>
      <form class="workout-form" id="log-form">
        <div class="form-group">
          <label class="label">Тип тренировки</label>
          ${o.length>10?ys({items:o.map(m=>({id:m.id,name:m.name})),selectedId:be?u==null?void 0:u.workoutTypeId:a,name:"typeId",inputId:"workout-type-select",placeholder:"Начните вводить название..."}):`<select class="select" name="typeId" id="workout-type-select" required>
                ${o.map(m=>`<option value="${m.id}" ${(be?u&&m.id===u.workoutTypeId:m.id===a)?"selected":""}>${m.name}</option>`).join("")}
              </select>`}
        </div>
        
        <div id="strength-inputs" style="display: none;">
            <div class="form-row">
              <div class="form-group">
                <label class="label">Вес (кг)</label>
                <input class="input" type="number" name="weight" step="0.5" placeholder="0" value="${be&&u?u.weight??"":""}">

              </div>
              <div class="form-group">
                <label class="label">Повторений</label>
                <input class="input" type="number" name="reps" placeholder="0" value="${be&&u?u.reps??"":""}">

              </div>
            </div>
        </div>

        <div id="time-inputs" style="display: none;">
            <div class="form-row">
                <div class="form-group">
                    <label class="label">Часы</label>
                    <input class="input" type="number" name="duration_hours" placeholder="0" value="${be&&u&&u.duration?Math.floor(u.duration/60):""}">
                </div>
                <div class="form-group">
                    <label class="label">Минуты</label>
                    <input class="input" type="number" name="duration_minutes" placeholder="0" value="${be&&u&&u.duration?u.duration%60:""}">
                </div>
            </div>
        </div>

        ${be&&u?`
        <div class="form-group">
          <label class="label">Дата</label>
          <input class="input" type="date" name="date" required value="${u.date.split("T")[0]}">
        </div>
        `:""}

        <button class="button" type="submit">${be?"Сохранить изменения":"Зафиксировать"}</button>
        ${be?'<button class="button button_secondary" type="button" id="cancel-edit-btn" style="margin-top: 12px;">Отмена</button>':""}
        ${!be&&r?`<button class="button button_secondary" type="button" id="duplicate-last-btn" style="margin-top: 12px;">Повторить: ${(p=o.find(m=>m.id===r.workoutTypeId))==null?void 0:p.name} ${r.weight!==void 0?`${r.weight}кг × ${r.reps}`:`${r.duration} мин`}</button>`:""}

      </form>
      <div class="recent-logs">
        <div class="recent-logs__header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
           <button class="icon-btn" id="prev-week-btn">◀️</button>
           <div id="week-label-container" style="display: flex; align-items: center; gap: 8px; position: relative;">
             <span style="font-size: 18px; position: relative; display: inline-block;">
               📅
               <input type="date" id="calendar-input" value="${qi}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
             </span>
             <h2 class="subtitle" style="margin: 0;">${Ke===0?"Последние 7 дней":d}</h2>
             <label class="filter-toggle" title="Фильтр по типу упражнения">
               <input type="checkbox" id="filter-toggle-input" ${Vi?"checked":""}>
               <span class="filter-toggle__icon">🔍</span>
             </label>
           </div>
           <button class="icon-btn" id="next-week-btn" ${Ke===0?"disabled":""} style="${Ke===0?"opacity: 0.3; cursor: default;":""}">▶️</button>
        </div>
        <div id="logs-list">
          ${Da()}
        </div>
      </div>
    </div>
  `}function Da(){const o=V.getLogs(),n=V.getWorkoutTypes(),{start:r,end:a}=Gi(Ke);let u=o.filter(d=>{const p=new Date(d.date);return p>=r&&p<=a});if(Vi){const d=Zo();d&&(u=u.filter(p=>p.workoutTypeId===d))}return Ia(u,n,!0)}function Tt(){const o=document.getElementById("logs-list"),n=document.querySelector("#week-label-container .subtitle");if(o&&(o.innerHTML=Da(),pl()),n){const{label:a}=Gi(Ke);n.textContent=Ke===0?"Последние 7 дней":a}const r=document.getElementById("next-week-btn");r&&(r.disabled=Ke===0,r.style.opacity=Ke===0?"0.3":"",r.style.cursor=Ke===0?"default":"")}function pl(){document.querySelectorAll(".log-set__delete").forEach(o=>{o.addEventListener("click",async()=>{const n=o.getAttribute("data-id");n&&(be===n&&(be=null),await V.deleteLog(n),Tt())})}),document.querySelectorAll(".log-set__edit").forEach(o=>{o.addEventListener("click",()=>{be=o.getAttribute("data-id"),it(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(o=>{o.addEventListener("click",()=>{const n=o.getAttribute("data-date");n&&Ma(n)})})}function Ia(o,n,r){if(o.length===0)return'<p class="hint">Нет записей за этот период</p>';const a=new Map;[...o].sort((p,m)=>new Date(m.date).getTime()-new Date(p.date).getTime()).forEach(p=>{const g=new Date(p.date).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"});a.has(g)||a.set(g,[]),a.get(g).push(p)});const u=V.getWorkouts();let d="";return a.forEach((p,m)=>{var U;const g=((U=p[0])==null?void 0:U.date.split("T")[0])||"",S=new Set;p.forEach(H=>{H.workoutId&&S.add(H.workoutId)});const C=Array.from(S).sort((H,F)=>{var ge,Ce;const G=u.find(le=>le.id===H),te=u.find(le=>le.id===F),se=(G==null?void 0:G.startTime)||((ge=p.find(le=>le.workoutId===H))==null?void 0:ge.date)||"",oe=(te==null?void 0:te.startTime)||((Ce=p.find(le=>le.workoutId===F))==null?void 0:Ce.date)||"";return new Date(oe).getTime()-new Date(se).getTime()}),D=C.length===1?C[0]:null,A=D?u.find(H=>H.id===D):null,L=A&&A.name,M=A?Math.round(V.getWorkoutDuration(A)):0;d+='<div class="log-day">',d+=`<div class="log-day__header">
      <span>${m}${L?` • ${A.name}`:""}${A?` • ${M} мин`:""}</span>
      ${r?`<button class="share-btn" data-date="${g}" title="Поделиться">📤</button>`:""}
    </div>`,C.forEach(H=>{const F=u.find(oe=>oe.id===H),G=p.filter(oe=>oe.workoutId===H);if(!(C.length===1&&(L||!(F!=null&&F.name)))){const oe=F?Math.round(V.getWorkoutDuration(F)):0;d+=`<h3 class="workout-subheader">
                ${(F==null?void 0:F.name)||"Тренировка"} 
                <span class="workout-subheader__time">${oe} мин</span>
            </h3>`}const se=new Map;G.forEach(oe=>{se.has(oe.workoutTypeId)||se.set(oe.workoutTypeId,[]),se.get(oe.workoutTypeId).push(oe)}),se.forEach((oe,ge)=>{const Ce=n.find(le=>le.id===ge);d+=`
            <div class="log-exercise">
              <div class="log-exercise__name">${(Ce==null?void 0:Ce.name)||"Удалено"}</div>
              <div class="log-exercise__sets">
                ${oe.map(le=>`
                  <div class="log-set ${le.id===be?"log-set_active-edit":""} ${le.id===hn?"log-set_new":""}">
                    <div class="log-set__info">
                      ${le.weight!==void 0&&le.reps!==void 0?`
                        <span class="log-set__weight">${le.weight} кг</span>
                        <span class="log-set__times">×</span>
                        <span class="log-set__reps">${le.reps}</span>
                      `:`
                        <span class="log-set__reps">⏱ ${le.duration} мин</span>
                      `}
                    </div>
                    ${r?`
                    <div class="log-set__actions">
                      <button class="log-set__edit" data-id="${le.id}">✏️</button>
                      <button class="log-set__delete" data-id="${le.id}">×</button>
                    </div>
                    `:""}
                  </div>
                `).join("")}
              </div>
            </div>
          `})});const $=p.filter(H=>!H.workoutId);if($.length>0){const H=new Map;$.forEach(F=>{H.has(F.workoutTypeId)||H.set(F.workoutTypeId,[]),H.get(F.workoutTypeId).push(F)}),H.forEach((F,G)=>{const te=n.find(se=>se.id===G);d+=`
            <div class="log-exercise">
              <div class="log-exercise__name">${(te==null?void 0:te.name)||"Удалено"}</div>
              <div class="log-exercise__sets">
                ${F.map(se=>`
                  <div class="log-set ${se.id===be?"log-set_active-edit":""} ${se.id===hn?"log-set_new":""}">
                    <div class="log-set__info">
                      ${se.weight!==void 0&&se.reps!==void 0?`
                        <span class="log-set__weight">${se.weight} кг</span>
                        <span class="log-set__times">×</span>
                        <span class="log-set__reps">${se.reps}</span>
                      `:`
                        <span class="log-set__reps">⏱ ${se.duration} мин</span>
                      `}
                    </div>
                    ${r?`
                    <div class="log-set__actions">
                      <button class="log-set__edit" data-id="${se.id}">✏️</button>
                      <button class="log-set__delete" data-id="${se.id}">×</button>
                    </div>
                    `:""}
                  </div>
                `).join("")}
              </div>
            </div>
          `})}d+="</div>"}),d}function Ta(){const o=V.getWorkoutTypes(),n=Je?o.find(r=>r.id===Je):null;return`
    <div class="page-content">
      <h1 class="title">Настройки</h1>
      <div class="settings-section">
        <h2 class="subtitle">${Je?"Редактирование типа":"Добавить тип тренировки"}</h2>
        <form class="add-type-form" id="add-type-form" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 8px; flex-direction: column;">
            <input class="input" type="text" id="new-type-name" placeholder="Название (напр. Жим гантелей)" required value="${n?n.name:""}">
            
            <div class="category-switch" style="display: flex; gap: 12px; margin-bottom: 8px;">
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="strength" ${!n||n.category!=="time"?"checked":""}>
                    Силовое
                </label>
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="time" ${n&&n.category==="time"?"checked":""}>
                    На время
                </label>
            </div>

            <button class="button" type="submit">${Je?"Сохранить":"Добавить"}</button>
          </div>
          ${Je?'<button class="button button_secondary" type="button" id="cancel-edit-type-btn" style="margin-top: 8px; width: 100%;">Отмена</button>':""}
        </form>

        <h2 class="subtitle">Типы тренировок</h2>
        <div class="type-list" id="workout-type-list">
          ${o.map(r=>`
            <div class="type-item" data-id="${r.id}">
              <span class="drag-handle" style="cursor: grab; margin-right: 12px; opacity: 0.5;">⋮⋮</span>
              <span style="flex-grow: 1;">${r.name}</span>
              <div style="display: flex; gap: 8px;">
                <button class="type-item__edit icon-btn" data-id="${r.id}" title="Редактировать">✏️</button>
                <button class="type-item__delete icon-btn" data-id="${r.id}" title="Удалить">×</button>
              </div>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `}function Oa(o){var p,m;const n=V.getProfile(),r=(n==null?void 0:n.isPublic)??!1,a=(n==null?void 0:n.displayName)||((m=(p=pe==null?void 0:pe.initDataUnsafe)==null?void 0:p.user)==null?void 0:m.first_name)||"",u=V.getProfileIdentifier(),d=u?bn(u):"";return o==="public"?`${n!=null&&n.friends&&n.friends.length>0?`
      <div class="settings-section">
          <div class="settings-section-title">Друзья (${n.friends.length})</div>
          <div class="friends-list">
              ${n.friends.map(g=>`
                  <a href="${bn(g.identifier)}" class="friend-item" style="display: flex; align-items: center; gap: 12px; padding: 8px 0; border-bottom: 1px solid var(--border-color); cursor: pointer; text-decoration: none; color: inherit;">
                      <div class="friend-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--surface-color-alt); display: flex; align-items: center; justify-content: center; overflow: hidden;">
                          ${g.photoUrl?`<img src="${g.photoUrl}" style="width: 100%; height: 100%; object-fit: cover;">`:g.displayName.charAt(0).toUpperCase()}
                      </div>
                      <div class="friend-info" style="flex-grow: 1;">
                          <div class="friend-name" style="font-weight: 500;">${g.displayName}</div>
                      </div>
                      <div class="friend-arrow">›</div>
                  </a>
              `).join("")}
          </div>
      </div>
      `:""}
      <div class="settings-section">
        <div class="settings-section-title">Видимость</div>
        <div class="toggle-row">
          <div class="toggle-label">
            <span class="toggle-label-text">Публичный профиль</span>
            <span class="toggle-label-hint">Другие смогут видеть вашу статистику</span>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="profile-public-toggle" ${r?"checked":""}>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="toggle-row" style="margin-top: 12px;">
          <div class="toggle-label">
            <span class="toggle-label-text">Показывать все упражнения</span>
            <span class="toggle-label-hint">Подробный список упражнений в публичном профиле</span>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="profile-history-toggle" ${n!=null&&n.showFullHistory?"checked":""}>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-section-title">Имя</div>
        <input class="input" type="text" id="profile-display-name" value="${a}" placeholder="Ваше имя">
      </div>

      ${r&&u?`
        <div class="settings-section">
          <div class="settings-section-title">Ссылка на профиль</div>
          <div class="profile-link-section">
            <a href="${d}" target="_blank" class="profile-link-url">${d}</a>
            <div class="profile-link-actions">
              <button class="button button_secondary" id="copy-profile-link">Копировать</button>
              <button class="button" id="share-profile-link">Поделиться</button>
            </div>
          </div>
        </div>
      `:""}

      <div class="settings-section">
        <div class="settings-section-title">Превью статистики</div>
        ${function(){const g=V.getLogs(),S=V.getWorkoutTypes(),C=g.reduce((F,G)=>F+(G.weight||0)*(G.reps||0),0),D=new Set(g.map(F=>F.date.split("T")[0])),A=D.size,L=g.length>0?[...g].sort((F,G)=>new Date(G.date).getTime()-new Date(F.date).getTime())[0].date:void 0,M=new Map;g.forEach(F=>{M.set(F.workoutTypeId,(M.get(F.workoutTypeId)||0)+1)});let $,U=0;return M.forEach((F,G)=>{if(F>U){U=F;const te=S.find(se=>se.id===G);te&&($=te.name)}}),_a({totalWorkouts:A,totalVolume:C,favoriteExercise:$,lastWorkoutDate:L},D)}()}
      </div>

      <button class="button" id="save-profile-btn" style="margin-top: 12px;">Сохранить</button>
    `:o==="ai"?`
      <div class="settings-section">
            <div class="settings-section-title">AI Рекомендации</div>
            
            <div class="ai-controls" style="display: flex; flex-direction: column; gap: 12px;">
                <button class="button" id="ai-general-btn" ${gn!=="idle"?"disabled":""}>
                    ${gn==="general"?"Анализ...":"✨ Общий анализ"}
                </button>

                <div id="ai-general-result" class="ai-result" style="margin-top: 24px; background: var(--surface-color-alt); padding: 16px; border-radius: 12px; ${mn.general?"":"display: none;"}">
                    <div class="markdown-body" style="font-family: inherit;">${mn.general||""}</div>
                </div>

                <div class="ai-plan-section">
                    <h3 class="workout-subheader" style="margin-bottom: 8px;">План тренировок</h3>
                    <div class="form-group">
                        <select class="select" id="ai-plan-period">
                            <option value="day">На сегодня</option>
                            <option value="week">На неделю</option>
                        </select>
                    </div>
                      
                    <div class="toggle-row toggle-row--clean" style="margin-top: 12px;">
                      <div class="toggle-label">
                          <span class="toggle-label-text">Рекомендовать новые упражнения</span>
                      </div>
                      <label class="toggle-switch">
                          <input type="checkbox" id="ai-allow-new">
                          <span class="toggle-slider"></span>
                      </label>
                    </div>
                    <button class="button" id="ai-plan-btn" ${gn!=="idle"?"disabled":""} style="margin-top: 8px;">
                        ${gn==="plan"?"Генерация...":"📅 Создать план"}
                    </button>

                    <div id="ai-plan-result" class="ai-result" style="margin-top: 12px; background: var(--surface-color-alt); padding: 16px; border-radius: 12px; ${mn.plan?"":"display: none;"}">
                        <div class="markdown-body" style="font-family: inherit;">${mn.plan||""}</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-section-title">Личные данные (Приватно)</div>
            <p class="hint" style="margin-bottom: 12px; font-size: 0.9em;">Эти данные используются только для персонализации советов от AI и не видны другим пользователям.</p>
            
            <div class="form-row">
              <div class="form-group">
                  <label class="label">Пол</label>
                  <select class="select" id="profile-gender">
                      <option value="" ${n!=null&&n.gender?"":"selected"}>Не указано</option>
                      <option value="male" ${(n==null?void 0:n.gender)==="male"?"selected":""}>Мужской</option>
                      <option value="female" ${(n==null?void 0:n.gender)==="female"?"selected":""}>Женский</option>
                  </select>
              </div>
              <div class="form-group">
                  <label class="label">Дата рождения</label>
                  <input class="input" type="date" id="profile-birthdate" value="${(n==null?void 0:n.birthDate)||""}">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                  <label class="label">Рост (см)</label>
                  <input class="input" type="number" id="profile-height" placeholder="180" value="${(n==null?void 0:n.height)||""}">
              </div>
              <div class="form-group">
                  <label class="label">Вес (кг)</label>
                  <input class="input" type="number" id="profile-weight" placeholder="75" value="${(n==null?void 0:n.weight)||""}">
              </div>
            </div>

            <div class="form-group">
               <label class="label">Дополнительная информация</label>
               <textarea class="input" id="profile-additional-info" rows="3" placeholder="Укажите травмы, ограничения, цели или любую другую информацию, которая поможет AI давать более точные советы...">${(n==null?void 0:n.additionalInfo)||""}</textarea>
            </div>
            <button class="button" id="save-profile-btn" style="margin-top: 12px;">Сохранить</button>
        </div>
    `:o==="data"?`
      <div class="settings-section">
        <div class="settings-section-title">Управление данными</div>
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <button class="button button_secondary" id="export-json-btn">Экспорт JSON (Backup)</button>
          <button class="button button_secondary" id="export-md-btn">Экспорт Markdown</button>
          <button class="button button_secondary" id="import-json-btn">Импорт JSON (Restore)</button>
          <input type="file" id="import-file-input" style="display: none" accept=".json">
        </div>
      </div>
    `:""}function hl(){var a,u;const o=V.getProfile(),n=(o==null?void 0:o.isPublic)??!1,r=(o==null?void 0:o.displayName)||((u=(a=pe==null?void 0:pe.initDataUnsafe)==null?void 0:a.user)==null?void 0:u.first_name)||"";return`
    <div class="page-content profile-page">
      <h1 class="title">Профиль</h1>
      
      <div class="profile-header">
        <div class="profile-avatar">
          ${o!=null&&o.photoUrl?`<img src="${o.photoUrl}" alt="${r}" class="profile-avatar-img">`:r.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${r}</div>
        <div class="profile-subtitle">${n?"Публичный профиль":"Приватный профиль"}</div>
      </div>

      <div class="stats-tabs">
        <button class="stats-tab profile-tab ${Yt==="ai"?"active":""}" data-tab="ai">AI</button>
        <button class="stats-tab profile-tab ${Yt==="public"?"active":""}" data-tab="public">Публичное</button>
        <button class="stats-tab profile-tab ${Yt==="data"?"active":""}" data-tab="data">Данные</button>
      </div>

      <div class="profile-settings" id="profile-tab-content">
        ${Oa(Yt)}
      </div>
    </div>
  `}function Aa(){var m,g;const o=document.getElementById("profile-tab-content");o&&(o.innerHTML=Oa(Yt),ml());const n=V.getProfile(),r=(n==null?void 0:n.displayName)||((g=(m=pe==null?void 0:pe.initDataUnsafe)==null?void 0:m.user)==null?void 0:g.first_name)||"",a=(n==null?void 0:n.isPublic)??!1,u=document.querySelector(".profile-page .profile-name");u&&(u.textContent=r);const d=document.querySelector(".profile-page .profile-subtitle");d&&(d.textContent=a?"Публичный профиль":"Приватный профиль");const p=document.querySelector(".profile-page .profile-avatar");p&&(p.innerHTML=n!=null&&n.photoUrl?`<img src="${n.photoUrl}" alt="${r}" class="profile-avatar-img">`:r.charAt(0).toUpperCase()),document.querySelectorAll(".profile-tab").forEach(S=>{const C=S.getAttribute("data-tab");S.classList.toggle("active",C===Yt)})}function Ki(){const o=document.querySelector(".content");o&&(o.innerHTML=La(),Ca())}function Ca(){document.querySelectorAll(".stats-tab").forEach(r=>{r.addEventListener("click",()=>{const a=r.getAttribute("data-tab");(a==="overview"||a==="progress")&&(Tr=a,Ki())})});const n=document.getElementById("stat-type-select");n==null||n.addEventListener("change",r=>{Bn=r.target.value,Ki()})}function Nn(){const o=document.querySelector(".content");o&&(o.innerHTML=Ta(),Pa())}function Pa(){const o=document.getElementById("add-type-form");o==null||o.addEventListener("submit",async a=>{var p;a.preventDefault();const u=document.getElementById("new-type-name"),d=((p=document.querySelector('input[name="new-type-category"]:checked'))==null?void 0:p.value)||"strength";u.value&&(Je?(await V.updateWorkoutType(Je,u.value,d),Je=null):await V.addWorkoutType(u.value,d),Nn())});const n=document.getElementById("cancel-edit-type-btn");n==null||n.addEventListener("click",()=>{Je=null,Nn()}),document.querySelectorAll(".type-item__edit").forEach(a=>{a.addEventListener("click",()=>{Je=a.getAttribute("data-id"),Nn();const u=document.getElementById("new-type-name");u==null||u.focus()})}),document.querySelectorAll(".type-item__delete").forEach(a=>{a.addEventListener("click",async()=>{const u=a.getAttribute("data-id");u&&confirm("Удалить этот тип тренировки?")&&(Je===u&&(Je=null),await V.deleteWorkoutType(u),Nn())})});const r=document.getElementById("workout-type-list");r&&re.create(r,{animation:150,handle:".drag-handle",onEnd:async()=>{const a=Array.from(r.children).map(u=>u.getAttribute("data-id")||"").filter(Boolean);await V.updateWorkoutTypeOrder(a)}})}function dn(){var a,u;const o=document.getElementById("main-content");if(!o)return;const n=Sa(),r=o.firstElementChild;if(r){const d=document.createElement("div");d.innerHTML=n;const p=d.firstElementChild;p&&(r.classList.contains("workout-controls")||r.id==="start-workout-btn"?r.replaceWith(p):o.querySelector(".workout-controls")?(a=o.querySelector(".workout-controls"))==null||a.replaceWith(p):o.querySelector("#start-workout-btn")?(u=o.querySelector("#start-workout-btn"))==null||u.replaceWith(p):o.insertBefore(p,o.firstChild),$a())}xa()}function $a(){const o=document.getElementById("start-workout-btn");o==null||o.addEventListener("click",()=>{Or=!0,dn()});const n=document.getElementById("cancel-start-workout-btn");n==null||n.addEventListener("click",()=>{Or=!1,dn()});const r=document.getElementById("start-workout-form");r==null||r.addEventListener("submit",async p=>{p.preventDefault();const g=new FormData(r).get("workoutName");await V.startWorkout(g),Or=!1,dn()});const a=document.getElementById("pause-workout-btn");a==null||a.addEventListener("click",async()=>{await V.pauseWorkout(),dn()});const u=document.getElementById("resume-workout-btn");u==null||u.addEventListener("click",async()=>{await V.resumeWorkout(),dn()});const d=document.getElementById("finish-workout-btn");d==null||d.addEventListener("click",async()=>{confirm("Завершить тренировку?")&&(await V.finishWorkout(),dn())})}function ml(){var m,g,S,C;const o=document.getElementById("save-profile-btn");o==null||o.addEventListener("click",async()=>{const D=document.getElementById("profile-public-toggle"),A=document.getElementById("profile-history-toggle"),L=document.getElementById("profile-display-name"),M=document.getElementById("profile-gender"),$=document.getElementById("profile-birthdate"),U=document.getElementById("profile-height"),H=document.getElementById("profile-weight"),F=document.getElementById("profile-additional-info"),G={};D&&(G.isPublic=D.checked),A&&(G.showFullHistory=A.checked),L&&(G.displayName=L.value),M&&(G.gender=M.value||void 0),$&&(G.birthDate=$.value),U&&(G.height=U.value?Number(U.value):void 0),H&&(G.weight=H.value?Number(H.value):void 0),F&&(G.additionalInfo=F.value),await V.updateProfileSettings(G),Se("Профиль сохранен")});const n=document.getElementById("ai-general-btn"),r=document.getElementById("ai-plan-btn"),a=D=>{gn=D,n&&(n.disabled=D!=="idle",n.textContent=D==="general"?"Анализ...":"✨ Общий анализ"),r&&(r.disabled=D!=="idle",r.textContent=D==="plan"?"Генерация...":"📅 Создать план")},u=(D,A)=>{mn[D]=A;const L=D==="general"?"ai-general-result":"ai-plan-result",M=document.getElementById(L);if(M){M.style.display="";const $=M.querySelector(".markdown-body");$&&($.innerHTML=A)}};n&&n.addEventListener("click",async()=>{a("general");try{const D=await V.getAIRecommendation("general");u("general",D)}catch(D){Se("Ошибка: "+(D instanceof Error?D.message:String(D)))}finally{a("idle")}}),r&&r.addEventListener("click",async()=>{const D=document.getElementById("ai-plan-period").value,A=document.getElementById("ai-allow-new").checked;a("plan");try{const L=await V.getAIRecommendation("plan",{period:D,allowNewExercises:A});u("plan",L)}catch(L){Se("Ошибка: "+(L instanceof Error?L.message:String(L)))}finally{a("idle")}});const d=document.getElementById("copy-profile-link");d==null||d.addEventListener("click",()=>{const D=V.getProfileIdentifier();if(D){const A=bn(D);navigator.clipboard.writeText(A).then(()=>{Se("Ссылка скопирована")})}});const p=document.getElementById("share-profile-link");p==null||p.addEventListener("click",()=>{const D=V.getProfileIdentifier();if(D){const A=bn(D);if(pe!=null&&pe.openTelegramLink){const L=`https://t.me/share/url?url=${encodeURIComponent(A)}&text=${encodeURIComponent("Мой профиль тренировок 💪")}`;pe.openTelegramLink(L)}else navigator.clipboard.writeText(A).then(()=>{Se("Ссылка скопирована")})}}),(m=document.getElementById("export-json-btn"))==null||m.addEventListener("click",async()=>{try{const D=await V.exportData(),A=`gym_backup_${new Date().toISOString().split("T")[0]}.json`;jr(JSON.stringify(D,null,2),A,"application/json"),Se("Экспорт выполнен")}catch(D){console.error(D),Se("Ошибка экспорта")}}),(g=document.getElementById("export-md-btn"))==null||g.addEventListener("click",async()=>{try{const D=await V.exportData(),A=wa(D),L=`gym_history_${new Date().toISOString().split("T")[0]}.md`;jr(A,L,"text/markdown"),Se("Экспорт выполнен")}catch(D){console.error(D),Se("Ошибка экспорта")}}),(S=document.getElementById("import-json-btn"))==null||S.addEventListener("click",()=>{var D;(D=document.getElementById("import-file-input"))==null||D.click()}),(C=document.getElementById("import-file-input"))==null||C.addEventListener("change",D=>{var M;const A=(M=D.target.files)==null?void 0:M[0];if(!A)return;const L=new FileReader;L.onload=async $=>{var U;try{const H=(U=$.target)==null?void 0:U.result,F=JSON.parse(H);confirm("Внимание! Все текущие данные будут заменены данными из файла. Продолжить?")&&(await V.importData(F),Se("Данные успешно импортированы"),setTimeout(()=>location.reload(),1e3))}catch(H){console.error(H),Se("Ошибка импорта: Неверный формат файла")}},L.readAsText(A),D.target.value=""})}function gl(){if(!ka)return`
      <div class="page-content">
        <div class="profile-not-found">
          <div class="profile-not-found-icon">🔍</div>
          <div class="profile-not-found-text">Профиль не найден</div>
        </div>
      </div>
    `;if(!Br)return Ri?`
        <div class="page-content">
          <div class="profile-not-found">
            <div class="profile-not-found-icon">🔒</div>
            <div class="profile-not-found-text">Профиль скрыт или не существует</div>
          </div>
        </div>
      `:`
      <div class="page-content">
        <div class="profile-loading">Загрузка профиля...</div>
      </div>
    `;const o=Br;return o.logs&&(o.logs=o.logs.filter(n=>!n.isDeleted)),o.workoutTypes&&(o.workoutTypes=o.workoutTypes.filter(n=>!n.isDeleted)),`
    <div class="page-content profile-page">
      <div class="profile-header">
        <div class="profile-avatar">
          ${o.photoUrl?`<img src="${o.photoUrl}" alt="${o.displayName}" class="profile-avatar-img">`:o.displayName.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${o.displayName}</div>
        <div class="profile-subtitle">@${o.identifier}</div>
        ${function(){const n=V.getProfile();if(n&&(n.telegramUsername===o.identifier||`id_${n.telegramUserId}`===o.identifier))return"";const a=V.isFriend(o.identifier);return`
                <button class="button ${a?"button_secondary":""}" id="friend-action-btn" data-id="${o.identifier}" data-name="${o.displayName}" data-photo="${o.photoUrl||""}" style="margin-top: 12px; height: 36px; font-size: 14px; display: flex; align-items: center; justify-content: center;">
                    ${a?"Удалить из друзей":"Добавить в друзья"}
                </button>
            `}()}
      </div>

      ${function(){let n=0;o.logs&&(n=o.logs.reduce((d,p)=>d+(p.weight||0)*(p.reps||0),0));const r=Math.max(o.stats.totalVolume,n),a={...o.stats,totalVolume:r},u=o.logs?new Set(o.logs.map(d=>d.date.split("T")[0])):new Set;return _a(a,u)}()}

      ${o.recentActivity.length>0?`
        <div class="activity-list">
          <h2 class="subtitle">Недавняя активность</h2>
          ${o.recentActivity.map(n=>`
            <div class="activity-item">
              <span class="activity-date">${new Date(n.date).toLocaleDateString()}</span>
              <span class="activity-count">${n.exerciseCount} упражнений</span>
            </div>
          `).join("")}
        </div>
      `:""}

      ${o.logs&&o.logs.length>0&&o.workoutTypes?`
        <div class="recent-logs">
          <h2 class="subtitle">История тренировок</h2>
          <div id="logs-list">
            ${Ia(o.logs,o.workoutTypes,!1)}
          </div>
        </div>
      `:""}
    </div>
  `}function La(){const o=V.getLogs(),n=V.getWorkouts(),r=V.getWorkoutTypes();if(o.length===0)return`
      <div class="page-content">
        <h1 class="title">Статистика</h1>
        <p class="hint">Недостаточно данных для статистики</p>
      </div>
    `;const a=o.reduce((m,g)=>m+(g.weight||0)*(g.reps||0),0),u=o.reduce((m,g)=>m+(g.reps||0),0),d=As(n);let p=`
    <div class="page-content">
      <h1 class="title">Статистика</h1>
      <div class="stats-tabs">
        <button class="stats-tab ${Tr==="overview"?"active":""}" data-tab="overview">Обзор</button>
        <button class="stats-tab ${Tr==="progress"?"active":""}" data-tab="progress">Прогресс</button>
      </div>
  `;if(Tr==="overview"){const m=Os(n,o);p+=`
        <div class="stats-section">
            <h2 class="subtitle">Активность</h2>
            ${ra(m)}
        </div>

        <div class="stats-summary">
            <div class="stat-metric">
                <div class="stat-metric__label">Всего тренировок</div>
                <div class="stat-metric__value">${m.size}</div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">Сред. длительность</div>
                <div class="stat-metric__value">${d.averageMinutes}<span class="stat-metric__unit">мин</span></div>
            </div>
             <div class="stat-metric">
                <div class="stat-metric__label">Общий объем</div>
                <div class="stat-metric__value">${Math.round(a/1e3)}<span class="stat-metric__unit">т</span></div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">Всего повторений</div>
                <div class="stat-metric__value">${u}</div>
            </div>
        </div>

        <div class="charts-section">
            <h2 class="subtitle">Длительность тренировок</h2>
            <div class="chart-container">
                ${Ps(n)}
            </div>
        </div>
     `}else if(p+=`
        <div class="form-group">
            <label class="label">Упражнение</label>
            <select class="select" id="stat-type-select">
                <option value="all">Все упражнения (Объем)</option>
                ${r.map(m=>`<option value="${m.id}" ${Bn===m.id?"selected":""}>${m.name}</option>`).join("")}
            </select>
        </div>
    `,Bn==="all")p+=`
            <div class="charts-section">
                <h2 class="subtitle">Общий объем по дням</h2>
                <div class="chart-container">
                    ${No(o)}
                </div>
            </div>
        `;else{const m=o.filter(S=>S.workoutTypeId===Bn),g=Ts(m,Bn);p+=`
             <div class="charts-section">
                <h2 class="subtitle">Прогресс силовых (1RM)</h2>
                <div class="chart-container">
                    ${Cs(g)}
                </div>
            </div>
            
            <div class="charts-section" style="margin-top: 24px;">
                <h2 class="subtitle">Объем нагрузки</h2>
                 <div class="chart-container">
                    ${No(m)}
                </div>
            </div>
        `}return p+="</div>",p}function vl(o){const n=V.getLogs(),r=V.getWorkoutTypes(),a=n.filter(S=>S.date.startsWith(o));if(a.length===0)return"";const d=new Date(a[0].date).toLocaleDateString("ru-RU",{day:"numeric",month:"long"}),p=new Map;a.forEach(S=>{p.has(S.workoutTypeId)||p.set(S.workoutTypeId,[]),p.get(S.workoutTypeId).push(S)});let m=`🏋️ Тренировка ${d}

`;p.forEach((S,C)=>{const D=r.find(A=>A.id===C);m+=`${(D==null?void 0:D.name)||"Упражнение"}:
`,S.forEach(A=>{A.duration?m+=`  ⏱ ${A.duration} мин
`:m+=`  ${A.weight} кг × ${A.reps}
`}),m+=`
`});const g=a.reduce((S,C)=>S+(C.weight&&C.reps?C.weight*C.reps:0),0);return g&&(m+=`💪 Общий объём: ${Math.round(g)} кг`),m}function Ma(o){const n=vl(o);if(n)if(pe!=null&&pe.openTelegramLink){const r=`https://t.me/share/url?url=${encodeURIComponent("https://t.me/gymgym21bot")}&text=${encodeURIComponent(n)}`;pe.openTelegramLink(r)}else navigator.clipboard.writeText(n).then(()=>{alert("Текст скопирован в буфер обмена")})}function yl(){var o,n,r,a;if(Ve==="main"){$a();const u=document.getElementById("log-form"),d=()=>{const M=V.getWorkoutTypes(),$=Zo(u),U=M.find(G=>G.id===$),H=document.getElementById("strength-inputs"),F=document.getElementById("time-inputs");U&&U.category==="time"?(H&&(H.style.display="none"),F&&(F.style.display="block"),u.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(G=>G.removeAttribute("required")),u.querySelectorAll('input[name="duration_hours"], input[name="duration_minutes"]').forEach(G=>G.removeAttribute("required"))):(H&&(H.style.display="block"),F&&(F.style.display="none"),u.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(G=>G.setAttribute("required","true")),u.querySelectorAll('input[name="duration_hours"], input[name="duration_minutes"]').forEach(G=>G.removeAttribute("required")))};d(),(u==null?void 0:u.querySelector("[data-typeahead]"))&&(ws(u,V.getWorkoutTypes().map(M=>({id:M.id,name:M.name}))),bs(u));const m=document.getElementById("workout-type-select");m==null||m.addEventListener("change",d),u==null||u.addEventListener("submit",async M=>{M.preventDefault();const $=new FormData(u),U=$.get("typeId"),F=V.getWorkoutTypes().find(te=>te.id===U),G={workoutTypeId:U};if((F==null?void 0:F.category)==="time"){const te=parseInt($.get("duration_hours"),10)||0,se=parseInt($.get("duration_minutes"),10)||0;G.duration=te*60+se}else G.weight=parseFloat($.get("weight")),G.reps=parseInt($.get("reps"),10);if(be){const se=V.getLogs().find(oe=>oe.id===be);if(se){const oe=$.get("date");let ge=se.date;if(oe){const Ce=new Date(se.date),[le,ot,Fe]=oe.split("-").map(Number);Ce.setFullYear(le,ot-1,Fe),ge=Ce.toISOString()}await V.updateLog({...se,...G,date:ge}),be=null,it()}}else hn=(await V.addLog(G)).id,Tt(),hn=null});const g=document.getElementById("duplicate-last-btn");g==null||g.addEventListener("click",async()=>{const M=V.getLogs(),$=M[M.length-1];$&&(hn=(await V.addLog({workoutTypeId:$.workoutTypeId,weight:$.weight,reps:$.reps,duration:$.duration})).id,Tt(),hn=null)});const S=document.getElementById("cancel-edit-btn");S==null||S.addEventListener("click",()=>{be=null,it()}),document.querySelectorAll(".log-set__delete").forEach(M=>{M.addEventListener("click",async()=>{const $=M.getAttribute("data-id");$&&(be===$&&(be=null),await V.deleteLog($),Tt())})}),document.querySelectorAll(".log-set__edit").forEach(M=>{M.addEventListener("click",()=>{be=M.getAttribute("data-id"),it(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(M=>{M.addEventListener("click",()=>{const $=M.getAttribute("data-date");$&&Ma($)})});const C=document.getElementById("prev-week-btn");C==null||C.addEventListener("click",()=>{Ke++,Tt()});const D=document.getElementById("next-week-btn");D==null||D.addEventListener("click",()=>{Ke>0&&(Ke--,Tt())});const A=document.getElementById("calendar-input");A==null||A.addEventListener("change",()=>{if(!A.value||A.value===qi)return;qi=A.value;const M=new Date(A.value),$=new Date;$.setHours(0,0,0,0);const U=$.getTime()-M.getTime(),H=Math.floor(U/(1e3*60*60*24));Ke=Math.max(0,Math.floor(H/7)),Tt()});const L=document.getElementById("filter-toggle-input");L==null||L.addEventListener("change",()=>{Vi=L.checked,Tt()})}if(Ve==="settings"&&Pa(),Ve==="profile-settings"){document.querySelectorAll(".profile-tab").forEach(A=>{A.addEventListener("click",()=>{const L=A.getAttribute("data-tab");(L==="ai"||L==="public"||L==="data")&&(Yt=L,Aa())})});const d=document.getElementById("save-profile-btn");d==null||d.addEventListener("click",async()=>{const A=document.getElementById("profile-public-toggle"),L=document.getElementById("profile-history-toggle"),M=document.getElementById("profile-display-name"),$=document.getElementById("profile-gender"),U=document.getElementById("profile-birthdate"),H=document.getElementById("profile-height"),F=document.getElementById("profile-weight"),G=document.getElementById("profile-additional-info"),te={};A&&(te.isPublic=A.checked),L&&(te.showFullHistory=L.checked),M&&(te.displayName=M.value),$&&(te.gender=$.value||void 0),U&&(te.birthDate=U.value),H&&(te.height=H.value?Number(H.value):void 0),F&&(te.weight=F.value?Number(F.value):void 0),G&&(te.additionalInfo=G.value),await V.updateProfileSettings(te),Se("Профиль сохранен")});const p=document.getElementById("ai-general-btn"),m=document.getElementById("ai-plan-btn"),g=A=>{gn=A,p&&(p.disabled=A!=="idle",p.textContent=A==="general"?"Анализ...":"✨ Общий анализ"),m&&(m.disabled=A!=="idle",m.textContent=A==="plan"?"Генерация...":"📅 Создать план")},S=(A,L)=>{mn[A]=L;const M=A==="general"?"ai-general-result":"ai-plan-result",$=document.getElementById(M);if($){$.style.display="";const U=$.querySelector(".markdown-body");U&&(U.innerHTML=L)}};p&&p.addEventListener("click",async()=>{g("general");try{const A=await V.getAIRecommendation("general");S("general",A)}catch(A){Se("Ошибка: "+(A instanceof Error?A.message:String(A)))}finally{g("idle")}}),m&&m.addEventListener("click",async()=>{const A=document.getElementById("ai-plan-period").value,L=document.getElementById("ai-allow-new").checked;g("plan");try{const M=await V.getAIRecommendation("plan",{period:A,allowNewExercises:L});S("plan",M)}catch(M){Se("Ошибка: "+(M instanceof Error?M.message:String(M)))}finally{g("idle")}});const C=document.getElementById("copy-profile-link");C==null||C.addEventListener("click",()=>{const A=V.getProfileIdentifier();if(A){const L=bn(A);navigator.clipboard.writeText(L).then(()=>{Se("Ссылка скопирована")})}});const D=document.getElementById("share-profile-link");D==null||D.addEventListener("click",()=>{const A=V.getProfileIdentifier();if(A){const L=bn(A);if(pe!=null&&pe.openTelegramLink){const M=`https://t.me/share/url?url=${encodeURIComponent(L)}&text=${encodeURIComponent("Мой профиль тренировок 💪")}`;pe.openTelegramLink(M)}else navigator.clipboard.writeText(L).then(()=>{Se("Ссылка скопирована")})}}),(o=document.getElementById("export-json-btn"))==null||o.addEventListener("click",async()=>{try{const A=await V.exportData(),L=`gym_backup_${new Date().toISOString().split("T")[0]}.json`;jr(JSON.stringify(A,null,2),L,"application/json"),Se("Экспорт выполнен")}catch(A){console.error(A),Se("Ошибка экспорта")}}),(n=document.getElementById("export-md-btn"))==null||n.addEventListener("click",async()=>{try{const A=await V.exportData(),L=wa(A),M=`gym_history_${new Date().toISOString().split("T")[0]}.md`;jr(L,M,"text/markdown"),Se("Экспорт выполнен")}catch(A){console.error(A),Se("Ошибка экспорта")}}),(r=document.getElementById("import-json-btn"))==null||r.addEventListener("click",()=>{var A;(A=document.getElementById("import-file-input"))==null||A.click()}),(a=document.getElementById("import-file-input"))==null||a.addEventListener("change",A=>{var $;const L=($=A.target.files)==null?void 0:$[0];if(!L)return;const M=new FileReader;M.onload=async U=>{var H;try{const F=(H=U.target)==null?void 0:H.result,G=JSON.parse(F);confirm("Внимание! Все текущие данные будут заменены данными из файла. Продолжить?")&&(await V.importData(G),Se("Данные успешно импортированы"),setTimeout(()=>location.reload(),1e3))}catch(F){console.error(F),Se("Ошибка импорта: Неверный формат файла")}},M.readAsText(L),A.target.value=""})}if(Ve==="stats"&&Ca(),Ve==="public-profile"){const u=document.getElementById("friend-action-btn");u==null||u.addEventListener("click",async()=>{const d=u.getAttribute("data-id"),p=u.getAttribute("data-name"),m=u.getAttribute("data-photo");d&&p&&(V.isFriend(d)?confirm("Удалить пользователя из друзей?")&&await V.removeFriend(d):(await V.addFriend({identifier:d,displayName:p,photoUrl:m||void 0}),Se("Пользователь добавлен в друзья")),it())})}}const Ht=document.createElement("div");Ht.className="sync-status";document.body.appendChild(Ht);function bl(o){switch(Ht.className="sync-status visible "+o,o){case"saving":Ht.textContent="Синхронизация...";break;case"success":Ht.textContent="Синхронизировано";break;case"error":Ht.textContent="Ошибка синхронизации";break;default:Ht.className="sync-status"}}V.onUpdate(()=>{switch(Ve){case"main":it();break;case"profile-settings":Aa();break;case"settings":Nn();break;case"stats":Ki();break;default:it()}});V.onSyncStatusChange(bl);async function wl(){var m;const o=new URLSearchParams(window.location.search);if(o.has("hash")&&o.has("id")){const g={id:parseInt(o.get("id")||"0",10),first_name:o.get("first_name")||"",last_name:o.get("last_name")||void 0,username:o.get("username")||void 0,photo_url:o.get("photo_url")||void 0,auth_date:parseInt(o.get("auth_date")||"0",10),hash:o.get("hash")||""};na(g),o.delete("hash"),o.delete("id"),o.delete("first_name"),o.delete("last_name"),o.delete("username"),o.delete("photo_url"),o.delete("auth_date"),o.delete("auth");const S=o.toString(),C=window.location.pathname+(S?"?"+S:"");window.history.replaceState({},document.title,C),location.reload();return}const n=localStorage.getItem("skip_tma_auth")==="true",r=!!(pe!=null&&pe.initData)&&!n,u=!!Ui();if(!r&&!u){oa(document.getElementById("app"),()=>{location.reload()});return}const p=new URLSearchParams(window.location.search).get("startapp")||((m=pe==null?void 0:pe.initDataUnsafe)==null?void 0:m.start_param);if(p&&p.startsWith("profile_")){const g=p.replace("profile_","");ka=g,Ve="public-profile",Ri=!1,it(),Br=await V.getPublicProfile(g),Br||(Ri=!0),it()}else it()}wl();
