var Xa=Object.defineProperty;var Ga=(i,n,o)=>n in i?Xa(i,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[n]=o;var me=(i,n,o)=>Ga(i,typeof n!="symbol"?n+"":n,o);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function o(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(c){if(c.ep)return;c.ep=!0;const d=o(c);fetch(c.href,d)}})();var Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qa(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var zi={exports:{}};(function(i,n){((o,s)=>{i.exports=s()})(Ti,function(){var o=function(t,e){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,a){r.__proto__=a}:function(r,a){for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(r[u]=a[u])}))(t,e)},s=function(){return(s=Object.assign||function(t){for(var e,r=1,a=arguments.length;r<a;r++)for(var u in e=arguments[r])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t}).apply(this,arguments)};function c(t,e,r){for(var a,u=0,l=e.length;u<l;u++)!a&&u in e||((a=a||Array.prototype.slice.call(e,0,u))[u]=e[u]);return t.concat(a||Array.prototype.slice.call(e))}var d=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ti,h=Object.keys,m=Array.isArray;function g(t,e){return typeof e=="object"&&h(e).forEach(function(r){t[r]=e[r]}),t}typeof Promise>"u"||d.Promise||(d.Promise=Promise);var k=Object.getPrototypeOf,O={}.hasOwnProperty;function P(t,e){return O.call(t,e)}function N(t,e){typeof e=="function"&&(e=e(k(t))),(typeof Reflect>"u"?h:Reflect.ownKeys)(e).forEach(function(r){F(t,r,e[r])})}var K=Object.defineProperty;function F(t,e,r,a){K(t,e,g(r&&P(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},a))}function Y(t){return{from:function(e){return t.prototype=Object.create(e.prototype),F(t.prototype,"constructor",t),{extend:N.bind(null,t.prototype)}}}}var J=Object.getOwnPropertyDescriptor,nt=[].slice;function ot(t,e,r){return nt.call(t,e,r)}function et(t,e){return e(t)}function V(t){if(!t)throw new Error("Assertion Failed")}function lt(t){d.setImmediate?setImmediate(t):setTimeout(t,0)}function mt(t,e){if(typeof e=="string"&&P(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],a=0,u=e.length;a<u;++a){var l=mt(t,e[a]);r.push(l)}return r}var f,p=e.indexOf(".");return p===-1||(f=t[e.substr(0,p)])==null?void 0:mt(f,e.substr(p+1))}function st(t,e,r){if(t&&e!==void 0&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){V(typeof r!="string"&&"length"in r);for(var a=0,u=e.length;a<u;++a)st(t,e[a],r[a])}else{var l,f,p=e.indexOf(".");p!==-1?(l=e.substr(0,p),(p=e.substr(p+1))===""?r===void 0?m(t)&&!isNaN(parseInt(l))?t.splice(l,1):delete t[l]:t[l]=r:st(f=(f=t[l])&&P(t,l)?f:t[l]={},p,r)):r===void 0?m(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function it(t){var e,r={};for(e in t)P(t,e)&&(r[e]=t[e]);return r}var vt=[].concat;function Zt(t){return vt.apply([],t)}var ee="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Zt([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return d[t]}),Ut=new Set(ee.map(function(t){return d[t]})),te=null;function Mt(t){return te=new WeakMap,t=function e(r){if(!r||typeof r!="object")return r;var a=te.get(r);if(a)return a;if(m(r)){a=[],te.set(r,a);for(var u=0,l=r.length;u<l;++u)a.push(e(r[u]))}else if(Ut.has(r.constructor))a=r;else{var f,p=k(r);for(f in a=p===Object.prototype?{}:Object.create(p),te.set(r,a),r)P(r,f)&&(a[f]=e(r[f]))}return a}(t),te=null,t}var de={}.toString;function fe(t){return de.call(t).slice(8,-1)}var Gt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ze=typeof Gt=="symbol"?function(t){var e;return t!=null&&(e=t[Gt])&&e.apply(t)}:function(){return null};function Yt(t,e){e=t.indexOf(e),0<=e&&t.splice(e,1)}var be={};function oe(t){var e,r,a,u;if(arguments.length===1){if(m(t))return t.slice();if(this===be&&typeof t=="string")return[t];if(u=ze(t))for(r=[];!(a=u.next()).done;)r.push(a.value);else{if(t==null)return[t];if(typeof(e=t.length)!="number")return[t];for(r=new Array(e);e--;)r[e]=t[e]}}else for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var He=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ee=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],zt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ee),va={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ve(t,e){this.name=t,this.message=e}function Uo(t,e){return t+". Errors: "+Object.keys(e).map(function(r){return e[r].toString()}).filter(function(r,a,u){return u.indexOf(r)===a}).join(`
`)}function Kn(t,e,r,a){this.failures=e,this.failedKeys=a,this.successCount=r,this.message=Uo(t,e)}function Xe(t,e){this.name="BulkError",this.failures=Object.keys(e).map(function(r){return e[r]}),this.failuresByPos=e,this.message=Uo(t,this.failures)}Y(Ve).from(Error).extend({toString:function(){return this.name+": "+this.message}}),Y(Kn).from(Ve),Y(Xe).from(Ve);var $r=zt.reduce(function(t,e){return t[e]=e+"Error",t},{}),ya=Ve,X=zt.reduce(function(t,e){var r=e+"Error";function a(u,l){this.name=r,u?typeof u=="string"?(this.message="".concat(u).concat(l?`
 `+l:""),this.inner=l||null):typeof u=="object"&&(this.message="".concat(u.name," ").concat(u.message),this.inner=u):(this.message=va[e]||r,this.inner=null)}return Y(a).from(ya),t[e]=a,t},{}),Yo=(X.Syntax=SyntaxError,X.Type=TypeError,X.Range=RangeError,ee.reduce(function(t,e){return t[e+"Error"]=X[e],t},{}));ee=zt.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=X[e]),t},{});function yt(){}function pn(t){return t}function ba(t,e){return t==null||t===pn?e:function(r){return e(t(r))}}function Pe(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function wa(t,e){return t===yt?e:function(){var r=t.apply(this,arguments),a=(r!==void 0&&(arguments[0]=r),this.onsuccess),u=this.onerror,l=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return a&&(this.onsuccess=this.onsuccess?Pe(a,this.onsuccess):a),u&&(this.onerror=this.onerror?Pe(u,this.onerror):u),l!==void 0?l:r}}function _a(t,e){return t===yt?e:function(){t.apply(this,arguments);var r=this.onsuccess,a=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Pe(r,this.onsuccess):r),a&&(this.onerror=this.onerror?Pe(a,this.onerror):a)}}function ka(t,e){return t===yt?e:function(u){var a=t.apply(this,arguments),u=(g(u,a),this.onsuccess),l=this.onerror,f=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return u&&(this.onsuccess=this.onsuccess?Pe(u,this.onsuccess):u),l&&(this.onerror=this.onerror?Pe(l,this.onerror):l),a===void 0?f===void 0?void 0:f:g(a,f)}}function Sa(t,e){return t===yt?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function Mr(t,e){return t===yt?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var a=this,u=arguments.length,l=new Array(u);u--;)l[u]=arguments[u];return r.then(function(){return e.apply(a,l)})}return e.apply(this,arguments)}}ee.ModifyError=Kn,ee.DexieError=Ve,ee.BulkError=Xe;var ie=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function zo(t){ie=t}var mn={},Ho=100,gn=typeof Promise>"u"?[]:(zt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[gn=crypto.subtle.digest("SHA-512",new Uint8Array([0])),k(gn),zt]:[zt,k(zt),zt]),zt=gn[0],rn=gn[1],rn=rn&&rn.then,Ce=zt&&zt.constructor,jr=!!gn[2],vn=function(t,e){yn.push([t,e]),Bn&&(queueMicrotask(Da),Bn=!1)},Lr=!0,Bn=!0,$e=[],qn=[],Rr=pn,we={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:yt,pgp:!1,env:{},finalize:yt},z=we,yn=[],Me=0,Fn=[];function B(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=z;if(typeof t!="function"){if(t!==mn)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Kr(this,this._value)}else this._state=null,this._value=null,++e.ref,function r(a,u){try{u(function(l){if(a._state===null){if(l===a)throw new TypeError("A promise cannot be resolved with itself.");var f=a._lib&&Ge();l&&typeof l.then=="function"?r(a,function(p,b){l instanceof B?l._then(p,b):l.then(p,b)}):(a._state=!0,a._value=l,Xo(a)),f&&Qe()}},Kr.bind(null,a))}catch(l){Kr(a,l)}}(this,t)}var Nr={get:function(){var t=z,e=zn;function r(a,u){var l=this,f=!t.global&&(t!==z||e!==zn),p=f&&!ke(),b=new B(function(x,w){Br(l,new Vo(Qo(a,t,f,p),Qo(u,t,f,p),x,w,t))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return r.prototype=mn,r},set:function(t){F(this,"then",t&&t.prototype===mn?Nr:{get:function(){return t},set:Nr.set})}};function Vo(t,e,r,a,u){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=a,this.psd=u}function Kr(t,e){var r,a;qn.push(e),t._state===null&&(r=t._lib&&Ge(),e=Rr(e),t._state=!1,t._value=e,a=t,$e.some(function(u){return u._value===a._value})||$e.push(a),Xo(t),r)&&Qe()}function Xo(t){var e=t._listeners;t._listeners=[];for(var r=0,a=e.length;r<a;++r)Br(t,e[r]);var u=t._PSD;--u.ref||u.finalize(),Me===0&&(++Me,vn(function(){--Me==0&&qr()},[]))}function Br(t,e){if(t._state===null)t._listeners.push(e);else{var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Me,vn(Ea,[r,t,e])}}function Ea(t,e,r){try{var a,u=e._value;!e._state&&qn.length&&(qn=[]),a=ie&&e._consoleTask?e._consoleTask.run(function(){return t(u)}):t(u),e._state||qn.indexOf(u)!==-1||(l=>{for(var f=$e.length;f;)if($e[--f]._value===l._value)return $e.splice(f,1)})(e),r.resolve(a)}catch(l){r.reject(l)}finally{--Me==0&&qr(),--r.psd.ref||r.psd.finalize()}}function Da(){je(we,function(){Ge()&&Qe()})}function Ge(){var t=Lr;return Bn=Lr=!1,t}function Qe(){var t,e,r;do for(;0<yn.length;)for(t=yn,yn=[],r=t.length,e=0;e<r;++e){var a=t[e];a[0].apply(null,a[1])}while(0<yn.length);Bn=Lr=!0}function qr(){for(var t=$e,e=($e=[],t.forEach(function(a){a._PSD.onunhandled.call(null,a._value,a)}),Fn.slice(0)),r=e.length;r;)e[--r]()}function Wn(t){return new B(mn,!1,t)}function wt(t,e){var r=z;return function(){var a=Ge(),u=z;try{return Se(r,!0),t.apply(this,arguments)}catch(l){e&&e(l)}finally{Se(u,!1),a&&Qe()}}}N(B.prototype,{then:Nr,_then:function(t,e){Br(this,new Vo(null,null,t,e,z))},catch:function(t){var e,r;return arguments.length===1?this.then(null,t):(e=t,r=arguments[1],typeof e=="function"?this.then(null,function(a){return(a instanceof e?r:Wn)(a)}):this.then(null,function(a){return(a&&a.name===e?r:Wn)(a)}))},finally:function(t){return this.then(function(e){return B.resolve(t()).then(function(){return e})},function(e){return B.resolve(t()).then(function(){return Wn(e)})})},timeout:function(t,e){var r=this;return t<1/0?new B(function(a,u){var l=setTimeout(function(){return u(new X.Timeout(e))},t);r.then(a,u).finally(clearTimeout.bind(null,l))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&F(B.prototype,Symbol.toStringTag,"Dexie.Promise"),we.env=Go(),N(B,{all:function(){var t=oe.apply(null,arguments).map(Hn);return new B(function(e,r){t.length===0&&e([]);var a=t.length;t.forEach(function(u,l){return B.resolve(u).then(function(f){t[l]=f,--a||e(t)},r)})})},resolve:function(t){return t instanceof B?t:t&&typeof t.then=="function"?new B(function(e,r){t.then(e,r)}):new B(mn,!0,t)},reject:Wn,race:function(){var t=oe.apply(null,arguments).map(Hn);return new B(function(e,r){t.map(function(a){return B.resolve(a).then(e,r)})})},PSD:{get:function(){return z},set:function(t){return z=t}},totalEchoes:{get:function(){return zn}},newPSD:_e,usePSD:je,scheduler:{get:function(){return vn},set:function(t){vn=t}},rejectionMapper:{get:function(){return Rr},set:function(t){Rr=t}},follow:function(t,e){return new B(function(r,a){return _e(function(u,l){var f=z;f.unhandleds=[],f.onunhandled=l,f.finalize=Pe(function(){var p,b=this;p=function(){b.unhandleds.length===0?u():l(b.unhandleds[0])},Fn.push(function x(){p(),Fn.splice(Fn.indexOf(x),1)}),++Me,vn(function(){--Me==0&&qr()},[])},f.finalize),t()},e,r,a)})}}),Ce&&(Ce.allSettled&&F(B,"allSettled",function(){var t=oe.apply(null,arguments).map(Hn);return new B(function(e){t.length===0&&e([]);var r=t.length,a=new Array(r);t.forEach(function(u,l){return B.resolve(u).then(function(f){return a[l]={status:"fulfilled",value:f}},function(f){return a[l]={status:"rejected",reason:f}}).then(function(){return--r||e(a)})})})}),Ce.any&&typeof AggregateError<"u"&&F(B,"any",function(){var t=oe.apply(null,arguments).map(Hn);return new B(function(e,r){t.length===0&&r(new AggregateError([]));var a=t.length,u=new Array(a);t.forEach(function(l,f){return B.resolve(l).then(function(p){return e(p)},function(p){u[f]=p,--a||r(new AggregateError(u))})})})}),Ce.withResolvers)&&(B.withResolvers=Ce.withResolvers);var Ct={awaits:0,echoes:0,id:0},xa=0,Un=[],Yn=0,zn=0,Ta=0;function _e(t,f,r,a){var u=z,l=Object.create(u),f=(l.parent=u,l.ref=0,l.global=!1,l.id=++Ta,we.env,l.env=jr?{Promise:B,PromiseProp:{value:B,configurable:!0,writable:!0},all:B.all,race:B.race,allSettled:B.allSettled,any:B.any,resolve:B.resolve,reject:B.reject}:{},f&&g(l,f),++u.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()},je(l,t,r,a));return l.ref===0&&l.finalize(),f}function Je(){return Ct.id||(Ct.id=++xa),++Ct.awaits,Ct.echoes+=Ho,Ct.id}function ke(){return!!Ct.awaits&&(--Ct.awaits==0&&(Ct.id=0),Ct.echoes=Ct.awaits*Ho,!0)}function Hn(t){return Ct.echoes&&t&&t.constructor===Ce?(Je(),t.then(function(e){return ke(),e},function(e){return ke(),Tt(e)})):t}function Ia(){var t=Un[Un.length-1];Un.pop(),Se(t,!1)}function Se(t,e){var r,a,u=z;(e?!Ct.echoes||Yn++&&t===z:!Yn||--Yn&&t===z)||queueMicrotask(e?(function(l){++zn,Ct.echoes&&--Ct.echoes!=0||(Ct.echoes=Ct.awaits=Ct.id=0),Un.push(z),Se(l,!0)}).bind(null,t):Ia),t!==z&&(z=t,u===we&&(we.env=Go()),jr)&&(r=we.env.Promise,a=t.env,u.global||t.global)&&(Object.defineProperty(d,"Promise",a.PromiseProp),r.all=a.all,r.race=a.race,r.resolve=a.resolve,r.reject=a.reject,a.allSettled&&(r.allSettled=a.allSettled),a.any)&&(r.any=a.any)}function Go(){var t=d.Promise;return jr?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(d,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function je(t,e,r,a,u){var l=z;try{return Se(t,!0),e(r,a,u)}finally{Se(l,!1)}}function Qo(t,e,r,a){return typeof t!="function"?t:function(){var u=z;r&&Je(),Se(e,!0);try{return t.apply(this,arguments)}finally{Se(u,!1),a&&queueMicrotask(ke)}}}function Fr(t){Promise===Ce&&Ct.echoes===0?Yn===0?t():enqueueNativeMicroTask(t):setTimeout(t,0)}(""+rn).indexOf("[native code]")===-1&&(Je=ke=yt);var Tt=B.reject,Le="ï¿¿",he="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Jo="String expected.",Ze=[],Vn="__dbnames",Wr="readonly",Ur="readwrite";function Re(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Zo={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Xn(t){return typeof t!="string"||/\./.test(t)?function(e){return e}:function(e){return e[t]===void 0&&t in e&&delete(e=Mt(e))[t],e}}function ti(){throw X.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ct(t,e){try{var r=ei(t),a=ei(e);if(r!==a)return r==="Array"?1:a==="Array"?-1:r==="binary"?1:a==="binary"?-1:r==="string"?1:a==="string"?-1:r==="Date"?1:a!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return e<t?1:t<e?-1:0;case"binary":for(var u=ni(t),l=ni(e),f=u.length,p=l.length,b=f<p?f:p,x=0;x<b;++x)if(u[x]!==l[x])return u[x]<l[x]?-1:1;return f===p?0:f<p?-1:1;case"Array":for(var w=t,v=e,S=w.length,E=v.length,_=S<E?S:E,y=0;y<_;++y){var T=ct(w[y],v[y]);if(T!==0)return T}return S===E?0:S<E?-1:1}}catch{}return NaN}function ei(t){var e=typeof t;return e=="object"&&(ArrayBuffer.isView(t)||(e=fe(t))==="ArrayBuffer")?"binary":e}function ni(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}function Gn(t,e,r){var a=t.schema.yProps;return a?(e&&0<r.numFailures&&(e=e.filter(function(u,l){return!r.failures[l]})),Promise.all(a.map(function(u){return u=u.updatesTable,e?t.db.table(u).where("k").anyOf(e).delete():t.db.table(u).clear()})).then(function(){return r})):r}ri.prototype.execute=function(t){var e=this["@@propmod"];if(e.add!==void 0){var r=e.add;if(m(r))return c(c([],m(t)?t:[],!0),r).sort();if(typeof r=="number")return(Number(t)||0)+r;if(typeof r=="bigint")try{return BigInt(t)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(e.remove!==void 0){var a=e.remove;if(m(a))return m(t)?t.filter(function(u){return!a.includes(u)}).sort():[];if(typeof a=="number")return Number(t)-a;if(typeof a=="bigint")try{return BigInt(t)-a}catch{return BigInt(0)-a}throw new TypeError("Invalid subtrahend ".concat(a))}return r=(r=e.replacePrefix)==null?void 0:r[0],r&&typeof t=="string"&&t.startsWith(r)?e.replacePrefix[1]+t.substring(r.length):t};var bn=ri;function ri(t){this["@@propmod"]=t}function oi(t,e){for(var r=h(e),a=r.length,u=!1,l=0;l<a;++l){var f=r[l],p=e[f],b=mt(t,f);p instanceof bn?(st(t,f,p.execute(b)),u=!0):b!==p&&(st(t,f,p),u=!0)}return u}bt.prototype._trans=function(t,e,r){var a=this._tx||z.trans,u=this.name,l=ie&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function f(x,w,v){if(v.schema[u])return e(v.idbtrans,v);throw new X.NotFound("Table "+u+" not part of transaction")}var p=Ge();try{var b=a&&a.db._novip===this.db._novip?a===z.trans?a._promise(t,f,r):_e(function(){return a._promise(t,f,r)},{trans:a,transless:z.transless||z}):function x(w,v,S,E){if(w.idbdb&&(w._state.openComplete||z.letThrough||w._vip)){var _=w._createTransaction(v,S,w._dbSchema);try{_.create(),w._state.PR1398_maxLoop=3}catch(y){return y.name===$r.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return x(w,v,S,E)})):Tt(y)}return _._promise(v,function(y,T){return _e(function(){return z.trans=_,E(y,T,_)})}).then(function(y){if(v==="readwrite")try{_.idbtrans.commit()}catch{}return v==="readonly"?y:_._completion.then(function(){return y})})}if(w._state.openComplete)return Tt(new X.DatabaseClosed(w._state.dbOpenError));if(!w._state.isBeingOpened){if(!w._state.autoOpen)return Tt(new X.DatabaseClosed);w.open().catch(yt)}return w._state.dbReadyPromise.then(function(){return x(w,v,S,E)})}(this.db,t,[this.name],f);return l&&(b._consoleTask=l,b=b.catch(function(x){return console.trace(x),Tt(x)})),b}finally{p&&Qe()}},bt.prototype.get=function(t,e){var r=this;return t&&t.constructor===Object?this.where(t).first(e):t==null?Tt(new X.Type("Invalid argument to Table.get()")):this._trans("readonly",function(a){return r.core.get({trans:a,key:t}).then(function(u){return r.hook.reading.fire(u)})}).then(e)},bt.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(m(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var e=h(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(p){if(p.compound&&e.every(function(x){return 0<=p.keyPath.indexOf(x)})){for(var b=0;b<e.length;++b)if(e.indexOf(p.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(p,b){return p.keyPath.length-b.keyPath.length})[0];if(r&&this.db._maxKey!==Le)return f=r.keyPath.slice(0,e.length),this.where(f).equals(f.map(function(p){return t[p]}));!r&&ie&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(e.join("+"),"]"));var a=this.schema.idxByName;function u(p,b){return ct(p,b)===0}var f=e.reduce(function(w,b){var x=w[0],w=w[1],v=a[b],S=t[b];return[x||v,x||!v?Re(w,v&&v.multi?function(E){return E=mt(E,b),m(E)&&E.some(function(_){return u(S,_)})}:function(E){return u(S,mt(E,b))}):w]},[null,null]),l=f[0],f=f[1];return l?this.where(l.name).equals(t[l.keyPath]).filter(f):r?this.filter(f):this.where(e).equals("")},bt.prototype.filter=function(t){return this.toCollection().and(t)},bt.prototype.count=function(t){return this.toCollection().count(t)},bt.prototype.offset=function(t){return this.toCollection().offset(t)},bt.prototype.limit=function(t){return this.toCollection().limit(t)},bt.prototype.each=function(t){return this.toCollection().each(t)},bt.prototype.toArray=function(t){return this.toCollection().toArray(t)},bt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},bt.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,m(t)?"[".concat(t.join("+"),"]"):t))},bt.prototype.reverse=function(){return this.toCollection().reverse()},bt.prototype.mapToClass=function(t){for(var e=this.db,r=this.name,a=((this.schema.mappedClass=t).prototype instanceof ti&&(t=(f=>{var p=w,b=f;if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function x(){this.constructor=p}function w(){return f!==null&&f.apply(this,arguments)||this}return o(p,b),p.prototype=b===null?Object.create(b):(x.prototype=b.prototype,new x),Object.defineProperty(w.prototype,"db",{get:function(){return e},enumerable:!1,configurable:!0}),w.prototype.table=function(){return r},w})(t)),new Set),u=t.prototype;u;u=k(u))Object.getOwnPropertyNames(u).forEach(function(f){return a.add(f)});function l(f){if(!f)return f;var p,b=Object.create(t.prototype);for(p in f)if(!a.has(p))try{b[p]=f[p]}catch{}return b}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=l,this.hook("reading",l),t},bt.prototype.defineClass=function(){return this.mapToClass(function(t){g(this,t)})},bt.prototype.add=function(t,e){var r=this,a=this.schema.primKey,u=a.auto,l=a.keyPath,f=t;return l&&u&&(f=Xn(l)(t)),this._trans("readwrite",function(p){return r.core.mutate({trans:p,type:"add",keys:e!=null?[e]:null,values:[f]})}).then(function(p){return p.numFailures?B.reject(p.failures[0]):p.lastResult}).then(function(p){if(l)try{st(t,l,p)}catch{}return p})},bt.prototype.upsert=function(t,e){var r=this,a=this.schema.primKey.keyPath;return this._trans("readwrite",function(u){return r.core.get({trans:u,key:t}).then(function(l){var f=l??{};return oi(f,e),a&&st(f,a,t),r.core.mutate({trans:u,type:"put",values:[f],keys:[t],upsert:!0,updates:{keys:[t],changeSpecs:[e]}}).then(function(p){return p.numFailures?B.reject(p.failures[0]):!!l})})})},bt.prototype.update=function(t,e){return typeof t!="object"||m(t)?this.where(":id").equals(t).modify(e):(t=mt(t,this.schema.primKey.keyPath))===void 0?Tt(new X.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(e)},bt.prototype.put=function(t,e){var r=this,a=this.schema.primKey,u=a.auto,l=a.keyPath,f=t;return l&&u&&(f=Xn(l)(t)),this._trans("readwrite",function(p){return r.core.mutate({trans:p,type:"put",values:[f],keys:e!=null?[e]:null})}).then(function(p){return p.numFailures?B.reject(p.failures[0]):p.lastResult}).then(function(p){if(l)try{st(t,l,p)}catch{}return p})},bt.prototype.delete=function(t){var e=this;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"delete",keys:[t]}).then(function(a){return Gn(e,[t],a)}).then(function(a){return a.numFailures?B.reject(a.failures[0]):void 0})})},bt.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:Zo}).then(function(r){return Gn(t,null,r)})}).then(function(e){return e.numFailures?B.reject(e.failures[0]):void 0})},bt.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",function(r){return e.core.getMany({keys:t,trans:r}).then(function(a){return a.map(function(u){return e.hook.reading.fire(u)})})})},bt.prototype.bulkAdd=function(t,e,r){var a=this,u=Array.isArray(e)?e:void 0,l=(r=r||(u?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",function(f){var p=a.schema.primKey,x=p.auto,p=p.keyPath;if(p&&u)throw new X.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(u&&u.length!==t.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var b=t.length,x=p&&x?t.map(Xn(p)):t;return a.core.mutate({trans:f,type:"add",keys:u,values:x,wantResults:l}).then(function(w){var v=w.numFailures,S=w.failures;if(v===0)return l?w.results:w.lastResult;throw new Xe("".concat(a.name,".bulkAdd(): ").concat(v," of ").concat(b," operations failed"),S)})})},bt.prototype.bulkPut=function(t,e,r){var a=this,u=Array.isArray(e)?e:void 0,l=(r=r||(u?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",function(f){var p=a.schema.primKey,x=p.auto,p=p.keyPath;if(p&&u)throw new X.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(u&&u.length!==t.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var b=t.length,x=p&&x?t.map(Xn(p)):t;return a.core.mutate({trans:f,type:"put",keys:u,values:x,wantResults:l}).then(function(w){var v=w.numFailures,S=w.failures;if(v===0)return l?w.results:w.lastResult;throw new Xe("".concat(a.name,".bulkPut(): ").concat(v," of ").concat(b," operations failed"),S)})})},bt.prototype.bulkUpdate=function(t){var e=this,r=this.core,a=t.map(function(f){return f.key}),u=t.map(function(f){return f.changes}),l=[];return this._trans("readwrite",function(f){return r.getMany({trans:f,keys:a,cache:"clone"}).then(function(p){var b=[],x=[],w=(t.forEach(function(v,S){var E=v.key,_=v.changes,y=p[S];if(y){for(var T=0,I=Object.keys(_);T<I.length;T++){var D=I[T],A=_[D];if(D===e.schema.primKey.keyPath){if(ct(A,E)!==0)throw new X.Constraint("Cannot update primary key in bulkUpdate()")}else st(y,D,A)}l.push(S),b.push(E),x.push(y)}}),b.length);return r.mutate({trans:f,type:"put",keys:b,values:x,updates:{keys:a,changeSpecs:u}}).then(function(v){var S=v.numFailures,E=v.failures;if(S===0)return w;for(var _=0,y=Object.keys(E);_<y.length;_++){var T,I=y[_],D=l[Number(I)];D!=null&&(T=E[I],delete E[I],E[D]=T)}throw new Xe("".concat(e.name,".bulkUpdate(): ").concat(S," of ").concat(w," operations failed"),E)})})})},bt.prototype.bulkDelete=function(t){var e=this,r=t.length;return this._trans("readwrite",function(a){return e.core.mutate({trans:a,type:"delete",keys:t}).then(function(u){return Gn(e,t,u)})}).then(function(a){var u=a.numFailures,l=a.failures;if(u===0)return a.lastResult;throw new Xe("".concat(e.name,".bulkDelete(): ").concat(u," of ").concat(r," operations failed"),l)})};var ii=bt;function bt(){}function wn(t){function e(f,p){if(p){for(var b=arguments.length,x=new Array(b-1);--b;)x[b-1]=arguments[b];return r[f].subscribe.apply(null,x),t}if(typeof f=="string")return r[f]}var r={};e.addEventType=l;for(var a=1,u=arguments.length;a<u;++a)l(arguments[a]);return e;function l(f,p,b){var x,w;if(typeof f!="object")return p=p||Sa,w={subscribers:[],fire:b=b||yt,subscribe:function(v){w.subscribers.indexOf(v)===-1&&(w.subscribers.push(v),w.fire=p(w.fire,v))},unsubscribe:function(v){w.subscribers=w.subscribers.filter(function(S){return S!==v}),w.fire=w.subscribers.reduce(p,b)}},r[f]=e[f]=w;h(x=f).forEach(function(v){var S=x[v];if(m(S))l(v,x[v][0],x[v][1]);else{if(S!=="asap")throw new X.InvalidArgument("Invalid event config");var E=l(v,pn,function(){for(var _=arguments.length,y=new Array(_);_--;)y[_]=arguments[_];E.subscribers.forEach(function(T){lt(function(){T.apply(null,y)})})})}})}}function _n(t,e){return Y(e).from({prototype:t}),e}function tn(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Yr(t,e){t.filter=Re(t.filter,e)}function zr(t,e,r){var a=t.replayFilter;t.replayFilter=a?function(){return Re(a(),e())}:e,t.justLimit=r&&!a}function Qn(t,e){if(t.isPrimKey)return e.primaryKey;var r=e.getIndexByKeyPath(t.index);if(r)return r;throw new X.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed")}function ai(t,e,r){var a=Qn(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:a,range:t.range}})}function Jn(t,e,r,a){var u,l,f=t.replayFilter?Re(t.filter,t.replayFilter()):t.filter;return t.or?(u={},l=function(p,b,x){var w,v;f&&!f(b,x,function(S){return b.stop(S)},function(S){return b.fail(S)})||((v=""+(w=b.primaryKey))=="[object ArrayBuffer]"&&(v=""+new Uint8Array(w)),P(u,v))||(u[v]=!0,e(p,b,x))},Promise.all([t.or._iterate(l,r),si(ai(t,a,r),t.algorithm,l,!t.keysOnly&&t.valueMapper)])):si(ai(t,a,r),Re(t.algorithm,f),e,!t.keysOnly&&t.valueMapper)}function si(t,e,r,a){var u=wt(a?function(l,f,p){return r(a(l),f,p)}:r);return t.then(function(l){if(l)return l.start(function(){var f=function(){return l.continue()};e&&!e(l,function(p){return f=p},function(p){l.stop(p),f=yt},function(p){l.fail(p),f=yt})||u(l.value,l,function(p){return f=p}),f()})})}ht.prototype._read=function(t,e){var r=this._ctx;return r.error?r.table._trans(null,Tt.bind(null,r.error)):r.table._trans("readonly",t).then(e)},ht.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,Tt.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},ht.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Re(e.algorithm,t)},ht.prototype._iterate=function(t,e){return Jn(this._ctx,t,e,this._ctx.table.core)},ht.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&g(r,t),e._ctx=r,e},ht.prototype.raw=function(){return this._ctx.valueMapper=null,this},ht.prototype.each=function(t){var e=this._ctx;return this._read(function(r){return Jn(e,t,r,e.table.core)})},ht.prototype.count=function(t){var e=this;return this._read(function(r){var a,u=e._ctx,l=u.table.core;return tn(u,!0)?l.count({trans:r,query:{index:Qn(u,l.schema),range:u.range}}).then(function(f){return Math.min(f,u.limit)}):(a=0,Jn(u,function(){return++a,!1},r,l).then(function(){return a}))}).then(t)},ht.prototype.sortBy=function(t,e){var r=t.split(".").reverse(),a=r[0],u=r.length-1;function l(b,x){return x?l(b[r[x]],x-1):b[a]}var f=this._ctx.dir==="next"?1:-1;function p(b,x){return ct(l(b,u),l(x,u))*f}return this.toArray(function(b){return b.sort(p)}).then(e)},ht.prototype.toArray=function(t){var e=this;return this._read(function(r){var a,u,l,f=e._ctx;return f.dir==="next"&&tn(f,!0)&&0<f.limit?(a=f.valueMapper,u=Qn(f,f.table.core.schema),f.table.core.query({trans:r,limit:f.limit,values:!0,query:{index:u,range:f.range}}).then(function(p){return p=p.result,a?p.map(a):p})):(l=[],Jn(f,function(p){return l.push(p)},r,f.table.core).then(function(){return l}))},t)},ht.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,tn(e)?zr(e,function(){var r=t;return function(a,u){return r===0||(r===1?--r:u(function(){a.advance(r),r=0}),!1)}}):zr(e,function(){var r=t;return function(){return--r<0}})),this},ht.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),zr(this._ctx,function(){var e=t;return function(r,a,u){return--e<=0&&a(u),0<=e}},!0),this},ht.prototype.until=function(t,e){return Yr(this._ctx,function(r,a,u){return!t(r.value)||(a(u),e)}),this},ht.prototype.first=function(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)},ht.prototype.last=function(t){return this.reverse().first(t)},ht.prototype.filter=function(t){var e;return Yr(this._ctx,function(r){return t(r.value)}),(e=this._ctx).isMatch=Re(e.isMatch,t),this},ht.prototype.and=function(t){return this.filter(t)},ht.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},ht.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ht.prototype.desc=function(){return this.reverse()},ht.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(r,a){t(a.key,a)})},ht.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},ht.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(r,a){t(a.primaryKey,a)})},ht.prototype.keys=function(t){var e=this._ctx,r=(e.keysOnly=!e.isMatch,[]);return this.each(function(a,u){r.push(u.key)}).then(function(){return r}).then(t)},ht.prototype.primaryKeys=function(t){var e=this._ctx;if(e.dir==="next"&&tn(e,!0)&&0<e.limit)return this._read(function(a){var u=Qn(e,e.table.core.schema);return e.table.core.query({trans:a,values:!1,limit:e.limit,query:{index:u,range:e.range}})}).then(function(a){return a.result}).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each(function(a,u){r.push(u.primaryKey)}).then(function(){return r}).then(t)},ht.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},ht.prototype.firstKey=function(t){return this.limit(1).keys(function(e){return e[0]}).then(t)},ht.prototype.lastKey=function(t){return this.reverse().firstKey(t)},ht.prototype.distinct=function(){var t,e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];return e&&e.multi&&(t={},Yr(this._ctx,function(a){var a=a.primaryKey.toString(),u=P(t,a);return t[a]=!0,!u})),this},ht.prototype.modify=function(t){var e=this,r=this._ctx;return this._write(function(a){function u(y,T){var I=T.failures;S+=y-T.numFailures;for(var D=0,A=h(I);D<A.length;D++){var C=A[D];v.push(I[C])}}var l=typeof t=="function"?t:function(y){return oi(y,t)},f=r.table.core,w=f.schema.primaryKey,p=w.outbound,b=w.extractKey,x=200,w=e.db._options.modifyChunkSize,v=(w&&(x=typeof w=="object"?w[f.name]||w["*"]||200:w),[]),S=0,E=[],_=t===ui;return e.clone().primaryKeys().then(function(y){function T(D){var A=Math.min(x,y.length-D),C=y.slice(D,D+A);return(_?Promise.resolve([]):f.getMany({trans:a,keys:C,cache:"immutable"})).then(function(j){var L=[],$=[],W=p?[]:null,q=_?C:[];if(!_)for(var M=0;M<A;++M){var U=j[M],ft={value:Mt(U),primKey:y[D+M]};l.call(ft,ft.value,ft)!==!1&&(ft.value==null?q.push(y[D+M]):p||ct(b(U),b(ft.value))===0?($.push(ft.value),p&&W.push(y[D+M])):(q.push(y[D+M]),L.push(ft.value)))}return Promise.resolve(0<L.length&&f.mutate({trans:a,type:"add",values:L}).then(function(pt){for(var Q in pt.failures)q.splice(parseInt(Q),1);u(L.length,pt)})).then(function(){return(0<$.length||I&&typeof t=="object")&&f.mutate({trans:a,type:"put",keys:W,values:$,criteria:I,changeSpec:typeof t!="function"&&t,isAdditionalChunk:0<D}).then(function(pt){return u($.length,pt)})}).then(function(){return(0<q.length||I&&_)&&f.mutate({trans:a,type:"delete",keys:q,criteria:I,isAdditionalChunk:0<D}).then(function(pt){return Gn(r.table,q,pt)}).then(function(pt){return u(q.length,pt)})}).then(function(){return y.length>D+A&&T(D+x)})})}var I=tn(r)&&r.limit===1/0&&(typeof t!="function"||_)&&{index:r.index,range:r.range};return T(0).then(function(){if(0<v.length)throw new Kn("Error modifying one or more objects",v,S,E);return y.length})})})},ht.prototype.delete=function(){var t=this._ctx,e=t.range;return!tn(t)||t.table.schema.yProps||!t.isPrimKey&&e.type!==3?this.modify(ui):this._write(function(r){var a=t.table.core.schema.primaryKey,u=e;return t.table.core.count({trans:r,query:{index:a,range:u}}).then(function(l){return t.table.core.mutate({trans:r,type:"deleteRange",range:u}).then(function(b){var p=b.failures,b=b.numFailures;if(b)throw new Kn("Could not delete some values",Object.keys(p).map(function(x){return p[x]}),l-b);return l-b})})})};var Oa=ht;function ht(){}var ui=function(t,e){return e.value=null};function Aa(t,e){return t<e?-1:t===e?0:1}function Pa(t,e){return e<t?-1:t===e?0:1}function Ht(t,e,r){return t=t instanceof ci?new t.Collection(t):t,t._ctx.error=new(r||TypeError)(e),t}function en(t){return new t.Collection(t,function(){return li("")}).limit(0)}function Zn(E,e,r,a){var u,l,f,p,b,x,w,v=r.length;if(!r.every(function(y){return typeof y=="string"}))return Ht(E,Jo);function S(y){u=y==="next"?function(I){return I.toUpperCase()}:function(I){return I.toLowerCase()},l=y==="next"?function(I){return I.toLowerCase()}:function(I){return I.toUpperCase()},f=y==="next"?Aa:Pa;var T=r.map(function(I){return{lower:l(I),upper:u(I)}}).sort(function(I,D){return f(I.lower,D.lower)});p=T.map(function(I){return I.upper}),b=T.map(function(I){return I.lower}),w=(x=y)==="next"?"":a}S("next");var E=new E.Collection(E,function(){return Ee(p[0],b[v-1]+a)}),_=(E._ondirectionchange=function(y){S(y)},0);return E._addAlgorithm(function(y,T,I){var D=y.key;if(typeof D=="string"){var A=l(D);if(e(A,b,_))return!0;for(var C=null,j=_;j<v;++j){var L=(($,W,q,M,U,ft)=>{for(var pt=Math.min($.length,M.length),Q=-1,at=0;at<pt;++at){var kt=W[at];if(kt!==M[at])return U($[at],q[at])<0?$.substr(0,at)+q[at]+q.substr(at+1):U($[at],M[at])<0?$.substr(0,at)+M[at]+q.substr(at+1):0<=Q?$.substr(0,Q)+W[Q]+q.substr(Q+1):null;U($[at],kt)<0&&(Q=at)}return pt<M.length&&ft==="next"?$+q.substr($.length):pt<$.length&&ft==="prev"?$.substr(0,q.length):Q<0?null:$.substr(0,Q)+M[Q]+q.substr(Q+1)})(D,A,p[j],b[j],f,x);L===null&&C===null?_=j+1:(C===null||0<f(C,L))&&(C=L)}T(C!==null?function(){y.continue(C+w)}:I)}return!1}),E}function Ee(t,e,r,a){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:a}}function li(t){return{type:1,lower:t,upper:t}}Object.defineProperty($t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),$t.prototype.between=function(t,e,r,a){r=r!==!1,a=a===!0;try{return 0<this._cmp(t,e)||this._cmp(t,e)===0&&(r||a)&&(!r||!a)?en(this):new this.Collection(this,function(){return Ee(t,e,!r,!a)})}catch{return Ht(this,he)}},$t.prototype.equals=function(t){return t==null?Ht(this,he):new this.Collection(this,function(){return li(t)})},$t.prototype.above=function(t){return t==null?Ht(this,he):new this.Collection(this,function(){return Ee(t,void 0,!0)})},$t.prototype.aboveOrEqual=function(t){return t==null?Ht(this,he):new this.Collection(this,function(){return Ee(t,void 0,!1)})},$t.prototype.below=function(t){return t==null?Ht(this,he):new this.Collection(this,function(){return Ee(void 0,t,!1,!0)})},$t.prototype.belowOrEqual=function(t){return t==null?Ht(this,he):new this.Collection(this,function(){return Ee(void 0,t)})},$t.prototype.startsWith=function(t){return typeof t!="string"?Ht(this,Jo):this.between(t,t+Le,!0,!0)},$t.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):Zn(this,function(e,r){return e.indexOf(r[0])===0},[t],Le)},$t.prototype.equalsIgnoreCase=function(t){return Zn(this,function(e,r){return e===r[0]},[t],"")},$t.prototype.anyOfIgnoreCase=function(){var t=oe.apply(be,arguments);return t.length===0?en(this):Zn(this,function(e,r){return r.indexOf(e)!==-1},t,"")},$t.prototype.startsWithAnyOfIgnoreCase=function(){var t=oe.apply(be,arguments);return t.length===0?en(this):Zn(this,function(e,r){return r.some(function(a){return e.indexOf(a)===0})},t,Le)},$t.prototype.anyOf=function(){var t,e,r=this,a=oe.apply(be,arguments),u=this._cmp;try{a.sort(u)}catch{return Ht(this,he)}return a.length===0?en(this):((t=new this.Collection(this,function(){return Ee(a[0],a[a.length-1])}))._ondirectionchange=function(l){u=l==="next"?r._ascending:r._descending,a.sort(u)},e=0,t._addAlgorithm(function(l,f,p){for(var b=l.key;0<u(b,a[e]);)if(++e===a.length)return f(p),!1;return u(b,a[e])===0||(f(function(){l.continue(a[e])}),!1)}),t)},$t.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},$t.prototype.noneOf=function(){var t=oe.apply(be,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return Ht(this,he)}var e=t.reduce(function(r,a){return r?r.concat([[r[r.length-1][1],a]]):[[-1/0,a]]},null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},$t.prototype.inAnyRange=function(t,I){var r=this,a=this._cmp,u=this._ascending,l=this._descending,f=this._min,p=this._max;if(t.length===0)return en(this);if(!t.every(function(D){return D[0]!==void 0&&D[1]!==void 0&&u(D[0],D[1])<=0}))return Ht(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",X.InvalidArgument);var b=!I||I.includeLowers!==!1,x=I&&I.includeUppers===!0,w,v=u;function S(D,A){return v(D[0],A[0])}try{(w=t.reduce(function(D,A){for(var C=0,j=D.length;C<j;++C){var L=D[C];if(a(A[0],L[1])<0&&0<a(A[1],L[0])){L[0]=f(L[0],A[0]),L[1]=p(L[1],A[1]);break}}return C===j&&D.push(A),D},[])).sort(S)}catch{return Ht(this,he)}var E=0,_=x?function(D){return 0<u(D,w[E][1])}:function(D){return 0<=u(D,w[E][1])},y=b?function(D){return 0<l(D,w[E][0])}:function(D){return 0<=l(D,w[E][0])},T=_,I=new this.Collection(this,function(){return Ee(w[0][0],w[w.length-1][1],!b,!x)});return I._ondirectionchange=function(D){v=D==="next"?(T=_,u):(T=y,l),w.sort(S)},I._addAlgorithm(function(D,A,C){for(var j,L=D.key;T(L);)if(++E===w.length)return A(C),!1;return!_(j=L)&&!y(j)||(r._cmp(L,w[E][1])===0||r._cmp(L,w[E][0])===0||A(function(){v===u?D.continue(w[E][0]):D.continue(w[E][1])}),!1)}),I},$t.prototype.startsWithAnyOf=function(){var t=oe.apply(be,arguments);return t.every(function(e){return typeof e=="string"})?t.length===0?en(this):this.inAnyRange(t.map(function(e){return[e,e+Le]})):Ht(this,"startsWithAnyOf() only works with strings")};var ci=$t;function $t(){}function ae(t){return wt(function(e){return kn(e),t(e.target.error),!1})}function kn(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Sn="storagemutated",Hr="x-storagemutated-1",De=wn(null,Sn),Ca=(se.prototype._lock=function(){return V(!z.global),++this._reculock,this._reculock!==1||z.global||(z.lockOwnerFor=this),this},se.prototype._unlock=function(){if(V(!z.global),--this._reculock==0)for(z.global||(z.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{je(t[1],t[0])}catch{}}return this},se.prototype._locked=function(){return this._reculock&&z.lockOwnerFor!==this},se.prototype.create=function(t){var e=this;if(this.mode){var r=this.db.idbdb,a=this.db._state.dbOpenError;if(V(!this.idbtrans),!t&&!r)switch(a&&a.name){case"DatabaseClosedError":throw new X.DatabaseClosed(a);case"MissingAPIError":throw new X.MissingAPI(a.message,a);default:throw new X.OpenFailed(a)}if(!this.active)throw new X.TransactionInactive;V(this._completion._state===null),(t=this.idbtrans=t||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=wt(function(u){kn(u),e._reject(t.error)}),t.onabort=wt(function(u){kn(u),e.active&&e._reject(new X.Abort(t.error)),e.active=!1,e.on("abort").fire(u)}),t.oncomplete=wt(function(){e.active=!1,e._resolve(),"mutatedParts"in t&&De.storagemutated.fire(t.mutatedParts)})}return this},se.prototype._promise=function(t,e,r){var a,u=this;return t==="readwrite"&&this.mode!=="readwrite"?Tt(new X.ReadOnly("Transaction is readonly")):this.active?this._locked()?new B(function(l,f){u._blockedFuncs.push([function(){u._promise(t,e,r).then(l,f)},z])}):r?_e(function(){var l=new B(function(f,p){u._lock();var b=e(f,p,u);b&&b.then&&b.then(f,p)});return l.finally(function(){return u._unlock()}),l._lib=!0,l}):((a=new B(function(l,f){var p=e(l,f,u);p&&p.then&&p.then(l,f)}))._lib=!0,a):Tt(new X.TransactionInactive)},se.prototype._root=function(){return this.parent?this.parent._root():this},se.prototype.waitFor=function(t){var e,r=this._root(),a=B.resolve(t),u=(r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return a}):(r._waitingFor=a,r._waitingQueue=[],e=r.idbtrans.objectStore(r.storeNames[0]),function l(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(e.get(-1/0).onsuccess=l)}()),r._waitingFor);return new B(function(l,f){a.then(function(p){return r._waitingQueue.push(wt(l.bind(null,p)))},function(p){return r._waitingQueue.push(wt(f.bind(null,p)))}).finally(function(){r._waitingFor===u&&(r._waitingFor=null)})})},se.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new X.Abort))},se.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(P(e,t))return e[t];var r=this.schema[t];if(r)return(r=new this.db.Table(t,r,this)).core=this.db.core.table(t),e[t]=r;throw new X.NotFound("Table "+t+" not part of transaction")},se);function se(){}function Vr(t,e,r,a,u,l,f,p){return{name:t,keyPath:e,unique:r,multi:a,auto:u,compound:l,src:(r&&!f?"&":"")+(a?"*":"")+(u?"++":"")+di(e),type:p}}function di(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Xr(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:(a=function(u){return[u.name,u]},r.reduce(function(u,l,f){return l=a(l,f),l&&(u[l[0]]=l[1]),u},{}))};var a}var En=function(t){try{return t.only([[]]),En=function(){return[[]]},[[]]}catch{return En=function(){return Le},Le}};function Gr(t){return t==null?function(){}:typeof t=="string"?(e=t).split(".").length===1?function(r){return r[e]}:function(r){return mt(r,e)}:function(r){return mt(r,t)};var e}function fi(t){return[].slice.call(t)}var $a=0;function Dn(t){return t==null?":id":typeof t=="string"?t:"[".concat(t.join("+"),"]")}function Ma(t,e,b){function a(_){if(_.type===3)return null;if(_.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var v=_.lower,S=_.upper,E=_.lowerOpen,_=_.upperOpen;return v===void 0?S===void 0?null:e.upperBound(S,!!_):S===void 0?e.lowerBound(v,!!E):e.bound(v,S,!!E,!!_)}function u(w){var v,S=w.name;return{name:S,schema:w,mutate:function(E){var _=E.trans,y=E.type,T=E.keys,I=E.values,D=E.range;return new Promise(function(A,C){A=wt(A);var j=_.objectStore(S),L=j.keyPath==null,$=y==="put"||y==="add";if(!$&&y!=="delete"&&y!=="deleteRange")throw new Error("Invalid operation type: "+y);var W,q=(T||I||{length:1}).length;if(T&&I&&T.length!==I.length)throw new Error("Given keys array must have same length as given values array.");if(q===0)return A({numFailures:0,failures:{},results:[],lastResult:void 0});function M(Dt){++pt,kn(Dt)}var U=[],ft=[],pt=0;if(y==="deleteRange"){if(D.type===4)return A({numFailures:pt,failures:ft,results:[],lastResult:void 0});D.type===3?U.push(W=j.clear()):U.push(W=j.delete(a(D)))}else{var L=$?L?[I,T]:[I,null]:[T,null],Q=L[0],at=L[1];if($)for(var kt=0;kt<q;++kt)U.push(W=at&&at[kt]!==void 0?j[y](Q[kt],at[kt]):j[y](Q[kt])),W.onerror=M;else for(kt=0;kt<q;++kt)U.push(W=j[y](Q[kt])),W.onerror=M}function Qt(Dt){Dt=Dt.target.result,U.forEach(function(Be,mo){return Be.error!=null&&(ft[mo]=Be.error)}),A({numFailures:pt,failures:ft,results:y==="delete"?T:U.map(function(Be){return Be.result}),lastResult:Dt})}W.onerror=function(Dt){M(Dt),Qt(Dt)},W.onsuccess=Qt})},getMany:function(E){var _=E.trans,y=E.keys;return new Promise(function(T,I){T=wt(T);for(var D,A=_.objectStore(S),C=y.length,j=new Array(C),L=0,$=0,W=function(U){U=U.target,j[U._pos]=U.result,++$===L&&T(j)},q=ae(I),M=0;M<C;++M)y[M]!=null&&((D=A.get(y[M]))._pos=M,D.onsuccess=W,D.onerror=q,++L);L===0&&T(j)})},get:function(E){var _=E.trans,y=E.key;return new Promise(function(T,I){T=wt(T);var D=_.objectStore(S).get(y);D.onsuccess=function(A){return T(A.target.result)},D.onerror=ae(I)})},query:(v=p,function(E){return new Promise(function(_,y){_=wt(_);var T,I,D,$=E.trans,A=E.values,C=E.limit,L=E.query,j=C===1/0?void 0:C,W=L.index,L=L.range,$=$.objectStore(S),$=W.isPrimaryKey?$:$.index(W.name),W=a(L);if(C===0)return _({result:[]});v?((L=A?$.getAll(W,j):$.getAllKeys(W,j)).onsuccess=function(q){return _({result:q.target.result})},L.onerror=ae(y)):(T=0,I=!A&&"openKeyCursor"in $?$.openKeyCursor(W):$.openCursor(W),D=[],I.onsuccess=function(q){var M=I.result;return!M||(D.push(A?M.value:M.primaryKey),++T===C)?_({result:D}):void M.continue()},I.onerror=ae(y))})}),openCursor:function(E){var _=E.trans,y=E.values,T=E.query,I=E.reverse,D=E.unique;return new Promise(function(A,C){A=wt(A);var $=T.index,j=T.range,L=_.objectStore(S),L=$.isPrimaryKey?L:L.index($.name),$=I?D?"prevunique":"prev":D?"nextunique":"next",W=!y&&"openKeyCursor"in L?L.openKeyCursor(a(j),$):L.openCursor(a(j),$);W.onerror=ae(C),W.onsuccess=wt(function(q){var M,U,ft,pt,Q=W.result;Q?(Q.___id=++$a,Q.done=!1,M=Q.continue.bind(Q),U=(U=Q.continuePrimaryKey)&&U.bind(Q),ft=Q.advance.bind(Q),pt=function(){throw new Error("Cursor not stopped")},Q.trans=_,Q.stop=Q.continue=Q.continuePrimaryKey=Q.advance=function(){throw new Error("Cursor not started")},Q.fail=wt(C),Q.next=function(){var at=this,kt=1;return this.start(function(){return kt--?at.continue():at.stop()}).then(function(){return at})},Q.start=function(at){function kt(){if(W.result)try{at()}catch(Dt){Q.fail(Dt)}else Q.done=!0,Q.start=function(){throw new Error("Cursor behind last entry")},Q.stop()}var Qt=new Promise(function(Dt,Be){Dt=wt(Dt),W.onerror=ae(Be),Q.fail=Be,Q.stop=function(mo){Q.stop=Q.continue=Q.continuePrimaryKey=Q.advance=pt,Dt(mo)}});return W.onsuccess=wt(function(Dt){W.onsuccess=kt,kt()}),Q.continue=M,Q.continuePrimaryKey=U,Q.advance=ft,kt(),Qt},A(Q)):A(null)},C)})},count:function(E){var _=E.query,y=E.trans,T=_.index,I=_.range;return new Promise(function(D,A){var C=y.objectStore(S),C=T.isPrimaryKey?C:C.index(T.name),j=a(I),j=j?C.count(j):C.count();j.onsuccess=wt(function(L){return D(L.target.result)}),j.onerror=ae(A)})}}}l=b,f=fi((b=t).objectStoreNames);var l,b={schema:{name:b.name,tables:f.map(function(w){return l.objectStore(w)}).map(function(w){var v=w.keyPath,S=w.autoIncrement,_=m(v),E={},_={name:w.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:v==null,compound:_,keyPath:v,autoIncrement:S,unique:!0,extractKey:Gr(v)},indexes:fi(w.indexNames).map(function(y){return w.index(y)}).map(function(D){var A=D.name,T=D.unique,I=D.multiEntry,D=D.keyPath,A={name:A,compound:m(D),keyPath:D,unique:T,multiEntry:I,extractKey:Gr(D)};return E[Dn(D)]=A}),getIndexByKeyPath:function(y){return E[Dn(y)]}};return E[":id"]=_.primaryKey,v!=null&&(E[Dn(v)]=_.primaryKey),_})},hasGetAll:0<f.length&&"getAll"in l.objectStore(f[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},f=b.schema,p=b.hasGetAll,b=f.tables.map(u),x={};return b.forEach(function(w){return x[w.name]=w}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(w){if(x[w])return x[w];throw new Error("Table '".concat(w,"' not found"))},MIN_KEY:-1/0,MAX_KEY:En(e),schema:f}}function ja(t,e,r,a){return r=r.IDBKeyRange,e=Ma(e,r,a),{dbcore:t.dbcore.reduce(function(u,l){return l=l.create,s(s({},u),l(u))},e)}}function tr(t,e){var r=e.db,r=ja(t._middlewares,r,t._deps,e);t.core=r.dbcore,t.tables.forEach(function(a){var u=a.name;t.core.schema.tables.some(function(l){return l.name===u})&&(a.core=t.core.table(u),t[u]instanceof t.Table)&&(t[u].core=a.core)})}function er(t,e,r,a){r.forEach(function(u){var l=a[u];e.forEach(function(f){var p=function b(x,w){return J(x,w)||(x=k(x))&&b(x,w)}(f,u);(!p||"value"in p&&p.value===void 0)&&(f===t.Transaction.prototype||f instanceof t.Transaction?F(f,u,{get:function(){return this.table(u)},set:function(b){K(this,u,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):f[u]=new t.Table(u,l))})})}function Qr(t,e){e.forEach(function(r){for(var a in r)r[a]instanceof t.Table&&delete r[a]})}function La(t,e){return t._cfg.version-e._cfg.version}function Ra(t,e,r,a){var u=t._dbSchema,l=(r.objectStoreNames.contains("$meta")&&!u.$meta&&(u.$meta=Xr("$meta",pi("")[0],[]),t._storeNames.push("$meta")),t._createTransaction("readwrite",t._storeNames,u)),f=(l.create(r),l._completion.catch(a),l._reject.bind(l)),p=z.transless||z;_e(function(){if(z.trans=l,z.transless=p,e!==0)return tr(t,r),x=e,((b=l).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(w){return w??x}):B.resolve(x)).then(function(T){var v=t,S=T,E=l,_=r,y=[],T=v._versions,I=v._dbSchema=rr(0,v.idbdb,_);return(T=T.filter(function(D){return D._cfg.version>=S})).length===0?B.resolve():(T.forEach(function(D){y.push(function(){var A,C,j,L=I,$=D._cfg.dbschema,W=(or(v,L,_),or(v,$,_),I=v._dbSchema=$,Jr(L,$)),q=(W.add.forEach(function(M){Zr(_,M[0],M[1].primKey,M[1].indexes)}),W.change.forEach(function(M){if(M.recreate)throw new X.Upgrade("Not yet support for changing primary key");var U=_.objectStore(M.name);M.add.forEach(function(ft){return nr(U,ft)}),M.change.forEach(function(ft){U.deleteIndex(ft.name),nr(U,ft)}),M.del.forEach(function(ft){return U.deleteIndex(ft)})}),D._cfg.contentUpgrade);if(q&&D._cfg.version>S)return tr(v,_),E._memoizedTables={},A=it($),W.del.forEach(function(M){A[M]=L[M]}),Qr(v,[v.Transaction.prototype]),er(v,[v.Transaction.prototype],h(A),A),E.schema=A,(C=He(q))&&Je(),$=B.follow(function(){var M;(j=q(E))&&C&&(M=ke.bind(null,null),j.then(M,M))}),j&&typeof j.then=="function"?B.resolve(j):$.then(function(){return j})}),y.push(function(A){var C,j,L=D._cfg.dbschema;C=L,j=A,[].slice.call(j.db.objectStoreNames).forEach(function($){return C[$]==null&&j.db.deleteObjectStore($)}),Qr(v,[v.Transaction.prototype]),er(v,[v.Transaction.prototype],v._storeNames,v._dbSchema),E.schema=v._dbSchema}),y.push(function(A){v.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(v.idbdb.version/10)===D._cfg.version?(v.idbdb.deleteObjectStore("$meta"),delete v._dbSchema.$meta,v._storeNames=v._storeNames.filter(function(C){return C!=="$meta"})):A.objectStore("$meta").put(D._cfg.version,"version"))})}),function D(){return y.length?B.resolve(y.shift()(E.idbtrans)).then(D):B.resolve()}().then(function(){hi(I,_)}))}).catch(f);var b,x;h(u).forEach(function(w){Zr(r,w,u[w].primKey,u[w].indexes)}),tr(t,r),B.follow(function(){return t.on.populate.fire(l)}).catch(f)})}function Na(t,e){hi(t._dbSchema,e),e.db.version%10!=0||e.objectStoreNames.contains("$meta")||e.db.createObjectStore("$meta").add(Math.ceil(e.db.version/10-1),"version");var r=rr(0,t.idbdb,e);or(t,t._dbSchema,e);for(var a=0,u=Jr(r,t._dbSchema).change;a<u.length;a++){var l=(f=>{if(f.change.length||f.recreate)return console.warn("Unable to patch indexes of table ".concat(f.name," because it has changes on the type of index or primary key.")),{value:void 0};var p=e.objectStore(f.name);f.add.forEach(function(b){ie&&console.debug("Dexie upgrade patch: Creating missing index ".concat(f.name,".").concat(b.src)),nr(p,b)})})(u[a]);if(typeof l=="object")return l.value}}function Jr(t,e){var r,a={del:[],add:[],change:[]};for(r in t)e[r]||a.del.push(r);for(r in e){var u=t[r],l=e[r];if(u){var f={name:r,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(u.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||u.primKey.auto!==l.primKey.auto)f.recreate=!0,a.change.push(f);else{var p=u.idxByName,b=l.idxByName,x=void 0;for(x in p)b[x]||f.del.push(x);for(x in b){var w=p[x],v=b[x];w?w.src!==v.src&&f.change.push(v):f.add.push(v)}(0<f.del.length||0<f.add.length||0<f.change.length)&&a.change.push(f)}}else a.add.push([r,l])}return a}function Zr(t,e,r,a){var u=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});a.forEach(function(l){return nr(u,l)})}function hi(t,e){h(t).forEach(function(r){e.db.objectStoreNames.contains(r)||(ie&&console.debug("Dexie: Creating missing table",r),Zr(e,r,t[r].primKey,t[r].indexes))})}function nr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function rr(t,e,r){var a={};return ot(e.objectStoreNames,0).forEach(function(u){for(var l=r.objectStore(u),f=Vr(di(x=l.keyPath),x||"",!0,!1,!!l.autoIncrement,x&&typeof x!="string",!0),p=[],b=0;b<l.indexNames.length;++b){var w=l.index(l.indexNames[b]),x=w.keyPath,w=Vr(w.name,x,!!w.unique,!!w.multiEntry,!1,x&&typeof x!="string",!1);p.push(w)}a[u]=Xr(u,f,p)}),a}function or(t,e,r){for(var a=r.db.objectStoreNames,u=0;u<a.length;++u){var l=a[u],f=r.objectStore(l);t._hasGetAll="getAll"in f;for(var p=0;p<f.indexNames.length;++p){var b,x=f.indexNames[p],w=f.index(x).keyPath,w=typeof w=="string"?w:"["+ot(w).join("+")+"]";e[l]&&(b=e[l].idxByName[w])&&(b.name=x,delete e[l].idxByName[w],e[l].idxByName[x]=b)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&d.WorkerGlobalScope&&d instanceof d.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function pi(t){return t.split(",").map(function(e,r){var u=e.split(":"),a=(a=u[1])==null?void 0:a.trim(),u=(e=u[0].trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Vr(u,l||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),m(l),r===0,a)})}nn.prototype._createTableSchema=Xr,nn.prototype._parseIndexSyntax=pi,nn.prototype._parseStoresSpec=function(t,e){var r=this;h(t).forEach(function(a){if(t[a]!==null){var u=r._parseIndexSyntax(t[a]),l=u.shift();if(!l)throw new X.Schema("Invalid schema for table "+a+": "+t[a]);if(l.unique=!0,l.multi)throw new X.Schema("Primary key cannot be multiEntry*");u.forEach(function(f){if(f.auto)throw new X.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new X.Schema("Index must have a name and cannot be an empty string")}),l=r._createTableSchema(a,l,u),e[a]=l}})},nn.prototype.stores=function(r){var e=this.db,r=(this._cfg.storesSource=this._cfg.storesSource?g(this._cfg.storesSource,r):r,e._versions),a={},u={};return r.forEach(function(l){g(a,l._cfg.storesSource),u=l._cfg.dbschema={},l._parseStoresSpec(a,u)}),e._dbSchema=u,Qr(e,[e._allTables,e,e.Transaction.prototype]),er(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],h(u),u),e._storeNames=h(u),this},nn.prototype.upgrade=function(t){return this._cfg.contentUpgrade=Mr(this._cfg.contentUpgrade||yt,t),this};var Ka=nn;function nn(){}function to(t,e){var r=t._dbNamesDB;return r||(r=t._dbNamesDB=new pe(Vn,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function eo(t){return t&&typeof t.databases=="function"}function no(t){return _e(function(){return z.letThrough=!0,t()})}function ro(t){return!("from"in t)}var Lt=function(t,e){var r;if(!this)return r=new Lt,t&&"d"in t&&g(r,t),r;g(this,arguments.length?{d:1,from:t,to:1<arguments.length?e:t}:{d:0})};function xn(t,e,r){var a=ct(e,r);if(!isNaN(a)){if(0<a)throw RangeError();if(ro(t))return g(t,{from:e,to:r,d:1});var a=t.l,u=t.r;if(ct(r,t.from)<0)return a?xn(a,e,r):t.l={from:e,to:r,d:1,l:null,r:null},gi(t);if(0<ct(e,t.to))return u?xn(u,e,r):t.r={from:e,to:r,d:1,l:null,r:null},gi(t);ct(e,t.from)<0&&(t.from=e,t.l=null,t.d=u?u.d+1:1),0<ct(r,t.to)&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1),e=!t.r,a&&!t.l&&Tn(t,a),u&&e&&Tn(t,u)}}function Tn(t,e){ro(e)||function r(a,u){var l=u.from,f=u.l,p=u.r;xn(a,l,u.to),f&&r(a,f),p&&r(a,p)}(t,e)}function mi(t,e){var r=ir(e),a=r.next();if(!a.done)for(var u=a.value,l=ir(t),f=l.next(u.from),p=f.value;!a.done&&!f.done;){if(ct(p.from,u.to)<=0&&0<=ct(p.to,u.from))return!0;ct(u.from,p.from)<0?u=(a=r.next(p.from)).value:p=(f=l.next(u.from)).value}return!1}function ir(t){var e=ro(t)?null:{s:0,n:t};return{next:function(r){for(var a=0<arguments.length;e;)switch(e.s){case 0:if(e.s=1,a)for(;e.n.l&&ct(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!a||ct(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function gi(t){var e,r,a,u=(((u=t.r)==null?void 0:u.d)||0)-(((u=t.l)==null?void 0:u.d)||0),u=1<u?"r":u<-1?"l":"";u&&(e=u=="r"?"l":"r",r=s({},t),a=t[u],t.from=a.from,t.to=a.to,t[u]=a[u],r[u]=a[e],(t[e]=r).d=vi(r)),t.d=vi(t)}function vi(r){var e=r.r,r=r.l;return(e?r?Math.max(e.d,r.d):e.d:r?r.d:0)+1}function ar(t,e){return h(e).forEach(function(r){t[r]?Tn(t[r],e[r]):t[r]=function a(u){var l,f,p={};for(l in u)P(u,l)&&(f=u[l],p[l]=!f||typeof f!="object"||Ut.has(f.constructor)?f:a(f));return p}(e[r])}),t}function oo(t,e){return t.all||e.all||Object.keys(t).some(function(r){return e[r]&&mi(e[r],t[r])})}N(Lt.prototype,((zt={add:function(t){return Tn(this,t),this},addKey:function(t){return xn(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(r){return xn(e,r,r)}),this},hasKey:function(t){var e=ir(this).next(t).value;return e&&ct(e.from,t)<=0&&0<=ct(e.to,t)}})[Gt]=function(){return ir(this)},zt));var Ne={},io={},ao=!1;function sr(t){ar(io,t),ao||(ao=!0,setTimeout(function(){ao=!1,so(io,!(io={}))},0))}function so(t,e){e===void 0&&(e=!1);var r=new Set;if(t.all)for(var a=0,u=Object.values(Ne);a<u.length;a++)yi(p=u[a],t,r,e);else for(var l in t){var f,p,l=/^idb\:\/\/(.*)\/(.*)\//.exec(l);l&&(f=l[1],l=l[2],p=Ne["idb://".concat(f,"/").concat(l)])&&yi(p,t,r,e)}r.forEach(function(b){return b()})}function yi(t,e,r,a){for(var u=[],l=0,f=Object.entries(t.queries.query);l<f.length;l++){for(var p=f[l],b=p[0],x=[],w=0,v=p[1];w<v.length;w++){var S=v[w];oo(e,S.obsSet)?S.subscribers.forEach(function(T){return r.add(T)}):a&&x.push(S)}a&&u.push([b,x])}if(a)for(var E=0,_=u;E<_.length;E++){var y=_[E],b=y[0],x=y[1];t.queries.query[b]=x}}function Ba(t){var e=t._state,r=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?Tt(e.dbOpenError):t});e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var a=e.openCanceller,u=Math.round(10*t.verno),l=!1;function f(){if(e.openCanceller!==a)throw new X.DatabaseClosed("db.open() was cancelled")}function p(){return new B(function(S,E){if(f(),!r)throw new X.MissingAPI;var _=t.name,y=e.autoSchema||!u?r.open(_):r.open(_,u);if(!y)throw new X.MissingAPI;y.onerror=ae(E),y.onblocked=wt(t._fireOnBlocked),y.onupgradeneeded=wt(function(T){var I;w=y.transaction,e.autoSchema&&!t._options.allowEmptyDB?(y.onerror=kn,w.abort(),y.result.close(),(I=r.deleteDatabase(_)).onsuccess=I.onerror=wt(function(){E(new X.NoSuchDatabase("Database ".concat(_," doesnt exist")))})):(w.onerror=ae(E),I=T.oldVersion>Math.pow(2,62)?0:T.oldVersion,v=I<1,t.idbdb=y.result,l&&Na(t,w),Ra(t,I/10,w,E))},E),y.onsuccess=wt(function(){w=null;var T,I,D,A,C,j,L=t.idbdb=y.result,$=ot(L.objectStoreNames);if(0<$.length)try{var W=L.transaction((C=$).length===1?C[0]:C,"readonly");if(e.autoSchema)j=L,A=W,(D=t).verno=j.version/10,A=D._dbSchema=rr(0,j,A),D._storeNames=ot(j.objectStoreNames,0),er(D,[D._allTables],h(A),A);else if(or(t,t._dbSchema,W),I=W,((I=Jr(rr(0,(T=t).idbdb,I),T._dbSchema)).add.length||I.change.some(function(q){return q.add.length||q.change.length}))&&!l)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),L.close(),u=L.version+1,l=!0,S(p());tr(t,W)}catch{}Ze.push(t),L.onversionchange=wt(function(q){e.vcFired=!0,t.on("versionchange").fire(q)}),L.onclose=wt(function(){t.close({disableAutoOpen:!1})}),v&&($=t._deps,C=_,eo(j=$.indexedDB)||C===Vn||to(j,$.IDBKeyRange).put({name:C}).catch(yt)),S()},E)}).catch(function(S){switch(S==null?void 0:S.name){case"UnknownError":if(0<e.PR1398_maxLoop)return e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),p();break;case"VersionError":if(0<u)return u=0,p()}return B.reject(S)})}var b,x=e.dbReadyResolve,w=null,v=!1;return B.race([a,(typeof navigator>"u"?B.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(S){function E(){return indexedDB.databases().finally(S)}b=setInterval(E,100),E()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(p)]).then(function(){return f(),e.onReadyBeingFired=[],B.resolve(no(function(){return t.on.ready.fire(t.vip)})).then(function S(){var E;if(0<e.onReadyBeingFired.length)return E=e.onReadyBeingFired.reduce(Mr,yt),e.onReadyBeingFired=[],B.resolve(no(function(){return E(t.vip)})).then(S)})}).finally(function(){e.openCanceller===a&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)}).catch(function(S){e.dbOpenError=S;try{w&&w.abort()}catch{}return a===e.openCanceller&&t._close(),Tt(S)}).finally(function(){e.openComplete=!0,x()}).then(function(){var S;return v&&(S={},t.tables.forEach(function(E){E.schema.indexes.forEach(function(_){_.name&&(S["idb://".concat(t.name,"/").concat(E.name,"/").concat(_.name)]=new Lt(-1/0,[[[]]]))}),S["idb://".concat(t.name,"/").concat(E.name,"/")]=S["idb://".concat(t.name,"/").concat(E.name,"/:dels")]=new Lt(-1/0,[[[]]])}),De(Sn).fire(S),so(S,!0)),t})}function uo(t){function e(l){return t.next(l)}var r=u(e),a=u(function(l){return t.throw(l)});function u(l){return function(p){var p=l(p),b=p.value;return p.done?b:b&&typeof b.then=="function"?b.then(r,a):m(b)?Promise.all(b).then(r,a):r(b)}}return u(e)()}function ur(t,e,r){for(var a=m(t)?t.slice():[t],u=0;u<r;++u)a.push(e);return a}var qa={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return s(s({},t),{table:function(a){var r=t.table(a),a=r.schema,u={},l=[];function f(S,E,_){var D=Dn(S),y=u[D]=u[D]||[],T=S==null?0:typeof S=="string"?1:S.length,I=0<E,D=s(s({},_),{name:I?"".concat(D,"(virtual-from:").concat(_.name,")"):_.name,lowLevelIndex:_,isVirtual:I,keyTail:E,keyLength:T,extractKey:Gr(S),unique:!I&&_.unique});return y.push(D),D.isPrimaryKey||l.push(D),1<T&&f(T===2?S[0]:S.slice(0,T-1),E+1,_),y.sort(function(A,C){return A.keyTail-C.keyTail}),D}var p=f(a.primaryKey.keyPath,0,a.primaryKey);u[":id"]=[p];for(var b=0,x=a.indexes;b<x.length;b++){var w=x[b];f(w.keyPath,0,w)}function v(S){var E,_=S.query.index;return _.isVirtual?s(s({},S),{query:{index:_.lowLevelIndex,range:(E=S.query.range,_=_.keyTail,{type:E.type===1?2:E.type,lower:ur(E.lower,E.lowerOpen?t.MAX_KEY:t.MIN_KEY,_),lowerOpen:!0,upper:ur(E.upper,E.upperOpen?t.MIN_KEY:t.MAX_KEY,_),upperOpen:!0})}}):S}return s(s({},r),{schema:s(s({},a),{primaryKey:p,indexes:l,getIndexByKeyPath:function(S){return(S=u[Dn(S)])&&S[0]}}),count:function(S){return r.count(v(S))},query:function(S){return r.query(v(S))},openCursor:function(S){var E=S.query.index,_=E.keyTail,y=E.keyLength;return E.isVirtual?r.openCursor(v(S)).then(function(I){return I&&T(I)}):r.openCursor(S);function T(I){return Object.create(I,{continue:{value:function(D){D!=null?I.continue(ur(D,S.reverse?t.MAX_KEY:t.MIN_KEY,_)):S.unique?I.continue(I.key.slice(0,y).concat(S.reverse?t.MIN_KEY:t.MAX_KEY,_)):I.continue()}},continuePrimaryKey:{value:function(D,A){I.continuePrimaryKey(ur(D,t.MAX_KEY,_),A)}},primaryKey:{get:function(){return I.primaryKey}},key:{get:function(){var D=I.key;return y===1?D[0]:D.slice(0,y)}},value:{get:function(){return I.value}}})}}})}})}};function lo(t,e,r,a){return r=r||{},a=a||"",h(t).forEach(function(u){var l,f,p;P(e,u)?(l=t[u],f=e[u],typeof l=="object"&&typeof f=="object"&&l&&f?(p=fe(l))!==fe(f)?r[a+u]=e[u]:p==="Object"?lo(l,f,r,a+u+"."):l!==f&&(r[a+u]=e[u]):l!==f&&(r[a+u]=e[u])):r[a+u]=void 0}),h(e).forEach(function(u){P(t,u)||(r[a+u]=e[u])}),r}function co(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Fa={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return s(s({},t),{table:function(e){var r=t.table(e),a=r.schema.primaryKey;return s(s({},r),{mutate:function(u){var l=z.trans,f=l.table(e).hook,p=f.deleting,b=f.creating,x=f.updating;switch(u.type){case"add":if(b.fire===yt)break;return l._promise("readwrite",function(){return w(u)},!0);case"put":if(b.fire===yt&&x.fire===yt)break;return l._promise("readwrite",function(){return w(u)},!0);case"delete":if(p.fire===yt)break;return l._promise("readwrite",function(){return w(u)},!0);case"deleteRange":if(p.fire===yt)break;return l._promise("readwrite",function(){return function v(S,E,_){return r.query({trans:S,values:!1,query:{index:a,range:E},limit:_}).then(function(y){var T=y.result;return w({type:"delete",keys:T,trans:S}).then(function(I){return 0<I.numFailures?Promise.reject(I.failures[0]):T.length<_?{failures:[],numFailures:0,lastResult:void 0}:v(S,s(s({},E),{lower:T[T.length-1],lowerOpen:!0}),_)})})}(u.trans,u.range,1e4)},!0)}return r.mutate(u);function w(v){var S,E,_,y=z.trans,T=v.keys||co(a,v);if(T)return(v=v.type==="add"||v.type==="put"?s(s({},v),{keys:T}):s({},v)).type!=="delete"&&(v.values=c([],v.values)),v.keys&&(v.keys=c([],v.keys)),S=r,_=T,((E=v).type==="add"?Promise.resolve([]):S.getMany({trans:E.trans,keys:_,cache:"immutable"})).then(function(I){var D=T.map(function(A,C){var j,L,$,W=I[C],q={onerror:null,onsuccess:null};return v.type==="delete"?p.fire.call(q,A,W,y):v.type==="add"||W===void 0?(j=b.fire.call(q,A,v.values[C],y),A==null&&j!=null&&(v.keys[C]=A=j,a.outbound||st(v.values[C],a.keyPath,A))):(j=lo(W,v.values[C]),(L=x.fire.call(q,j,A,W,y))&&($=v.values[C],Object.keys(L).forEach(function(M){P($,M)?$[M]=L[M]:st($,M,L[M])}))),q});return r.mutate(v).then(function(A){for(var C=A.failures,j=A.results,L=A.numFailures,A=A.lastResult,$=0;$<T.length;++$){var W=(j||T)[$],q=D[$];W==null?q.onerror&&q.onerror(C[$]):q.onsuccess&&q.onsuccess(v.type==="put"&&I[$]?v.values[$]:W)}return{failures:C,results:j,numFailures:L,lastResult:A}}).catch(function(A){return D.forEach(function(C){return C.onerror&&C.onerror(A)}),Promise.reject(A)})});throw new Error("Keys missing")}}})}})}};function bi(t,e,r){try{if(!e||e.keys.length<t.length)return null;for(var a=[],u=0,l=0;u<e.keys.length&&l<t.length;++u)ct(e.keys[u],t[l])===0&&(a.push(r?Mt(e.values[u]):e.values[u]),++l);return a.length===t.length?a:null}catch{return null}}var Wa={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var r=t.table(e);return s(s({},r),{getMany:function(a){var u;return a.cache?(u=bi(a.keys,a.trans._cache,a.cache==="clone"))?B.resolve(u):r.getMany(a).then(function(l){return a.trans._cache={keys:a.keys,values:a.cache==="clone"?Mt(l):l},l}):r.getMany(a)},mutate:function(a){return a.type!=="add"&&(a.trans._cache=null),r.mutate(a)}})}}}};function wi(t,e){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!e.schema.primaryKey.outbound}function _i(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ua={stack:"dbcore",level:0,name:"Observability",create:function(t){var e=t.schema.name,r=new Lt(t.MIN_KEY,t.MAX_KEY);return s(s({},t),{transaction:function(a,u,l){if(z.subscr&&u!=="readonly")throw new X.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(z.querier));return t.transaction(a,u,l)},table:function(a){function u(T){var y,T=T.query;return[y=T.index,new Lt((y=(T=T.range).lower)!=null?y:t.MIN_KEY,(y=T.upper)!=null?y:t.MAX_KEY)]}var l=t.table(a),f=l.schema,p=f.primaryKey,b=f.indexes,x=p.extractKey,w=p.outbound,v=p.autoIncrement&&b.filter(function(_){return _.compound&&_.keyPath.includes(p.keyPath)}),S=s(s({},l),{mutate:function(_){function y(U){return U="idb://".concat(e,"/").concat(a,"/").concat(U),C[U]||(C[U]=new Lt)}var T,I,D,A=_.trans,C=_.mutatedParts||(_.mutatedParts={}),j=y(""),L=y(":dels"),$=_.type,q=_.type==="deleteRange"?[_.range]:_.type==="delete"?[_.keys]:_.values.length<50?[co(p,_).filter(function(U){return U}),_.values]:[],W=q[0],q=q[1],M=_.trans._cache;return m(W)?(j.addKeys(W),($=$==="delete"||W.length===q.length?bi(W,M):null)||L.addKeys(W),($||q)&&(T=y,I=$,D=q,f.indexes.forEach(function(U){var ft=T(U.name||"");function pt(at){return at!=null?U.extractKey(at):null}function Q(at){U.multiEntry&&m(at)?at.forEach(function(kt){return ft.addKey(kt)}):ft.addKey(at)}(I||D).forEach(function(at,Dt){var Qt=I&&pt(I[Dt]),Dt=D&&pt(D[Dt]);ct(Qt,Dt)!==0&&(Qt!=null&&Q(Qt),Dt!=null)&&Q(Dt)})}))):W?(q={from:(M=W.lower)!=null?M:t.MIN_KEY,to:($=W.upper)!=null?$:t.MAX_KEY},L.add(q),j.add(q)):(j.add(r),L.add(r),f.indexes.forEach(function(U){return y(U.name).add(r)})),l.mutate(_).then(function(U){return!W||_.type!=="add"&&_.type!=="put"||(j.addKeys(U.results),v&&v.forEach(function(ft){for(var pt=_.values.map(function(Qt){return ft.extractKey(Qt)}),Q=ft.keyPath.findIndex(function(Qt){return Qt===p.keyPath}),at=0,kt=U.results.length;at<kt;++at)pt[at][Q]=U.results[at];y(ft.name).addKeys(pt)})),A.mutatedParts=ar(A.mutatedParts||{},C),U})}}),E={get:function(_){return[p,new Lt(_.key)]},getMany:function(_){return[p,new Lt().addKeys(_.keys)]},count:u,query:u,openCursor:u};return h(E).forEach(function(_){S[_]=function(y){var T=z.subscr,I=!!T,D=wi(z,l)&&_i(_,y)?y.obsSet={}:T;if(I){var A,T=function(q){return q="idb://".concat(e,"/").concat(a,"/").concat(q),D[q]||(D[q]=new Lt)},C=T(""),j=T(":dels"),I=E[_](y),L=I[0],I=I[1];if((_==="query"&&L.isPrimaryKey&&!y.values?j:T(L.name||"")).add(I),!L.isPrimaryKey){if(_!=="count")return A=_==="query"&&w&&y.values&&l.query(s(s({},y),{values:!1})),l[_].apply(this,arguments).then(function(q){if(_==="query"){if(w&&y.values)return A.then(function(pt){return pt=pt.result,C.addKeys(pt),q});var M=y.values?q.result.map(x):q.result;(y.values?C:j).addKeys(M)}else{var U,ft;if(_==="openCursor")return ft=y.values,(U=q)&&Object.create(U,{key:{get:function(){return j.addKey(U.primaryKey),U.key}},primaryKey:{get:function(){var pt=U.primaryKey;return j.addKey(pt),pt}},value:{get:function(){return ft&&C.addKey(U.primaryKey),U.value}}})}return q});j.add(r)}}return l[_].apply(this,arguments)}}),S}})}};function ki(t,e,r){var a;return r.numFailures===0?e:e.type==="deleteRange"||(a=e.keys?e.keys.length:"values"in e&&e.values?e.values.length:1,r.numFailures===a)?null:(a=s({},e),m(a.keys)&&(a.keys=a.keys.filter(function(u,l){return!(l in r.failures)})),"values"in a&&m(a.values)&&(a.values=a.values.filter(function(u,l){return!(l in r.failures)})),a)}function fo(t,e){return r=t,((a=e).lower===void 0||(a.lowerOpen?0<ct(r,a.lower):0<=ct(r,a.lower)))&&(r=t,(a=e).upper===void 0||(a.upperOpen?ct(r,a.upper)<0:ct(r,a.upper)<=0));var r,a}function Si(t,e,r,a,u,l){var f,p,b,x,w,v;return!r||r.length===0||(f=e.query.index,p=f.multiEntry,b=e.query.range,x=a.schema.primaryKey.extractKey,w=f.extractKey,v=(f.lowLevelIndex||f).extractKey,(a=r.reduce(function(S,E){var _=S,y=[];if(E.type==="add"||E.type==="put")for(var T=new Lt,I=E.values.length-1;0<=I;--I){var D,A=E.values[I],C=x(A);!T.hasKey(C)&&(D=w(A),p&&m(D)?D.some(function(q){return fo(q,b)}):fo(D,b))&&(T.addKey(C),y.push(A))}switch(E.type){case"add":var j=new Lt().addKeys(e.values?S.map(function(M){return x(M)}):S),_=S.concat(e.values?y.filter(function(M){return M=x(M),!j.hasKey(M)&&(j.addKey(M),!0)}):y.map(function(M){return x(M)}).filter(function(M){return!j.hasKey(M)&&(j.addKey(M),!0)}));break;case"put":var L=new Lt().addKeys(E.values.map(function(M){return x(M)}));_=S.filter(function(M){return!L.hasKey(e.values?x(M):M)}).concat(e.values?y:y.map(function(M){return x(M)}));break;case"delete":var $=new Lt().addKeys(E.keys);_=S.filter(function(M){return!$.hasKey(e.values?x(M):M)});break;case"deleteRange":var W=E.range;_=S.filter(function(M){return!fo(x(M),W)})}return _},t))===t)?t:(a.sort(function(S,E){return ct(v(S),v(E))||ct(x(S),x(E))}),e.limit&&e.limit<1/0&&(a.length>e.limit?a.length=e.limit:t.length===e.limit&&a.length<e.limit&&(u.dirty=!0)),l?Object.freeze(a):a)}function Ei(t,e){return ct(t.lower,e.lower)===0&&ct(t.upper,e.upper)===0&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function Ya(t,e){return((r,a,u,l)=>{if(r===void 0)return a!==void 0?-1:0;if(a===void 0)return 1;if((r=ct(r,a))===0){if(u&&l)return 0;if(u)return 1;if(l)return-1}return r})(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&0<=((r,a,u,l)=>{if(r===void 0)return a!==void 0?1:0;if(a===void 0)return-1;if((r=ct(r,a))===0){if(u&&l)return 0;if(u)return-1;if(l)return 1}return r})(t.upper,e.upper,t.upperOpen,e.upperOpen)}function za(t,e,r,a){t.subscribers.add(r),a.addEventListener("abort",function(){var u,l;t.subscribers.delete(r),t.subscribers.size===0&&(u=t,l=e,setTimeout(function(){u.subscribers.size===0&&Yt(l,u)},3e3))})}var Ha={stack:"dbcore",level:0,name:"Cache",create:function(t){var e=t.schema.name;return s(s({},t),{transaction:function(r,a,u){var l,f,p=t.transaction(r,a,u);return a==="readwrite"&&(u=(l=new AbortController).signal,p.addEventListener("abort",(f=function(b){return function(){if(l.abort(),a==="readwrite"){for(var x=new Set,w=0,v=r;w<v.length;w++){var S=v[w],E=Ne["idb://".concat(e,"/").concat(S)];if(E){var _=t.table(S),y=E.optimisticOps.filter(function(U){return U.trans===p});if(p._explicit&&b&&p.mutatedParts)for(var T=0,I=Object.values(E.queries.query);T<I.length;T++)for(var D=0,A=(L=I[T]).slice();D<A.length;D++)oo(($=A[D]).obsSet,p.mutatedParts)&&(Yt(L,$),$.subscribers.forEach(function(U){return x.add(U)}));else if(0<y.length){E.optimisticOps=E.optimisticOps.filter(function(U){return U.trans!==p});for(var C=0,j=Object.values(E.queries.query);C<j.length;C++)for(var L,$,W,q=0,M=(L=j[C]).slice();q<M.length;q++)($=M[q]).res!=null&&p.mutatedParts&&(b&&!$.dirty?(W=Object.isFrozen($.res),W=Si($.res,$.req,y,_,$,W),$.dirty?(Yt(L,$),$.subscribers.forEach(function(U){return x.add(U)})):W!==$.res&&($.res=W,$.promise=B.resolve({result:W}))):($.dirty&&Yt(L,$),$.subscribers.forEach(function(U){return x.add(U)})))}}}x.forEach(function(U){return U()})}}})(!1),{signal:u}),p.addEventListener("error",f(!1),{signal:u}),p.addEventListener("complete",f(!0),{signal:u})),p},table:function(r){var a=t.table(r),u=a.schema.primaryKey;return s(s({},a),{mutate:function(l){var f,p=z.trans;return!u.outbound&&p.db._options.cache!=="disabled"&&!p.explicit&&p.idbtrans.mode==="readwrite"&&(f=Ne["idb://".concat(e,"/").concat(r)])?(p=a.mutate(l),l.type!=="add"&&l.type!=="put"||!(50<=l.values.length||co(u,l).some(function(b){return b==null}))?(f.optimisticOps.push(l),l.mutatedParts&&sr(l.mutatedParts),p.then(function(b){0<b.numFailures&&(Yt(f.optimisticOps,l),(b=ki(0,l,b))&&f.optimisticOps.push(b),l.mutatedParts)&&sr(l.mutatedParts)}),p.catch(function(){Yt(f.optimisticOps,l),l.mutatedParts&&sr(l.mutatedParts)})):p.then(function(b){var x=ki(0,s(s({},l),{values:l.values.map(function(w,v){var S;return b.failures[v]?w:(st(S=(S=u.keyPath)!=null&&S.includes(".")?Mt(w):s({},w),u.keyPath,b.results[v]),S)})}),b);f.optimisticOps.push(x),queueMicrotask(function(){return l.mutatedParts&&sr(l.mutatedParts)})}),p):a.mutate(l)},query:function(l){var f,p,b,x,w,v,S;return wi(z,a)&&_i("query",l)?(f=((b=z.trans)==null?void 0:b.db._options.cache)==="immutable",p=(b=z).requery,b=b.signal,v=((E,_,y,T)=>{var I=Ne["idb://".concat(E,"/").concat(_)];if(!I)return[];if(!(E=I.queries[y]))return[null,!1,I,null];var D=E[(T.query?T.query.index.name:null)||""];if(!D)return[null,!1,I,null];switch(y){case"query":var A=D.find(function(C){return C.req.limit===T.limit&&C.req.values===T.values&&Ei(C.req.query.range,T.query.range)});return A?[A,!0,I,D]:[D.find(function(C){return("limit"in C.req?C.req.limit:1/0)>=T.limit&&(!T.values||C.req.values)&&Ya(C.req.query.range,T.query.range)}),!1,I,D];case"count":return A=D.find(function(C){return Ei(C.req.query.range,T.query.range)}),[A,!!A,I,D]}})(e,r,"query",l),S=v[0],x=v[2],w=v[3],S&&v[1]?S.obsSet=l.obsSet:(v=a.query(l).then(function(E){var _=E.result;if(S&&(S.res=_),f){for(var y=0,T=_.length;y<T;++y)Object.freeze(_[y]);Object.freeze(_)}else E.result=Mt(_);return E}).catch(function(E){return w&&S&&Yt(w,S),Promise.reject(E)}),S={obsSet:l.obsSet,promise:v,subscribers:new Set,type:"query",req:l,dirty:!1},w?w.push(S):(w=[S],(x=x||(Ne["idb://".concat(e,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[l.query.index.name||""]=w)),za(S,w,p,b),S.promise.then(function(E){return{result:Si(E.result,l,x==null?void 0:x.optimisticOps,a,S,f)}})):a.query(l)}})}})}};function lr(t,e){return new Proxy(t,{get:function(r,a,u){return a==="db"?e:Reflect.get(r,a,u)}})}It.prototype.version=function(t){if(isNaN(t)||t<.1)throw new X.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new X.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,r=e.filter(function(a){return a._cfg.version===t})[0];return r||(r=new this.Version(t),e.push(r),e.sort(La),r.stores({}),this._state.autoSchema=!1),r},It.prototype._whenReady=function(t){var e=this;return this.idbdb&&(this._state.openComplete||z.letThrough||this._vip)?t():new B(function(r,a){if(e._state.openComplete)return a(new X.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return void a(new X.DatabaseClosed);e.open().catch(yt)}e._state.dbReadyPromise.then(r,a)}).then(t)},It.prototype.use=function(u){var e=u.stack,r=u.create,a=u.level,u=u.name,l=(u&&this.unuse({stack:e,name:u}),this._middlewares[e]||(this._middlewares[e]=[]));return l.push({stack:e,create:r,level:a??10,name:u}),l.sort(function(f,p){return f.level-p.level}),this},It.prototype.unuse=function(t){var e=t.stack,r=t.name,a=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(u){return a?u.create!==a:!!r&&u.name!==r})),this},It.prototype.open=function(){var t=this;return je(we,function(){return Ba(t)})},It.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var t=this._state,e=Ze.indexOf(this);if(0<=e&&Ze.splice(e,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new B(function(r){t.dbReadyResolve=r}),t.openCanceller=new B(function(r,a){t.cancelOpen=a}))},It.prototype.close=function(e){var e=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,r=this._state;e?(r.isBeingOpened&&r.cancelOpen(new X.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new X.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},It.prototype.delete=function(t){var e=this,r=(t===void 0&&(t={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),a=this._state;return new B(function(u,l){function f(){e.close(t);var p=e._deps.indexedDB.deleteDatabase(e.name);p.onsuccess=wt(function(){var b,x,w;b=e._deps,x=e.name,eo(w=b.indexedDB)||x===Vn||to(w,b.IDBKeyRange).delete(x).catch(yt),u()}),p.onerror=ae(l),p.onblocked=e._fireOnBlocked}if(r)throw new X.InvalidArgument("Invalid closeOptions argument to db.delete()");a.isBeingOpened?a.dbReadyPromise.then(f):f()})},It.prototype.backendDB=function(){return this.idbdb},It.prototype.isOpen=function(){return this.idbdb!==null},It.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},It.prototype.hasFailed=function(){return this._state.dbOpenError!==null},It.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(It.prototype,"tables",{get:function(){var t=this;return h(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!1,configurable:!0}),It.prototype.transaction=function(){var t=(function(e,r,a){var u=arguments.length;if(u<2)throw new X.InvalidArgument("Too few arguments");for(var l=new Array(u-1);--u;)l[u-1]=arguments[u];return a=l.pop(),[e,Zt(l),a]}).apply(this,arguments);return this._transaction.apply(this,t)},It.prototype._transaction=function(t,e,r){var a,u,l=this,f=z.trans,p=(f&&f.db===this&&t.indexOf("!")===-1||(f=null),t.indexOf("?")!==-1);t=t.replace("!","").replace("?","");try{if(u=e.map(function(x){if(x=x instanceof l.Table?x.name:x,typeof x!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return x}),t=="r"||t===Wr)a=Wr;else{if(t!="rw"&&t!=Ur)throw new X.InvalidArgument("Invalid transaction mode: "+t);a=Ur}if(f){if(f.mode===Wr&&a===Ur){if(!p)throw new X.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");f=null}f&&u.forEach(function(x){if(f&&f.storeNames.indexOf(x)===-1){if(!p)throw new X.SubTransaction("Table "+x+" not included in parent transaction.");f=null}}),p&&f&&!f.active&&(f=null)}}catch(x){return f?f._promise(null,function(w,v){v(x)}):Tt(x)}var b=(function x(w,v,S,E,_){return B.resolve().then(function(){var D=z.transless||z,y=w._createTransaction(v,S,w._dbSchema,E),D=(y.explicit=!0,{trans:y,transless:D});if(E)y.idbtrans=E.idbtrans;else try{y.create(),y.idbtrans._explicit=!0,w._state.PR1398_maxLoop=3}catch(A){return A.name===$r.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return x(w,v,S,null,_)})):Tt(A)}var T,I=He(_),D=(I&&Je(),B.follow(function(){var A;(T=_.call(y,y))&&(I?(A=ke.bind(null,null),T.then(A,A)):typeof T.next=="function"&&typeof T.throw=="function"&&(T=uo(T)))},D));return(T&&typeof T.then=="function"?B.resolve(T).then(function(A){return y.active?A:Tt(new X.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):D.then(function(){return T})).then(function(A){return E&&y._resolve(),y._completion.then(function(){return A})}).catch(function(A){return y._reject(A),Tt(A)})})}).bind(null,this,a,u,f,r);return f?f._promise(a,b,"lock"):z.trans?je(z.transless,function(){return l._whenReady(b)}):this._whenReady(b)},It.prototype.table=function(t){if(P(this._allTables,t))return this._allTables[t];throw new X.InvalidTable("Table ".concat(t," does not exist"))};var pe=It;function It(t,e){var r,a,u,l,f,p=this,b=(this._middlewares={},this.verno=0,It.dependencies),b=(this._options=e=s({addons:It.addons,autoOpen:!0,indexedDB:b.indexedDB,IDBKeyRange:b.IDBKeyRange,cache:"cloned"},e),this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange},e.addons),x=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:yt,dbReadyPromise:null,cancelOpen:yt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:e.autoOpen}),w=(x.dbReadyPromise=new B(function(v){x.dbReadyResolve=v}),x.openCanceller=new B(function(v,S){x.cancelOpen=S}),this._state=x,this.name=t,this.on=wn(this,"populate","blocked","versionchange","close",{ready:[Mr,yt]}),this.once=function(v,S){var E=function(){for(var _=[],y=0;y<arguments.length;y++)_[y]=arguments[y];p.on(v).unsubscribe(E),S.apply(p,_)};return p.on(v,E)},this.on.ready.subscribe=et(this.on.ready.subscribe,function(v){return function(S,E){It.vip(function(){var _,y=p._state;y.openComplete?(y.dbOpenError||B.resolve().then(S),E&&v(S)):y.onReadyBeingFired?(y.onReadyBeingFired.push(S),E&&v(S)):(v(S),_=p,E||v(function T(){_.on.ready.unsubscribe(S),_.on.ready.unsubscribe(T)}))})}}),this.Collection=(r=this,_n(Oa.prototype,function(T,y){this.db=r;var E=Zo,_=null;if(y)try{E=y()}catch(D){_=D}var y=T._ctx,T=y.table,I=T.hook.reading.fire;this._ctx={table:T,index:y.index,isPrimKey:!y.index||T.schema.primKey.keyPath&&y.index===T.schema.primKey.name,range:E,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:_,or:y.or,valueMapper:I!==pn?I:null}})),this.Table=(a=this,_n(ii.prototype,function(v,S,E){this.db=a,this._tx=E,this.name=v,this.schema=S,this.hook=a._allTables[v]?a._allTables[v].hook:wn(null,{creating:[wa,yt],reading:[ba,pn],updating:[ka,yt],deleting:[_a,yt]})})),this.Transaction=(u=this,_n(Ca.prototype,function(v,S,E,_,y){var T=this;v!=="readonly"&&S.forEach(function(I){I=(I=E[I])==null?void 0:I.yProps,I&&(S=S.concat(I.map(function(D){return D.updatesTable})))}),this.db=u,this.mode=v,this.storeNames=S,this.schema=E,this.chromeTransactionDurability=_,this.idbtrans=null,this.on=wn(this,"complete","error","abort"),this.parent=y||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new B(function(I,D){T._resolve=I,T._reject=D}),this._completion.then(function(){T.active=!1,T.on.complete.fire()},function(I){var D=T.active;return T.active=!1,T.on.error.fire(I),T.parent?T.parent._reject(I):D&&T.idbtrans&&T.idbtrans.abort(),Tt(I)})})),this.Version=(l=this,_n(Ka.prototype,function(v){this.db=l,this._cfg={version:v,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(f=this,_n(ci.prototype,function(v,S,E){if(this.db=f,this._ctx={table:v,index:S===":id"?null:S,or:E},this._cmp=this._ascending=ct,this._descending=function(_,y){return ct(y,_)},this._max=function(_,y){return 0<ct(_,y)?_:y},this._min=function(_,y){return ct(_,y)<0?_:y},this._IDBKeyRange=f._deps.IDBKeyRange,!this._IDBKeyRange)throw new X.MissingAPI})),this.on("versionchange",function(v){0<v.newVersion?console.warn("Another connection wants to upgrade database '".concat(p.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(p.name,"'. Closing db now to resume the delete request.")),p.close({disableAutoOpen:!1})}),this.on("blocked",function(v){!v.newVersion||v.newVersion<v.oldVersion?console.warn("Dexie.delete('".concat(p.name,"') was blocked")):console.warn("Upgrade '".concat(p.name,"' blocked by other connection holding version ").concat(v.oldVersion/10))}),this._maxKey=En(e.IDBKeyRange),this._createTransaction=function(v,S,E,_){return new p.Transaction(v,S,E,p._options.chromeTransactionDurability,_)},this._fireOnBlocked=function(v){p.on("blocked").fire(v),Ze.filter(function(S){return S.name===p.name&&S!==p&&!S._state.vcFired}).map(function(S){return S.on("versionchange").fire(v)})},this.use(Wa),this.use(Ha),this.use(Ua),this.use(qa),this.use(Fa),new Proxy(this,{get:function(v,S,E){var _;return S==="_vip"||(S==="table"?function(y){return lr(p.table(y),w)}:(_=Reflect.get(v,S,E))instanceof ii?lr(_,w):S==="tables"?_.map(function(y){return lr(y,w)}):S==="_createTransaction"?function(){return lr(_.apply(this,arguments),w)}:_)}}));this.vip=w,b.forEach(function(v){return v(p)})}var cr,rn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Va=(ho.prototype.subscribe=function(t,e,r){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:e,complete:r})},ho.prototype[rn]=function(){return this},ho);function ho(t){this._subscribe=t}try{cr={indexedDB:d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,IDBKeyRange:d.IDBKeyRange||d.webkitIDBKeyRange}}catch{cr={indexedDB:null,IDBKeyRange:null}}function Di(t){var e,r=!1,a=new Va(function(u){var l=He(t),f,p=!1,b={},x={},w={get closed(){return p},unsubscribe:function(){p||(p=!0,f&&f.abort(),v&&De.storagemutated.unsubscribe(E))}},v=(u.start&&u.start(w),!1),S=function(){return Fr(_)},E=function(y){ar(b,y),oo(x,b)&&S()},_=function(){var y,T,I;!p&&cr.indexedDB&&(b={},y={},f&&f.abort(),f=new AbortController,I=(D=>{var A=Ge();try{l&&Je();var C=_e(t,D);return C=l?C.finally(ke):C}finally{A&&Qe()}})(T={subscr:y,signal:f.signal,requery:S,querier:t,trans:null}),Promise.resolve(I).then(function(D){r=!0,e=D,p||T.signal.aborted||(b={},(A=>{for(var C in A)if(P(A,C))return;return 1})(x=y)||v||(De(Sn,E),v=!0),Fr(function(){return!p&&u.next&&u.next(D)}))},function(D){r=!1,["DatabaseClosedError","AbortError"].includes(D==null?void 0:D.name)||p||Fr(function(){p||u.error&&u.error(D)})}))};return setTimeout(S,0),w});return a.hasValue=function(){return r},a.getValue=function(){return e},a}var Ke=pe;function po(t){var e=xe;try{xe=!0,De.storagemutated.fire(t),so(t,!0)}finally{xe=e}}N(Ke,s(s({},ee),{delete:function(t){return new Ke(t,{addons:[]}).delete()},exists:function(t){return new Ke(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return e=Ke.dependencies,r=e.indexedDB,e=e.IDBKeyRange,(eo(r)?Promise.resolve(r.databases()).then(function(a){return a.map(function(u){return u.name}).filter(function(u){return u!==Vn})}):to(r,e).toCollection().primaryKeys()).then(t)}catch{return Tt(new X.MissingAPI)}var e,r},defineClass:function(){return function(t){g(this,t)}},ignoreTransaction:function(t){return z.trans?je(z.transless,t):t()},vip:no,async:function(t){return function(){try{var e=uo(t.apply(this,arguments));return e&&typeof e.then=="function"?e:B.resolve(e)}catch(r){return Tt(r)}}},spawn:function(t,e,r){try{var a=uo(t.apply(r,e||[]));return a&&typeof a.then=="function"?a:B.resolve(a)}catch(u){return Tt(u)}},currentTransaction:{get:function(){return z.trans||null}},waitFor:function(t,e){return t=B.resolve(typeof t=="function"?Ke.ignoreTransaction(t):t).timeout(e||6e4),z.trans?z.trans.waitFor(t):t},Promise:B,debug:{get:function(){return ie},set:function(t){zo(t)}},derive:Y,extend:g,props:N,override:et,Events:wn,on:De,liveQuery:Di,extendObservabilitySet:ar,getByKeyPath:mt,setByKeyPath:st,delByKeyPath:function(t,e){typeof e=="string"?st(t,e,void 0):"length"in e&&[].map.call(e,function(r){st(t,r,void 0)})},shallowClone:it,deepClone:Mt,getObjectDiff:lo,cmp:ct,asap:lt,minKey:-1/0,addons:[],connections:Ze,errnames:$r,dependencies:cr,cache:Ne,semVer:"4.3.0",version:"4.3.0".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,r){return t+e/Math.pow(10,2*r)})})),Ke.maxKey=En(Ke.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(De(Sn,function(t){xe||(t=new CustomEvent(Hr,{detail:t}),xe=!0,dispatchEvent(t),xe=!1)}),addEventListener(Hr,function(t){t=t.detail,xe||po(t)}));var on,xe=!1,xi=function(){};return typeof BroadcastChannel<"u"&&((xi=function(){(on=new BroadcastChannel(Hr)).onmessage=function(t){return t.data&&po(t.data)}})(),typeof on.unref=="function"&&on.unref(),De(Sn,function(t){xe||on.postMessage(t)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(t){if(!pe.disableBfCache&&t.persisted){ie&&console.debug("Dexie: handling persisted pagehide"),on!=null&&on.close();for(var e=0,r=Ze;e<r.length;e++)r[e].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(t){!pe.disableBfCache&&t.persisted&&(ie&&console.debug("Dexie: handling persisted pageshow"),xi(),po({all:new Lt(-1/0,[[]])}))})),B.rejectionMapper=function(t,e){return!t||t instanceof Ve||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Yo[t.name]?t:(e=new Yo[t.name](e||t.message,t),"stack"in t&&F(e,"stack",{get:function(){return this.inner.stack}}),e)},zo(ie),s(pe,Object.freeze({__proto__:null,Dexie:pe,Entity:ti,PropModification:bn,RangeSet:Lt,add:function(t){return new bn({add:t})},cmp:ct,default:pe,liveQuery:Di,mergeRanges:Tn,rangesOverlap:mi,remove:function(t){return new bn({remove:t})},replacePrefix:function(t,e){return new bn({replacePrefix:[t,e]})}}),{default:pe}),pe})})(zi);var Ja=zi.exports;const Io=Qa(Ja),Ii=Symbol.for("Dexie"),Er=globalThis[Ii]||(globalThis[Ii]=Io);if(Io.semVer!==Er.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Io.semVer} and ${Er.semVer}`);const{liveQuery:ru,mergeRanges:ou,rangesOverlap:iu,RangeSet:au,cmp:su,Entity:uu,PropModification:lu,replacePrefix:cu,add:du,remove:fu,DexieYProvider:hu}=Er;class Za extends Er{constructor(){super("GymDatabase");me(this,"workouts");me(this,"logs");me(this,"workoutTypes");me(this,"profile");this.version(1).stores({workouts:"id, status, startTime, updatedAt, isDeleted",logs:"id, workoutId, workoutTypeId, date, updatedAt, isDeleted",workoutTypes:"id, updatedAt, isDeleted",profile:"id, updatedAt, isDeleted"})}}const G=new Za,jo="gym_web_auth";function Lo(){const i=localStorage.getItem(jo);try{return i?JSON.parse(i):null}catch{return null}}function Hi(i){localStorage.setItem(jo,JSON.stringify(i))}function ts(){localStorage.removeItem(jo)}function Vi(){const i=Lo();if(!i)return null;const n=new URLSearchParams;return Object.entries(i).forEach(([o,s])=>{s!=null&&n.append(o,String(s))}),n.toString()}var Wi;const dr=(Wi=window.Telegram)==null?void 0:Wi.WebApp,Oi="https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4";class go{static getHeaders(){const n={"Content-Type":"application/json"};if(dr!=null&&dr.initData)localStorage.getItem("skip_tma_auth")==="true"||(n["X-Telegram-Init-Data"]=dr.initData);else{const o=Vi();o&&(n["X-Telegram-Init-Data"]=o)}return n}static async sync(){if(!navigator.onLine)throw new Error("Offline");const n=this.getHeaders(),o=await fetch(Oi,{headers:n});if(!o.ok)throw o.status===401?new Error("Unauthorized"):new Error("Sync failed");const s=await o.json();await this.mergeData(s);const c=await this.readAll();await fetch(Oi,{method:"POST",headers:n,body:JSON.stringify(c)})}static async mergeData(n){await G.transaction("rw",G.workouts,G.logs,G.workoutTypes,G.profile,async()=>{if(await this.mergeTable(G.workouts,n.workouts),await this.mergeTable(G.logs,n.logs),await this.mergeTable(G.workoutTypes,n.workoutTypes),n.profile){const o={...n.profile,id:"me"};await this.mergeTable(G.profile,[o])}})}static async mergeTable(n,o=[]){const s=await n.toArray(),c=new Map(s.map(d=>[d.id,d]));for(const d of o){const h=c.get(d.id);if(!h)await n.put(d);else{const m=new Date(d.updatedAt).getTime(),g=new Date(h.updatedAt).getTime();m>g&&await n.put(d)}}}static async readAll(){return{workouts:await G.workouts.toArray(),logs:await G.logs.toArray(),workoutTypes:await G.workoutTypes.toArray(),profile:(await G.profile.toArray())[0]}}}const es="gym_twa_data";var Ui;const an=(Ui=window.Telegram)==null?void 0:Ui.WebApp,vo={workoutTypes:[{id:"1",name:"ÐÐ¸Ð¼ Ð»ÐµÐ¶Ð°",updatedAt:new Date().toISOString()},{id:"2",name:"ÐÑÐ¸ÑÐµÐ´Ð°Ð½Ð¸Ñ",updatedAt:new Date().toISOString()},{id:"3",name:"Ð¡ÑÐ°Ð½Ð¾Ð²Ð°Ñ ÑÑÐ³Ð°",updatedAt:new Date().toISOString()}],logs:[],workouts:[]};class ns{constructor(){me(this,"onUpdateCallback");me(this,"onSyncStatusChangeCallback");me(this,"status","idle");me(this,"cache",{...vo});this.init()}async init(){await this.migrateFromLocalStorage(),this.sync().catch(console.error)}async migrateFromLocalStorage(){const n=localStorage.getItem(es);if(n)try{const o=JSON.parse(n);if(await G.workoutTypes.count()===0){console.log("Migrating from localStorage to IDB...");const c=new Date().toISOString(),d=(o.workoutTypes||vo.workoutTypes).map(g=>({...g,updatedAt:c}));await G.workoutTypes.bulkPut(d);const h=(o.logs||[]).map(g=>({...g,updatedAt:c,workoutId:g.workoutId||"legacy"}));await G.logs.bulkPut(h);const m=(o.workouts||[]).map(g=>({...g,updatedAt:c}));if(await G.workouts.bulkPut(m),o.profile){const g={...o.profile,id:"me",updatedAt:c};await G.profile.put(g)}}}catch(o){console.error("Migration failed",o)}else await G.workoutTypes.count()===0&&await G.workoutTypes.bulkPut(vo.workoutTypes)}onUpdate(n){this.onUpdateCallback=n}onSyncStatusChange(n){this.onSyncStatusChangeCallback=n}setStatus(n){var o;this.status=n,(o=this.onSyncStatusChangeCallback)==null||o.call(this,n),n==="success"&&setTimeout(()=>{this.status==="success"&&this.setStatus("idle")},2e3)}async sync(){var o;const n=localStorage.getItem("skip_tma_auth")==="true";if(n&&!Vi()){this.setStatus("idle");return}try{this.setStatus("saving"),await go.sync(),this.setStatus("success"),(o=this.onUpdateCallback)==null||o.call(this)}catch(s){if(console.error("Sync failed",s),(s instanceof Error?s.message:String(s)).toLowerCase().includes("unauthorized")){if(n){this.setStatus("error");return}localStorage.setItem("skip_tma_auth","true"),ts(),location.reload();return}s instanceof Error&&s.message==="Offline"?this.setStatus("idle"):this.setStatus("error")}}async reloadCache(){var n;this.cache=await go.readAll(),(n=this.onUpdateCallback)==null||n.call(this)}getWorkoutTypes(){return this.cache.workoutTypes.filter(o=>!o.isDeleted).sort((o,s)=>(o.order??1/0)-(s.order??1/0))}getLogs(){return this.cache.logs.filter(n=>!n.isDeleted)}getWorkouts(){return this.cache.workouts.filter(n=>!n.isDeleted)}getActiveWorkout(){return this.cache.workouts.find(n=>!n.isDeleted&&(n.status==="active"||n.status==="paused"))}getProfile(){return this.cache.profile}async addWorkoutType(n,o="strength"){const s=this.getWorkoutTypes(),c=s.length>0?Math.max(...s.map(h=>h.order??0)):0,d={id:Date.now().toString(),name:n,category:o,order:c+1,updatedAt:new Date().toISOString()};return await G.workoutTypes.put(d),await this.reloadCache(),this.sync().catch(()=>{}),d}async deleteWorkoutType(n){const o=await G.workoutTypes.get(n);o&&(o.isDeleted=!0,o.updatedAt=new Date().toISOString(),await G.workoutTypes.put(o),await this.reloadCache(),this.sync().catch(()=>{}))}async updateWorkoutType(n,o,s){const c=await G.workoutTypes.get(n);c&&(c.name=o,s&&(c.category=s),c.updatedAt=new Date().toISOString(),await G.workoutTypes.put(c),await this.reloadCache(),this.sync().catch(()=>{}))}async startWorkout(n){this.getActiveWorkout()&&await this.finishWorkout();const s={id:Date.now().toString(),startTime:new Date().toISOString(),status:"active",name:n,isManual:!0,pauseIntervals:[],updatedAt:new Date().toISOString()};return await G.workouts.put(s),await this.reloadCache(),this.sync().catch(()=>{}),s}async pauseWorkout(){const n=this.getActiveWorkout();n&&n.status==="active"&&(n.status="paused",n.pauseIntervals.push({start:new Date().toISOString()}),n.updatedAt=new Date().toISOString(),await G.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{}))}async resumeWorkout(){const n=this.getActiveWorkout();if(n&&n.status==="paused"){n.status="active";const o=n.pauseIntervals[n.pauseIntervals.length-1];o&&!o.end&&(o.end=new Date().toISOString()),n.updatedAt=new Date().toISOString(),await G.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}async finishWorkout(){const n=this.getActiveWorkout();if(n){n.status="finished",n.endTime=new Date().toISOString();const o=n.pauseIntervals[n.pauseIntervals.length-1];o&&!o.end&&(o.end=n.endTime),n.updatedAt=new Date().toISOString(),await G.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}getWorkoutDuration(n){const o=new Date(n.startTime).getTime(),s=n.endTime?new Date(n.endTime).getTime():Date.now();let c=s-o;n.pauseIntervals.forEach(g=>{const k=new Date(g.start).getTime(),O=g.end?new Date(g.end).getTime():n.status==="paused"?Date.now():s;O>k&&(c-=O-k)});const d=Math.floor(Math.max(0,c)/6e4),m=this.cache.logs.filter(g=>g.workoutId===n.id&&!g.isDeleted).reduce((g,k)=>g+(k.duration||0),0);return Math.max(d,m)}async ensureActiveWorkout(){const n=this.getActiveWorkout();if(n)return n.id;const o=new Date().toISOString().split("T")[0],d=this.getWorkouts().filter(g=>g.startTime.startsWith(o)).sort((g,k)=>new Date(k.startTime).getTime()-new Date(g.startTime).getTime())[0];if(d&&!d.isManual&&d.status==="finished")return d.endTime=new Date().toISOString(),d.updatedAt=new Date().toISOString(),await G.workouts.put(d),await this.reloadCache(),this.sync().catch(()=>{}),d.id;const h=`implicit_${o}_${Date.now()}`,m={id:h,startTime:new Date().toISOString(),endTime:new Date().toISOString(),status:"finished",isManual:!1,pauseIntervals:[],updatedAt:new Date().toISOString()};return await G.workouts.put(m),await this.reloadCache(),this.sync().catch(()=>{}),h}async updateImplicitWorkoutBounds(n){const o=await G.workouts.get(n);if(!o||o.isManual)return;const c=(await G.logs.where("workoutId").equals(n).toArray()).filter(h=>!h.isDeleted);if(c.length===0)return;const d=c.sort((h,m)=>new Date(h.date).getTime()-new Date(m.date).getTime());o.startTime=d[0].date,o.endTime=d[d.length-1].date,o.status="finished",o.updatedAt=new Date().toISOString(),await G.workouts.put(o)}async addLog(n){const o=await this.ensureActiveWorkout(),s={...n,id:Date.now().toString(),date:new Date().toISOString(),workoutId:o,updatedAt:new Date().toISOString()};return await G.logs.put(s),await this.updateImplicitWorkoutBounds(o),await this.reloadCache(),this.sync().catch(()=>{}),s}async deleteLog(n){const o=await G.logs.get(n);if(o){const s=o.workoutId;o.isDeleted=!0,o.updatedAt=new Date().toISOString(),await G.logs.put(o),s&&await this.updateImplicitWorkoutBounds(s),await this.reloadCache(),this.sync().catch(()=>{})}}async updateLog(n){const o={...n,updatedAt:new Date().toISOString()};await G.logs.put(o),await this.reloadCache(),this.sync().catch(()=>{})}getProfileIdentifier(){var s,c;const n=this.cache.profile;if(n!=null&&n.telegramUsername)return n.telegramUsername;if(n!=null&&n.telegramUserId)return`id_${n.telegramUserId}`;const o=(c=(s=an==null?void 0:an.initDataUnsafe)==null?void 0:s.user)==null?void 0:c.id;return o?`id_${o}`:""}async updateProfileSettings(n){var h;const o=(h=an==null?void 0:an.initDataUnsafe)==null?void 0:h.user,s=o==null?void 0:o.id;let c=this.cache.profile;c?o!=null&&o.photo_url&&(c.photoUrl=o.photo_url):c={id:"me",isPublic:!1,showFullHistory:!1,telegramUserId:s||0,telegramUsername:o==null?void 0:o.username,photoUrl:o==null?void 0:o.photo_url,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),friends:[]};const d={...c,...n,updatedAt:new Date().toISOString()};await G.profile.put(d),await this.reloadCache(),this.sync().catch(()=>{})}async addFriend(n){const o=this.cache.profile;if(!o)return;const s=o.friends||[];if(s.some(d=>d.identifier===n.identifier))return;const c={...n,addedAt:new Date().toISOString()};await this.updateProfileSettings({friends:[...s,c]})}async removeFriend(n){const o=this.cache.profile;if(!o||!o.friends)return;const s=o.friends.filter(c=>c.identifier!==n);await this.updateProfileSettings({friends:s})}isFriend(n){var s;const o=this.cache.profile;return((s=o==null?void 0:o.friends)==null?void 0:s.some(c=>c.identifier===n))??!1}async updateWorkoutTypeOrder(n){const o=n.map((s,c)=>{const d=this.cache.workoutTypes.find(h=>h.id===s);return d?{...d,order:c,updatedAt:new Date().toISOString()}:null}).filter(Boolean);o.length>0&&(await G.workoutTypes.bulkPut(o),await this.reloadCache(),this.sync().catch(()=>{}))}async getPublicProfile(n){try{const s=await fetch(`https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4?profile=${encodeURIComponent(n)}`);return s.ok?await s.json():null}catch{return null}}async exportData(){return await go.readAll()}async importData(n){if(!n.logs||!n.workoutTypes)throw new Error("Invalid data format");await G.transaction("rw",G.workouts,G.logs,G.workoutTypes,G.profile,async()=>{var o,s,c;await G.workouts.clear(),await G.logs.clear(),await G.workoutTypes.clear(),await G.profile.clear(),(o=n.workouts)!=null&&o.length&&await G.workouts.bulkAdd(n.workouts),(s=n.logs)!=null&&s.length&&await G.logs.bulkAdd(n.logs),(c=n.workoutTypes)!=null&&c.length&&await G.workoutTypes.bulkAdd(n.workoutTypes),n.profile&&await G.profile.put({...n.profile,id:"me"})}),await this.reloadCache(),this.sync().catch(()=>{})}}const H=new ns;H.reloadCache().then(()=>{});function rs(i=0,n=0){return n===1?i:Math.round(i*(1+n/30))}function os(i,n){const o=new Map;return i.filter(c=>c.workoutTypeId===n).forEach(c=>{const d=c.date.split("T")[0],h=rs(c.weight||0,c.reps||0),m=o.get(d)||0;h>m&&o.set(d,h)}),o}function is(i,n){const o=new Set;return i.forEach(s=>o.add(s.startTime.split("T")[0])),n.forEach(s=>o.add(s.date.split("T")[0])),o}function as(i){const n=i.filter(d=>d.endTime&&d.status==="finished");if(n.length===0)return{averageMinutes:0,totalMinutes:0,count:0};let o=0;n.forEach(d=>{const h=new Date(d.startTime).getTime(),m=new Date(d.endTime).getTime();let g=m-h;d.pauseIntervals&&d.pauseIntervals.forEach(k=>{const O=new Date(k.start).getTime(),P=k.end?new Date(k.end).getTime():m;g-=P-O}),o+=g});const s=Math.round(o/1e3/60);return{averageMinutes:Math.round(s/n.length),totalMinutes:s,count:n.length}}function Xi(i,n=6){const o=new Date,s=new Date(o);s.setMonth(o.getMonth()-n),s.setDate(s.getDate()-s.getDay());let c='<div class="heatmap-container"><div class="heatmap-grid">';const d=new Date(s),h=new Date(o);for(;d<=h;){const m=d.toISOString().split("T")[0],g=i.has(m),O=`heatmap-cell level-${g?4:0}`,P=`${m}: ${g?"Workout":"No workout"}`;c+=`<div class="${O}" title="${P}"></div>`,d.setDate(d.getDate()+1)}return c+="</div>",c+=`
        <div class="heatmap-legend">
            Less <div class="heatmap-cell level-0"></div>
            <div class="heatmap-cell level-4"></div> More
        </div>
    `,c+="</div>",c}function Ai(i){const n=new Map;i.forEach(c=>{const d=c.date.split("T")[0],h=(c.weight||0)*(c.reps||0);n.set(d,(n.get(d)||0)+h)});const o=Array.from(n.keys()).sort().slice(-10);if(o.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¾Ð±ÑÐµÐ¼Ð°</p>';const s=o.map(c=>({label:new Date(c).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:n.get(c)}));return ls(s,"ÐºÐ³")}function ss(i){const n=Array.from(i.keys()).sort();if(n.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° 1RM</p>';const o=n.map(s=>({label:new Date(s).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:i.get(s)}));return Gi(o,"ÐºÐ³")}function us(i){const n=i.filter(s=>s.status==="finished"&&s.endTime).sort((s,c)=>new Date(s.startTime).getTime()-new Date(c.startTime).getTime()).slice(-10);if(n.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÐ¸</p>';const o=n.map(s=>{const c=new Date(s.startTime).getTime(),d=new Date(s.endTime).getTime();let h=(d-c)/1e3/60;return s.pauseIntervals&&s.pauseIntervals.forEach(m=>{const g=new Date(m.start).getTime(),k=m.end?new Date(m.end).getTime():d;h-=(k-g)/1e3/60}),{label:new Date(s.startTime).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:Math.round(h)}});return Gi(o,"Ð¼Ð¸Ð½")}function ls(i,n){const c=Math.max(...i.map(h=>h.value))*1.1;return`
        <svg width="100%" height="150" preserveAspectRatio="none">
            ${i.map((h,m)=>{const g=h.value/c*100,k=m/i.length*100,O=1/i.length*80;return`
            <rect x="${k+5}%" y="${100-g}%" width="${O}%" height="${g}%" fill="var(--color-button)" rx="2" opacity="0.8">
               <title>${h.label}: ${h.value}${n}</title>
            </rect>
            <text x="${k+5+O/2}%" y="95%" font-size="10" text-anchor="middle" fill="var(--color-text)" style="pointer-events: none;">
                ${h.label}
            </text>
        `}).join("")}
        </svg>
    `}function Gi(i,n){const d=i.map(K=>K.value),h=Math.min(...d),m=Math.max(...d),g=m-h||1,k=K=>20+K/(i.length-1)*(400-2*20),O=K=>130-(K-h)/g*(150-2*20),P=i.map((K,F)=>`${k(F)},${O(K.value)}`).join(" "),N=i.map((K,F)=>`
        <circle cx="${k(F)}" cy="${O(K.value)}" r="4" fill="var(--color-bg)" stroke="var(--color-button)" stroke-width="2">
            <title>${K.label}: ${K.value}${n}</title>
        </circle>
    `).join("");return`
        <svg viewBox="0 0 400 150" class="chart">
             <polyline
                fill="none"
                stroke="var(--color-button)"
                stroke-width="3"
                stroke-linejoin="round"
                stroke-linecap="round"
                points="${P}"
            />
            ${N}
        </svg>
        <div style="display: flex; justify-content: space-between; margin-top: 4px; font-size: 12px; color: var(--color-hint);">
            <span>${Math.round(h)}${n}</span>
            <span>${Math.round(m)}${n}</span>
        </div>
    `}function cs(i,n){i.innerHTML=`
        <div class="page-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 24px;">ðï¸</div>
            <h1 class="title" style="margin-bottom: 12px;">ÐÐ¸Ð¼-Ð¶Ð¸Ð¼ 21</h1>
            <p class="subtitle" style="margin-bottom: 32px; opacity: 0.7;">ÐÐ¾Ð¹Ð´Ð¸ÑÐµ ÑÐµÑÐµÐ· Telegram, ÑÑÐ¾Ð±Ñ ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</p>
            <div id="telegram-login-container"></div>
        </div>
    `,window.onTelegramAuth=c=>{console.log("Telegram auth callback received:",c),Hi(c),localStorage.removeItem("skip_tma_auth"),n()};const o=document.createElement("script");o.src="https://telegram.org/js/telegram-widget.js?22",o.async=!0,o.setAttribute("data-telegram-login","gymgym21bot"),o.setAttribute("data-size","large"),o.setAttribute("data-radius","12"),o.setAttribute("data-onauth","onTelegramAuth(user)"),o.setAttribute("data-request-access","write");const s=document.getElementById("telegram-login-container");s&&s.appendChild(o)}const ds="modulepreload",fs=function(i,n){return new URL(i,n).href},Pi={},hs=function(n,o,s){let c=Promise.resolve();if(o&&o.length>0){const h=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),g=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));c=Promise.allSettled(o.map(k=>{if(k=fs(k,s),k in Pi)return;Pi[k]=!0;const O=k.endsWith(".css"),P=O?'[rel="stylesheet"]':"";if(!!s)for(let F=h.length-1;F>=0;F--){const Y=h[F];if(Y.href===k&&(!O||Y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${k}"]${P}`))return;const K=document.createElement("link");if(K.rel=O?"stylesheet":ds,O||(K.as="script"),K.crossOrigin="",K.href=k,g&&K.setAttribute("nonce",g),document.head.appendChild(K),O)return new Promise((F,Y)=>{K.addEventListener("load",F),K.addEventListener("error",()=>Y(new Error(`Unable to preload CSS for ${k}`)))})}))}function d(h){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=h,window.dispatchEvent(m),!m.defaultPrevented)throw h}return c.then(h=>{for(const m of h||[])m.status==="rejected"&&d(m.reason);return n().catch(d)})};function ps(i={}){const{immediate:n=!1,onNeedRefresh:o,onOfflineReady:s,onRegistered:c,onRegisteredSW:d,onRegisterError:h}=i;let m,g;const k=async(P=!0)=>{await g};async function O(){if("serviceWorker"in navigator){if(m=await hs(async()=>{const{Workbox:P}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:P}},[],import.meta.url).then(({Workbox:P})=>new P("./sw.js",{scope:"./",type:"classic"})).catch(P=>{h==null||h(P)}),!m)return;m.addEventListener("activated",P=>{(P.isUpdate||P.isExternal)&&window.location.reload()}),m.addEventListener("installed",P=>{P.isUpdate||s==null||s()}),m.register({immediate:n}).then(P=>{d?d("./sw.js",P):c==null||c(P)}).catch(P=>{h==null||h(P)})}}return g=O(),k}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ci(i,n){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(i,c).enumerable})),o.push.apply(o,s)}return o}function ce(i){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Ci(Object(o),!0).forEach(function(s){ms(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ci(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function vr(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vr=function(n){return typeof n}:vr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vr(i)}function ms(i,n,o){return n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i}function ve(){return ve=Object.assign||function(i){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i},ve.apply(this,arguments)}function gs(i,n){if(i==null)return{};var o={},s=Object.keys(i),c,d;for(d=0;d<s.length;d++)c=s[d],!(n.indexOf(c)>=0)&&(o[c]=i[c]);return o}function vs(i,n){if(i==null)return{};var o=gs(i,n),s,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(c=0;c<d.length;c++)s=d[c],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(o[s]=i[s])}return o}var ys="1.15.6";function ge(i){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(i)}var ye=ge(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Rn=ge(/Edge/i),$i=ge(/firefox/i),Cn=ge(/safari/i)&&!ge(/chrome/i)&&!ge(/android/i),Ro=ge(/iP(ad|od|hone)/i),Qi=ge(/chrome/i)&&ge(/android/i),Ji={capture:!1,passive:!1};function dt(i,n,o){i.addEventListener(n,o,!ye&&Ji)}function ut(i,n,o){i.removeEventListener(n,o,!ye&&Ji)}function Dr(i,n){if(n){if(n[0]===">"&&(n=n.substring(1)),i)try{if(i.matches)return i.matches(n);if(i.msMatchesSelector)return i.msMatchesSelector(n);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(n)}catch{return!1}return!1}}function Zi(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function re(i,n,o,s){if(i){o=o||document;do{if(n!=null&&(n[0]===">"?i.parentNode===o&&Dr(i,n):Dr(i,n))||s&&i===o)return i;if(i===o)break}while(i=Zi(i))}return null}var Mi=/\s+/g;function Vt(i,n,o){if(i&&n)if(i.classList)i.classList[o?"add":"remove"](n);else{var s=(" "+i.className+" ").replace(Mi," ").replace(" "+n+" "," ");i.className=(s+(o?" "+n:"")).replace(Mi," ")}}function Z(i,n,o){var s=i&&i.style;if(s){if(o===void 0)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(o=i.currentStyle),n===void 0?o:o[n];!(n in s)&&n.indexOf("webkit")===-1&&(n="-webkit-"+n),s[n]=o+(typeof o=="string"?"":"px")}}function fn(i,n){var o="";if(typeof i=="string")o=i;else do{var s=Z(i,"transform");s&&s!=="none"&&(o=s+" "+o)}while(!n&&(i=i.parentNode));var c=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return c&&new c(o)}function ta(i,n,o){if(i){var s=i.getElementsByTagName(n),c=0,d=s.length;if(o)for(;c<d;c++)o(s[c],c);return s}return[]}function le(){var i=document.scrollingElement;return i||document.documentElement}function Pt(i,n,o,s,c){if(!(!i.getBoundingClientRect&&i!==window)){var d,h,m,g,k,O,P;if(i!==window&&i.parentNode&&i!==le()?(d=i.getBoundingClientRect(),h=d.top,m=d.left,g=d.bottom,k=d.right,O=d.height,P=d.width):(h=0,m=0,g=window.innerHeight,k=window.innerWidth,O=window.innerHeight,P=window.innerWidth),(n||o)&&i!==window&&(c=c||i.parentNode,!ye))do if(c&&c.getBoundingClientRect&&(Z(c,"transform")!=="none"||o&&Z(c,"position")!=="static")){var N=c.getBoundingClientRect();h-=N.top+parseInt(Z(c,"border-top-width")),m-=N.left+parseInt(Z(c,"border-left-width")),g=h+d.height,k=m+d.width;break}while(c=c.parentNode);if(s&&i!==window){var K=fn(c||i),F=K&&K.a,Y=K&&K.d;K&&(h/=Y,m/=F,P/=F,O/=Y,g=h+O,k=m+P)}return{top:h,left:m,bottom:g,right:k,width:P,height:O}}}function ji(i,n,o){for(var s=Ae(i,!0),c=Pt(i)[n];s;){var d=Pt(s)[o],h=void 0;if(h=c>=d,!h)return s;if(s===le())break;s=Ae(s,!1)}return!1}function hn(i,n,o,s){for(var c=0,d=0,h=i.children;d<h.length;){if(h[d].style.display!=="none"&&h[d]!==tt.ghost&&(s||h[d]!==tt.dragged)&&re(h[d],o.draggable,i,!1)){if(c===n)return h[d];c++}d++}return null}function No(i,n){for(var o=i.lastElementChild;o&&(o===tt.ghost||Z(o,"display")==="none"||n&&!Dr(o,n));)o=o.previousElementSibling;return o||null}function Jt(i,n){var o=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==tt.clone&&(!n||Dr(i,n))&&o++;return o}function Li(i){var n=0,o=0,s=le();if(i)do{var c=fn(i),d=c.a,h=c.d;n+=i.scrollLeft*d,o+=i.scrollTop*h}while(i!==s&&(i=i.parentNode));return[n,o]}function bs(i,n){for(var o in i)if(i.hasOwnProperty(o)){for(var s in n)if(n.hasOwnProperty(s)&&n[s]===i[o][s])return Number(o)}return-1}function Ae(i,n){if(!i||!i.getBoundingClientRect)return le();var o=i,s=!1;do if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var c=Z(o);if(o.clientWidth<o.scrollWidth&&(c.overflowX=="auto"||c.overflowX=="scroll")||o.clientHeight<o.scrollHeight&&(c.overflowY=="auto"||c.overflowY=="scroll")){if(!o.getBoundingClientRect||o===document.body)return le();if(s||n)return o;s=!0}}while(o=o.parentNode);return le()}function ws(i,n){if(i&&n)for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o]);return i}function yo(i,n){return Math.round(i.top)===Math.round(n.top)&&Math.round(i.left)===Math.round(n.left)&&Math.round(i.height)===Math.round(n.height)&&Math.round(i.width)===Math.round(n.width)}var $n;function ea(i,n){return function(){if(!$n){var o=arguments,s=this;o.length===1?i.call(s,o[0]):i.apply(s,o),$n=setTimeout(function(){$n=void 0},n)}}}function _s(){clearTimeout($n),$n=void 0}function na(i,n,o){i.scrollLeft+=n,i.scrollTop+=o}function ra(i){var n=window.Polymer,o=window.jQuery||window.Zepto;return n&&n.dom?n.dom(i).cloneNode(!0):o?o(i).clone(!0)[0]:i.cloneNode(!0)}function oa(i,n,o){var s={};return Array.from(i.children).forEach(function(c){var d,h,m,g;if(!(!re(c,n.draggable,i,!1)||c.animated||c===o)){var k=Pt(c);s.left=Math.min((d=s.left)!==null&&d!==void 0?d:1/0,k.left),s.top=Math.min((h=s.top)!==null&&h!==void 0?h:1/0,k.top),s.right=Math.max((m=s.right)!==null&&m!==void 0?m:-1/0,k.right),s.bottom=Math.max((g=s.bottom)!==null&&g!==void 0?g:-1/0,k.bottom)}}),s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}var Ft="Sortable"+new Date().getTime();function ks(){var i=[],n;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var s=[].slice.call(this.el.children);s.forEach(function(c){if(!(Z(c,"display")==="none"||c===tt.ghost)){i.push({target:c,rect:Pt(c)});var d=ce({},i[i.length-1].rect);if(c.thisAnimationDuration){var h=fn(c,!0);h&&(d.top-=h.f,d.left-=h.e)}c.fromRect=d}})}},addAnimationState:function(s){i.push(s)},removeAnimationState:function(s){i.splice(bs(i,{target:s}),1)},animateAll:function(s){var c=this;if(!this.options.animation){clearTimeout(n),typeof s=="function"&&s();return}var d=!1,h=0;i.forEach(function(m){var g=0,k=m.target,O=k.fromRect,P=Pt(k),N=k.prevFromRect,K=k.prevToRect,F=m.rect,Y=fn(k,!0);Y&&(P.top-=Y.f,P.left-=Y.e),k.toRect=P,k.thisAnimationDuration&&yo(N,P)&&!yo(O,P)&&(F.top-P.top)/(F.left-P.left)===(O.top-P.top)/(O.left-P.left)&&(g=Es(F,N,K,c.options)),yo(P,O)||(k.prevFromRect=O,k.prevToRect=P,g||(g=c.options.animation),c.animate(k,F,P,g)),g&&(d=!0,h=Math.max(h,g),clearTimeout(k.animationResetTimer),k.animationResetTimer=setTimeout(function(){k.animationTime=0,k.prevFromRect=null,k.fromRect=null,k.prevToRect=null,k.thisAnimationDuration=null},g),k.thisAnimationDuration=g)}),clearTimeout(n),d?n=setTimeout(function(){typeof s=="function"&&s()},h):typeof s=="function"&&s(),i=[]},animate:function(s,c,d,h){if(h){Z(s,"transition",""),Z(s,"transform","");var m=fn(this.el),g=m&&m.a,k=m&&m.d,O=(c.left-d.left)/(g||1),P=(c.top-d.top)/(k||1);s.animatingX=!!O,s.animatingY=!!P,Z(s,"transform","translate3d("+O+"px,"+P+"px,0)"),this.forRepaintDummy=Ss(s),Z(s,"transition","transform "+h+"ms"+(this.options.easing?" "+this.options.easing:"")),Z(s,"transform","translate3d(0,0,0)"),typeof s.animated=="number"&&clearTimeout(s.animated),s.animated=setTimeout(function(){Z(s,"transition",""),Z(s,"transform",""),s.animated=!1,s.animatingX=!1,s.animatingY=!1},h)}}}}function Ss(i){return i.offsetWidth}function Es(i,n,o,s){return Math.sqrt(Math.pow(n.top-i.top,2)+Math.pow(n.left-i.left,2))/Math.sqrt(Math.pow(n.top-o.top,2)+Math.pow(n.left-o.left,2))*s.animation}var sn=[],bo={initializeByDefault:!0},Nn={mount:function(n){for(var o in bo)bo.hasOwnProperty(o)&&!(o in n)&&(n[o]=bo[o]);sn.forEach(function(s){if(s.pluginName===n.pluginName)throw"Sortable: Cannot mount plugin ".concat(n.pluginName," more than once")}),sn.push(n)},pluginEvent:function(n,o,s){var c=this;this.eventCanceled=!1,s.cancel=function(){c.eventCanceled=!0};var d=n+"Global";sn.forEach(function(h){o[h.pluginName]&&(o[h.pluginName][d]&&o[h.pluginName][d](ce({sortable:o},s)),o.options[h.pluginName]&&o[h.pluginName][n]&&o[h.pluginName][n](ce({sortable:o},s)))})},initializePlugins:function(n,o,s,c){sn.forEach(function(m){var g=m.pluginName;if(!(!n.options[g]&&!m.initializeByDefault)){var k=new m(n,o,n.options);k.sortable=n,k.options=n.options,n[g]=k,ve(s,k.defaults)}});for(var d in n.options)if(n.options.hasOwnProperty(d)){var h=this.modifyOption(n,d,n.options[d]);typeof h<"u"&&(n.options[d]=h)}},getEventProperties:function(n,o){var s={};return sn.forEach(function(c){typeof c.eventProperties=="function"&&ve(s,c.eventProperties.call(o[c.pluginName],n))}),s},modifyOption:function(n,o,s){var c;return sn.forEach(function(d){n[d.pluginName]&&d.optionListeners&&typeof d.optionListeners[o]=="function"&&(c=d.optionListeners[o].call(n[d.pluginName],s))}),c}};function Ds(i){var n=i.sortable,o=i.rootEl,s=i.name,c=i.targetEl,d=i.cloneEl,h=i.toEl,m=i.fromEl,g=i.oldIndex,k=i.newIndex,O=i.oldDraggableIndex,P=i.newDraggableIndex,N=i.originalEvent,K=i.putSortable,F=i.extraEventProperties;if(n=n||o&&o[Ft],!!n){var Y,J=n.options,nt="on"+s.charAt(0).toUpperCase()+s.substr(1);window.CustomEvent&&!ye&&!Rn?Y=new CustomEvent(s,{bubbles:!0,cancelable:!0}):(Y=document.createEvent("Event"),Y.initEvent(s,!0,!0)),Y.to=h||o,Y.from=m||o,Y.item=c||o,Y.clone=d,Y.oldIndex=g,Y.newIndex=k,Y.oldDraggableIndex=O,Y.newDraggableIndex=P,Y.originalEvent=N,Y.pullMode=K?K.lastPutMode:void 0;var ot=ce(ce({},F),Nn.getEventProperties(s,n));for(var et in ot)Y[et]=ot[et];o&&o.dispatchEvent(Y),J[nt]&&J[nt].call(n,Y)}}var xs=["evt"],Bt=function(n,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=s.evt,d=vs(s,xs);Nn.pluginEvent.bind(tt)(n,o,ce({dragEl:R,parentEl:xt,ghostEl:rt,rootEl:_t,nextEl:We,lastDownEl:yr,cloneEl:St,cloneHidden:Ie,dragStarted:In,putSortable:jt,activeSortable:tt.active,originalEvent:c,oldIndex:cn,oldDraggableIndex:Mn,newIndex:Xt,newDraggableIndex:Te,hideGhostForTarget:ua,unhideGhostForTarget:la,cloneNowHidden:function(){Ie=!0},cloneNowShown:function(){Ie=!1},dispatchSortableEvent:function(m){Nt({sortable:o,name:m,originalEvent:c})}},d))};function Nt(i){Ds(ce({putSortable:jt,cloneEl:St,targetEl:R,rootEl:_t,oldIndex:cn,oldDraggableIndex:Mn,newIndex:Xt,newDraggableIndex:Te},i))}var R,xt,rt,_t,We,yr,St,Ie,cn,Xt,Mn,Te,fr,jt,ln=!1,xr=!1,Tr=[],qe,ne,wo,_o,Ri,Ni,In,un,jn,Ln=!1,hr=!1,br,Rt,ko=[],Oo=!1,Ir=[],Cr=typeof document<"u",pr=Ro,Ki=Rn||ye?"cssFloat":"float",Ts=Cr&&!Qi&&!Ro&&"draggable"in document.createElement("div"),ia=function(){if(Cr){if(ye)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),aa=function(n,o){var s=Z(n),c=parseInt(s.width)-parseInt(s.paddingLeft)-parseInt(s.paddingRight)-parseInt(s.borderLeftWidth)-parseInt(s.borderRightWidth),d=hn(n,0,o),h=hn(n,1,o),m=d&&Z(d),g=h&&Z(h),k=m&&parseInt(m.marginLeft)+parseInt(m.marginRight)+Pt(d).width,O=g&&parseInt(g.marginLeft)+parseInt(g.marginRight)+Pt(h).width;if(s.display==="flex")return s.flexDirection==="column"||s.flexDirection==="column-reverse"?"vertical":"horizontal";if(s.display==="grid")return s.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(d&&m.float&&m.float!=="none"){var P=m.float==="left"?"left":"right";return h&&(g.clear==="both"||g.clear===P)?"vertical":"horizontal"}return d&&(m.display==="block"||m.display==="flex"||m.display==="table"||m.display==="grid"||k>=c&&s[Ki]==="none"||h&&s[Ki]==="none"&&k+O>c)?"vertical":"horizontal"},Is=function(n,o,s){var c=s?n.left:n.top,d=s?n.right:n.bottom,h=s?n.width:n.height,m=s?o.left:o.top,g=s?o.right:o.bottom,k=s?o.width:o.height;return c===m||d===g||c+h/2===m+k/2},Os=function(n,o){var s;return Tr.some(function(c){var d=c[Ft].options.emptyInsertThreshold;if(!(!d||No(c))){var h=Pt(c),m=n>=h.left-d&&n<=h.right+d,g=o>=h.top-d&&o<=h.bottom+d;if(m&&g)return s=c}}),s},sa=function(n){function o(d,h){return function(m,g,k,O){var P=m.options.group.name&&g.options.group.name&&m.options.group.name===g.options.group.name;if(d==null&&(h||P))return!0;if(d==null||d===!1)return!1;if(h&&d==="clone")return d;if(typeof d=="function")return o(d(m,g,k,O),h)(m,g,k,O);var N=(h?m:g).options.group.name;return d===!0||typeof d=="string"&&d===N||d.join&&d.indexOf(N)>-1}}var s={},c=n.group;(!c||vr(c)!="object")&&(c={name:c}),s.name=c.name,s.checkPull=o(c.pull,!0),s.checkPut=o(c.put),s.revertClone=c.revertClone,n.group=s},ua=function(){!ia&&rt&&Z(rt,"display","none")},la=function(){!ia&&rt&&Z(rt,"display","")};Cr&&!Qi&&document.addEventListener("click",function(i){if(xr)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),xr=!1,!1},!0);var Fe=function(n){if(R){n=n.touches?n.touches[0]:n;var o=Os(n.clientX,n.clientY);if(o){var s={};for(var c in n)n.hasOwnProperty(c)&&(s[c]=n[c]);s.target=s.rootEl=o,s.preventDefault=void 0,s.stopPropagation=void 0,o[Ft]._onDragOver(s)}}},As=function(n){R&&R.parentNode[Ft]._isOutsideThisEl(n.target)};function tt(i,n){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=n=ve({},n),i[Ft]=this;var o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return aa(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(h,m){h.setData("Text",m.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:tt.supportPointer!==!1&&"PointerEvent"in window&&(!Cn||Ro),emptyInsertThreshold:5};Nn.initializePlugins(this,i,o);for(var s in o)!(s in n)&&(n[s]=o[s]);sa(n);for(var c in this)c.charAt(0)==="_"&&typeof this[c]=="function"&&(this[c]=this[c].bind(this));this.nativeDraggable=n.forceFallback?!1:Ts,this.nativeDraggable&&(this.options.touchStartThreshold=1),n.supportPointer?dt(i,"pointerdown",this._onTapStart):(dt(i,"mousedown",this._onTapStart),dt(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(dt(i,"dragover",this),dt(i,"dragenter",this)),Tr.push(this.el),n.store&&n.store.get&&this.sort(n.store.get(this)||[]),ve(this,ks())}tt.prototype={constructor:tt,_isOutsideThisEl:function(n){!this.el.contains(n)&&n!==this.el&&(un=null)},_getDirection:function(n,o){return typeof this.options.direction=="function"?this.options.direction.call(this,n,o,R):this.options.direction},_onTapStart:function(n){if(n.cancelable){var o=this,s=this.el,c=this.options,d=c.preventOnFilter,h=n.type,m=n.touches&&n.touches[0]||n.pointerType&&n.pointerType==="touch"&&n,g=(m||n).target,k=n.target.shadowRoot&&(n.path&&n.path[0]||n.composedPath&&n.composedPath()[0])||g,O=c.filter;if(Ns(s),!R&&!(/mousedown|pointerdown/.test(h)&&n.button!==0||c.disabled)&&!k.isContentEditable&&!(!this.nativeDraggable&&Cn&&g&&g.tagName.toUpperCase()==="SELECT")&&(g=re(g,c.draggable,s,!1),!(g&&g.animated)&&yr!==g)){if(cn=Jt(g),Mn=Jt(g,c.draggable),typeof O=="function"){if(O.call(this,n,g,this)){Nt({sortable:o,rootEl:k,name:"filter",targetEl:g,toEl:s,fromEl:s}),Bt("filter",o,{evt:n}),d&&n.preventDefault();return}}else if(O&&(O=O.split(",").some(function(P){if(P=re(k,P.trim(),s,!1),P)return Nt({sortable:o,rootEl:P,name:"filter",targetEl:g,fromEl:s,toEl:s}),Bt("filter",o,{evt:n}),!0}),O)){d&&n.preventDefault();return}c.handle&&!re(k,c.handle,s,!1)||this._prepareDragStart(n,m,g)}}},_prepareDragStart:function(n,o,s){var c=this,d=c.el,h=c.options,m=d.ownerDocument,g;if(s&&!R&&s.parentNode===d){var k=Pt(s);if(_t=d,R=s,xt=R.parentNode,We=R.nextSibling,yr=s,fr=h.group,tt.dragged=R,qe={target:R,clientX:(o||n).clientX,clientY:(o||n).clientY},Ri=qe.clientX-k.left,Ni=qe.clientY-k.top,this._lastX=(o||n).clientX,this._lastY=(o||n).clientY,R.style["will-change"]="all",g=function(){if(Bt("delayEnded",c,{evt:n}),tt.eventCanceled){c._onDrop();return}c._disableDelayedDragEvents(),!$i&&c.nativeDraggable&&(R.draggable=!0),c._triggerDragStart(n,o),Nt({sortable:c,name:"choose",originalEvent:n}),Vt(R,h.chosenClass,!0)},h.ignore.split(",").forEach(function(O){ta(R,O.trim(),So)}),dt(m,"dragover",Fe),dt(m,"mousemove",Fe),dt(m,"touchmove",Fe),h.supportPointer?(dt(m,"pointerup",c._onDrop),!this.nativeDraggable&&dt(m,"pointercancel",c._onDrop)):(dt(m,"mouseup",c._onDrop),dt(m,"touchend",c._onDrop),dt(m,"touchcancel",c._onDrop)),$i&&this.nativeDraggable&&(this.options.touchStartThreshold=4,R.draggable=!0),Bt("delayStart",this,{evt:n}),h.delay&&(!h.delayOnTouchOnly||o)&&(!this.nativeDraggable||!(Rn||ye))){if(tt.eventCanceled){this._onDrop();return}h.supportPointer?(dt(m,"pointerup",c._disableDelayedDrag),dt(m,"pointercancel",c._disableDelayedDrag)):(dt(m,"mouseup",c._disableDelayedDrag),dt(m,"touchend",c._disableDelayedDrag),dt(m,"touchcancel",c._disableDelayedDrag)),dt(m,"mousemove",c._delayedDragTouchMoveHandler),dt(m,"touchmove",c._delayedDragTouchMoveHandler),h.supportPointer&&dt(m,"pointermove",c._delayedDragTouchMoveHandler),c._dragStartTimer=setTimeout(g,h.delay)}else g()}},_delayedDragTouchMoveHandler:function(n){var o=n.touches?n.touches[0]:n;Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){R&&So(R),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var n=this.el.ownerDocument;ut(n,"mouseup",this._disableDelayedDrag),ut(n,"touchend",this._disableDelayedDrag),ut(n,"touchcancel",this._disableDelayedDrag),ut(n,"pointerup",this._disableDelayedDrag),ut(n,"pointercancel",this._disableDelayedDrag),ut(n,"mousemove",this._delayedDragTouchMoveHandler),ut(n,"touchmove",this._delayedDragTouchMoveHandler),ut(n,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(n,o){o=o||n.pointerType=="touch"&&n,!this.nativeDraggable||o?this.options.supportPointer?dt(document,"pointermove",this._onTouchMove):o?dt(document,"touchmove",this._onTouchMove):dt(document,"mousemove",this._onTouchMove):(dt(R,"dragend",this),dt(_t,"dragstart",this._onDragStart));try{document.selection?wr(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(n,o){if(ln=!1,_t&&R){Bt("dragStarted",this,{evt:o}),this.nativeDraggable&&dt(document,"dragover",As);var s=this.options;!n&&Vt(R,s.dragClass,!1),Vt(R,s.ghostClass,!0),tt.active=this,n&&this._appendGhost(),Nt({sortable:this,name:"start",originalEvent:o})}else this._nulling()},_emulateDragOver:function(){if(ne){this._lastX=ne.clientX,this._lastY=ne.clientY,ua();for(var n=document.elementFromPoint(ne.clientX,ne.clientY),o=n;n&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(ne.clientX,ne.clientY),n!==o);)o=n;if(R.parentNode[Ft]._isOutsideThisEl(n),o)do{if(o[Ft]){var s=void 0;if(s=o[Ft]._onDragOver({clientX:ne.clientX,clientY:ne.clientY,target:n,rootEl:o}),s&&!this.options.dragoverBubble)break}n=o}while(o=Zi(o));la()}},_onTouchMove:function(n){if(qe){var o=this.options,s=o.fallbackTolerance,c=o.fallbackOffset,d=n.touches?n.touches[0]:n,h=rt&&fn(rt,!0),m=rt&&h&&h.a,g=rt&&h&&h.d,k=pr&&Rt&&Li(Rt),O=(d.clientX-qe.clientX+c.x)/(m||1)+(k?k[0]-ko[0]:0)/(m||1),P=(d.clientY-qe.clientY+c.y)/(g||1)+(k?k[1]-ko[1]:0)/(g||1);if(!tt.active&&!ln){if(s&&Math.max(Math.abs(d.clientX-this._lastX),Math.abs(d.clientY-this._lastY))<s)return;this._onDragStart(n,!0)}if(rt){h?(h.e+=O-(wo||0),h.f+=P-(_o||0)):h={a:1,b:0,c:0,d:1,e:O,f:P};var N="matrix(".concat(h.a,",").concat(h.b,",").concat(h.c,",").concat(h.d,",").concat(h.e,",").concat(h.f,")");Z(rt,"webkitTransform",N),Z(rt,"mozTransform",N),Z(rt,"msTransform",N),Z(rt,"transform",N),wo=O,_o=P,ne=d}n.cancelable&&n.preventDefault()}},_appendGhost:function(){if(!rt){var n=this.options.fallbackOnBody?document.body:_t,o=Pt(R,!0,pr,!0,n),s=this.options;if(pr){for(Rt=n;Z(Rt,"position")==="static"&&Z(Rt,"transform")==="none"&&Rt!==document;)Rt=Rt.parentNode;Rt!==document.body&&Rt!==document.documentElement?(Rt===document&&(Rt=le()),o.top+=Rt.scrollTop,o.left+=Rt.scrollLeft):Rt=le(),ko=Li(Rt)}rt=R.cloneNode(!0),Vt(rt,s.ghostClass,!1),Vt(rt,s.fallbackClass,!0),Vt(rt,s.dragClass,!0),Z(rt,"transition",""),Z(rt,"transform",""),Z(rt,"box-sizing","border-box"),Z(rt,"margin",0),Z(rt,"top",o.top),Z(rt,"left",o.left),Z(rt,"width",o.width),Z(rt,"height",o.height),Z(rt,"opacity","0.8"),Z(rt,"position",pr?"absolute":"fixed"),Z(rt,"zIndex","100000"),Z(rt,"pointerEvents","none"),tt.ghost=rt,n.appendChild(rt),Z(rt,"transform-origin",Ri/parseInt(rt.style.width)*100+"% "+Ni/parseInt(rt.style.height)*100+"%")}},_onDragStart:function(n,o){var s=this,c=n.dataTransfer,d=s.options;if(Bt("dragStart",this,{evt:n}),tt.eventCanceled){this._onDrop();return}Bt("setupClone",this),tt.eventCanceled||(St=ra(R),St.removeAttribute("id"),St.draggable=!1,St.style["will-change"]="",this._hideClone(),Vt(St,this.options.chosenClass,!1),tt.clone=St),s.cloneId=wr(function(){Bt("clone",s),!tt.eventCanceled&&(s.options.removeCloneOnHide||_t.insertBefore(St,R),s._hideClone(),Nt({sortable:s,name:"clone"}))}),!o&&Vt(R,d.dragClass,!0),o?(xr=!0,s._loopId=setInterval(s._emulateDragOver,50)):(ut(document,"mouseup",s._onDrop),ut(document,"touchend",s._onDrop),ut(document,"touchcancel",s._onDrop),c&&(c.effectAllowed="move",d.setData&&d.setData.call(s,c,R)),dt(document,"drop",s),Z(R,"transform","translateZ(0)")),ln=!0,s._dragStartId=wr(s._dragStarted.bind(s,o,n)),dt(document,"selectstart",s),In=!0,window.getSelection().removeAllRanges(),Cn&&Z(document.body,"user-select","none")},_onDragOver:function(n){var o=this.el,s=n.target,c,d,h,m=this.options,g=m.group,k=tt.active,O=fr===g,P=m.sort,N=jt||k,K,F=this,Y=!1;if(Oo)return;function J(Yt,be){Bt(Yt,F,ce({evt:n,isOwner:O,axis:K?"vertical":"horizontal",revert:h,dragRect:c,targetRect:d,canSort:P,fromSortable:N,target:s,completed:ot,onMove:function(He,ee){return mr(_t,o,R,c,He,Pt(He),n,ee)},changed:et},be))}function nt(){J("dragOverAnimationCapture"),F.captureAnimationState(),F!==N&&N.captureAnimationState()}function ot(Yt){return J("dragOverCompleted",{insertion:Yt}),Yt&&(O?k._hideClone():k._showClone(F),F!==N&&(Vt(R,jt?jt.options.ghostClass:k.options.ghostClass,!1),Vt(R,m.ghostClass,!0)),jt!==F&&F!==tt.active?jt=F:F===tt.active&&jt&&(jt=null),N===F&&(F._ignoreWhileAnimating=s),F.animateAll(function(){J("dragOverAnimationComplete"),F._ignoreWhileAnimating=null}),F!==N&&(N.animateAll(),N._ignoreWhileAnimating=null)),(s===R&&!R.animated||s===o&&!s.animated)&&(un=null),!m.dragoverBubble&&!n.rootEl&&s!==document&&(R.parentNode[Ft]._isOutsideThisEl(n.target),!Yt&&Fe(n)),!m.dragoverBubble&&n.stopPropagation&&n.stopPropagation(),Y=!0}function et(){Xt=Jt(R),Te=Jt(R,m.draggable),Nt({sortable:F,name:"change",toEl:o,newIndex:Xt,newDraggableIndex:Te,originalEvent:n})}if(n.preventDefault!==void 0&&n.cancelable&&n.preventDefault(),s=re(s,m.draggable,o,!0),J("dragOver"),tt.eventCanceled)return Y;if(R.contains(n.target)||s.animated&&s.animatingX&&s.animatingY||F._ignoreWhileAnimating===s)return ot(!1);if(xr=!1,k&&!m.disabled&&(O?P||(h=xt!==_t):jt===this||(this.lastPutMode=fr.checkPull(this,k,R,n))&&g.checkPut(this,k,R,n))){if(K=this._getDirection(n,s)==="vertical",c=Pt(R),J("dragOverValid"),tt.eventCanceled)return Y;if(h)return xt=_t,nt(),this._hideClone(),J("revert"),tt.eventCanceled||(We?_t.insertBefore(R,We):_t.appendChild(R)),ot(!0);var V=No(o,m.draggable);if(!V||Ms(n,K,this)&&!V.animated){if(V===R)return ot(!1);if(V&&o===n.target&&(s=V),s&&(d=Pt(s)),mr(_t,o,R,c,s,d,n,!!s)!==!1)return nt(),V&&V.nextSibling?o.insertBefore(R,V.nextSibling):o.appendChild(R),xt=o,et(),ot(!0)}else if(V&&$s(n,K,this)){var lt=hn(o,0,m,!0);if(lt===R)return ot(!1);if(s=lt,d=Pt(s),mr(_t,o,R,c,s,d,n,!1)!==!1)return nt(),o.insertBefore(R,lt),xt=o,et(),ot(!0)}else if(s.parentNode===o){d=Pt(s);var mt=0,st,it=R.parentNode!==o,vt=!Is(R.animated&&R.toRect||c,s.animated&&s.toRect||d,K),Zt=K?"top":"left",Ut=ji(s,"top","top")||ji(R,"top","top"),te=Ut?Ut.scrollTop:void 0;un!==s&&(st=d[Zt],Ln=!1,hr=!vt&&m.invertSwap||it),mt=js(n,s,d,K,vt?1:m.swapThreshold,m.invertedSwapThreshold==null?m.swapThreshold:m.invertedSwapThreshold,hr,un===s);var Mt;if(mt!==0){var de=Jt(R);do de-=mt,Mt=xt.children[de];while(Mt&&(Z(Mt,"display")==="none"||Mt===rt))}if(mt===0||Mt===s)return ot(!1);un=s,jn=mt;var fe=s.nextElementSibling,Gt=!1;Gt=mt===1;var ze=mr(_t,o,R,c,s,d,n,Gt);if(ze!==!1)return(ze===1||ze===-1)&&(Gt=ze===1),Oo=!0,setTimeout(Cs,30),nt(),Gt&&!fe?o.appendChild(R):s.parentNode.insertBefore(R,Gt?fe:s),Ut&&na(Ut,0,te-Ut.scrollTop),xt=R.parentNode,st!==void 0&&!hr&&(br=Math.abs(st-Pt(s)[Zt])),et(),ot(!0)}if(o.contains(R))return ot(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){ut(document,"mousemove",this._onTouchMove),ut(document,"touchmove",this._onTouchMove),ut(document,"pointermove",this._onTouchMove),ut(document,"dragover",Fe),ut(document,"mousemove",Fe),ut(document,"touchmove",Fe)},_offUpEvents:function(){var n=this.el.ownerDocument;ut(n,"mouseup",this._onDrop),ut(n,"touchend",this._onDrop),ut(n,"pointerup",this._onDrop),ut(n,"pointercancel",this._onDrop),ut(n,"touchcancel",this._onDrop),ut(document,"selectstart",this)},_onDrop:function(n){var o=this.el,s=this.options;if(Xt=Jt(R),Te=Jt(R,s.draggable),Bt("drop",this,{evt:n}),xt=R&&R.parentNode,Xt=Jt(R),Te=Jt(R,s.draggable),tt.eventCanceled){this._nulling();return}ln=!1,hr=!1,Ln=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ao(this.cloneId),Ao(this._dragStartId),this.nativeDraggable&&(ut(document,"drop",this),ut(o,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Cn&&Z(document.body,"user-select",""),Z(R,"transform",""),n&&(In&&(n.cancelable&&n.preventDefault(),!s.dropBubble&&n.stopPropagation()),rt&&rt.parentNode&&rt.parentNode.removeChild(rt),(_t===xt||jt&&jt.lastPutMode!=="clone")&&St&&St.parentNode&&St.parentNode.removeChild(St),R&&(this.nativeDraggable&&ut(R,"dragend",this),So(R),R.style["will-change"]="",In&&!ln&&Vt(R,jt?jt.options.ghostClass:this.options.ghostClass,!1),Vt(R,this.options.chosenClass,!1),Nt({sortable:this,name:"unchoose",toEl:xt,newIndex:null,newDraggableIndex:null,originalEvent:n}),_t!==xt?(Xt>=0&&(Nt({rootEl:xt,name:"add",toEl:xt,fromEl:_t,originalEvent:n}),Nt({sortable:this,name:"remove",toEl:xt,originalEvent:n}),Nt({rootEl:xt,name:"sort",toEl:xt,fromEl:_t,originalEvent:n}),Nt({sortable:this,name:"sort",toEl:xt,originalEvent:n})),jt&&jt.save()):Xt!==cn&&Xt>=0&&(Nt({sortable:this,name:"update",toEl:xt,originalEvent:n}),Nt({sortable:this,name:"sort",toEl:xt,originalEvent:n})),tt.active&&((Xt==null||Xt===-1)&&(Xt=cn,Te=Mn),Nt({sortable:this,name:"end",toEl:xt,originalEvent:n}),this.save()))),this._nulling()},_nulling:function(){Bt("nulling",this),_t=R=xt=rt=We=St=yr=Ie=qe=ne=In=Xt=Te=cn=Mn=un=jn=jt=fr=tt.dragged=tt.ghost=tt.clone=tt.active=null,Ir.forEach(function(n){n.checked=!0}),Ir.length=wo=_o=0},handleEvent:function(n){switch(n.type){case"drop":case"dragend":this._onDrop(n);break;case"dragenter":case"dragover":R&&(this._onDragOver(n),Ps(n));break;case"selectstart":n.preventDefault();break}},toArray:function(){for(var n=[],o,s=this.el.children,c=0,d=s.length,h=this.options;c<d;c++)o=s[c],re(o,h.draggable,this.el,!1)&&n.push(o.getAttribute(h.dataIdAttr)||Rs(o));return n},sort:function(n,o){var s={},c=this.el;this.toArray().forEach(function(d,h){var m=c.children[h];re(m,this.options.draggable,c,!1)&&(s[d]=m)},this),o&&this.captureAnimationState(),n.forEach(function(d){s[d]&&(c.removeChild(s[d]),c.appendChild(s[d]))}),o&&this.animateAll()},save:function(){var n=this.options.store;n&&n.set&&n.set(this)},closest:function(n,o){return re(n,o||this.options.draggable,this.el,!1)},option:function(n,o){var s=this.options;if(o===void 0)return s[n];var c=Nn.modifyOption(this,n,o);typeof c<"u"?s[n]=c:s[n]=o,n==="group"&&sa(s)},destroy:function(){Bt("destroy",this);var n=this.el;n[Ft]=null,ut(n,"mousedown",this._onTapStart),ut(n,"touchstart",this._onTapStart),ut(n,"pointerdown",this._onTapStart),this.nativeDraggable&&(ut(n,"dragover",this),ut(n,"dragenter",this)),Array.prototype.forEach.call(n.querySelectorAll("[draggable]"),function(o){o.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Tr.splice(Tr.indexOf(this.el),1),this.el=n=null},_hideClone:function(){if(!Ie){if(Bt("hideClone",this),tt.eventCanceled)return;Z(St,"display","none"),this.options.removeCloneOnHide&&St.parentNode&&St.parentNode.removeChild(St),Ie=!0}},_showClone:function(n){if(n.lastPutMode!=="clone"){this._hideClone();return}if(Ie){if(Bt("showClone",this),tt.eventCanceled)return;R.parentNode==_t&&!this.options.group.revertClone?_t.insertBefore(St,R):We?_t.insertBefore(St,We):_t.appendChild(St),this.options.group.revertClone&&this.animate(R,St),Z(St,"display",""),Ie=!1}}};function Ps(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function mr(i,n,o,s,c,d,h,m){var g,k=i[Ft],O=k.options.onMove,P;return window.CustomEvent&&!ye&&!Rn?g=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(g=document.createEvent("Event"),g.initEvent("move",!0,!0)),g.to=n,g.from=i,g.dragged=o,g.draggedRect=s,g.related=c||n,g.relatedRect=d||Pt(n),g.willInsertAfter=m,g.originalEvent=h,i.dispatchEvent(g),O&&(P=O.call(k,g,h)),P}function So(i){i.draggable=!1}function Cs(){Oo=!1}function $s(i,n,o){var s=Pt(hn(o.el,0,o.options,!0)),c=oa(o.el,o.options,rt),d=10;return n?i.clientX<c.left-d||i.clientY<s.top&&i.clientX<s.right:i.clientY<c.top-d||i.clientY<s.bottom&&i.clientX<s.left}function Ms(i,n,o){var s=Pt(No(o.el,o.options.draggable)),c=oa(o.el,o.options,rt),d=10;return n?i.clientX>c.right+d||i.clientY>s.bottom&&i.clientX>s.left:i.clientY>c.bottom+d||i.clientX>s.right&&i.clientY>s.top}function js(i,n,o,s,c,d,h,m){var g=s?i.clientY:i.clientX,k=s?o.height:o.width,O=s?o.top:o.left,P=s?o.bottom:o.right,N=!1;if(!h){if(m&&br<k*c){if(!Ln&&(jn===1?g>O+k*d/2:g<P-k*d/2)&&(Ln=!0),Ln)N=!0;else if(jn===1?g<O+br:g>P-br)return-jn}else if(g>O+k*(1-c)/2&&g<P-k*(1-c)/2)return Ls(n)}return N=N||h,N&&(g<O+k*d/2||g>P-k*d/2)?g>O+k/2?1:-1:0}function Ls(i){return Jt(R)<Jt(i)?1:-1}function Rs(i){for(var n=i.tagName+i.className+i.src+i.href+i.textContent,o=n.length,s=0;o--;)s+=n.charCodeAt(o);return s.toString(36)}function Ns(i){Ir.length=0;for(var n=i.getElementsByTagName("input"),o=n.length;o--;){var s=n[o];s.checked&&Ir.push(s)}}function wr(i){return setTimeout(i,0)}function Ao(i){return clearTimeout(i)}Cr&&dt(document,"touchmove",function(i){(tt.active||ln)&&i.cancelable&&i.preventDefault()});tt.utils={on:dt,off:ut,css:Z,find:ta,is:function(n,o){return!!re(n,o,n,!1)},extend:ws,throttle:ea,closest:re,toggleClass:Vt,clone:ra,index:Jt,nextTick:wr,cancelNextTick:Ao,detectDirection:aa,getChild:hn,expando:Ft};tt.get=function(i){return i[Ft]};tt.mount=function(){for(var i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];n[0].constructor===Array&&(n=n[0]),n.forEach(function(s){if(!s.prototype||!s.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(s));s.utils&&(tt.utils=ce(ce({},tt.utils),s.utils)),Nn.mount(s)})};tt.create=function(i,n){return new tt(i,n)};tt.version=ys;var At=[],On,Po,Co=!1,Eo,Do,Or,An;function Ks(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this))}return i.prototype={dragStarted:function(o){var s=o.originalEvent;this.sortable.nativeDraggable?dt(document,"dragover",this._handleAutoScroll):this.options.supportPointer?dt(document,"pointermove",this._handleFallbackAutoScroll):s.touches?dt(document,"touchmove",this._handleFallbackAutoScroll):dt(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(o){var s=o.originalEvent;!this.options.dragOverBubble&&!s.rootEl&&this._handleAutoScroll(s)},drop:function(){this.sortable.nativeDraggable?ut(document,"dragover",this._handleAutoScroll):(ut(document,"pointermove",this._handleFallbackAutoScroll),ut(document,"touchmove",this._handleFallbackAutoScroll),ut(document,"mousemove",this._handleFallbackAutoScroll)),Bi(),_r(),_s()},nulling:function(){Or=Po=On=Co=An=Eo=Do=null,At.length=0},_handleFallbackAutoScroll:function(o){this._handleAutoScroll(o,!0)},_handleAutoScroll:function(o,s){var c=this,d=(o.touches?o.touches[0]:o).clientX,h=(o.touches?o.touches[0]:o).clientY,m=document.elementFromPoint(d,h);if(Or=o,s||this.options.forceAutoScrollFallback||Rn||ye||Cn){xo(o,this.options,m,s);var g=Ae(m,!0);Co&&(!An||d!==Eo||h!==Do)&&(An&&Bi(),An=setInterval(function(){var k=Ae(document.elementFromPoint(d,h),!0);k!==g&&(g=k,_r()),xo(o,c.options,k,s)},10),Eo=d,Do=h)}else{if(!this.options.bubbleScroll||Ae(m,!0)===le()){_r();return}xo(o,this.options,Ae(m,!1),!1)}}},ve(i,{pluginName:"scroll",initializeByDefault:!0})}function _r(){At.forEach(function(i){clearInterval(i.pid)}),At=[]}function Bi(){clearInterval(An)}var xo=ea(function(i,n,o,s){if(n.scroll){var c=(i.touches?i.touches[0]:i).clientX,d=(i.touches?i.touches[0]:i).clientY,h=n.scrollSensitivity,m=n.scrollSpeed,g=le(),k=!1,O;Po!==o&&(Po=o,_r(),On=n.scroll,O=n.scrollFn,On===!0&&(On=Ae(o,!0)));var P=0,N=On;do{var K=N,F=Pt(K),Y=F.top,J=F.bottom,nt=F.left,ot=F.right,et=F.width,V=F.height,lt=void 0,mt=void 0,st=K.scrollWidth,it=K.scrollHeight,vt=Z(K),Zt=K.scrollLeft,Ut=K.scrollTop;K===g?(lt=et<st&&(vt.overflowX==="auto"||vt.overflowX==="scroll"||vt.overflowX==="visible"),mt=V<it&&(vt.overflowY==="auto"||vt.overflowY==="scroll"||vt.overflowY==="visible")):(lt=et<st&&(vt.overflowX==="auto"||vt.overflowX==="scroll"),mt=V<it&&(vt.overflowY==="auto"||vt.overflowY==="scroll"));var te=lt&&(Math.abs(ot-c)<=h&&Zt+et<st)-(Math.abs(nt-c)<=h&&!!Zt),Mt=mt&&(Math.abs(J-d)<=h&&Ut+V<it)-(Math.abs(Y-d)<=h&&!!Ut);if(!At[P])for(var de=0;de<=P;de++)At[de]||(At[de]={});(At[P].vx!=te||At[P].vy!=Mt||At[P].el!==K)&&(At[P].el=K,At[P].vx=te,At[P].vy=Mt,clearInterval(At[P].pid),(te!=0||Mt!=0)&&(k=!0,At[P].pid=setInterval((function(){s&&this.layer===0&&tt.active._onTouchMove(Or);var fe=At[this.layer].vy?At[this.layer].vy*m:0,Gt=At[this.layer].vx?At[this.layer].vx*m:0;typeof O=="function"&&O.call(tt.dragged.parentNode[Ft],Gt,fe,i,Or,At[this.layer].el)!=="continue"||na(At[this.layer].el,Gt,fe)}).bind({layer:P}),24))),P++}while(n.bubbleScroll&&N!==g&&(N=Ae(N,!1)));Co=k}},30),ca=function(n){var o=n.originalEvent,s=n.putSortable,c=n.dragEl,d=n.activeSortable,h=n.dispatchSortableEvent,m=n.hideGhostForTarget,g=n.unhideGhostForTarget;if(o){var k=s||d;m();var O=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:o,P=document.elementFromPoint(O.clientX,O.clientY);g(),k&&!k.el.contains(P)&&(h("spill"),this.onSpill({dragEl:c,putSortable:s}))}};function Ko(){}Ko.prototype={startIndex:null,dragStart:function(n){var o=n.oldDraggableIndex;this.startIndex=o},onSpill:function(n){var o=n.dragEl,s=n.putSortable;this.sortable.captureAnimationState(),s&&s.captureAnimationState();var c=hn(this.sortable.el,this.startIndex,this.options);c?this.sortable.el.insertBefore(o,c):this.sortable.el.appendChild(o),this.sortable.animateAll(),s&&s.animateAll()},drop:ca};ve(Ko,{pluginName:"revertOnSpill"});function Bo(){}Bo.prototype={onSpill:function(n){var o=n.dragEl,s=n.putSortable,c=s||this.sortable;c.captureAnimationState(),o.parentNode&&o.parentNode.removeChild(o),c.animateAll()},drop:ca};ve(Bo,{pluginName:"removeOnSpill"});tt.mount(new Ks);tt.mount(Bo,Ko);function qi(i,n,o){const s=new Blob([i],{type:o}),c=URL.createObjectURL(s),d=document.createElement("a");d.href=c,d.download=n,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c)}function Bs(i){const{profile:n,workoutTypes:o,workouts:s,logs:c}=i,d=[];d.push("# ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº"),n&&(d.push(`
## ÐÑÐ¾ÑÐ¸Ð»Ñ`),d.push(`- **ÐÐ¼Ñ:** ${n.displayName||"ÐÐµ ÑÐºÐ°Ð·Ð°Ð½Ð¾"}`),n.telegramUsername&&d.push(`- **Username:** @${n.telegramUsername}`),d.push(`- **ID:** ${n.id}`),d.push(`- **ÐÐ°ÑÐ° ÑÐµÐ³Ð¸ÑÑÑÐ°ÑÐ¸Ð¸:** ${new Date(n.createdAt).toLocaleDateString()}`)),d.push(`
## Ð¢Ð¸Ð¿Ñ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹`);const h=o.filter(k=>!k.isDeleted);if(h.length>0?h.sort((k,O)=>(k.order??0)-(O.order??0)).forEach(k=>{d.push(`- ${k.name} (${k.category==="time"?"ÐÐ° Ð²ÑÐµÐ¼Ñ":"Ð¡Ð¸Ð»Ð¾Ð²Ð¾Ðµ"})`)}):d.push("_ÐÐµÑ Ð°ÐºÑÐ¸Ð²Ð½ÑÑ ÑÐ¸Ð¿Ð¾Ð² ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹_"),d.push(`
## ÐÑÑÐ¾ÑÐ¸Ñ`),c.length===0)return d.push("_ÐÑÑÐ¾ÑÐ¸Ñ Ð¿ÑÑÑÐ°_"),d.join(`
`);const m=new Map;return[...c].filter(k=>!k.isDeleted).sort((k,O)=>new Date(O.date).getTime()-new Date(k.date).getTime()).forEach(k=>{const O=new Date(k.date).toLocaleDateString();m.has(O)||m.set(O,[]),m.get(O).push(k)}),m.forEach((k,O)=>{d.push(`
### ${O}`),Array.from(new Set(k.map(N=>N.workoutId).filter(Boolean))).forEach(N=>{const K=s.find(J=>J.id===N),F=k.filter(J=>J.workoutId===N);K&&K.name&&d.push(`
#### ${K.name}`);const Y=new Map;F.forEach(J=>{Y.has(J.workoutTypeId)||Y.set(J.workoutTypeId,[]),Y.get(J.workoutTypeId).push(J)}),Y.forEach((J,nt)=>{const ot=o.find(V=>V.id===nt),et=(ot==null?void 0:ot.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑÐ½Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ";d.push(`- **${et}**: ${J.map(V=>qs(V)).join(", ")}`)})})}),d.join(`
`)}function qs(i){return i.duration!==void 0?`${i.duration} Ð¼Ð¸Ð½`:`${i.weight}ÐºÐ³ Ã ${i.reps}`}function da(i,n){const o=i.totalVolume;let s="";return o<1e3?s=`${Math.round(o)}ÐºÐ³`:o<1e4?s=`${(o/1e3).toFixed(1)}Ñ`:s=`${Math.round(o/1e3)}Ñ`,`
      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-value">${i.totalWorkouts}</div>
          <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${s}</div>
          <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
        </div>
        ${i.favoriteExercise?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${i.favoriteExercise}</div>
            <div class="stat-label">ÐÑÐ±Ð¸Ð¼Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</div>
          </div>
        `:""}
        ${i.lastWorkoutDate?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${new Date(i.lastWorkoutDate).toLocaleDateString()}</div>
            <div class="stat-label">ÐÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</div>
          </div>
        `:""}
      </div>

      ${n&&n.size>0?`
        <div class="activity-list">
          <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          <div class="heatmap-container" style="margin-bottom: 24px;">
            ${Xi(n)}
          </div>
        </div>
      `:""}
    `}const Ar=i=>`https://tadatuta.github.io/21/?startapp=profile_${i}`;ps({immediate:!0});var Yi;const Et=(Yi=window.Telegram)==null?void 0:Yi.WebApp;Et&&(Et.ready(),Et.expand());let qt="main",dn="all",Ot=null,fa=null,Pr=null,$o=!1,Pn=null,Kt=null,kr="overview",Ue="ai",qo=!1,Sr=!1;function Fs(i){qt=i,gt()}let To=null;function ue(i){let n=document.querySelector(".toast");n||(n=document.createElement("div"),n.className="toast",document.body.appendChild(n)),n.textContent=i,n.classList.add("visible"),To&&clearTimeout(To),To=setTimeout(()=>{n==null||n.classList.remove("visible")},2e3)}function gt(){const i=document.getElementById("app");if(!i)return;const n=localStorage.getItem("skip_tma_auth")==="true",o=!!(Et!=null&&Et.initData)&&!n,c=!!Lo();!o&&!c||(i.innerHTML=`
    <main class="content">
      ${Ws()}
    </main>
    <nav class="navigation">
      <button class="navigation__item ${qt==="main"?"navigation__item_active":""}" data-page="main">
        <span class="navigation__icon">ðï¸</span>
        <span class="navigation__label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</span>
      </button>
      <button class="navigation__item ${qt==="stats"?"navigation__item_active":""}" data-page="stats">
        <span class="navigation__icon">ð</span>
        <span class="navigation__label">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</span>
      </button>
      <button class="navigation__item ${qt==="profile-settings"?"navigation__item_active":""}" data-page="profile-settings">
        <span class="navigation__icon">ð¤</span>
        <span class="navigation__label">ÐÑÐ¾ÑÐ¸Ð»Ñ</span>
      </button>
      <button class="navigation__item ${qt==="settings"?"navigation__item_active":""}" data-page="settings">
        <span class="navigation__icon">âï¸</span>
        <span class="navigation__label">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</span>
      </button>
    </nav>
    <div id="sync-status" class="sync-status"></div>
  `,i.querySelectorAll(".navigation__item").forEach(d=>{d.addEventListener("click",()=>{const h=d.getAttribute("data-page");Fs(h)})}),Zs(),Ys())}let ha="idle";H.onSyncStatusChange(i=>{ha=i,Fo()});function Fo(){const i=document.getElementById("sync-status");if(!i)return;i.className="sync-status";let n="",o="";switch(ha){case"saving":n="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...",o="ð",i.classList.add("sync-status_saving");break;case"success":n="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾",o="â",i.classList.add("sync-status_success");break;case"error":n="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸",o="â ï¸",i.classList.add("sync-status_error");break;case"idle":if(!navigator.onLine)n="ÐÑÑÐ»Ð°Ð¹Ð½",o="ð¡",i.classList.add("sync-status_offline");else return;break}i.innerHTML=`${o} ${n}`}window.addEventListener("online",()=>{H.sync(),Fo()});window.addEventListener("offline",()=>Fo());function Ws(){switch(qt){case"main":return zs();case"stats":return Qs();case"settings":return Vs();case"profile-settings":return Xs();case"public-profile":return Gs();default:return""}}function Us(){const i=H.getActiveWorkout();if(i){const n=i.status==="paused";return`
      <div class="workout-controls card">
        <div class="workout-controls__header">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span class="workout-status ${n?"workout-status_paused":""}">
              ${n?"â¸ï¸ ÐÐ°ÑÐ·Ð°":"ð¥ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° Ð°ÐºÑÐ¸Ð²Ð½Ð°"}
            </span>
            <span class="workout-timer">00:00</span>
          </div>
          ${i.name?`<span class="workout-name">${i.name}</span>`:""}
        </div>
        <div class="workout-controls__actions">
          ${n?'<button class="button" id="resume-workout-btn">ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ</button>':'<button class="button button_secondary" id="pause-workout-btn">ÐÐ°ÑÐ·Ð°</button>'}
          <button class="button button_destructive" id="finish-workout-btn">ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ</button>
        </div>
      </div>
    `}return Sr?`
      <div class="workout-controls card">
        <h3 class="subtitle" style="margin-top: 0">ÐÐ°ÑÐ°Ð»Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</h3>
        <form id="start-workout-form" style="display: flex; flex-direction: column; gap: 12px;">
          <input class="input" type="text" name="workoutName" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð¾Ð¿ÑÐ¸Ð¾Ð½Ð°Ð»ÑÐ½Ð¾)">
          <div style="display: flex; gap: 8px;">
            <button class="button" type="submit">ÐÐ°ÑÐ°ÑÑ</button>
            <button class="button button_secondary" type="button" id="cancel-start-workout-btn">ÐÑÐ¼ÐµÐ½Ð°</button>
          </div>
        </form>
      </div>
    `:`
    <button class="button" id="start-workout-btn" style="margin-bottom: 24px;">â¶ï¸ ÐÐ°ÑÐ°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ</button>
  `}let Oe=null;function Fi(){const i=H.getActiveWorkout(),n=document.querySelector(".workout-timer");if(!i||!n){Oe&&(clearInterval(Oe),Oe=null);return}const o=new Date(i.startTime).getTime(),s=Date.now();let c=s-o;i.pauseIntervals.forEach(g=>{const k=new Date(g.start).getTime(),O=g.end?new Date(g.end).getTime():(i.status==="paused",s);O>k&&(c-=O-k)});const d=Math.floor(Math.max(0,c)/1e3),h=Math.floor(d/60),m=d%60;n.textContent=`${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`}function Ys(){const i=H.getActiveWorkout();Fi(),i&&i.status==="active"?Oe||(Oe=setInterval(Fi,1e3)):Oe&&(clearInterval(Oe),Oe=null)}let Wt=0,Mo="";function Wo(i){const n=new Date;n.setHours(0,0,0,0);const o=new Date(n);o.setDate(n.getDate()-i*7),o.setHours(23,59,59,999);const s=new Date(o);return s.setDate(o.getDate()-6),s.setHours(0,0,0,0),{start:s,end:o,label:`${s.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})} - ${o.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}`}}function zs(){var h;const i=H.getWorkoutTypes(),n=H.getLogs(),o=n[n.length-1],s=o==null?void 0:o.workoutTypeId,c=Ot?n.find(m=>m.id===Ot):null,{label:d}=Wo(Wt);return`
    <div class="page-content" id="main-content">
      ${Us()}
      <h1 class="title">${Ot?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´ÑÐ¾Ð´Ð°":"ÐÐ¾Ð²ÑÐ¹ Ð¿Ð¾Ð´ÑÐ¾Ð´"}</h1>
      <form class="workout-form" id="log-form">
        <div class="form-group">
          <label class="label">Ð¢Ð¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</label>
          <select class="select" name="typeId" id="workout-type-select" required>
            ${i.map(m=>`<option value="${m.id}" ${(Ot?c&&m.id===c.workoutTypeId:m.id===s)?"selected":""}>${m.name}</option>`).join("")}
          </select>
        </div>
        
        <div id="strength-inputs" style="display: none;">
            <div class="form-row">
              <div class="form-group">
                <label class="label">ÐÐµÑ (ÐºÐ³)</label>
                <input class="input" type="number" name="weight" step="0.5" placeholder="0" value="${Ot&&c?c.weight??"":""}">

              </div>
              <div class="form-group">
                <label class="label">ÐÐ¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</label>
                <input class="input" type="number" name="reps" placeholder="0" value="${Ot&&c?c.reps??"":""}">

              </div>
            </div>
        </div>

        <div id="time-inputs" style="display: none;">
            <div class="form-group">
                <label class="label">ÐÑÐµÐ¼Ñ (Ð¼Ð¸Ð½)</label>
                <input class="input" type="number" name="duration" placeholder="0" value="${Ot&&c&&c.duration||""}">
            </div>
        </div>

        <button class="button" type="submit">${Ot?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ":"ÐÐ°ÑÐ¸ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ"}</button>
        ${Ot?'<button class="button button_secondary" type="button" id="cancel-edit-btn" style="margin-top: 12px;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        ${!Ot&&o?`<button class="button button_secondary" type="button" id="duplicate-last-btn" style="margin-top: 12px;">ÐÐ¾Ð²ÑÐ¾ÑÐ¸ÑÑ: ${(h=i.find(m=>m.id===o.workoutTypeId))==null?void 0:h.name} ${o.weight!==void 0?`${o.weight}ÐºÐ³ Ã ${o.reps}`:`${o.duration} Ð¼Ð¸Ð½`}</button>`:""}

      </form>
      <div class="recent-logs">
        <div class="recent-logs__header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
           <button class="icon-btn" id="prev-week-btn">âï¸</button>
           <div id="week-label-container" style="display: flex; align-items: center; gap: 8px; position: relative;">
             <span style="font-size: 18px; position: relative; display: inline-block;">
               ð
               <input type="date" id="calendar-input" value="${Mo}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
             </span>
             <h2 class="subtitle" style="margin: 0;">${Wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":d}</h2>
             <label class="filter-toggle" title="Ð¤Ð¸Ð»ÑÑÑ Ð¿Ð¾ ÑÐ¸Ð¿Ñ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ">
               <input type="checkbox" id="filter-toggle-input" ${qo?"checked":""}>
               <span class="filter-toggle__icon">ð</span>
             </label>
           </div>
           <button class="icon-btn" id="next-week-btn" ${Wt===0?"disabled":""} style="${Wt===0?"opacity: 0.3; cursor: default;":""}">â¶ï¸</button>
        </div>
        <div id="logs-list">
          ${pa()}
        </div>
      </div>
    </div>
  `}function pa(){var d;const i=H.getLogs(),n=H.getWorkoutTypes(),{start:o,end:s}=Wo(Wt);let c=i.filter(h=>{const m=new Date(h.date);return m>=o&&m<=s});if(qo){const h=(d=document.querySelector('select[name="typeId"]'))==null?void 0:d.value;h&&(c=c.filter(m=>m.workoutTypeId===h))}return ma(c,n,!0)}function gr(){const i=document.getElementById("logs-list"),n=document.querySelector("#week-label-container .subtitle");if(i&&(i.innerHTML=pa(),Hs()),n){const{label:s}=Wo(Wt);n.textContent=Wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":s}const o=document.getElementById("next-week-btn");o&&(o.disabled=Wt===0,o.style.opacity=Wt===0?"0.3":"",o.style.cursor=Wt===0?"default":"")}function Hs(){document.querySelectorAll(".log-set__delete").forEach(i=>{i.addEventListener("click",async()=>{const n=i.getAttribute("data-id");n&&(Ot===n&&(Ot=null),await H.deleteLog(n),gt())})}),document.querySelectorAll(".log-set__edit").forEach(i=>{i.addEventListener("click",()=>{Ot=i.getAttribute("data-id"),gt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(i=>{i.addEventListener("click",()=>{const n=i.getAttribute("data-date");n&&ga(n)})})}function ma(i,n,o){if(i.length===0)return'<p class="hint">ÐÐµÑ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð·Ð° ÑÑÐ¾Ñ Ð¿ÐµÑÐ¸Ð¾Ð´</p>';const s=new Map;[...i].sort((h,m)=>new Date(m.date).getTime()-new Date(h.date).getTime()).forEach(h=>{const g=new Date(h.date).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"});s.has(g)||s.set(g,[]),s.get(g).push(h)});const c=H.getWorkouts();let d="";return s.forEach((h,m)=>{var Y;const g=((Y=h[0])==null?void 0:Y.date.split("T")[0])||"",k=new Set;h.forEach(J=>{J.workoutId&&k.add(J.workoutId)});const O=Array.from(k).sort((J,nt)=>{var mt,st;const ot=c.find(it=>it.id===J),et=c.find(it=>it.id===nt),V=(ot==null?void 0:ot.startTime)||((mt=h.find(it=>it.workoutId===J))==null?void 0:mt.date)||"",lt=(et==null?void 0:et.startTime)||((st=h.find(it=>it.workoutId===nt))==null?void 0:st.date)||"";return new Date(lt).getTime()-new Date(V).getTime()}),P=O.length===1?O[0]:null,N=P?c.find(J=>J.id===P):null,K=N&&N.name,F=N?Math.round(H.getWorkoutDuration(N)):0;d+='<div class="log-day">',d+=`<div class="log-day__header">
      <span>${m}${K?` â¢ ${N.name}`:""}${N?` â¢ ${F} Ð¼Ð¸Ð½`:""}</span>
      ${o?`<button class="share-btn" data-date="${g}" title="ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ">ð¤</button>`:""}
    </div>`,O.forEach(J=>{const nt=c.find(lt=>lt.id===J),ot=h.filter(lt=>lt.workoutId===J);if(!(O.length===1&&(K||!(nt!=null&&nt.name)))){const lt=nt?Math.round(H.getWorkoutDuration(nt)):0;d+=`<h3 class="workout-subheader">
                ${(nt==null?void 0:nt.name)||"Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°"} 
                <span class="workout-subheader__time">${lt} Ð¼Ð¸Ð½</span>
            </h3>`}const V=new Map;ot.forEach(lt=>{V.has(lt.workoutTypeId)||V.set(lt.workoutTypeId,[]),V.get(lt.workoutTypeId).push(lt)}),V.forEach((lt,mt)=>{const st=n.find(it=>it.id===mt);d+=`
            <div class="log-exercise">
              <div class="log-exercise__name">${(st==null?void 0:st.name)||"Ð£Ð´Ð°Ð»ÐµÐ½Ð¾"}</div>
              <div class="log-exercise__sets">
                ${lt.map(it=>`
                  <div class="log-set ${it.id===Ot?"log-set_active-edit":""} ${it.id===Pn?"log-set_new":""}">
                    <div class="log-set__info">
                      ${it.weight!==void 0&&it.reps!==void 0?`
                        <span class="log-set__weight">${it.weight} ÐºÐ³</span>
                        <span class="log-set__times">Ã</span>
                        <span class="log-set__reps">${it.reps}</span>
                      `:`
                        <span class="log-set__reps">â± ${it.duration} Ð¼Ð¸Ð½</span>
                      `}
                    </div>
                    ${o?`
                    <div class="log-set__actions">
                      <button class="log-set__edit" data-id="${it.id}">âï¸</button>
                      <button class="log-set__delete" data-id="${it.id}">Ã</button>
                    </div>
                    `:""}
                  </div>
                `).join("")}
              </div>
            </div>
          `})}),d+="</div>"}),d}function Vs(){const i=H.getWorkoutTypes(),n=Kt?i.find(o=>o.id===Kt):null;return`
    <div class="page-content">
      <h1 class="title">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</h1>
      <div class="settings-section">
        <h2 class="subtitle">${Kt?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¿Ð°":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸"}</h2>
        <form class="add-type-form" id="add-type-form" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 8px; flex-direction: column;">
            <input class="input" type="text" id="new-type-name" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð½Ð°Ð¿Ñ. ÐÐ¸Ð¼ Ð³Ð°Ð½ÑÐµÐ»ÐµÐ¹)" required value="${n?n.name:""}">
            
            <div class="category-switch" style="display: flex; gap: 12px; margin-bottom: 8px;">
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="strength" ${!n||n.category!=="time"?"checked":""}>
                    Ð¡Ð¸Ð»Ð¾Ð²Ð¾Ðµ
                </label>
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="time" ${n&&n.category==="time"?"checked":""}>
                    ÐÐ° Ð²ÑÐµÐ¼Ñ
                </label>
            </div>

            <button class="button" type="submit">${Kt?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ"}</button>
          </div>
          ${Kt?'<button class="button button_secondary" type="button" id="cancel-edit-type-btn" style="margin-top: 8px; width: 100%;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        </form>

        <h2 class="subtitle">Ð¢Ð¸Ð¿Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
        <div class="type-list" id="workout-type-list">
          ${i.map(o=>`
            <div class="type-item" data-id="${o.id}">
              <span class="drag-handle" style="cursor: grab; margin-right: 12px; opacity: 0.5;">â®â®</span>
              <span style="flex-grow: 1;">${o.name}</span>
              <div style="display: flex; gap: 8px;">
                <button class="type-item__edit icon-btn" data-id="${o.id}" title="Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ">âï¸</button>
                <button class="type-item__delete icon-btn" data-id="${o.id}" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">Ã</button>
              </div>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `}function Xs(){var d,h;const i=H.getProfile(),n=(i==null?void 0:i.isPublic)??!1,o=(i==null?void 0:i.displayName)||((h=(d=Et==null?void 0:Et.initDataUnsafe)==null?void 0:d.user)==null?void 0:h.first_name)||"",s=H.getProfileIdentifier(),c=s?Ar(s):"";return`
    <div class="page-content profile-page">
      <h1 class="title">ÐÑÐ¾ÑÐ¸Ð»Ñ</h1>
      
      <div class="profile-header">
        <div class="profile-avatar">
          ${i!=null&&i.photoUrl?`<img src="${i.photoUrl}" alt="${o}" class="profile-avatar-img">`:o.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${o}</div>
        <div class="profile-subtitle">${n?"ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ":"ÐÑÐ¸Ð²Ð°ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ"}</div>
      </div>

      <div class="stats-tabs">
        <button class="stats-tab profile-tab ${Ue==="ai"?"active":""}" data-tab="ai">AI</button>
        <button class="stats-tab profile-tab ${Ue==="public"?"active":""}" data-tab="public">ÐÑÐ±Ð»Ð¸ÑÐ½Ð¾Ðµ</button>
        <button class="stats-tab profile-tab ${Ue==="data"?"active":""}" data-tab="data">ÐÐ°Ð½Ð½ÑÐµ</button>
      </div>

      <div class="profile-settings">

        ${Ue==="public"?`
          <div class="settings-section">
            <div class="settings-section-title">ÐÐ¸Ð´Ð¸Ð¼Ð¾ÑÑÑ</div>
            <div class="toggle-row">
              <div class="toggle-label">
                <span class="toggle-label-text">ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</span>
                <span class="toggle-label-hint">ÐÑÑÐ³Ð¸Ðµ ÑÐ¼Ð¾Ð³ÑÑ Ð²Ð¸Ð´ÐµÑÑ Ð²Ð°ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÑ</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="profile-public-toggle" ${n?"checked":""}>
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row" style="margin-top: 12px;">
              <div class="toggle-label">
                <span class="toggle-label-text">ÐÐ¾ÐºÐ°Ð·ÑÐ²Ð°ÑÑ Ð²ÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ</span>
                <span class="toggle-label-hint">ÐÐ¾Ð´ÑÐ¾Ð±Ð½ÑÐ¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð² Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ð¼ Ð¿ÑÐ¾ÑÐ¸Ð»Ðµ</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="profile-history-toggle" ${i!=null&&i.showFullHistory?"checked":""}>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title">ÐÐ¼Ñ</div>
            <input class="input" type="text" id="profile-display-name" value="${o}" placeholder="ÐÐ°ÑÐµ Ð¸Ð¼Ñ">
          </div>

          ${n&&s?`
            <div class="settings-section">
              <div class="settings-section-title">Ð¡ÑÑÐ»ÐºÐ° Ð½Ð° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</div>
              <div class="profile-link-section">
                <a href="${c}" target="_blank" class="profile-link-url">${c}</a>
                <div class="profile-link-actions">
                  <button class="button button_secondary" id="copy-profile-link">ÐÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ</button>
                  <button class="button" id="share-profile-link">ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ</button>
                </div>
              </div>
            </div>
          `:""}

          <div class="settings-section">
            <div class="settings-section-title">ÐÑÐµÐ²ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</div>
            ${function(){const m=H.getLogs(),g=H.getWorkoutTypes(),k=m.reduce((nt,ot)=>nt+(ot.weight||0)*(ot.reps||0),0),O=new Set(m.map(nt=>nt.date.split("T")[0])),P=O.size,N=m.length>0?[...m].sort((nt,ot)=>new Date(ot.date).getTime()-new Date(nt.date).getTime())[0].date:void 0,K=new Map;m.forEach(nt=>{K.set(nt.workoutTypeId,(K.get(nt.workoutTypeId)||0)+1)});let F,Y=0;return K.forEach((nt,ot)=>{if(nt>Y){Y=nt;const et=g.find(V=>V.id===ot);et&&(F=et.name)}}),da({totalWorkouts:P,totalVolume:k,favoriteExercise:F,lastWorkoutDate:N},O)}()}
          </div>
  
          ${i!=null&&i.friends&&i.friends.length>0?`
          <div class="settings-section">
              <div class="settings-section-title">ÐÑÑÐ·ÑÑ (${i.friends.length})</div>
              <div class="friends-list">
                  ${i.friends.map(m=>`
                      <a href="${Ar(m.identifier)}" class="friend-item" style="display: flex; align-items: center; gap: 12px; padding: 8px 0; border-bottom: 1px solid var(--border-color); cursor: pointer; text-decoration: none; color: inherit;">
                          <div class="friend-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--surface-color-alt); display: flex; align-items: center; justify-content: center; overflow: hidden;">
                              ${m.photoUrl?`<img src="${m.photoUrl}" style="width: 100%; height: 100%; object-fit: cover;">`:m.displayName.charAt(0).toUpperCase()}
                          </div>
                          <div class="friend-info" style="flex-grow: 1;">
                              <div class="friend-name" style="font-weight: 500;">${m.displayName}</div>
                          </div>
                          <div class="friend-arrow">âº</div>
                      </a>
                  `).join("")}
              </div>
          </div>
          `:""}

          <button class="button" id="save-profile-btn" style="margin-top: 12px;">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
        `:""}

        ${Ue==="ai"?`
          <div class="settings-section">
            <div class="settings-section-title">ÐÐ¸ÑÐ½ÑÐµ Ð´Ð°Ð½Ð½ÑÐµ (ÐÑÐ¸Ð²Ð°ÑÐ½Ð¾)</div>
            <p class="hint" style="margin-bottom: 12px; font-size: 0.9em;">Ð­ÑÐ¸ Ð´Ð°Ð½Ð½ÑÐµ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·ÑÑÑÑÑ ÑÐ¾Ð»ÑÐºÐ¾ Ð´Ð»Ñ Ð¿ÐµÑÑÐ¾Ð½Ð°Ð»Ð¸Ð·Ð°ÑÐ¸Ð¸ ÑÐ¾Ð²ÐµÑÐ¾Ð² Ð¾Ñ AI Ð¸ Ð½Ðµ Ð²Ð¸Ð´Ð½Ñ Ð´ÑÑÐ³Ð¸Ð¼ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»ÑÐ¼.</p>
            
            <div class="form-row">
              <div class="form-group">
                  <label class="label">ÐÐ¾Ð»</label>
                  <select class="select" id="profile-gender">
                      <option value="" ${i!=null&&i.gender?"":"selected"}>ÐÐµ ÑÐºÐ°Ð·Ð°Ð½Ð¾</option>
                      <option value="male" ${(i==null?void 0:i.gender)==="male"?"selected":""}>ÐÑÐ¶ÑÐºÐ¾Ð¹</option>
                      <option value="female" ${(i==null?void 0:i.gender)==="female"?"selected":""}>ÐÐµÐ½ÑÐºÐ¸Ð¹</option>
                  </select>
              </div>
              <div class="form-group">
                  <label class="label">ÐÐ°ÑÐ° ÑÐ¾Ð¶Ð´ÐµÐ½Ð¸Ñ</label>
                  <input class="input" type="date" id="profile-birthdate" value="${(i==null?void 0:i.birthDate)||""}">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                  <label class="label">Ð Ð¾ÑÑ (ÑÐ¼)</label>
                  <input class="input" type="number" id="profile-height" placeholder="180" value="${(i==null?void 0:i.height)||""}">
              </div>
              <div class="form-group">
                  <label class="label">ÐÐµÑ (ÐºÐ³)</label>
                  <input class="input" type="number" id="profile-weight" placeholder="75" value="${(i==null?void 0:i.weight)||""}">
              </div>
            </div>

            <div class="form-group">
               <label class="label">ÐÐ¾Ð¿Ð¾Ð»Ð½Ð¸ÑÐµÐ»ÑÐ½Ð°Ñ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ</label>
               <textarea class="input" id="profile-additional-info" rows="3" placeholder="Ð£ÐºÐ°Ð¶Ð¸ÑÐµ ÑÑÐ°Ð²Ð¼Ñ, Ð¾Ð³ÑÐ°Ð½Ð¸ÑÐµÐ½Ð¸Ñ, ÑÐµÐ»Ð¸ Ð¸Ð»Ð¸ Ð»ÑÐ±ÑÑ Ð´ÑÑÐ³ÑÑ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ, ÐºÐ¾ÑÐ¾ÑÐ°Ñ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ AI Ð´Ð°Ð²Ð°ÑÑ Ð±Ð¾Ð»ÐµÐµ ÑÐ¾ÑÐ½ÑÐµ ÑÐ¾Ð²ÐµÑÑ...">${(i==null?void 0:i.additionalInfo)||""}</textarea>
            </div>
          </div>

          <button class="button" id="save-profile-btn" style="margin-top: 12px;">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
        `:""}

        ${Ue==="data"?`
          <div class="settings-section">
            <div class="settings-section-title">Ð£Ð¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸</div>
            <div style="display: flex; flex-direction: column; gap: 12px;">
              <button class="button button_secondary" id="export-json-btn">Ð­ÐºÑÐ¿Ð¾ÑÑ JSON (Backup)</button>
              <button class="button button_secondary" id="export-md-btn">Ð­ÐºÑÐ¿Ð¾ÑÑ Markdown</button>
              <button class="button button_secondary" id="import-json-btn">ÐÐ¼Ð¿Ð¾ÑÑ JSON (Restore)</button>
              <input type="file" id="import-file-input" style="display: none" accept=".json">
            </div>
          </div>
        `:""}

      </div>
    </div>
  `}function Gs(){if(!fa)return`
      <div class="page-content">
        <div class="profile-not-found">
          <div class="profile-not-found-icon">ð</div>
          <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½</div>
        </div>
      </div>
    `;if(!Pr)return $o?`
        <div class="page-content">
          <div class="profile-not-found">
            <div class="profile-not-found-icon">ð</div>
            <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐºÑÑÑ Ð¸Ð»Ð¸ Ð½Ðµ ÑÑÑÐµÑÑÐ²ÑÐµÑ</div>
          </div>
        </div>
      `:`
      <div class="page-content">
        <div class="profile-loading">ÐÐ°Ð³ÑÑÐ·ÐºÐ° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ...</div>
      </div>
    `;const i=Pr;return i.logs&&(i.logs=i.logs.filter(n=>!n.isDeleted)),i.workoutTypes&&(i.workoutTypes=i.workoutTypes.filter(n=>!n.isDeleted)),`
    <div class="page-content profile-page">
      <div class="profile-header">
        <div class="profile-avatar">
          ${i.photoUrl?`<img src="${i.photoUrl}" alt="${i.displayName}" class="profile-avatar-img">`:i.displayName.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${i.displayName}</div>
        <div class="profile-subtitle">@${i.identifier}</div>
        ${function(){const n=H.getProfile();if(n&&(n.telegramUsername===i.identifier||`id_${n.telegramUserId}`===i.identifier))return"";const s=H.isFriend(i.identifier);return`
                <button class="button ${s?"button_secondary":""}" id="friend-action-btn" data-id="${i.identifier}" data-name="${i.displayName}" data-photo="${i.photoUrl||""}" style="margin-top: 12px; height: 36px; font-size: 14px; display: flex; align-items: center; justify-content: center;">
                    ${s?"Ð£Ð´Ð°Ð»Ð¸ÑÑ Ð¸Ð· Ð´ÑÑÐ·ÐµÐ¹":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ Ð² Ð´ÑÑÐ·ÑÑ"}
                </button>
            `}()}
      </div>

      ${function(){let n=0;i.logs&&(n=i.logs.reduce((d,h)=>d+(h.weight||0)*(h.reps||0),0));const o=Math.max(i.stats.totalVolume,n),s={...i.stats,totalVolume:o},c=i.logs?new Set(i.logs.map(d=>d.date.split("T")[0])):new Set;return da(s,c)}()}

      ${i.recentActivity.length>0?`
        <div class="activity-list">
          <h2 class="subtitle">ÐÐµÐ´Ð°Ð²Ð½ÑÑ Ð°ÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          ${i.recentActivity.map(n=>`
            <div class="activity-item">
              <span class="activity-date">${new Date(n.date).toLocaleDateString()}</span>
              <span class="activity-count">${n.exerciseCount} ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹</span>
            </div>
          `).join("")}
        </div>
      `:""}

      ${i.logs&&i.logs.length>0&&i.workoutTypes?`
        <div class="recent-logs">
          <h2 class="subtitle">ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
          <div id="logs-list">
            ${ma(i.logs,i.workoutTypes,!1)}
          </div>
        </div>
      `:""}
    </div>
  `}function Qs(){const i=H.getLogs(),n=H.getWorkouts(),o=H.getWorkoutTypes();if(i.length===0)return`
      <div class="page-content">
        <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
        <p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</p>
      </div>
    `;const s=i.reduce((m,g)=>m+(g.weight||0)*(g.reps||0),0),c=i.reduce((m,g)=>m+(g.reps||0),0),d=as(n);let h=`
    <div class="page-content">
      <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
      <div class="stats-tabs">
        <button class="stats-tab ${kr==="overview"?"active":""}" data-tab="overview">ÐÐ±Ð·Ð¾Ñ</button>
        <button class="stats-tab ${kr==="progress"?"active":""}" data-tab="progress">ÐÑÐ¾Ð³ÑÐµÑÑ</button>
      </div>
  `;if(kr==="overview"){const m=is(n,i);h+=`
        <div class="stats-section">
            <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
            ${Xi(m)}
        </div>

        <div class="stats-summary">
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
                <div class="stat-metric__value">${m.size}</div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">Ð¡ÑÐµÐ´. Ð´Ð»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ</div>
                <div class="stat-metric__value">${d.averageMinutes}<span class="stat-metric__unit">Ð¼Ð¸Ð½</span></div>
            </div>
             <div class="stat-metric">
                <div class="stat-metric__label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼</div>
                <div class="stat-metric__value">${Math.round(s/1e3)}<span class="stat-metric__unit">Ñ</span></div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ Ð¿Ð¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</div>
                <div class="stat-metric__value">${c}</div>
            </div>
        </div>

        <div class="charts-section">
            <h2 class="subtitle">ÐÐ»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
            <div class="chart-container">
                ${us(n)}
            </div>
        </div>
     `}else if(h+=`
        <div class="form-group">
            <label class="label">Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</label>
            <select class="select" id="stat-type-select">
                <option value="all">ÐÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ (ÐÐ±ÑÐµÐ¼)</option>
                ${o.map(m=>`<option value="${m.id}" ${dn===m.id?"selected":""}>${m.name}</option>`).join("")}
            </select>
        </div>
    `,dn==="all")h+=`
            <div class="charts-section">
                <h2 class="subtitle">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼ Ð¿Ð¾ Ð´Ð½ÑÐ¼</h2>
                <div class="chart-container">
                    ${Ai(i)}
                </div>
            </div>
        `;else{const m=i.filter(k=>k.workoutTypeId===dn),g=os(m,dn);h+=`
             <div class="charts-section">
                <h2 class="subtitle">ÐÑÐ¾Ð³ÑÐµÑÑ ÑÐ¸Ð»Ð¾Ð²ÑÑ (1RM)</h2>
                <div class="chart-container">
                    ${ss(g)}
                </div>
            </div>
            
            <div class="charts-section" style="margin-top: 24px;">
                <h2 class="subtitle">ÐÐ±ÑÐµÐ¼ Ð½Ð°Ð³ÑÑÐ·ÐºÐ¸</h2>
                 <div class="chart-container">
                    ${Ai(m)}
                </div>
            </div>
        `}return h+="</div>",h}function Js(i){const n=H.getLogs(),o=H.getWorkoutTypes(),s=n.filter(k=>k.date.startsWith(i));if(s.length===0)return"";const d=new Date(s[0].date).toLocaleDateString("ru-RU",{day:"numeric",month:"long"}),h=new Map;s.forEach(k=>{h.has(k.workoutTypeId)||h.set(k.workoutTypeId,[]),h.get(k.workoutTypeId).push(k)});let m=`ðï¸ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° ${d}

`;h.forEach((k,O)=>{const P=o.find(N=>N.id===O);m+=`${(P==null?void 0:P.name)||"Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ"}:
`,k.forEach(N=>{N.duration?m+=`  â± ${N.duration} Ð¼Ð¸Ð½
`:m+=`  ${N.weight} ÐºÐ³ Ã ${N.reps}
`}),m+=`
`});const g=s.reduce((k,O)=>k+(O.weight&&O.reps?O.weight*O.reps:0),0);return g&&(m+=`ðª ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼: ${Math.round(g)} ÐºÐ³`),m}function ga(i){const n=Js(i);if(n)if(Et!=null&&Et.openTelegramLink){const o=`https://t.me/share/url?url=${encodeURIComponent("https://t.me/gymgym21bot")}&text=${encodeURIComponent(n)}`;Et.openTelegramLink(o)}else navigator.clipboard.writeText(n).then(()=>{alert("Ð¢ÐµÐºÑÑ ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½ Ð² Ð±ÑÑÐµÑ Ð¾Ð±Ð¼ÐµÐ½Ð°")})}function Zs(){var i,n,o,s;if(qt==="main"){const c=document.getElementById("start-workout-btn");c==null||c.addEventListener("click",()=>{Sr=!0,gt()});const d=document.getElementById("cancel-start-workout-btn");d==null||d.addEventListener("click",()=>{Sr=!1,gt()});const h=document.getElementById("start-workout-form");h==null||h.addEventListener("submit",async et=>{et.preventDefault();const lt=new FormData(h).get("workoutName");await H.startWorkout(lt),Sr=!1,gt()});const m=document.getElementById("pause-workout-btn");m==null||m.addEventListener("click",async()=>{await H.pauseWorkout(),gt()});const g=document.getElementById("resume-workout-btn");g==null||g.addEventListener("click",async()=>{await H.resumeWorkout(),gt()});const k=document.getElementById("finish-workout-btn");k==null||k.addEventListener("click",async()=>{confirm("ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ?")&&(await H.finishWorkout(),gt())});const O=document.getElementById("log-form"),P=()=>{const et=document.getElementById("workout-type-select"),V=H.getWorkoutTypes(),lt=et==null?void 0:et.value,mt=V.find(vt=>vt.id===lt),st=document.getElementById("strength-inputs"),it=document.getElementById("time-inputs");mt&&mt.category==="time"?(st&&(st.style.display="none"),it&&(it.style.display="block"),O.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(vt=>vt.removeAttribute("required")),O.querySelectorAll('input[name="duration"]').forEach(vt=>vt.setAttribute("required","true"))):(st&&(st.style.display="block"),it&&(it.style.display="none"),O.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(vt=>vt.setAttribute("required","true")),O.querySelectorAll('input[name="duration"]').forEach(vt=>vt.removeAttribute("required")))};P();const N=document.getElementById("workout-type-select");N==null||N.addEventListener("change",P),O==null||O.addEventListener("submit",async et=>{et.preventDefault();const V=new FormData(O),lt=V.get("typeId"),st=H.getWorkoutTypes().find(vt=>vt.id===lt),it={workoutTypeId:lt};if((st==null?void 0:st.category)==="time"?it.duration=parseInt(V.get("duration"),10):(it.weight=parseFloat(V.get("weight")),it.reps=parseInt(V.get("reps"),10)),Ot){const Zt=H.getLogs().find(Ut=>Ut.id===Ot);Zt&&(await H.updateLog({...Zt,...it}),Ot=null)}else Pn=(await H.addLog(it)).id;gt(),Pn=null});const K=document.getElementById("duplicate-last-btn");K==null||K.addEventListener("click",async()=>{const et=H.getLogs(),V=et[et.length-1];V&&(Pn=(await H.addLog({workoutTypeId:V.workoutTypeId,weight:V.weight,reps:V.reps,duration:V.duration})).id,gt(),Pn=null)});const F=document.getElementById("cancel-edit-btn");F==null||F.addEventListener("click",()=>{Ot=null,gt()}),document.querySelectorAll(".log-set__delete").forEach(et=>{et.addEventListener("click",async()=>{const V=et.getAttribute("data-id");V&&(Ot===V&&(Ot=null),await H.deleteLog(V),gt())})}),document.querySelectorAll(".log-set__edit").forEach(et=>{et.addEventListener("click",()=>{Ot=et.getAttribute("data-id"),gt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(et=>{et.addEventListener("click",()=>{const V=et.getAttribute("data-date");V&&ga(V)})});const Y=document.getElementById("prev-week-btn");Y==null||Y.addEventListener("click",()=>{Wt++,gr()});const J=document.getElementById("next-week-btn");J==null||J.addEventListener("click",()=>{Wt>0&&(Wt--,gr())});const nt=document.getElementById("calendar-input");nt==null||nt.addEventListener("change",()=>{if(!nt.value||nt.value===Mo)return;Mo=nt.value;const et=new Date(nt.value),V=new Date;V.setHours(0,0,0,0);const lt=V.getTime()-et.getTime(),mt=Math.floor(lt/(1e3*60*60*24));Wt=Math.max(0,Math.floor(mt/7)),gr()});const ot=document.getElementById("filter-toggle-input");ot==null||ot.addEventListener("change",()=>{qo=ot.checked,gr()})}if(qt==="settings"){const c=document.getElementById("add-type-form");c==null||c.addEventListener("submit",async h=>{var k;h.preventDefault();const m=document.getElementById("new-type-name"),g=(k=document.querySelector('input[name="new-type-category"]:checked'))==null?void 0:k.value;m.value&&(Kt?(await H.updateWorkoutType(Kt,m.value,g),Kt=null):await H.addWorkoutType(m.value,g),gt())});const d=document.getElementById("cancel-edit-type-btn");d==null||d.addEventListener("click",()=>{Kt=null,gt()}),document.querySelectorAll(".type-item__edit").forEach(h=>{h.addEventListener("click",()=>{Kt=h.getAttribute("data-id"),gt();const m=document.getElementById("new-type-name");m==null||m.focus()})}),document.querySelectorAll(".type-item__delete").forEach(h=>{h.addEventListener("click",async()=>{const m=h.getAttribute("data-id");m&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(Kt===m&&(Kt=null),await H.deleteWorkoutType(m),gt())})})}if(qt==="settings"){const c=document.getElementById("workout-type-list");c&&tt.create(c,{animation:150,handle:".drag-handle",onEnd:async()=>{const d=Array.from(c.children).map(h=>h.getAttribute("data-id")||"").filter(Boolean);await H.updateWorkoutTypeOrder(d)}}),document.querySelectorAll(".type-item__edit").forEach(d=>{d.addEventListener("click",()=>{Kt=d.getAttribute("data-id"),gt();const h=document.getElementById("new-type-name");h==null||h.focus()})}),document.querySelectorAll(".type-item__delete").forEach(d=>{d.addEventListener("click",async()=>{const h=d.getAttribute("data-id");h&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(Kt===h&&(Kt=null),await H.deleteWorkoutType(h),gt())})})}if(qt==="stats"){const c=document.getElementById("stat-type-select");c==null||c.addEventListener("change",()=>{dn=c.value,gt()})}if(qt==="profile-settings"){document.querySelectorAll(".profile-tab").forEach(g=>{g.addEventListener("click",()=>{const k=g.getAttribute("data-tab");(k==="ai"||k==="public"||k==="data")&&(Ue=k,gt())})});const d=document.getElementById("save-profile-btn");d==null||d.addEventListener("click",async()=>{const g=document.getElementById("profile-public-toggle"),k=document.getElementById("profile-history-toggle"),O=document.getElementById("profile-display-name"),P=document.getElementById("profile-gender"),N=document.getElementById("profile-birthdate"),K=document.getElementById("profile-height"),F=document.getElementById("profile-weight"),Y=document.getElementById("profile-additional-info"),J={};g&&(J.isPublic=g.checked),k&&(J.showFullHistory=k.checked),O&&(J.displayName=O.value),P&&(J.gender=P.value||void 0),N&&(J.birthDate=N.value),K&&(J.height=K.value?Number(K.value):void 0),F&&(J.weight=F.value?Number(F.value):void 0),Y&&(J.additionalInfo=Y.value),await H.updateProfileSettings(J),ue("ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐ¾ÑÑÐ°Ð½ÐµÐ½"),gt()});const h=document.getElementById("copy-profile-link");h==null||h.addEventListener("click",()=>{const g=H.getProfileIdentifier();if(g){const k=Ar(g);navigator.clipboard.writeText(k).then(()=>{ue("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})}});const m=document.getElementById("share-profile-link");m==null||m.addEventListener("click",()=>{const g=H.getProfileIdentifier();if(g){const k=Ar(g);if(Et!=null&&Et.openTelegramLink){const O=`https://t.me/share/url?url=${encodeURIComponent(k)}&text=${encodeURIComponent("ÐÐ¾Ð¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº ðª")}`;Et.openTelegramLink(O)}else navigator.clipboard.writeText(k).then(()=>{ue("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})}}),(i=document.getElementById("export-json-btn"))==null||i.addEventListener("click",async()=>{try{const g=await H.exportData(),k=`gym_backup_${new Date().toISOString().split("T")[0]}.json`;qi(JSON.stringify(g,null,2),k,"application/json"),ue("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(g){console.error(g),ue("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(n=document.getElementById("export-md-btn"))==null||n.addEventListener("click",async()=>{try{const g=await H.exportData(),k=Bs(g),O=`gym_history_${new Date().toISOString().split("T")[0]}.md`;qi(k,O,"text/markdown"),ue("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(g){console.error(g),ue("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(o=document.getElementById("import-json-btn"))==null||o.addEventListener("click",()=>{var g;(g=document.getElementById("import-file-input"))==null||g.click()}),(s=document.getElementById("import-file-input"))==null||s.addEventListener("change",g=>{var P;const k=(P=g.target.files)==null?void 0:P[0];if(!k)return;const O=new FileReader;O.onload=async N=>{var K;try{const F=(K=N.target)==null?void 0:K.result,Y=JSON.parse(F);confirm("ÐÐ½Ð¸Ð¼Ð°Ð½Ð¸Ðµ! ÐÑÐµ ÑÐµÐºÑÑÐ¸Ðµ Ð´Ð°Ð½Ð½ÑÐµ Ð±ÑÐ´ÑÑ Ð·Ð°Ð¼ÐµÐ½ÐµÐ½Ñ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸ Ð¸Ð· ÑÐ°Ð¹Ð»Ð°. ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ?")&&(await H.importData(Y),ue("ÐÐ°Ð½Ð½ÑÐµ ÑÑÐ¿ÐµÑÐ½Ð¾ Ð¸Ð¼Ð¿Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°Ð½Ñ"),setTimeout(()=>location.reload(),1e3))}catch(F){console.error(F),ue("ÐÑÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾ÑÑÐ°: ÐÐµÐ²ÐµÑÐ½ÑÐ¹ ÑÐ¾ÑÐ¼Ð°Ñ ÑÐ°Ð¹Ð»Ð°")}},O.readAsText(k),g.target.value=""})}if(qt==="stats"){document.querySelectorAll(".stats-tab").forEach(h=>{h.addEventListener("click",()=>{const m=h.getAttribute("data-tab");(m==="overview"||m==="progress")&&(kr=m,gt())})});const d=document.getElementById("stat-type-select");d==null||d.addEventListener("change",h=>{dn=h.target.value,gt()})}if(qt==="public-profile"){const c=document.getElementById("friend-action-btn");c==null||c.addEventListener("click",async()=>{const d=c.getAttribute("data-id"),h=c.getAttribute("data-name"),m=c.getAttribute("data-photo");d&&h&&(H.isFriend(d)?confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ Ð¸Ð· Ð´ÑÑÐ·ÐµÐ¹?")&&(await H.removeFriend(d),H.sync().catch(()=>{})):(await H.addFriend({identifier:d,displayName:h,photoUrl:m||void 0}),ue("ÐÐ¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² Ð´ÑÑÐ·ÑÑ"),H.sync().catch(()=>{})),gt())})}}const Ye=document.createElement("div");Ye.className="sync-status";document.body.appendChild(Ye);function tu(i){switch(Ye.className="sync-status visible "+i,i){case"saving":Ye.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...";break;case"success":Ye.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð¾";break;case"error":Ye.textContent="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸";break;default:Ye.className="sync-status"}}H.onUpdate(()=>gt());H.onSyncStatusChange(tu);async function eu(){var m;const i=new URLSearchParams(window.location.search);if(i.has("hash")&&i.has("id")){const g={id:parseInt(i.get("id")||"0",10),first_name:i.get("first_name")||"",last_name:i.get("last_name")||void 0,username:i.get("username")||void 0,photo_url:i.get("photo_url")||void 0,auth_date:parseInt(i.get("auth_date")||"0",10),hash:i.get("hash")||""};Hi(g),i.delete("hash"),i.delete("id"),i.delete("first_name"),i.delete("last_name"),i.delete("username"),i.delete("photo_url"),i.delete("auth_date"),i.delete("auth");const k=i.toString(),O=window.location.pathname+(k?"?"+k:"");window.history.replaceState({},document.title,O),location.reload();return}const n=localStorage.getItem("skip_tma_auth")==="true",o=!!(Et!=null&&Et.initData)&&!n,c=!!Lo();if(!o&&!c){cs(document.getElementById("app"),()=>{location.reload()});return}const h=new URLSearchParams(window.location.search).get("startapp")||((m=Et==null?void 0:Et.initDataUnsafe)==null?void 0:m.start_param);if(h&&h.startsWith("profile_")){const g=h.replace("profile_","");fa=g,qt="public-profile",$o=!1,gt(),Pr=await H.getPublicProfile(g),Pr||($o=!0),gt()}else gt();await H.init()}eu();
