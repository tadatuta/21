var Xa=Object.defineProperty;var Va=(a,n,i)=>n in a?Xa(a,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[n]=i;var pe=(a,n,i)=>Va(a,typeof n!="symbol"?n+"":n,i);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function i(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(c){if(c.ep)return;c.ep=!0;const d=i(c);fetch(c.href,d)}})();const Ga="modulepreload",Qa=function(a,n){return new URL(a,n).href},xi={},Yi=function(n,i,s){let c=Promise.resolve();if(i&&i.length>0){const h=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),v=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));c=Promise.allSettled(i.map(E=>{if(E=Qa(E,s),E in xi)return;xi[E]=!0;const A=E.endsWith(".css"),C=A?'[rel="stylesheet"]':"";if(!!s)for(let U=h.length-1;U>=0;U--){const X=h[U];if(X.href===E&&(!A||X.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${E}"]${C}`))return;const F=document.createElement("link");if(F.rel=A?"stylesheet":Ga,A||(F.as="script"),F.crossOrigin="",F.href=E,v&&F.setAttribute("nonce",v),document.head.appendChild(F),A)return new Promise((U,X)=>{F.addEventListener("load",U),F.addEventListener("error",()=>X(new Error(`Unable to preload CSS for ${E}`)))})}))}function d(h){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=h,window.dispatchEvent(m),!m.defaultPrevented)throw h}return c.then(h=>{for(const m of h||[])m.status==="rejected"&&d(m.reason);return n().catch(d)})};var Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ja(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var zi={exports:{}};(function(a,n){((i,s)=>{a.exports=s()})(Ti,function(){var i=function(t,e){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,o){r.__proto__=o}:function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])}))(t,e)},s=function(){return(s=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var u in e=arguments[r])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t}).apply(this,arguments)};function c(t,e,r){for(var o,u=0,l=e.length;u<l;u++)!o&&u in e||((o=o||Array.prototype.slice.call(e,0,u))[u]=e[u]);return t.concat(o||Array.prototype.slice.call(e))}var d=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ti,h=Object.keys,m=Array.isArray;function v(t,e){return typeof e=="object"&&h(e).forEach(function(r){t[r]=e[r]}),t}typeof Promise>"u"||d.Promise||(d.Promise=Promise);var E=Object.getPrototypeOf,A={}.hasOwnProperty;function C(t,e){return A.call(t,e)}function B(t,e){typeof e=="function"&&(e=e(E(t))),(typeof Reflect>"u"?h:Reflect.ownKeys)(e).forEach(function(r){U(t,r,e[r])})}var F=Object.defineProperty;function U(t,e,r,o){F(t,e,v(r&&C(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},o))}function X(t){return{from:function(e){return t.prototype=Object.create(e.prototype),U(t.prototype,"constructor",t),{extend:B.bind(null,t.prototype)}}}}var nt=Object.getOwnPropertyDescriptor,ft=[].slice;function st(t,e,r){return ft.call(t,e,r)}function et(t,e){return e(t)}function z(t){if(!t)throw new Error("Assertion Failed")}function ut(t){d.setImmediate?setImmediate(t):setTimeout(t,0)}function mt(t,e){if(typeof e=="string"&&C(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],o=0,u=e.length;o<u;++o){var l=mt(t,e[o]);r.push(l)}return r}var f,p=e.indexOf(".");return p===-1||(f=t[e.substr(0,p)])==null?void 0:mt(f,e.substr(p+1))}function it(t,e,r){if(t&&e!==void 0&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){z(typeof r!="string"&&"length"in r);for(var o=0,u=e.length;o<u;++o)it(t,e[o],r[o])}else{var l,f,p=e.indexOf(".");p!==-1?(l=e.substr(0,p),(p=e.substr(p+1))===""?r===void 0?m(t)&&!isNaN(parseInt(l))?t.splice(l,1):delete t[l]:t[l]=r:it(f=(f=t[l])&&C(t,l)?f:t[l]={},p,r)):r===void 0?m(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function rt(t){var e,r={};for(e in t)C(t,e)&&(r[e]=t[e]);return r}var gt=[].concat;function Zt(t){return gt.apply([],t)}var ee="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Zt([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return d[t]}),Wt=new Set(ee.map(function(t){return d[t]})),te=null;function jt(t){return te=new WeakMap,t=function e(r){if(!r||typeof r!="object")return r;var o=te.get(r);if(o)return o;if(m(r)){o=[],te.set(r,o);for(var u=0,l=r.length;u<l;++u)o.push(e(r[u]))}else if(Wt.has(r.constructor))o=r;else{var f,p=E(r);for(f in o=p===Object.prototype?{}:Object.create(p),te.set(r,o),r)C(r,f)&&(o[f]=e(r[f]))}return o}(t),te=null,t}var ce={}.toString;function de(t){return ce.call(t).slice(8,-1)}var Gt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Ye=typeof Gt=="symbol"?function(t){var e;return t!=null&&(e=t[Gt])&&e.apply(t)}:function(){return null};function Ut(t,e){e=t.indexOf(e),0<=e&&t.splice(e,1)}var be={};function oe(t){var e,r,o,u;if(arguments.length===1){if(m(t))return t.slice();if(this===be&&typeof t=="string")return[t];if(u=Ye(t))for(r=[];!(o=u.next()).done;)r.push(o.value);else{if(t==null)return[t];if(typeof(e=t.length)!="number")return[t];for(r=new Array(e);e--;)r[e]=t[e]}}else for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var ze=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ee=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Yt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ee),ga={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function He(t,e){this.name=t,this.message=e}function Wo(t,e){return t+". Errors: "+Object.keys(e).map(function(r){return e[r].toString()}).filter(function(r,o,u){return u.indexOf(r)===o}).join(`
`)}function Kn(t,e,r,o){this.failures=e,this.failedKeys=o,this.successCount=r,this.message=Wo(t,e)}function Xe(t,e){this.name="BulkError",this.failures=Object.keys(e).map(function(r){return e[r]}),this.failuresByPos=e,this.message=Wo(t,this.failures)}X(He).from(Error).extend({toString:function(){return this.name+": "+this.message}}),X(Kn).from(He),X(Xe).from(He);var Pr=Yt.reduce(function(t,e){return t[e]=e+"Error",t},{}),va=He,H=Yt.reduce(function(t,e){var r=e+"Error";function o(u,l){this.name=r,u?typeof u=="string"?(this.message="".concat(u).concat(l?`
 `+l:""),this.inner=l||null):typeof u=="object"&&(this.message="".concat(u.name," ").concat(u.message),this.inner=u):(this.message=ga[e]||r,this.inner=null)}return X(o).from(va),t[e]=o,t},{}),Uo=(H.Syntax=SyntaxError,H.Type=TypeError,H.Range=RangeError,ee.reduce(function(t,e){return t[e+"Error"]=H[e],t},{}));ee=Yt.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=H[e]),t},{});function vt(){}function hn(t){return t}function ya(t,e){return t==null||t===hn?e:function(r){return e(t(r))}}function Ce(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ba(t,e){return t===vt?e:function(){var r=t.apply(this,arguments),o=(r!==void 0&&(arguments[0]=r),this.onsuccess),u=this.onerror,l=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return o&&(this.onsuccess=this.onsuccess?Ce(o,this.onsuccess):o),u&&(this.onerror=this.onerror?Ce(u,this.onerror):u),l!==void 0?l:r}}function wa(t,e){return t===vt?e:function(){t.apply(this,arguments);var r=this.onsuccess,o=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Ce(r,this.onsuccess):r),o&&(this.onerror=this.onerror?Ce(o,this.onerror):o)}}function _a(t,e){return t===vt?e:function(u){var o=t.apply(this,arguments),u=(v(u,o),this.onsuccess),l=this.onerror,f=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return u&&(this.onsuccess=this.onsuccess?Ce(u,this.onsuccess):u),l&&(this.onerror=this.onerror?Ce(l,this.onerror):l),o===void 0?f===void 0?void 0:f:v(o,f)}}function ka(t,e){return t===vt?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function $r(t,e){return t===vt?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var o=this,u=arguments.length,l=new Array(u);u--;)l[u]=arguments[u];return r.then(function(){return e.apply(o,l)})}return e.apply(this,arguments)}}ee.ModifyError=Kn,ee.DexieError=He,ee.BulkError=Xe;var ie=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Yo(t){ie=t}var pn={},zo=100,mn=typeof Promise>"u"?[]:(Yt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[mn=crypto.subtle.digest("SHA-512",new Uint8Array([0])),E(mn),Yt]:[Yt,E(Yt),Yt]),Yt=mn[0],nn=mn[1],nn=nn&&nn.then,Pe=Yt&&Yt.constructor,jr=!!mn[2],gn=function(t,e){vn.push([t,e]),Nn&&(queueMicrotask(Ea),Nn=!1)},Mr=!0,Nn=!0,$e=[],Bn=[],Lr=hn,we={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:vt,pgp:!1,env:{},finalize:vt},Y=we,vn=[],je=0,qn=[];function K(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=Y;if(typeof t!="function"){if(t!==pn)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Kr(this,this._value)}else this._state=null,this._value=null,++e.ref,function r(o,u){try{u(function(l){if(o._state===null){if(l===o)throw new TypeError("A promise cannot be resolved with itself.");var f=o._lib&&Ve();l&&typeof l.then=="function"?r(o,function(p,b){l instanceof K?l._then(p,b):l.then(p,b)}):(o._state=!0,o._value=l,Xo(o)),f&&Ge()}},Kr.bind(null,o))}catch(l){Kr(o,l)}}(this,t)}var Rr={get:function(){var t=Y,e=Yn;function r(o,u){var l=this,f=!t.global&&(t!==Y||e!==Yn),p=f&&!ke(),b=new K(function(x,w){Nr(l,new Ho(Go(o,t,f,p),Go(u,t,f,p),x,w,t))});return this._consoleTask&&(b._consoleTask=this._consoleTask),b}return r.prototype=pn,r},set:function(t){U(this,"then",t&&t.prototype===pn?Rr:{get:function(){return t},set:Rr.set})}};function Ho(t,e,r,o,u){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=o,this.psd=u}function Kr(t,e){var r,o;Bn.push(e),t._state===null&&(r=t._lib&&Ve(),e=Lr(e),t._state=!1,t._value=e,o=t,$e.some(function(u){return u._value===o._value})||$e.push(o),Xo(t),r)&&Ge()}function Xo(t){var e=t._listeners;t._listeners=[];for(var r=0,o=e.length;r<o;++r)Nr(t,e[r]);var u=t._PSD;--u.ref||u.finalize(),je===0&&(++je,gn(function(){--je==0&&Br()},[]))}function Nr(t,e){if(t._state===null)t._listeners.push(e);else{var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++je,gn(Sa,[r,t,e])}}function Sa(t,e,r){try{var o,u=e._value;!e._state&&Bn.length&&(Bn=[]),o=ie&&e._consoleTask?e._consoleTask.run(function(){return t(u)}):t(u),e._state||Bn.indexOf(u)!==-1||(l=>{for(var f=$e.length;f;)if($e[--f]._value===l._value)return $e.splice(f,1)})(e),r.resolve(o)}catch(l){r.reject(l)}finally{--je==0&&Br(),--r.psd.ref||r.psd.finalize()}}function Ea(){Me(we,function(){Ve()&&Ge()})}function Ve(){var t=Mr;return Nn=Mr=!1,t}function Ge(){var t,e,r;do for(;0<vn.length;)for(t=vn,vn=[],r=t.length,e=0;e<r;++e){var o=t[e];o[0].apply(null,o[1])}while(0<vn.length);Nn=Mr=!0}function Br(){for(var t=$e,e=($e=[],t.forEach(function(o){o._PSD.onunhandled.call(null,o._value,o)}),qn.slice(0)),r=e.length;r;)e[--r]()}function Fn(t){return new K(pn,!1,t)}function wt(t,e){var r=Y;return function(){var o=Ve(),u=Y;try{return Se(r,!0),t.apply(this,arguments)}catch(l){e&&e(l)}finally{Se(u,!1),o&&Ge()}}}B(K.prototype,{then:Rr,_then:function(t,e){Nr(this,new Ho(null,null,t,e,Y))},catch:function(t){var e,r;return arguments.length===1?this.then(null,t):(e=t,r=arguments[1],typeof e=="function"?this.then(null,function(o){return(o instanceof e?r:Fn)(o)}):this.then(null,function(o){return(o&&o.name===e?r:Fn)(o)}))},finally:function(t){return this.then(function(e){return K.resolve(t()).then(function(){return e})},function(e){return K.resolve(t()).then(function(){return Fn(e)})})},timeout:function(t,e){var r=this;return t<1/0?new K(function(o,u){var l=setTimeout(function(){return u(new H.Timeout(e))},t);r.then(o,u).finally(clearTimeout.bind(null,l))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&U(K.prototype,Symbol.toStringTag,"Dexie.Promise"),we.env=Vo(),B(K,{all:function(){var t=oe.apply(null,arguments).map(zn);return new K(function(e,r){t.length===0&&e([]);var o=t.length;t.forEach(function(u,l){return K.resolve(u).then(function(f){t[l]=f,--o||e(t)},r)})})},resolve:function(t){return t instanceof K?t:t&&typeof t.then=="function"?new K(function(e,r){t.then(e,r)}):new K(pn,!0,t)},reject:Fn,race:function(){var t=oe.apply(null,arguments).map(zn);return new K(function(e,r){t.map(function(o){return K.resolve(o).then(e,r)})})},PSD:{get:function(){return Y},set:function(t){return Y=t}},totalEchoes:{get:function(){return Yn}},newPSD:_e,usePSD:Me,scheduler:{get:function(){return gn},set:function(t){gn=t}},rejectionMapper:{get:function(){return Lr},set:function(t){Lr=t}},follow:function(t,e){return new K(function(r,o){return _e(function(u,l){var f=Y;f.unhandleds=[],f.onunhandled=l,f.finalize=Ce(function(){var p,b=this;p=function(){b.unhandleds.length===0?u():l(b.unhandleds[0])},qn.push(function x(){p(),qn.splice(qn.indexOf(x),1)}),++je,gn(function(){--je==0&&Br()},[])},f.finalize),t()},e,r,o)})}}),Pe&&(Pe.allSettled&&U(K,"allSettled",function(){var t=oe.apply(null,arguments).map(zn);return new K(function(e){t.length===0&&e([]);var r=t.length,o=new Array(r);t.forEach(function(u,l){return K.resolve(u).then(function(f){return o[l]={status:"fulfilled",value:f}},function(f){return o[l]={status:"rejected",reason:f}}).then(function(){return--r||e(o)})})})}),Pe.any&&typeof AggregateError<"u"&&U(K,"any",function(){var t=oe.apply(null,arguments).map(zn);return new K(function(e,r){t.length===0&&r(new AggregateError([]));var o=t.length,u=new Array(o);t.forEach(function(l,f){return K.resolve(l).then(function(p){return e(p)},function(p){u[f]=p,--o||r(new AggregateError(u))})})})}),Pe.withResolvers)&&(K.withResolvers=Pe.withResolvers);var Pt={awaits:0,echoes:0,id:0},Da=0,Wn=[],Un=0,Yn=0,xa=0;function _e(t,f,r,o){var u=Y,l=Object.create(u),f=(l.parent=u,l.ref=0,l.global=!1,l.id=++xa,we.env,l.env=jr?{Promise:K,PromiseProp:{value:K,configurable:!0,writable:!0},all:K.all,race:K.race,allSettled:K.allSettled,any:K.any,resolve:K.resolve,reject:K.reject}:{},f&&v(l,f),++u.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()},Me(l,t,r,o));return l.ref===0&&l.finalize(),f}function Qe(){return Pt.id||(Pt.id=++Da),++Pt.awaits,Pt.echoes+=zo,Pt.id}function ke(){return!!Pt.awaits&&(--Pt.awaits==0&&(Pt.id=0),Pt.echoes=Pt.awaits*zo,!0)}function zn(t){return Pt.echoes&&t&&t.constructor===Pe?(Qe(),t.then(function(e){return ke(),e},function(e){return ke(),Tt(e)})):t}function Ta(){var t=Wn[Wn.length-1];Wn.pop(),Se(t,!1)}function Se(t,e){var r,o,u=Y;(e?!Pt.echoes||Un++&&t===Y:!Un||--Un&&t===Y)||queueMicrotask(e?(function(l){++Yn,Pt.echoes&&--Pt.echoes!=0||(Pt.echoes=Pt.awaits=Pt.id=0),Wn.push(Y),Se(l,!0)}).bind(null,t):Ta),t!==Y&&(Y=t,u===we&&(we.env=Vo()),jr)&&(r=we.env.Promise,o=t.env,u.global||t.global)&&(Object.defineProperty(d,"Promise",o.PromiseProp),r.all=o.all,r.race=o.race,r.resolve=o.resolve,r.reject=o.reject,o.allSettled&&(r.allSettled=o.allSettled),o.any)&&(r.any=o.any)}function Vo(){var t=d.Promise;return jr?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(d,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function Me(t,e,r,o,u){var l=Y;try{return Se(t,!0),e(r,o,u)}finally{Se(l,!1)}}function Go(t,e,r,o){return typeof t!="function"?t:function(){var u=Y;r&&Qe(),Se(e,!0);try{return t.apply(this,arguments)}finally{Se(u,!1),o&&queueMicrotask(ke)}}}function qr(t){Promise===Pe&&Pt.echoes===0?Un===0?t():enqueueNativeMicroTask(t):setTimeout(t,0)}(""+nn).indexOf("[native code]")===-1&&(Qe=ke=vt);var Tt=K.reject,Le="ï¿¿",fe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Qo="String expected.",Je=[],Hn="__dbnames",Fr="readonly",Wr="readwrite";function Re(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Jo={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Xn(t){return typeof t!="string"||/\./.test(t)?function(e){return e}:function(e){return e[t]===void 0&&t in e&&delete(e=jt(e))[t],e}}function Zo(){throw H.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function lt(t,e){try{var r=ti(t),o=ti(e);if(r!==o)return r==="Array"?1:o==="Array"?-1:r==="binary"?1:o==="binary"?-1:r==="string"?1:o==="string"?-1:r==="Date"?1:o!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return e<t?1:t<e?-1:0;case"binary":for(var u=ei(t),l=ei(e),f=u.length,p=l.length,b=f<p?f:p,x=0;x<b;++x)if(u[x]!==l[x])return u[x]<l[x]?-1:1;return f===p?0:f<p?-1:1;case"Array":for(var w=t,g=e,k=w.length,S=g.length,_=k<S?k:S,y=0;y<_;++y){var T=lt(w[y],g[y]);if(T!==0)return T}return k===S?0:k<S?-1:1}}catch{}return NaN}function ti(t){var e=typeof t;return e=="object"&&(ArrayBuffer.isView(t)||(e=de(t))==="ArrayBuffer")?"binary":e}function ei(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}function Vn(t,e,r){var o=t.schema.yProps;return o?(e&&0<r.numFailures&&(e=e.filter(function(u,l){return!r.failures[l]})),Promise.all(o.map(function(u){return u=u.updatesTable,e?t.db.table(u).where("k").anyOf(e).delete():t.db.table(u).clear()})).then(function(){return r})):r}ni.prototype.execute=function(t){var e=this["@@propmod"];if(e.add!==void 0){var r=e.add;if(m(r))return c(c([],m(t)?t:[],!0),r).sort();if(typeof r=="number")return(Number(t)||0)+r;if(typeof r=="bigint")try{return BigInt(t)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(e.remove!==void 0){var o=e.remove;if(m(o))return m(t)?t.filter(function(u){return!o.includes(u)}).sort():[];if(typeof o=="number")return Number(t)-o;if(typeof o=="bigint")try{return BigInt(t)-o}catch{return BigInt(0)-o}throw new TypeError("Invalid subtrahend ".concat(o))}return r=(r=e.replacePrefix)==null?void 0:r[0],r&&typeof t=="string"&&t.startsWith(r)?e.replacePrefix[1]+t.substring(r.length):t};var yn=ni;function ni(t){this["@@propmod"]=t}function ri(t,e){for(var r=h(e),o=r.length,u=!1,l=0;l<o;++l){var f=r[l],p=e[f],b=mt(t,f);p instanceof yn?(it(t,f,p.execute(b)),u=!0):b!==p&&(it(t,f,p),u=!0)}return u}bt.prototype._trans=function(t,e,r){var o=this._tx||Y.trans,u=this.name,l=ie&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function f(x,w,g){if(g.schema[u])return e(g.idbtrans,g);throw new H.NotFound("Table "+u+" not part of transaction")}var p=Ve();try{var b=o&&o.db._novip===this.db._novip?o===Y.trans?o._promise(t,f,r):_e(function(){return o._promise(t,f,r)},{trans:o,transless:Y.transless||Y}):function x(w,g,k,S){if(w.idbdb&&(w._state.openComplete||Y.letThrough||w._vip)){var _=w._createTransaction(g,k,w._dbSchema);try{_.create(),w._state.PR1398_maxLoop=3}catch(y){return y.name===Pr.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return x(w,g,k,S)})):Tt(y)}return _._promise(g,function(y,T){return _e(function(){return Y.trans=_,S(y,T,_)})}).then(function(y){if(g==="readwrite")try{_.idbtrans.commit()}catch{}return g==="readonly"?y:_._completion.then(function(){return y})})}if(w._state.openComplete)return Tt(new H.DatabaseClosed(w._state.dbOpenError));if(!w._state.isBeingOpened){if(!w._state.autoOpen)return Tt(new H.DatabaseClosed);w.open().catch(vt)}return w._state.dbReadyPromise.then(function(){return x(w,g,k,S)})}(this.db,t,[this.name],f);return l&&(b._consoleTask=l,b=b.catch(function(x){return console.trace(x),Tt(x)})),b}finally{p&&Ge()}},bt.prototype.get=function(t,e){var r=this;return t&&t.constructor===Object?this.where(t).first(e):t==null?Tt(new H.Type("Invalid argument to Table.get()")):this._trans("readonly",function(o){return r.core.get({trans:o,key:t}).then(function(u){return r.hook.reading.fire(u)})}).then(e)},bt.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(m(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var e=h(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(p){if(p.compound&&e.every(function(x){return 0<=p.keyPath.indexOf(x)})){for(var b=0;b<e.length;++b)if(e.indexOf(p.keyPath[b])===-1)return!1;return!0}return!1}).sort(function(p,b){return p.keyPath.length-b.keyPath.length})[0];if(r&&this.db._maxKey!==Le)return f=r.keyPath.slice(0,e.length),this.where(f).equals(f.map(function(p){return t[p]}));!r&&ie&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(e.join("+"),"]"));var o=this.schema.idxByName;function u(p,b){return lt(p,b)===0}var f=e.reduce(function(w,b){var x=w[0],w=w[1],g=o[b],k=t[b];return[x||g,x||!g?Re(w,g&&g.multi?function(S){return S=mt(S,b),m(S)&&S.some(function(_){return u(k,_)})}:function(S){return u(k,mt(S,b))}):w]},[null,null]),l=f[0],f=f[1];return l?this.where(l.name).equals(t[l.keyPath]).filter(f):r?this.filter(f):this.where(e).equals("")},bt.prototype.filter=function(t){return this.toCollection().and(t)},bt.prototype.count=function(t){return this.toCollection().count(t)},bt.prototype.offset=function(t){return this.toCollection().offset(t)},bt.prototype.limit=function(t){return this.toCollection().limit(t)},bt.prototype.each=function(t){return this.toCollection().each(t)},bt.prototype.toArray=function(t){return this.toCollection().toArray(t)},bt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},bt.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,m(t)?"[".concat(t.join("+"),"]"):t))},bt.prototype.reverse=function(){return this.toCollection().reverse()},bt.prototype.mapToClass=function(t){for(var e=this.db,r=this.name,o=((this.schema.mappedClass=t).prototype instanceof Zo&&(t=(f=>{var p=w,b=f;if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function x(){this.constructor=p}function w(){return f!==null&&f.apply(this,arguments)||this}return i(p,b),p.prototype=b===null?Object.create(b):(x.prototype=b.prototype,new x),Object.defineProperty(w.prototype,"db",{get:function(){return e},enumerable:!1,configurable:!0}),w.prototype.table=function(){return r},w})(t)),new Set),u=t.prototype;u;u=E(u))Object.getOwnPropertyNames(u).forEach(function(f){return o.add(f)});function l(f){if(!f)return f;var p,b=Object.create(t.prototype);for(p in f)if(!o.has(p))try{b[p]=f[p]}catch{}return b}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=l,this.hook("reading",l),t},bt.prototype.defineClass=function(){return this.mapToClass(function(t){v(this,t)})},bt.prototype.add=function(t,e){var r=this,o=this.schema.primKey,u=o.auto,l=o.keyPath,f=t;return l&&u&&(f=Xn(l)(t)),this._trans("readwrite",function(p){return r.core.mutate({trans:p,type:"add",keys:e!=null?[e]:null,values:[f]})}).then(function(p){return p.numFailures?K.reject(p.failures[0]):p.lastResult}).then(function(p){if(l)try{it(t,l,p)}catch{}return p})},bt.prototype.upsert=function(t,e){var r=this,o=this.schema.primKey.keyPath;return this._trans("readwrite",function(u){return r.core.get({trans:u,key:t}).then(function(l){var f=l??{};return ri(f,e),o&&it(f,o,t),r.core.mutate({trans:u,type:"put",values:[f],keys:[t],upsert:!0,updates:{keys:[t],changeSpecs:[e]}}).then(function(p){return p.numFailures?K.reject(p.failures[0]):!!l})})})},bt.prototype.update=function(t,e){return typeof t!="object"||m(t)?this.where(":id").equals(t).modify(e):(t=mt(t,this.schema.primKey.keyPath))===void 0?Tt(new H.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(e)},bt.prototype.put=function(t,e){var r=this,o=this.schema.primKey,u=o.auto,l=o.keyPath,f=t;return l&&u&&(f=Xn(l)(t)),this._trans("readwrite",function(p){return r.core.mutate({trans:p,type:"put",values:[f],keys:e!=null?[e]:null})}).then(function(p){return p.numFailures?K.reject(p.failures[0]):p.lastResult}).then(function(p){if(l)try{it(t,l,p)}catch{}return p})},bt.prototype.delete=function(t){var e=this;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"delete",keys:[t]}).then(function(o){return Vn(e,[t],o)}).then(function(o){return o.numFailures?K.reject(o.failures[0]):void 0})})},bt.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:Jo}).then(function(r){return Vn(t,null,r)})}).then(function(e){return e.numFailures?K.reject(e.failures[0]):void 0})},bt.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",function(r){return e.core.getMany({keys:t,trans:r}).then(function(o){return o.map(function(u){return e.hook.reading.fire(u)})})})},bt.prototype.bulkAdd=function(t,e,r){var o=this,u=Array.isArray(e)?e:void 0,l=(r=r||(u?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",function(f){var p=o.schema.primKey,x=p.auto,p=p.keyPath;if(p&&u)throw new H.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(u&&u.length!==t.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");var b=t.length,x=p&&x?t.map(Xn(p)):t;return o.core.mutate({trans:f,type:"add",keys:u,values:x,wantResults:l}).then(function(w){var g=w.numFailures,k=w.failures;if(g===0)return l?w.results:w.lastResult;throw new Xe("".concat(o.name,".bulkAdd(): ").concat(g," of ").concat(b," operations failed"),k)})})},bt.prototype.bulkPut=function(t,e,r){var o=this,u=Array.isArray(e)?e:void 0,l=(r=r||(u?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",function(f){var p=o.schema.primKey,x=p.auto,p=p.keyPath;if(p&&u)throw new H.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(u&&u.length!==t.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");var b=t.length,x=p&&x?t.map(Xn(p)):t;return o.core.mutate({trans:f,type:"put",keys:u,values:x,wantResults:l}).then(function(w){var g=w.numFailures,k=w.failures;if(g===0)return l?w.results:w.lastResult;throw new Xe("".concat(o.name,".bulkPut(): ").concat(g," of ").concat(b," operations failed"),k)})})},bt.prototype.bulkUpdate=function(t){var e=this,r=this.core,o=t.map(function(f){return f.key}),u=t.map(function(f){return f.changes}),l=[];return this._trans("readwrite",function(f){return r.getMany({trans:f,keys:o,cache:"clone"}).then(function(p){var b=[],x=[],w=(t.forEach(function(g,k){var S=g.key,_=g.changes,y=p[k];if(y){for(var T=0,I=Object.keys(_);T<I.length;T++){var D=I[T],O=_[D];if(D===e.schema.primKey.keyPath){if(lt(O,S)!==0)throw new H.Constraint("Cannot update primary key in bulkUpdate()")}else it(y,D,O)}l.push(k),b.push(S),x.push(y)}}),b.length);return r.mutate({trans:f,type:"put",keys:b,values:x,updates:{keys:o,changeSpecs:u}}).then(function(g){var k=g.numFailures,S=g.failures;if(k===0)return w;for(var _=0,y=Object.keys(S);_<y.length;_++){var T,I=y[_],D=l[Number(I)];D!=null&&(T=S[I],delete S[I],S[D]=T)}throw new Xe("".concat(e.name,".bulkUpdate(): ").concat(k," of ").concat(w," operations failed"),S)})})})},bt.prototype.bulkDelete=function(t){var e=this,r=t.length;return this._trans("readwrite",function(o){return e.core.mutate({trans:o,type:"delete",keys:t}).then(function(u){return Vn(e,t,u)})}).then(function(o){var u=o.numFailures,l=o.failures;if(u===0)return o.lastResult;throw new Xe("".concat(e.name,".bulkDelete(): ").concat(u," of ").concat(r," operations failed"),l)})};var oi=bt;function bt(){}function bn(t){function e(f,p){if(p){for(var b=arguments.length,x=new Array(b-1);--b;)x[b-1]=arguments[b];return r[f].subscribe.apply(null,x),t}if(typeof f=="string")return r[f]}var r={};e.addEventType=l;for(var o=1,u=arguments.length;o<u;++o)l(arguments[o]);return e;function l(f,p,b){var x,w;if(typeof f!="object")return p=p||ka,w={subscribers:[],fire:b=b||vt,subscribe:function(g){w.subscribers.indexOf(g)===-1&&(w.subscribers.push(g),w.fire=p(w.fire,g))},unsubscribe:function(g){w.subscribers=w.subscribers.filter(function(k){return k!==g}),w.fire=w.subscribers.reduce(p,b)}},r[f]=e[f]=w;h(x=f).forEach(function(g){var k=x[g];if(m(k))l(g,x[g][0],x[g][1]);else{if(k!=="asap")throw new H.InvalidArgument("Invalid event config");var S=l(g,hn,function(){for(var _=arguments.length,y=new Array(_);_--;)y[_]=arguments[_];S.subscribers.forEach(function(T){ut(function(){T.apply(null,y)})})})}})}}function wn(t,e){return X(e).from({prototype:t}),e}function Ze(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Ur(t,e){t.filter=Re(t.filter,e)}function Yr(t,e,r){var o=t.replayFilter;t.replayFilter=o?function(){return Re(o(),e())}:e,t.justLimit=r&&!o}function Gn(t,e){if(t.isPrimKey)return e.primaryKey;var r=e.getIndexByKeyPath(t.index);if(r)return r;throw new H.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed")}function ii(t,e,r){var o=Gn(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:o,range:t.range}})}function Qn(t,e,r,o){var u,l,f=t.replayFilter?Re(t.filter,t.replayFilter()):t.filter;return t.or?(u={},l=function(p,b,x){var w,g;f&&!f(b,x,function(k){return b.stop(k)},function(k){return b.fail(k)})||((g=""+(w=b.primaryKey))=="[object ArrayBuffer]"&&(g=""+new Uint8Array(w)),C(u,g))||(u[g]=!0,e(p,b,x))},Promise.all([t.or._iterate(l,r),ai(ii(t,o,r),t.algorithm,l,!t.keysOnly&&t.valueMapper)])):ai(ii(t,o,r),Re(t.algorithm,f),e,!t.keysOnly&&t.valueMapper)}function ai(t,e,r,o){var u=wt(o?function(l,f,p){return r(o(l),f,p)}:r);return t.then(function(l){if(l)return l.start(function(){var f=function(){return l.continue()};e&&!e(l,function(p){return f=p},function(p){l.stop(p),f=vt},function(p){l.fail(p),f=vt})||u(l.value,l,function(p){return f=p}),f()})})}ht.prototype._read=function(t,e){var r=this._ctx;return r.error?r.table._trans(null,Tt.bind(null,r.error)):r.table._trans("readonly",t).then(e)},ht.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,Tt.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},ht.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Re(e.algorithm,t)},ht.prototype._iterate=function(t,e){return Qn(this._ctx,t,e,this._ctx.table.core)},ht.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&v(r,t),e._ctx=r,e},ht.prototype.raw=function(){return this._ctx.valueMapper=null,this},ht.prototype.each=function(t){var e=this._ctx;return this._read(function(r){return Qn(e,t,r,e.table.core)})},ht.prototype.count=function(t){var e=this;return this._read(function(r){var o,u=e._ctx,l=u.table.core;return Ze(u,!0)?l.count({trans:r,query:{index:Gn(u,l.schema),range:u.range}}).then(function(f){return Math.min(f,u.limit)}):(o=0,Qn(u,function(){return++o,!1},r,l).then(function(){return o}))}).then(t)},ht.prototype.sortBy=function(t,e){var r=t.split(".").reverse(),o=r[0],u=r.length-1;function l(b,x){return x?l(b[r[x]],x-1):b[o]}var f=this._ctx.dir==="next"?1:-1;function p(b,x){return lt(l(b,u),l(x,u))*f}return this.toArray(function(b){return b.sort(p)}).then(e)},ht.prototype.toArray=function(t){var e=this;return this._read(function(r){var o,u,l,f=e._ctx;return f.dir==="next"&&Ze(f,!0)&&0<f.limit?(o=f.valueMapper,u=Gn(f,f.table.core.schema),f.table.core.query({trans:r,limit:f.limit,values:!0,query:{index:u,range:f.range}}).then(function(p){return p=p.result,o?p.map(o):p})):(l=[],Qn(f,function(p){return l.push(p)},r,f.table.core).then(function(){return l}))},t)},ht.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,Ze(e)?Yr(e,function(){var r=t;return function(o,u){return r===0||(r===1?--r:u(function(){o.advance(r),r=0}),!1)}}):Yr(e,function(){var r=t;return function(){return--r<0}})),this},ht.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Yr(this._ctx,function(){var e=t;return function(r,o,u){return--e<=0&&o(u),0<=e}},!0),this},ht.prototype.until=function(t,e){return Ur(this._ctx,function(r,o,u){return!t(r.value)||(o(u),e)}),this},ht.prototype.first=function(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)},ht.prototype.last=function(t){return this.reverse().first(t)},ht.prototype.filter=function(t){var e;return Ur(this._ctx,function(r){return t(r.value)}),(e=this._ctx).isMatch=Re(e.isMatch,t),this},ht.prototype.and=function(t){return this.filter(t)},ht.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},ht.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ht.prototype.desc=function(){return this.reverse()},ht.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(r,o){t(o.key,o)})},ht.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},ht.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(r,o){t(o.primaryKey,o)})},ht.prototype.keys=function(t){var e=this._ctx,r=(e.keysOnly=!e.isMatch,[]);return this.each(function(o,u){r.push(u.key)}).then(function(){return r}).then(t)},ht.prototype.primaryKeys=function(t){var e=this._ctx;if(e.dir==="next"&&Ze(e,!0)&&0<e.limit)return this._read(function(o){var u=Gn(e,e.table.core.schema);return e.table.core.query({trans:o,values:!1,limit:e.limit,query:{index:u,range:e.range}})}).then(function(o){return o.result}).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each(function(o,u){r.push(u.primaryKey)}).then(function(){return r}).then(t)},ht.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},ht.prototype.firstKey=function(t){return this.limit(1).keys(function(e){return e[0]}).then(t)},ht.prototype.lastKey=function(t){return this.reverse().firstKey(t)},ht.prototype.distinct=function(){var t,e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];return e&&e.multi&&(t={},Ur(this._ctx,function(o){var o=o.primaryKey.toString(),u=C(t,o);return t[o]=!0,!u})),this},ht.prototype.modify=function(t){var e=this,r=this._ctx;return this._write(function(o){function u(y,T){var I=T.failures;k+=y-T.numFailures;for(var D=0,O=h(I);D<O.length;D++){var P=O[D];g.push(I[P])}}var l=typeof t=="function"?t:function(y){return ri(y,t)},f=r.table.core,w=f.schema.primaryKey,p=w.outbound,b=w.extractKey,x=200,w=e.db._options.modifyChunkSize,g=(w&&(x=typeof w=="object"?w[f.name]||w["*"]||200:w),[]),k=0,S=[],_=t===si;return e.clone().primaryKeys().then(function(y){function T(D){var O=Math.min(x,y.length-D),P=y.slice(D,D+O);return(_?Promise.resolve([]):f.getMany({trans:o,keys:P,cache:"immutable"})).then(function(M){var L=[],$=[],q=p?[]:null,N=_?P:[];if(!_)for(var j=0;j<O;++j){var W=M[j],dt={value:jt(W),primKey:y[D+j]};l.call(dt,dt.value,dt)!==!1&&(dt.value==null?N.push(y[D+j]):p||lt(b(W),b(dt.value))===0?($.push(dt.value),p&&q.push(y[D+j])):(N.push(y[D+j]),L.push(dt.value)))}return Promise.resolve(0<L.length&&f.mutate({trans:o,type:"add",values:L}).then(function(pt){for(var G in pt.failures)N.splice(parseInt(G),1);u(L.length,pt)})).then(function(){return(0<$.length||I&&typeof t=="object")&&f.mutate({trans:o,type:"put",keys:q,values:$,criteria:I,changeSpec:typeof t!="function"&&t,isAdditionalChunk:0<D}).then(function(pt){return u($.length,pt)})}).then(function(){return(0<N.length||I&&_)&&f.mutate({trans:o,type:"delete",keys:N,criteria:I,isAdditionalChunk:0<D}).then(function(pt){return Vn(r.table,N,pt)}).then(function(pt){return u(N.length,pt)})}).then(function(){return y.length>D+O&&T(D+x)})})}var I=Ze(r)&&r.limit===1/0&&(typeof t!="function"||_)&&{index:r.index,range:r.range};return T(0).then(function(){if(0<g.length)throw new Kn("Error modifying one or more objects",g,k,S);return y.length})})})},ht.prototype.delete=function(){var t=this._ctx,e=t.range;return!Ze(t)||t.table.schema.yProps||!t.isPrimKey&&e.type!==3?this.modify(si):this._write(function(r){var o=t.table.core.schema.primaryKey,u=e;return t.table.core.count({trans:r,query:{index:o,range:u}}).then(function(l){return t.table.core.mutate({trans:r,type:"deleteRange",range:u}).then(function(b){var p=b.failures,b=b.numFailures;if(b)throw new Kn("Could not delete some values",Object.keys(p).map(function(x){return p[x]}),l-b);return l-b})})})};var Ia=ht;function ht(){}var si=function(t,e){return e.value=null};function Oa(t,e){return t<e?-1:t===e?0:1}function Aa(t,e){return e<t?-1:t===e?0:1}function zt(t,e,r){return t=t instanceof li?new t.Collection(t):t,t._ctx.error=new(r||TypeError)(e),t}function tn(t){return new t.Collection(t,function(){return ui("")}).limit(0)}function Jn(S,e,r,o){var u,l,f,p,b,x,w,g=r.length;if(!r.every(function(y){return typeof y=="string"}))return zt(S,Qo);function k(y){u=y==="next"?function(I){return I.toUpperCase()}:function(I){return I.toLowerCase()},l=y==="next"?function(I){return I.toLowerCase()}:function(I){return I.toUpperCase()},f=y==="next"?Oa:Aa;var T=r.map(function(I){return{lower:l(I),upper:u(I)}}).sort(function(I,D){return f(I.lower,D.lower)});p=T.map(function(I){return I.upper}),b=T.map(function(I){return I.lower}),w=(x=y)==="next"?"":o}k("next");var S=new S.Collection(S,function(){return Ee(p[0],b[g-1]+o)}),_=(S._ondirectionchange=function(y){k(y)},0);return S._addAlgorithm(function(y,T,I){var D=y.key;if(typeof D=="string"){var O=l(D);if(e(O,b,_))return!0;for(var P=null,M=_;M<g;++M){var L=(($,q,N,j,W,dt)=>{for(var pt=Math.min($.length,j.length),G=-1,ot=0;ot<pt;++ot){var kt=q[ot];if(kt!==j[ot])return W($[ot],N[ot])<0?$.substr(0,ot)+N[ot]+N.substr(ot+1):W($[ot],j[ot])<0?$.substr(0,ot)+j[ot]+N.substr(ot+1):0<=G?$.substr(0,G)+q[G]+N.substr(G+1):null;W($[ot],kt)<0&&(G=ot)}return pt<j.length&&dt==="next"?$+N.substr($.length):pt<$.length&&dt==="prev"?$.substr(0,N.length):G<0?null:$.substr(0,G)+j[G]+N.substr(G+1)})(D,O,p[M],b[M],f,x);L===null&&P===null?_=M+1:(P===null||0<f(P,L))&&(P=L)}T(P!==null?function(){y.continue(P+w)}:I)}return!1}),S}function Ee(t,e,r,o){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:o}}function ui(t){return{type:1,lower:t,upper:t}}Object.defineProperty($t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),$t.prototype.between=function(t,e,r,o){r=r!==!1,o=o===!0;try{return 0<this._cmp(t,e)||this._cmp(t,e)===0&&(r||o)&&(!r||!o)?tn(this):new this.Collection(this,function(){return Ee(t,e,!r,!o)})}catch{return zt(this,fe)}},$t.prototype.equals=function(t){return t==null?zt(this,fe):new this.Collection(this,function(){return ui(t)})},$t.prototype.above=function(t){return t==null?zt(this,fe):new this.Collection(this,function(){return Ee(t,void 0,!0)})},$t.prototype.aboveOrEqual=function(t){return t==null?zt(this,fe):new this.Collection(this,function(){return Ee(t,void 0,!1)})},$t.prototype.below=function(t){return t==null?zt(this,fe):new this.Collection(this,function(){return Ee(void 0,t,!1,!0)})},$t.prototype.belowOrEqual=function(t){return t==null?zt(this,fe):new this.Collection(this,function(){return Ee(void 0,t)})},$t.prototype.startsWith=function(t){return typeof t!="string"?zt(this,Qo):this.between(t,t+Le,!0,!0)},$t.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):Jn(this,function(e,r){return e.indexOf(r[0])===0},[t],Le)},$t.prototype.equalsIgnoreCase=function(t){return Jn(this,function(e,r){return e===r[0]},[t],"")},$t.prototype.anyOfIgnoreCase=function(){var t=oe.apply(be,arguments);return t.length===0?tn(this):Jn(this,function(e,r){return r.indexOf(e)!==-1},t,"")},$t.prototype.startsWithAnyOfIgnoreCase=function(){var t=oe.apply(be,arguments);return t.length===0?tn(this):Jn(this,function(e,r){return r.some(function(o){return e.indexOf(o)===0})},t,Le)},$t.prototype.anyOf=function(){var t,e,r=this,o=oe.apply(be,arguments),u=this._cmp;try{o.sort(u)}catch{return zt(this,fe)}return o.length===0?tn(this):((t=new this.Collection(this,function(){return Ee(o[0],o[o.length-1])}))._ondirectionchange=function(l){u=l==="next"?r._ascending:r._descending,o.sort(u)},e=0,t._addAlgorithm(function(l,f,p){for(var b=l.key;0<u(b,o[e]);)if(++e===o.length)return f(p),!1;return u(b,o[e])===0||(f(function(){l.continue(o[e])}),!1)}),t)},$t.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},$t.prototype.noneOf=function(){var t=oe.apply(be,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return zt(this,fe)}var e=t.reduce(function(r,o){return r?r.concat([[r[r.length-1][1],o]]):[[-1/0,o]]},null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},$t.prototype.inAnyRange=function(t,I){var r=this,o=this._cmp,u=this._ascending,l=this._descending,f=this._min,p=this._max;if(t.length===0)return tn(this);if(!t.every(function(D){return D[0]!==void 0&&D[1]!==void 0&&u(D[0],D[1])<=0}))return zt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",H.InvalidArgument);var b=!I||I.includeLowers!==!1,x=I&&I.includeUppers===!0,w,g=u;function k(D,O){return g(D[0],O[0])}try{(w=t.reduce(function(D,O){for(var P=0,M=D.length;P<M;++P){var L=D[P];if(o(O[0],L[1])<0&&0<o(O[1],L[0])){L[0]=f(L[0],O[0]),L[1]=p(L[1],O[1]);break}}return P===M&&D.push(O),D},[])).sort(k)}catch{return zt(this,fe)}var S=0,_=x?function(D){return 0<u(D,w[S][1])}:function(D){return 0<=u(D,w[S][1])},y=b?function(D){return 0<l(D,w[S][0])}:function(D){return 0<=l(D,w[S][0])},T=_,I=new this.Collection(this,function(){return Ee(w[0][0],w[w.length-1][1],!b,!x)});return I._ondirectionchange=function(D){g=D==="next"?(T=_,u):(T=y,l),w.sort(k)},I._addAlgorithm(function(D,O,P){for(var M,L=D.key;T(L);)if(++S===w.length)return O(P),!1;return!_(M=L)&&!y(M)||(r._cmp(L,w[S][1])===0||r._cmp(L,w[S][0])===0||O(function(){g===u?D.continue(w[S][0]):D.continue(w[S][1])}),!1)}),I},$t.prototype.startsWithAnyOf=function(){var t=oe.apply(be,arguments);return t.every(function(e){return typeof e=="string"})?t.length===0?tn(this):this.inAnyRange(t.map(function(e){return[e,e+Le]})):zt(this,"startsWithAnyOf() only works with strings")};var li=$t;function $t(){}function ae(t){return wt(function(e){return _n(e),t(e.target.error),!1})}function _n(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var kn="storagemutated",zr="x-storagemutated-1",De=bn(null,kn),Ca=(se.prototype._lock=function(){return z(!Y.global),++this._reculock,this._reculock!==1||Y.global||(Y.lockOwnerFor=this),this},se.prototype._unlock=function(){if(z(!Y.global),--this._reculock==0)for(Y.global||(Y.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{Me(t[1],t[0])}catch{}}return this},se.prototype._locked=function(){return this._reculock&&Y.lockOwnerFor!==this},se.prototype.create=function(t){var e=this;if(this.mode){var r=this.db.idbdb,o=this.db._state.dbOpenError;if(z(!this.idbtrans),!t&&!r)switch(o&&o.name){case"DatabaseClosedError":throw new H.DatabaseClosed(o);case"MissingAPIError":throw new H.MissingAPI(o.message,o);default:throw new H.OpenFailed(o)}if(!this.active)throw new H.TransactionInactive;z(this._completion._state===null),(t=this.idbtrans=t||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=wt(function(u){_n(u),e._reject(t.error)}),t.onabort=wt(function(u){_n(u),e.active&&e._reject(new H.Abort(t.error)),e.active=!1,e.on("abort").fire(u)}),t.oncomplete=wt(function(){e.active=!1,e._resolve(),"mutatedParts"in t&&De.storagemutated.fire(t.mutatedParts)})}return this},se.prototype._promise=function(t,e,r){var o,u=this;return t==="readwrite"&&this.mode!=="readwrite"?Tt(new H.ReadOnly("Transaction is readonly")):this.active?this._locked()?new K(function(l,f){u._blockedFuncs.push([function(){u._promise(t,e,r).then(l,f)},Y])}):r?_e(function(){var l=new K(function(f,p){u._lock();var b=e(f,p,u);b&&b.then&&b.then(f,p)});return l.finally(function(){return u._unlock()}),l._lib=!0,l}):((o=new K(function(l,f){var p=e(l,f,u);p&&p.then&&p.then(l,f)}))._lib=!0,o):Tt(new H.TransactionInactive)},se.prototype._root=function(){return this.parent?this.parent._root():this},se.prototype.waitFor=function(t){var e,r=this._root(),o=K.resolve(t),u=(r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return o}):(r._waitingFor=o,r._waitingQueue=[],e=r.idbtrans.objectStore(r.storeNames[0]),function l(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(e.get(-1/0).onsuccess=l)}()),r._waitingFor);return new K(function(l,f){o.then(function(p){return r._waitingQueue.push(wt(l.bind(null,p)))},function(p){return r._waitingQueue.push(wt(f.bind(null,p)))}).finally(function(){r._waitingFor===u&&(r._waitingFor=null)})})},se.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new H.Abort))},se.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(C(e,t))return e[t];var r=this.schema[t];if(r)return(r=new this.db.Table(t,r,this)).core=this.db.core.table(t),e[t]=r;throw new H.NotFound("Table "+t+" not part of transaction")},se);function se(){}function Hr(t,e,r,o,u,l,f,p){return{name:t,keyPath:e,unique:r,multi:o,auto:u,compound:l,src:(r&&!f?"&":"")+(o?"*":"")+(u?"++":"")+ci(e),type:p}}function ci(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Xr(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:(o=function(u){return[u.name,u]},r.reduce(function(u,l,f){return l=o(l,f),l&&(u[l[0]]=l[1]),u},{}))};var o}var Sn=function(t){try{return t.only([[]]),Sn=function(){return[[]]},[[]]}catch{return Sn=function(){return Le},Le}};function Vr(t){return t==null?function(){}:typeof t=="string"?(e=t).split(".").length===1?function(r){return r[e]}:function(r){return mt(r,e)}:function(r){return mt(r,t)};var e}function di(t){return[].slice.call(t)}var Pa=0;function En(t){return t==null?":id":typeof t=="string"?t:"[".concat(t.join("+"),"]")}function $a(t,e,b){function o(_){if(_.type===3)return null;if(_.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var g=_.lower,k=_.upper,S=_.lowerOpen,_=_.upperOpen;return g===void 0?k===void 0?null:e.upperBound(k,!!_):k===void 0?e.lowerBound(g,!!S):e.bound(g,k,!!S,!!_)}function u(w){var g,k=w.name;return{name:k,schema:w,mutate:function(S){var _=S.trans,y=S.type,T=S.keys,I=S.values,D=S.range;return new Promise(function(O,P){O=wt(O);var M=_.objectStore(k),L=M.keyPath==null,$=y==="put"||y==="add";if(!$&&y!=="delete"&&y!=="deleteRange")throw new Error("Invalid operation type: "+y);var q,N=(T||I||{length:1}).length;if(T&&I&&T.length!==I.length)throw new Error("Given keys array must have same length as given values array.");if(N===0)return O({numFailures:0,failures:{},results:[],lastResult:void 0});function j(Dt){++pt,_n(Dt)}var W=[],dt=[],pt=0;if(y==="deleteRange"){if(D.type===4)return O({numFailures:pt,failures:dt,results:[],lastResult:void 0});D.type===3?W.push(q=M.clear()):W.push(q=M.delete(o(D)))}else{var L=$?L?[I,T]:[I,null]:[T,null],G=L[0],ot=L[1];if($)for(var kt=0;kt<N;++kt)W.push(q=ot&&ot[kt]!==void 0?M[y](G[kt],ot[kt]):M[y](G[kt])),q.onerror=j;else for(kt=0;kt<N;++kt)W.push(q=M[y](G[kt])),q.onerror=j}function Qt(Dt){Dt=Dt.target.result,W.forEach(function(Be,po){return Be.error!=null&&(dt[po]=Be.error)}),O({numFailures:pt,failures:dt,results:y==="delete"?T:W.map(function(Be){return Be.result}),lastResult:Dt})}q.onerror=function(Dt){j(Dt),Qt(Dt)},q.onsuccess=Qt})},getMany:function(S){var _=S.trans,y=S.keys;return new Promise(function(T,I){T=wt(T);for(var D,O=_.objectStore(k),P=y.length,M=new Array(P),L=0,$=0,q=function(W){W=W.target,M[W._pos]=W.result,++$===L&&T(M)},N=ae(I),j=0;j<P;++j)y[j]!=null&&((D=O.get(y[j]))._pos=j,D.onsuccess=q,D.onerror=N,++L);L===0&&T(M)})},get:function(S){var _=S.trans,y=S.key;return new Promise(function(T,I){T=wt(T);var D=_.objectStore(k).get(y);D.onsuccess=function(O){return T(O.target.result)},D.onerror=ae(I)})},query:(g=p,function(S){return new Promise(function(_,y){_=wt(_);var T,I,D,$=S.trans,O=S.values,P=S.limit,L=S.query,M=P===1/0?void 0:P,q=L.index,L=L.range,$=$.objectStore(k),$=q.isPrimaryKey?$:$.index(q.name),q=o(L);if(P===0)return _({result:[]});g?((L=O?$.getAll(q,M):$.getAllKeys(q,M)).onsuccess=function(N){return _({result:N.target.result})},L.onerror=ae(y)):(T=0,I=!O&&"openKeyCursor"in $?$.openKeyCursor(q):$.openCursor(q),D=[],I.onsuccess=function(N){var j=I.result;return!j||(D.push(O?j.value:j.primaryKey),++T===P)?_({result:D}):void j.continue()},I.onerror=ae(y))})}),openCursor:function(S){var _=S.trans,y=S.values,T=S.query,I=S.reverse,D=S.unique;return new Promise(function(O,P){O=wt(O);var $=T.index,M=T.range,L=_.objectStore(k),L=$.isPrimaryKey?L:L.index($.name),$=I?D?"prevunique":"prev":D?"nextunique":"next",q=!y&&"openKeyCursor"in L?L.openKeyCursor(o(M),$):L.openCursor(o(M),$);q.onerror=ae(P),q.onsuccess=wt(function(N){var j,W,dt,pt,G=q.result;G?(G.___id=++Pa,G.done=!1,j=G.continue.bind(G),W=(W=G.continuePrimaryKey)&&W.bind(G),dt=G.advance.bind(G),pt=function(){throw new Error("Cursor not stopped")},G.trans=_,G.stop=G.continue=G.continuePrimaryKey=G.advance=function(){throw new Error("Cursor not started")},G.fail=wt(P),G.next=function(){var ot=this,kt=1;return this.start(function(){return kt--?ot.continue():ot.stop()}).then(function(){return ot})},G.start=function(ot){function kt(){if(q.result)try{ot()}catch(Dt){G.fail(Dt)}else G.done=!0,G.start=function(){throw new Error("Cursor behind last entry")},G.stop()}var Qt=new Promise(function(Dt,Be){Dt=wt(Dt),q.onerror=ae(Be),G.fail=Be,G.stop=function(po){G.stop=G.continue=G.continuePrimaryKey=G.advance=pt,Dt(po)}});return q.onsuccess=wt(function(Dt){q.onsuccess=kt,kt()}),G.continue=j,G.continuePrimaryKey=W,G.advance=dt,kt(),Qt},O(G)):O(null)},P)})},count:function(S){var _=S.query,y=S.trans,T=_.index,I=_.range;return new Promise(function(D,O){var P=y.objectStore(k),P=T.isPrimaryKey?P:P.index(T.name),M=o(I),M=M?P.count(M):P.count();M.onsuccess=wt(function(L){return D(L.target.result)}),M.onerror=ae(O)})}}}l=b,f=di((b=t).objectStoreNames);var l,b={schema:{name:b.name,tables:f.map(function(w){return l.objectStore(w)}).map(function(w){var g=w.keyPath,k=w.autoIncrement,_=m(g),S={},_={name:w.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g==null,compound:_,keyPath:g,autoIncrement:k,unique:!0,extractKey:Vr(g)},indexes:di(w.indexNames).map(function(y){return w.index(y)}).map(function(D){var O=D.name,T=D.unique,I=D.multiEntry,D=D.keyPath,O={name:O,compound:m(D),keyPath:D,unique:T,multiEntry:I,extractKey:Vr(D)};return S[En(D)]=O}),getIndexByKeyPath:function(y){return S[En(y)]}};return S[":id"]=_.primaryKey,g!=null&&(S[En(g)]=_.primaryKey),_})},hasGetAll:0<f.length&&"getAll"in l.objectStore(f[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},f=b.schema,p=b.hasGetAll,b=f.tables.map(u),x={};return b.forEach(function(w){return x[w.name]=w}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(w){if(x[w])return x[w];throw new Error("Table '".concat(w,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Sn(e),schema:f}}function ja(t,e,r,o){return r=r.IDBKeyRange,e=$a(e,r,o),{dbcore:t.dbcore.reduce(function(u,l){return l=l.create,s(s({},u),l(u))},e)}}function Zn(t,e){var r=e.db,r=ja(t._middlewares,r,t._deps,e);t.core=r.dbcore,t.tables.forEach(function(o){var u=o.name;t.core.schema.tables.some(function(l){return l.name===u})&&(o.core=t.core.table(u),t[u]instanceof t.Table)&&(t[u].core=o.core)})}function tr(t,e,r,o){r.forEach(function(u){var l=o[u];e.forEach(function(f){var p=function b(x,w){return nt(x,w)||(x=E(x))&&b(x,w)}(f,u);(!p||"value"in p&&p.value===void 0)&&(f===t.Transaction.prototype||f instanceof t.Transaction?U(f,u,{get:function(){return this.table(u)},set:function(b){F(this,u,{value:b,writable:!0,configurable:!0,enumerable:!0})}}):f[u]=new t.Table(u,l))})})}function Gr(t,e){e.forEach(function(r){for(var o in r)r[o]instanceof t.Table&&delete r[o]})}function Ma(t,e){return t._cfg.version-e._cfg.version}function La(t,e,r,o){var u=t._dbSchema,l=(r.objectStoreNames.contains("$meta")&&!u.$meta&&(u.$meta=Xr("$meta",hi("")[0],[]),t._storeNames.push("$meta")),t._createTransaction("readwrite",t._storeNames,u)),f=(l.create(r),l._completion.catch(o),l._reject.bind(l)),p=Y.transless||Y;_e(function(){if(Y.trans=l,Y.transless=p,e!==0)return Zn(t,r),x=e,((b=l).storeNames.includes("$meta")?b.table("$meta").get("version").then(function(w){return w??x}):K.resolve(x)).then(function(T){var g=t,k=T,S=l,_=r,y=[],T=g._versions,I=g._dbSchema=nr(0,g.idbdb,_);return(T=T.filter(function(D){return D._cfg.version>=k})).length===0?K.resolve():(T.forEach(function(D){y.push(function(){var O,P,M,L=I,$=D._cfg.dbschema,q=(rr(g,L,_),rr(g,$,_),I=g._dbSchema=$,Qr(L,$)),N=(q.add.forEach(function(j){Jr(_,j[0],j[1].primKey,j[1].indexes)}),q.change.forEach(function(j){if(j.recreate)throw new H.Upgrade("Not yet support for changing primary key");var W=_.objectStore(j.name);j.add.forEach(function(dt){return er(W,dt)}),j.change.forEach(function(dt){W.deleteIndex(dt.name),er(W,dt)}),j.del.forEach(function(dt){return W.deleteIndex(dt)})}),D._cfg.contentUpgrade);if(N&&D._cfg.version>k)return Zn(g,_),S._memoizedTables={},O=rt($),q.del.forEach(function(j){O[j]=L[j]}),Gr(g,[g.Transaction.prototype]),tr(g,[g.Transaction.prototype],h(O),O),S.schema=O,(P=ze(N))&&Qe(),$=K.follow(function(){var j;(M=N(S))&&P&&(j=ke.bind(null,null),M.then(j,j))}),M&&typeof M.then=="function"?K.resolve(M):$.then(function(){return M})}),y.push(function(O){var P,M,L=D._cfg.dbschema;P=L,M=O,[].slice.call(M.db.objectStoreNames).forEach(function($){return P[$]==null&&M.db.deleteObjectStore($)}),Gr(g,[g.Transaction.prototype]),tr(g,[g.Transaction.prototype],g._storeNames,g._dbSchema),S.schema=g._dbSchema}),y.push(function(O){g.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(g.idbdb.version/10)===D._cfg.version?(g.idbdb.deleteObjectStore("$meta"),delete g._dbSchema.$meta,g._storeNames=g._storeNames.filter(function(P){return P!=="$meta"})):O.objectStore("$meta").put(D._cfg.version,"version"))})}),function D(){return y.length?K.resolve(y.shift()(S.idbtrans)).then(D):K.resolve()}().then(function(){fi(I,_)}))}).catch(f);var b,x;h(u).forEach(function(w){Jr(r,w,u[w].primKey,u[w].indexes)}),Zn(t,r),K.follow(function(){return t.on.populate.fire(l)}).catch(f)})}function Ra(t,e){fi(t._dbSchema,e),e.db.version%10!=0||e.objectStoreNames.contains("$meta")||e.db.createObjectStore("$meta").add(Math.ceil(e.db.version/10-1),"version");var r=nr(0,t.idbdb,e);rr(t,t._dbSchema,e);for(var o=0,u=Qr(r,t._dbSchema).change;o<u.length;o++){var l=(f=>{if(f.change.length||f.recreate)return console.warn("Unable to patch indexes of table ".concat(f.name," because it has changes on the type of index or primary key.")),{value:void 0};var p=e.objectStore(f.name);f.add.forEach(function(b){ie&&console.debug("Dexie upgrade patch: Creating missing index ".concat(f.name,".").concat(b.src)),er(p,b)})})(u[o]);if(typeof l=="object")return l.value}}function Qr(t,e){var r,o={del:[],add:[],change:[]};for(r in t)e[r]||o.del.push(r);for(r in e){var u=t[r],l=e[r];if(u){var f={name:r,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(u.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||u.primKey.auto!==l.primKey.auto)f.recreate=!0,o.change.push(f);else{var p=u.idxByName,b=l.idxByName,x=void 0;for(x in p)b[x]||f.del.push(x);for(x in b){var w=p[x],g=b[x];w?w.src!==g.src&&f.change.push(g):f.add.push(g)}(0<f.del.length||0<f.add.length||0<f.change.length)&&o.change.push(f)}}else o.add.push([r,l])}return o}function Jr(t,e,r,o){var u=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});o.forEach(function(l){return er(u,l)})}function fi(t,e){h(t).forEach(function(r){e.db.objectStoreNames.contains(r)||(ie&&console.debug("Dexie: Creating missing table",r),Jr(e,r,t[r].primKey,t[r].indexes))})}function er(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function nr(t,e,r){var o={};return st(e.objectStoreNames,0).forEach(function(u){for(var l=r.objectStore(u),f=Hr(ci(x=l.keyPath),x||"",!0,!1,!!l.autoIncrement,x&&typeof x!="string",!0),p=[],b=0;b<l.indexNames.length;++b){var w=l.index(l.indexNames[b]),x=w.keyPath,w=Hr(w.name,x,!!w.unique,!!w.multiEntry,!1,x&&typeof x!="string",!1);p.push(w)}o[u]=Xr(u,f,p)}),o}function rr(t,e,r){for(var o=r.db.objectStoreNames,u=0;u<o.length;++u){var l=o[u],f=r.objectStore(l);t._hasGetAll="getAll"in f;for(var p=0;p<f.indexNames.length;++p){var b,x=f.indexNames[p],w=f.index(x).keyPath,w=typeof w=="string"?w:"["+st(w).join("+")+"]";e[l]&&(b=e[l].idxByName[w])&&(b.name=x,delete e[l].idxByName[w],e[l].idxByName[x]=b)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&d.WorkerGlobalScope&&d instanceof d.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function hi(t){return t.split(",").map(function(e,r){var u=e.split(":"),o=(o=u[1])==null?void 0:o.trim(),u=(e=u[0].trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Hr(u,l||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),m(l),r===0,o)})}en.prototype._createTableSchema=Xr,en.prototype._parseIndexSyntax=hi,en.prototype._parseStoresSpec=function(t,e){var r=this;h(t).forEach(function(o){if(t[o]!==null){var u=r._parseIndexSyntax(t[o]),l=u.shift();if(!l)throw new H.Schema("Invalid schema for table "+o+": "+t[o]);if(l.unique=!0,l.multi)throw new H.Schema("Primary key cannot be multiEntry*");u.forEach(function(f){if(f.auto)throw new H.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new H.Schema("Index must have a name and cannot be an empty string")}),l=r._createTableSchema(o,l,u),e[o]=l}})},en.prototype.stores=function(r){var e=this.db,r=(this._cfg.storesSource=this._cfg.storesSource?v(this._cfg.storesSource,r):r,e._versions),o={},u={};return r.forEach(function(l){v(o,l._cfg.storesSource),u=l._cfg.dbschema={},l._parseStoresSpec(o,u)}),e._dbSchema=u,Gr(e,[e._allTables,e,e.Transaction.prototype]),tr(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],h(u),u),e._storeNames=h(u),this},en.prototype.upgrade=function(t){return this._cfg.contentUpgrade=$r(this._cfg.contentUpgrade||vt,t),this};var Ka=en;function en(){}function Zr(t,e){var r=t._dbNamesDB;return r||(r=t._dbNamesDB=new he(Hn,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function to(t){return t&&typeof t.databases=="function"}function eo(t){return _e(function(){return Y.letThrough=!0,t()})}function no(t){return!("from"in t)}var Lt=function(t,e){var r;if(!this)return r=new Lt,t&&"d"in t&&v(r,t),r;v(this,arguments.length?{d:1,from:t,to:1<arguments.length?e:t}:{d:0})};function Dn(t,e,r){var o=lt(e,r);if(!isNaN(o)){if(0<o)throw RangeError();if(no(t))return v(t,{from:e,to:r,d:1});var o=t.l,u=t.r;if(lt(r,t.from)<0)return o?Dn(o,e,r):t.l={from:e,to:r,d:1,l:null,r:null},mi(t);if(0<lt(e,t.to))return u?Dn(u,e,r):t.r={from:e,to:r,d:1,l:null,r:null},mi(t);lt(e,t.from)<0&&(t.from=e,t.l=null,t.d=u?u.d+1:1),0<lt(r,t.to)&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1),e=!t.r,o&&!t.l&&xn(t,o),u&&e&&xn(t,u)}}function xn(t,e){no(e)||function r(o,u){var l=u.from,f=u.l,p=u.r;Dn(o,l,u.to),f&&r(o,f),p&&r(o,p)}(t,e)}function pi(t,e){var r=or(e),o=r.next();if(!o.done)for(var u=o.value,l=or(t),f=l.next(u.from),p=f.value;!o.done&&!f.done;){if(lt(p.from,u.to)<=0&&0<=lt(p.to,u.from))return!0;lt(u.from,p.from)<0?u=(o=r.next(p.from)).value:p=(f=l.next(u.from)).value}return!1}function or(t){var e=no(t)?null:{s:0,n:t};return{next:function(r){for(var o=0<arguments.length;e;)switch(e.s){case 0:if(e.s=1,o)for(;e.n.l&&lt(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!o||lt(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function mi(t){var e,r,o,u=(((u=t.r)==null?void 0:u.d)||0)-(((u=t.l)==null?void 0:u.d)||0),u=1<u?"r":u<-1?"l":"";u&&(e=u=="r"?"l":"r",r=s({},t),o=t[u],t.from=o.from,t.to=o.to,t[u]=o[u],r[u]=o[e],(t[e]=r).d=gi(r)),t.d=gi(t)}function gi(r){var e=r.r,r=r.l;return(e?r?Math.max(e.d,r.d):e.d:r?r.d:0)+1}function ir(t,e){return h(e).forEach(function(r){t[r]?xn(t[r],e[r]):t[r]=function o(u){var l,f,p={};for(l in u)C(u,l)&&(f=u[l],p[l]=!f||typeof f!="object"||Wt.has(f.constructor)?f:o(f));return p}(e[r])}),t}function ro(t,e){return t.all||e.all||Object.keys(t).some(function(r){return e[r]&&pi(e[r],t[r])})}B(Lt.prototype,((Yt={add:function(t){return xn(this,t),this},addKey:function(t){return Dn(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(r){return Dn(e,r,r)}),this},hasKey:function(t){var e=or(this).next(t).value;return e&&lt(e.from,t)<=0&&0<=lt(e.to,t)}})[Gt]=function(){return or(this)},Yt));var Ke={},oo={},io=!1;function ar(t){ir(oo,t),io||(io=!0,setTimeout(function(){io=!1,ao(oo,!(oo={}))},0))}function ao(t,e){e===void 0&&(e=!1);var r=new Set;if(t.all)for(var o=0,u=Object.values(Ke);o<u.length;o++)vi(p=u[o],t,r,e);else for(var l in t){var f,p,l=/^idb\:\/\/(.*)\/(.*)\//.exec(l);l&&(f=l[1],l=l[2],p=Ke["idb://".concat(f,"/").concat(l)])&&vi(p,t,r,e)}r.forEach(function(b){return b()})}function vi(t,e,r,o){for(var u=[],l=0,f=Object.entries(t.queries.query);l<f.length;l++){for(var p=f[l],b=p[0],x=[],w=0,g=p[1];w<g.length;w++){var k=g[w];ro(e,k.obsSet)?k.subscribers.forEach(function(T){return r.add(T)}):o&&x.push(k)}o&&u.push([b,x])}if(o)for(var S=0,_=u;S<_.length;S++){var y=_[S],b=y[0],x=y[1];t.queries.query[b]=x}}function Na(t){var e=t._state,r=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?Tt(e.dbOpenError):t});e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var o=e.openCanceller,u=Math.round(10*t.verno),l=!1;function f(){if(e.openCanceller!==o)throw new H.DatabaseClosed("db.open() was cancelled")}function p(){return new K(function(k,S){if(f(),!r)throw new H.MissingAPI;var _=t.name,y=e.autoSchema||!u?r.open(_):r.open(_,u);if(!y)throw new H.MissingAPI;y.onerror=ae(S),y.onblocked=wt(t._fireOnBlocked),y.onupgradeneeded=wt(function(T){var I;w=y.transaction,e.autoSchema&&!t._options.allowEmptyDB?(y.onerror=_n,w.abort(),y.result.close(),(I=r.deleteDatabase(_)).onsuccess=I.onerror=wt(function(){S(new H.NoSuchDatabase("Database ".concat(_," doesnt exist")))})):(w.onerror=ae(S),I=T.oldVersion>Math.pow(2,62)?0:T.oldVersion,g=I<1,t.idbdb=y.result,l&&Ra(t,w),La(t,I/10,w,S))},S),y.onsuccess=wt(function(){w=null;var T,I,D,O,P,M,L=t.idbdb=y.result,$=st(L.objectStoreNames);if(0<$.length)try{var q=L.transaction((P=$).length===1?P[0]:P,"readonly");if(e.autoSchema)M=L,O=q,(D=t).verno=M.version/10,O=D._dbSchema=nr(0,M,O),D._storeNames=st(M.objectStoreNames,0),tr(D,[D._allTables],h(O),O);else if(rr(t,t._dbSchema,q),I=q,((I=Qr(nr(0,(T=t).idbdb,I),T._dbSchema)).add.length||I.change.some(function(N){return N.add.length||N.change.length}))&&!l)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),L.close(),u=L.version+1,l=!0,k(p());Zn(t,q)}catch{}Je.push(t),L.onversionchange=wt(function(N){e.vcFired=!0,t.on("versionchange").fire(N)}),L.onclose=wt(function(){t.close({disableAutoOpen:!1})}),g&&($=t._deps,P=_,to(M=$.indexedDB)||P===Hn||Zr(M,$.IDBKeyRange).put({name:P}).catch(vt)),k()},S)}).catch(function(k){switch(k==null?void 0:k.name){case"UnknownError":if(0<e.PR1398_maxLoop)return e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),p();break;case"VersionError":if(0<u)return u=0,p()}return K.reject(k)})}var b,x=e.dbReadyResolve,w=null,g=!1;return K.race([o,(typeof navigator>"u"?K.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(k){function S(){return indexedDB.databases().finally(k)}b=setInterval(S,100),S()}).finally(function(){return clearInterval(b)}):Promise.resolve()).then(p)]).then(function(){return f(),e.onReadyBeingFired=[],K.resolve(eo(function(){return t.on.ready.fire(t.vip)})).then(function k(){var S;if(0<e.onReadyBeingFired.length)return S=e.onReadyBeingFired.reduce($r,vt),e.onReadyBeingFired=[],K.resolve(eo(function(){return S(t.vip)})).then(k)})}).finally(function(){e.openCanceller===o&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)}).catch(function(k){e.dbOpenError=k;try{w&&w.abort()}catch{}return o===e.openCanceller&&t._close(),Tt(k)}).finally(function(){e.openComplete=!0,x()}).then(function(){var k;return g&&(k={},t.tables.forEach(function(S){S.schema.indexes.forEach(function(_){_.name&&(k["idb://".concat(t.name,"/").concat(S.name,"/").concat(_.name)]=new Lt(-1/0,[[[]]]))}),k["idb://".concat(t.name,"/").concat(S.name,"/")]=k["idb://".concat(t.name,"/").concat(S.name,"/:dels")]=new Lt(-1/0,[[[]]])}),De(kn).fire(k),ao(k,!0)),t})}function so(t){function e(l){return t.next(l)}var r=u(e),o=u(function(l){return t.throw(l)});function u(l){return function(p){var p=l(p),b=p.value;return p.done?b:b&&typeof b.then=="function"?b.then(r,o):m(b)?Promise.all(b).then(r,o):r(b)}}return u(e)()}function sr(t,e,r){for(var o=m(t)?t.slice():[t],u=0;u<r;++u)o.push(e);return o}var Ba={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return s(s({},t),{table:function(o){var r=t.table(o),o=r.schema,u={},l=[];function f(k,S,_){var D=En(k),y=u[D]=u[D]||[],T=k==null?0:typeof k=="string"?1:k.length,I=0<S,D=s(s({},_),{name:I?"".concat(D,"(virtual-from:").concat(_.name,")"):_.name,lowLevelIndex:_,isVirtual:I,keyTail:S,keyLength:T,extractKey:Vr(k),unique:!I&&_.unique});return y.push(D),D.isPrimaryKey||l.push(D),1<T&&f(T===2?k[0]:k.slice(0,T-1),S+1,_),y.sort(function(O,P){return O.keyTail-P.keyTail}),D}var p=f(o.primaryKey.keyPath,0,o.primaryKey);u[":id"]=[p];for(var b=0,x=o.indexes;b<x.length;b++){var w=x[b];f(w.keyPath,0,w)}function g(k){var S,_=k.query.index;return _.isVirtual?s(s({},k),{query:{index:_.lowLevelIndex,range:(S=k.query.range,_=_.keyTail,{type:S.type===1?2:S.type,lower:sr(S.lower,S.lowerOpen?t.MAX_KEY:t.MIN_KEY,_),lowerOpen:!0,upper:sr(S.upper,S.upperOpen?t.MIN_KEY:t.MAX_KEY,_),upperOpen:!0})}}):k}return s(s({},r),{schema:s(s({},o),{primaryKey:p,indexes:l,getIndexByKeyPath:function(k){return(k=u[En(k)])&&k[0]}}),count:function(k){return r.count(g(k))},query:function(k){return r.query(g(k))},openCursor:function(k){var S=k.query.index,_=S.keyTail,y=S.keyLength;return S.isVirtual?r.openCursor(g(k)).then(function(I){return I&&T(I)}):r.openCursor(k);function T(I){return Object.create(I,{continue:{value:function(D){D!=null?I.continue(sr(D,k.reverse?t.MAX_KEY:t.MIN_KEY,_)):k.unique?I.continue(I.key.slice(0,y).concat(k.reverse?t.MIN_KEY:t.MAX_KEY,_)):I.continue()}},continuePrimaryKey:{value:function(D,O){I.continuePrimaryKey(sr(D,t.MAX_KEY,_),O)}},primaryKey:{get:function(){return I.primaryKey}},key:{get:function(){var D=I.key;return y===1?D[0]:D.slice(0,y)}},value:{get:function(){return I.value}}})}}})}})}};function uo(t,e,r,o){return r=r||{},o=o||"",h(t).forEach(function(u){var l,f,p;C(e,u)?(l=t[u],f=e[u],typeof l=="object"&&typeof f=="object"&&l&&f?(p=de(l))!==de(f)?r[o+u]=e[u]:p==="Object"?uo(l,f,r,o+u+"."):l!==f&&(r[o+u]=e[u]):l!==f&&(r[o+u]=e[u])):r[o+u]=void 0}),h(e).forEach(function(u){C(t,u)||(r[o+u]=e[u])}),r}function lo(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var qa={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return s(s({},t),{table:function(e){var r=t.table(e),o=r.schema.primaryKey;return s(s({},r),{mutate:function(u){var l=Y.trans,f=l.table(e).hook,p=f.deleting,b=f.creating,x=f.updating;switch(u.type){case"add":if(b.fire===vt)break;return l._promise("readwrite",function(){return w(u)},!0);case"put":if(b.fire===vt&&x.fire===vt)break;return l._promise("readwrite",function(){return w(u)},!0);case"delete":if(p.fire===vt)break;return l._promise("readwrite",function(){return w(u)},!0);case"deleteRange":if(p.fire===vt)break;return l._promise("readwrite",function(){return function g(k,S,_){return r.query({trans:k,values:!1,query:{index:o,range:S},limit:_}).then(function(y){var T=y.result;return w({type:"delete",keys:T,trans:k}).then(function(I){return 0<I.numFailures?Promise.reject(I.failures[0]):T.length<_?{failures:[],numFailures:0,lastResult:void 0}:g(k,s(s({},S),{lower:T[T.length-1],lowerOpen:!0}),_)})})}(u.trans,u.range,1e4)},!0)}return r.mutate(u);function w(g){var k,S,_,y=Y.trans,T=g.keys||lo(o,g);if(T)return(g=g.type==="add"||g.type==="put"?s(s({},g),{keys:T}):s({},g)).type!=="delete"&&(g.values=c([],g.values)),g.keys&&(g.keys=c([],g.keys)),k=r,_=T,((S=g).type==="add"?Promise.resolve([]):k.getMany({trans:S.trans,keys:_,cache:"immutable"})).then(function(I){var D=T.map(function(O,P){var M,L,$,q=I[P],N={onerror:null,onsuccess:null};return g.type==="delete"?p.fire.call(N,O,q,y):g.type==="add"||q===void 0?(M=b.fire.call(N,O,g.values[P],y),O==null&&M!=null&&(g.keys[P]=O=M,o.outbound||it(g.values[P],o.keyPath,O))):(M=uo(q,g.values[P]),(L=x.fire.call(N,M,O,q,y))&&($=g.values[P],Object.keys(L).forEach(function(j){C($,j)?$[j]=L[j]:it($,j,L[j])}))),N});return r.mutate(g).then(function(O){for(var P=O.failures,M=O.results,L=O.numFailures,O=O.lastResult,$=0;$<T.length;++$){var q=(M||T)[$],N=D[$];q==null?N.onerror&&N.onerror(P[$]):N.onsuccess&&N.onsuccess(g.type==="put"&&I[$]?g.values[$]:q)}return{failures:P,results:M,numFailures:L,lastResult:O}}).catch(function(O){return D.forEach(function(P){return P.onerror&&P.onerror(O)}),Promise.reject(O)})});throw new Error("Keys missing")}}})}})}};function yi(t,e,r){try{if(!e||e.keys.length<t.length)return null;for(var o=[],u=0,l=0;u<e.keys.length&&l<t.length;++u)lt(e.keys[u],t[l])===0&&(o.push(r?jt(e.values[u]):e.values[u]),++l);return o.length===t.length?o:null}catch{return null}}var Fa={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var r=t.table(e);return s(s({},r),{getMany:function(o){var u;return o.cache?(u=yi(o.keys,o.trans._cache,o.cache==="clone"))?K.resolve(u):r.getMany(o).then(function(l){return o.trans._cache={keys:o.keys,values:o.cache==="clone"?jt(l):l},l}):r.getMany(o)},mutate:function(o){return o.type!=="add"&&(o.trans._cache=null),r.mutate(o)}})}}}};function bi(t,e){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!e.schema.primaryKey.outbound}function wi(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Wa={stack:"dbcore",level:0,name:"Observability",create:function(t){var e=t.schema.name,r=new Lt(t.MIN_KEY,t.MAX_KEY);return s(s({},t),{transaction:function(o,u,l){if(Y.subscr&&u!=="readonly")throw new H.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Y.querier));return t.transaction(o,u,l)},table:function(o){function u(T){var y,T=T.query;return[y=T.index,new Lt((y=(T=T.range).lower)!=null?y:t.MIN_KEY,(y=T.upper)!=null?y:t.MAX_KEY)]}var l=t.table(o),f=l.schema,p=f.primaryKey,b=f.indexes,x=p.extractKey,w=p.outbound,g=p.autoIncrement&&b.filter(function(_){return _.compound&&_.keyPath.includes(p.keyPath)}),k=s(s({},l),{mutate:function(_){function y(W){return W="idb://".concat(e,"/").concat(o,"/").concat(W),P[W]||(P[W]=new Lt)}var T,I,D,O=_.trans,P=_.mutatedParts||(_.mutatedParts={}),M=y(""),L=y(":dels"),$=_.type,N=_.type==="deleteRange"?[_.range]:_.type==="delete"?[_.keys]:_.values.length<50?[lo(p,_).filter(function(W){return W}),_.values]:[],q=N[0],N=N[1],j=_.trans._cache;return m(q)?(M.addKeys(q),($=$==="delete"||q.length===N.length?yi(q,j):null)||L.addKeys(q),($||N)&&(T=y,I=$,D=N,f.indexes.forEach(function(W){var dt=T(W.name||"");function pt(ot){return ot!=null?W.extractKey(ot):null}function G(ot){W.multiEntry&&m(ot)?ot.forEach(function(kt){return dt.addKey(kt)}):dt.addKey(ot)}(I||D).forEach(function(ot,Dt){var Qt=I&&pt(I[Dt]),Dt=D&&pt(D[Dt]);lt(Qt,Dt)!==0&&(Qt!=null&&G(Qt),Dt!=null)&&G(Dt)})}))):q?(N={from:(j=q.lower)!=null?j:t.MIN_KEY,to:($=q.upper)!=null?$:t.MAX_KEY},L.add(N),M.add(N)):(M.add(r),L.add(r),f.indexes.forEach(function(W){return y(W.name).add(r)})),l.mutate(_).then(function(W){return!q||_.type!=="add"&&_.type!=="put"||(M.addKeys(W.results),g&&g.forEach(function(dt){for(var pt=_.values.map(function(Qt){return dt.extractKey(Qt)}),G=dt.keyPath.findIndex(function(Qt){return Qt===p.keyPath}),ot=0,kt=W.results.length;ot<kt;++ot)pt[ot][G]=W.results[ot];y(dt.name).addKeys(pt)})),O.mutatedParts=ir(O.mutatedParts||{},P),W})}}),S={get:function(_){return[p,new Lt(_.key)]},getMany:function(_){return[p,new Lt().addKeys(_.keys)]},count:u,query:u,openCursor:u};return h(S).forEach(function(_){k[_]=function(y){var T=Y.subscr,I=!!T,D=bi(Y,l)&&wi(_,y)?y.obsSet={}:T;if(I){var O,T=function(N){return N="idb://".concat(e,"/").concat(o,"/").concat(N),D[N]||(D[N]=new Lt)},P=T(""),M=T(":dels"),I=S[_](y),L=I[0],I=I[1];if((_==="query"&&L.isPrimaryKey&&!y.values?M:T(L.name||"")).add(I),!L.isPrimaryKey){if(_!=="count")return O=_==="query"&&w&&y.values&&l.query(s(s({},y),{values:!1})),l[_].apply(this,arguments).then(function(N){if(_==="query"){if(w&&y.values)return O.then(function(pt){return pt=pt.result,P.addKeys(pt),N});var j=y.values?N.result.map(x):N.result;(y.values?P:M).addKeys(j)}else{var W,dt;if(_==="openCursor")return dt=y.values,(W=N)&&Object.create(W,{key:{get:function(){return M.addKey(W.primaryKey),W.key}},primaryKey:{get:function(){var pt=W.primaryKey;return M.addKey(pt),pt}},value:{get:function(){return dt&&P.addKey(W.primaryKey),W.value}}})}return N});M.add(r)}}return l[_].apply(this,arguments)}}),k}})}};function _i(t,e,r){var o;return r.numFailures===0?e:e.type==="deleteRange"||(o=e.keys?e.keys.length:"values"in e&&e.values?e.values.length:1,r.numFailures===o)?null:(o=s({},e),m(o.keys)&&(o.keys=o.keys.filter(function(u,l){return!(l in r.failures)})),"values"in o&&m(o.values)&&(o.values=o.values.filter(function(u,l){return!(l in r.failures)})),o)}function co(t,e){return r=t,((o=e).lower===void 0||(o.lowerOpen?0<lt(r,o.lower):0<=lt(r,o.lower)))&&(r=t,(o=e).upper===void 0||(o.upperOpen?lt(r,o.upper)<0:lt(r,o.upper)<=0));var r,o}function ki(t,e,r,o,u,l){var f,p,b,x,w,g;return!r||r.length===0||(f=e.query.index,p=f.multiEntry,b=e.query.range,x=o.schema.primaryKey.extractKey,w=f.extractKey,g=(f.lowLevelIndex||f).extractKey,(o=r.reduce(function(k,S){var _=k,y=[];if(S.type==="add"||S.type==="put")for(var T=new Lt,I=S.values.length-1;0<=I;--I){var D,O=S.values[I],P=x(O);!T.hasKey(P)&&(D=w(O),p&&m(D)?D.some(function(N){return co(N,b)}):co(D,b))&&(T.addKey(P),y.push(O))}switch(S.type){case"add":var M=new Lt().addKeys(e.values?k.map(function(j){return x(j)}):k),_=k.concat(e.values?y.filter(function(j){return j=x(j),!M.hasKey(j)&&(M.addKey(j),!0)}):y.map(function(j){return x(j)}).filter(function(j){return!M.hasKey(j)&&(M.addKey(j),!0)}));break;case"put":var L=new Lt().addKeys(S.values.map(function(j){return x(j)}));_=k.filter(function(j){return!L.hasKey(e.values?x(j):j)}).concat(e.values?y:y.map(function(j){return x(j)}));break;case"delete":var $=new Lt().addKeys(S.keys);_=k.filter(function(j){return!$.hasKey(e.values?x(j):j)});break;case"deleteRange":var q=S.range;_=k.filter(function(j){return!co(x(j),q)})}return _},t))===t)?t:(o.sort(function(k,S){return lt(g(k),g(S))||lt(x(k),x(S))}),e.limit&&e.limit<1/0&&(o.length>e.limit?o.length=e.limit:t.length===e.limit&&o.length<e.limit&&(u.dirty=!0)),l?Object.freeze(o):o)}function Si(t,e){return lt(t.lower,e.lower)===0&&lt(t.upper,e.upper)===0&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function Ua(t,e){return((r,o,u,l)=>{if(r===void 0)return o!==void 0?-1:0;if(o===void 0)return 1;if((r=lt(r,o))===0){if(u&&l)return 0;if(u)return 1;if(l)return-1}return r})(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&0<=((r,o,u,l)=>{if(r===void 0)return o!==void 0?1:0;if(o===void 0)return-1;if((r=lt(r,o))===0){if(u&&l)return 0;if(u)return-1;if(l)return 1}return r})(t.upper,e.upper,t.upperOpen,e.upperOpen)}function Ya(t,e,r,o){t.subscribers.add(r),o.addEventListener("abort",function(){var u,l;t.subscribers.delete(r),t.subscribers.size===0&&(u=t,l=e,setTimeout(function(){u.subscribers.size===0&&Ut(l,u)},3e3))})}var za={stack:"dbcore",level:0,name:"Cache",create:function(t){var e=t.schema.name;return s(s({},t),{transaction:function(r,o,u){var l,f,p=t.transaction(r,o,u);return o==="readwrite"&&(u=(l=new AbortController).signal,p.addEventListener("abort",(f=function(b){return function(){if(l.abort(),o==="readwrite"){for(var x=new Set,w=0,g=r;w<g.length;w++){var k=g[w],S=Ke["idb://".concat(e,"/").concat(k)];if(S){var _=t.table(k),y=S.optimisticOps.filter(function(W){return W.trans===p});if(p._explicit&&b&&p.mutatedParts)for(var T=0,I=Object.values(S.queries.query);T<I.length;T++)for(var D=0,O=(L=I[T]).slice();D<O.length;D++)ro(($=O[D]).obsSet,p.mutatedParts)&&(Ut(L,$),$.subscribers.forEach(function(W){return x.add(W)}));else if(0<y.length){S.optimisticOps=S.optimisticOps.filter(function(W){return W.trans!==p});for(var P=0,M=Object.values(S.queries.query);P<M.length;P++)for(var L,$,q,N=0,j=(L=M[P]).slice();N<j.length;N++)($=j[N]).res!=null&&p.mutatedParts&&(b&&!$.dirty?(q=Object.isFrozen($.res),q=ki($.res,$.req,y,_,$,q),$.dirty?(Ut(L,$),$.subscribers.forEach(function(W){return x.add(W)})):q!==$.res&&($.res=q,$.promise=K.resolve({result:q}))):($.dirty&&Ut(L,$),$.subscribers.forEach(function(W){return x.add(W)})))}}}x.forEach(function(W){return W()})}}})(!1),{signal:u}),p.addEventListener("error",f(!1),{signal:u}),p.addEventListener("complete",f(!0),{signal:u})),p},table:function(r){var o=t.table(r),u=o.schema.primaryKey;return s(s({},o),{mutate:function(l){var f,p=Y.trans;return!u.outbound&&p.db._options.cache!=="disabled"&&!p.explicit&&p.idbtrans.mode==="readwrite"&&(f=Ke["idb://".concat(e,"/").concat(r)])?(p=o.mutate(l),l.type!=="add"&&l.type!=="put"||!(50<=l.values.length||lo(u,l).some(function(b){return b==null}))?(f.optimisticOps.push(l),l.mutatedParts&&ar(l.mutatedParts),p.then(function(b){0<b.numFailures&&(Ut(f.optimisticOps,l),(b=_i(0,l,b))&&f.optimisticOps.push(b),l.mutatedParts)&&ar(l.mutatedParts)}),p.catch(function(){Ut(f.optimisticOps,l),l.mutatedParts&&ar(l.mutatedParts)})):p.then(function(b){var x=_i(0,s(s({},l),{values:l.values.map(function(w,g){var k;return b.failures[g]?w:(it(k=(k=u.keyPath)!=null&&k.includes(".")?jt(w):s({},w),u.keyPath,b.results[g]),k)})}),b);f.optimisticOps.push(x),queueMicrotask(function(){return l.mutatedParts&&ar(l.mutatedParts)})}),p):o.mutate(l)},query:function(l){var f,p,b,x,w,g,k;return bi(Y,o)&&wi("query",l)?(f=((b=Y.trans)==null?void 0:b.db._options.cache)==="immutable",p=(b=Y).requery,b=b.signal,g=((S,_,y,T)=>{var I=Ke["idb://".concat(S,"/").concat(_)];if(!I)return[];if(!(S=I.queries[y]))return[null,!1,I,null];var D=S[(T.query?T.query.index.name:null)||""];if(!D)return[null,!1,I,null];switch(y){case"query":var O=D.find(function(P){return P.req.limit===T.limit&&P.req.values===T.values&&Si(P.req.query.range,T.query.range)});return O?[O,!0,I,D]:[D.find(function(P){return("limit"in P.req?P.req.limit:1/0)>=T.limit&&(!T.values||P.req.values)&&Ua(P.req.query.range,T.query.range)}),!1,I,D];case"count":return O=D.find(function(P){return Si(P.req.query.range,T.query.range)}),[O,!!O,I,D]}})(e,r,"query",l),k=g[0],x=g[2],w=g[3],k&&g[1]?k.obsSet=l.obsSet:(g=o.query(l).then(function(S){var _=S.result;if(k&&(k.res=_),f){for(var y=0,T=_.length;y<T;++y)Object.freeze(_[y]);Object.freeze(_)}else S.result=jt(_);return S}).catch(function(S){return w&&k&&Ut(w,k),Promise.reject(S)}),k={obsSet:l.obsSet,promise:g,subscribers:new Set,type:"query",req:l,dirty:!1},w?w.push(k):(w=[k],(x=x||(Ke["idb://".concat(e,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[l.query.index.name||""]=w)),Ya(k,w,p,b),k.promise.then(function(S){return{result:ki(S.result,l,x==null?void 0:x.optimisticOps,o,k,f)}})):o.query(l)}})}})}};function ur(t,e){return new Proxy(t,{get:function(r,o,u){return o==="db"?e:Reflect.get(r,o,u)}})}It.prototype.version=function(t){if(isNaN(t)||t<.1)throw new H.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new H.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,r=e.filter(function(o){return o._cfg.version===t})[0];return r||(r=new this.Version(t),e.push(r),e.sort(Ma),r.stores({}),this._state.autoSchema=!1),r},It.prototype._whenReady=function(t){var e=this;return this.idbdb&&(this._state.openComplete||Y.letThrough||this._vip)?t():new K(function(r,o){if(e._state.openComplete)return o(new H.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return void o(new H.DatabaseClosed);e.open().catch(vt)}e._state.dbReadyPromise.then(r,o)}).then(t)},It.prototype.use=function(u){var e=u.stack,r=u.create,o=u.level,u=u.name,l=(u&&this.unuse({stack:e,name:u}),this._middlewares[e]||(this._middlewares[e]=[]));return l.push({stack:e,create:r,level:o??10,name:u}),l.sort(function(f,p){return f.level-p.level}),this},It.prototype.unuse=function(t){var e=t.stack,r=t.name,o=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(u){return o?u.create!==o:!!r&&u.name!==r})),this},It.prototype.open=function(){var t=this;return Me(we,function(){return Na(t)})},It.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var t=this._state,e=Je.indexOf(this);if(0<=e&&Je.splice(e,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new K(function(r){t.dbReadyResolve=r}),t.openCanceller=new K(function(r,o){t.cancelOpen=o}))},It.prototype.close=function(e){var e=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,r=this._state;e?(r.isBeingOpened&&r.cancelOpen(new H.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new H.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},It.prototype.delete=function(t){var e=this,r=(t===void 0&&(t={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),o=this._state;return new K(function(u,l){function f(){e.close(t);var p=e._deps.indexedDB.deleteDatabase(e.name);p.onsuccess=wt(function(){var b,x,w;b=e._deps,x=e.name,to(w=b.indexedDB)||x===Hn||Zr(w,b.IDBKeyRange).delete(x).catch(vt),u()}),p.onerror=ae(l),p.onblocked=e._fireOnBlocked}if(r)throw new H.InvalidArgument("Invalid closeOptions argument to db.delete()");o.isBeingOpened?o.dbReadyPromise.then(f):f()})},It.prototype.backendDB=function(){return this.idbdb},It.prototype.isOpen=function(){return this.idbdb!==null},It.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},It.prototype.hasFailed=function(){return this._state.dbOpenError!==null},It.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(It.prototype,"tables",{get:function(){var t=this;return h(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!1,configurable:!0}),It.prototype.transaction=function(){var t=(function(e,r,o){var u=arguments.length;if(u<2)throw new H.InvalidArgument("Too few arguments");for(var l=new Array(u-1);--u;)l[u-1]=arguments[u];return o=l.pop(),[e,Zt(l),o]}).apply(this,arguments);return this._transaction.apply(this,t)},It.prototype._transaction=function(t,e,r){var o,u,l=this,f=Y.trans,p=(f&&f.db===this&&t.indexOf("!")===-1||(f=null),t.indexOf("?")!==-1);t=t.replace("!","").replace("?","");try{if(u=e.map(function(x){if(x=x instanceof l.Table?x.name:x,typeof x!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return x}),t=="r"||t===Fr)o=Fr;else{if(t!="rw"&&t!=Wr)throw new H.InvalidArgument("Invalid transaction mode: "+t);o=Wr}if(f){if(f.mode===Fr&&o===Wr){if(!p)throw new H.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");f=null}f&&u.forEach(function(x){if(f&&f.storeNames.indexOf(x)===-1){if(!p)throw new H.SubTransaction("Table "+x+" not included in parent transaction.");f=null}}),p&&f&&!f.active&&(f=null)}}catch(x){return f?f._promise(null,function(w,g){g(x)}):Tt(x)}var b=(function x(w,g,k,S,_){return K.resolve().then(function(){var D=Y.transless||Y,y=w._createTransaction(g,k,w._dbSchema,S),D=(y.explicit=!0,{trans:y,transless:D});if(S)y.idbtrans=S.idbtrans;else try{y.create(),y.idbtrans._explicit=!0,w._state.PR1398_maxLoop=3}catch(O){return O.name===Pr.InvalidState&&w.isOpen()&&0<--w._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),w.close({disableAutoOpen:!1}),w.open().then(function(){return x(w,g,k,null,_)})):Tt(O)}var T,I=ze(_),D=(I&&Qe(),K.follow(function(){var O;(T=_.call(y,y))&&(I?(O=ke.bind(null,null),T.then(O,O)):typeof T.next=="function"&&typeof T.throw=="function"&&(T=so(T)))},D));return(T&&typeof T.then=="function"?K.resolve(T).then(function(O){return y.active?O:Tt(new H.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):D.then(function(){return T})).then(function(O){return S&&y._resolve(),y._completion.then(function(){return O})}).catch(function(O){return y._reject(O),Tt(O)})})}).bind(null,this,o,u,f,r);return f?f._promise(o,b,"lock"):Y.trans?Me(Y.transless,function(){return l._whenReady(b)}):this._whenReady(b)},It.prototype.table=function(t){if(C(this._allTables,t))return this._allTables[t];throw new H.InvalidTable("Table ".concat(t," does not exist"))};var he=It;function It(t,e){var r,o,u,l,f,p=this,b=(this._middlewares={},this.verno=0,It.dependencies),b=(this._options=e=s({addons:It.addons,autoOpen:!0,indexedDB:b.indexedDB,IDBKeyRange:b.IDBKeyRange,cache:"cloned"},e),this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange},e.addons),x=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:vt,dbReadyPromise:null,cancelOpen:vt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:e.autoOpen}),w=(x.dbReadyPromise=new K(function(g){x.dbReadyResolve=g}),x.openCanceller=new K(function(g,k){x.cancelOpen=k}),this._state=x,this.name=t,this.on=bn(this,"populate","blocked","versionchange","close",{ready:[$r,vt]}),this.once=function(g,k){var S=function(){for(var _=[],y=0;y<arguments.length;y++)_[y]=arguments[y];p.on(g).unsubscribe(S),k.apply(p,_)};return p.on(g,S)},this.on.ready.subscribe=et(this.on.ready.subscribe,function(g){return function(k,S){It.vip(function(){var _,y=p._state;y.openComplete?(y.dbOpenError||K.resolve().then(k),S&&g(k)):y.onReadyBeingFired?(y.onReadyBeingFired.push(k),S&&g(k)):(g(k),_=p,S||g(function T(){_.on.ready.unsubscribe(k),_.on.ready.unsubscribe(T)}))})}}),this.Collection=(r=this,wn(Ia.prototype,function(T,y){this.db=r;var S=Jo,_=null;if(y)try{S=y()}catch(D){_=D}var y=T._ctx,T=y.table,I=T.hook.reading.fire;this._ctx={table:T,index:y.index,isPrimKey:!y.index||T.schema.primKey.keyPath&&y.index===T.schema.primKey.name,range:S,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:_,or:y.or,valueMapper:I!==hn?I:null}})),this.Table=(o=this,wn(oi.prototype,function(g,k,S){this.db=o,this._tx=S,this.name=g,this.schema=k,this.hook=o._allTables[g]?o._allTables[g].hook:bn(null,{creating:[ba,vt],reading:[ya,hn],updating:[_a,vt],deleting:[wa,vt]})})),this.Transaction=(u=this,wn(Ca.prototype,function(g,k,S,_,y){var T=this;g!=="readonly"&&k.forEach(function(I){I=(I=S[I])==null?void 0:I.yProps,I&&(k=k.concat(I.map(function(D){return D.updatesTable})))}),this.db=u,this.mode=g,this.storeNames=k,this.schema=S,this.chromeTransactionDurability=_,this.idbtrans=null,this.on=bn(this,"complete","error","abort"),this.parent=y||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new K(function(I,D){T._resolve=I,T._reject=D}),this._completion.then(function(){T.active=!1,T.on.complete.fire()},function(I){var D=T.active;return T.active=!1,T.on.error.fire(I),T.parent?T.parent._reject(I):D&&T.idbtrans&&T.idbtrans.abort(),Tt(I)})})),this.Version=(l=this,wn(Ka.prototype,function(g){this.db=l,this._cfg={version:g,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(f=this,wn(li.prototype,function(g,k,S){if(this.db=f,this._ctx={table:g,index:k===":id"?null:k,or:S},this._cmp=this._ascending=lt,this._descending=function(_,y){return lt(y,_)},this._max=function(_,y){return 0<lt(_,y)?_:y},this._min=function(_,y){return lt(_,y)<0?_:y},this._IDBKeyRange=f._deps.IDBKeyRange,!this._IDBKeyRange)throw new H.MissingAPI})),this.on("versionchange",function(g){0<g.newVersion?console.warn("Another connection wants to upgrade database '".concat(p.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(p.name,"'. Closing db now to resume the delete request.")),p.close({disableAutoOpen:!1})}),this.on("blocked",function(g){!g.newVersion||g.newVersion<g.oldVersion?console.warn("Dexie.delete('".concat(p.name,"') was blocked")):console.warn("Upgrade '".concat(p.name,"' blocked by other connection holding version ").concat(g.oldVersion/10))}),this._maxKey=Sn(e.IDBKeyRange),this._createTransaction=function(g,k,S,_){return new p.Transaction(g,k,S,p._options.chromeTransactionDurability,_)},this._fireOnBlocked=function(g){p.on("blocked").fire(g),Je.filter(function(k){return k.name===p.name&&k!==p&&!k._state.vcFired}).map(function(k){return k.on("versionchange").fire(g)})},this.use(Fa),this.use(za),this.use(Wa),this.use(Ba),this.use(qa),new Proxy(this,{get:function(g,k,S){var _;return k==="_vip"||(k==="table"?function(y){return ur(p.table(y),w)}:(_=Reflect.get(g,k,S))instanceof oi?ur(_,w):k==="tables"?_.map(function(y){return ur(y,w)}):k==="_createTransaction"?function(){return ur(_.apply(this,arguments),w)}:_)}}));this.vip=w,b.forEach(function(g){return g(p)})}var lr,nn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ha=(fo.prototype.subscribe=function(t,e,r){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:e,complete:r})},fo.prototype[nn]=function(){return this},fo);function fo(t){this._subscribe=t}try{lr={indexedDB:d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,IDBKeyRange:d.IDBKeyRange||d.webkitIDBKeyRange}}catch{lr={indexedDB:null,IDBKeyRange:null}}function Ei(t){var e,r=!1,o=new Ha(function(u){var l=ze(t),f,p=!1,b={},x={},w={get closed(){return p},unsubscribe:function(){p||(p=!0,f&&f.abort(),g&&De.storagemutated.unsubscribe(S))}},g=(u.start&&u.start(w),!1),k=function(){return qr(_)},S=function(y){ir(b,y),ro(x,b)&&k()},_=function(){var y,T,I;!p&&lr.indexedDB&&(b={},y={},f&&f.abort(),f=new AbortController,I=(D=>{var O=Ve();try{l&&Qe();var P=_e(t,D);return P=l?P.finally(ke):P}finally{O&&Ge()}})(T={subscr:y,signal:f.signal,requery:k,querier:t,trans:null}),Promise.resolve(I).then(function(D){r=!0,e=D,p||T.signal.aborted||(b={},(O=>{for(var P in O)if(C(O,P))return;return 1})(x=y)||g||(De(kn,S),g=!0),qr(function(){return!p&&u.next&&u.next(D)}))},function(D){r=!1,["DatabaseClosedError","AbortError"].includes(D==null?void 0:D.name)||p||qr(function(){p||u.error&&u.error(D)})}))};return setTimeout(k,0),w});return o.hasValue=function(){return r},o.getValue=function(){return e},o}var Ne=he;function ho(t){var e=xe;try{xe=!0,De.storagemutated.fire(t),ao(t,!0)}finally{xe=e}}B(Ne,s(s({},ee),{delete:function(t){return new Ne(t,{addons:[]}).delete()},exists:function(t){return new Ne(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return e=Ne.dependencies,r=e.indexedDB,e=e.IDBKeyRange,(to(r)?Promise.resolve(r.databases()).then(function(o){return o.map(function(u){return u.name}).filter(function(u){return u!==Hn})}):Zr(r,e).toCollection().primaryKeys()).then(t)}catch{return Tt(new H.MissingAPI)}var e,r},defineClass:function(){return function(t){v(this,t)}},ignoreTransaction:function(t){return Y.trans?Me(Y.transless,t):t()},vip:eo,async:function(t){return function(){try{var e=so(t.apply(this,arguments));return e&&typeof e.then=="function"?e:K.resolve(e)}catch(r){return Tt(r)}}},spawn:function(t,e,r){try{var o=so(t.apply(r,e||[]));return o&&typeof o.then=="function"?o:K.resolve(o)}catch(u){return Tt(u)}},currentTransaction:{get:function(){return Y.trans||null}},waitFor:function(t,e){return t=K.resolve(typeof t=="function"?Ne.ignoreTransaction(t):t).timeout(e||6e4),Y.trans?Y.trans.waitFor(t):t},Promise:K,debug:{get:function(){return ie},set:function(t){Yo(t)}},derive:X,extend:v,props:B,override:et,Events:bn,on:De,liveQuery:Ei,extendObservabilitySet:ir,getByKeyPath:mt,setByKeyPath:it,delByKeyPath:function(t,e){typeof e=="string"?it(t,e,void 0):"length"in e&&[].map.call(e,function(r){it(t,r,void 0)})},shallowClone:rt,deepClone:jt,getObjectDiff:uo,cmp:lt,asap:ut,minKey:-1/0,addons:[],connections:Je,errnames:Pr,dependencies:lr,cache:Ke,semVer:"4.3.0",version:"4.3.0".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,r){return t+e/Math.pow(10,2*r)})})),Ne.maxKey=Sn(Ne.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(De(kn,function(t){xe||(t=new CustomEvent(zr,{detail:t}),xe=!0,dispatchEvent(t),xe=!1)}),addEventListener(zr,function(t){t=t.detail,xe||ho(t)}));var rn,xe=!1,Di=function(){};return typeof BroadcastChannel<"u"&&((Di=function(){(rn=new BroadcastChannel(zr)).onmessage=function(t){return t.data&&ho(t.data)}})(),typeof rn.unref=="function"&&rn.unref(),De(kn,function(t){xe||rn.postMessage(t)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(t){if(!he.disableBfCache&&t.persisted){ie&&console.debug("Dexie: handling persisted pagehide"),rn!=null&&rn.close();for(var e=0,r=Je;e<r.length;e++)r[e].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(t){!he.disableBfCache&&t.persisted&&(ie&&console.debug("Dexie: handling persisted pageshow"),Di(),ho({all:new Lt(-1/0,[[]])}))})),K.rejectionMapper=function(t,e){return!t||t instanceof He||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Uo[t.name]?t:(e=new Uo[t.name](e||t.message,t),"stack"in t&&U(e,"stack",{get:function(){return this.inner.stack}}),e)},Yo(ie),s(he,Object.freeze({__proto__:null,Dexie:he,Entity:Zo,PropModification:yn,RangeSet:Lt,add:function(t){return new yn({add:t})},cmp:lt,default:he,liveQuery:Ei,mergeRanges:xn,rangesOverlap:pi,remove:function(t){return new yn({remove:t})},replacePrefix:function(t,e){return new yn({replacePrefix:[t,e]})}}),{default:he}),he})})(zi);var Za=zi.exports;const To=Ja(Za),Ii=Symbol.for("Dexie"),Sr=globalThis[Ii]||(globalThis[Ii]=To);if(To.semVer!==Sr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${To.semVer} and ${Sr.semVer}`);const{liveQuery:eu,mergeRanges:nu,rangesOverlap:ru,RangeSet:ou,cmp:iu,Entity:au,PropModification:su,replacePrefix:uu,add:lu,remove:cu,DexieYProvider:du}=Sr;class ts extends Sr{constructor(){super("GymDatabase");pe(this,"workouts");pe(this,"logs");pe(this,"workoutTypes");pe(this,"profile");this.version(1).stores({workouts:"id, status, startTime, updatedAt, isDeleted",logs:"id, workoutId, workoutTypeId, date, updatedAt, isDeleted",workoutTypes:"id, updatedAt, isDeleted",profile:"id, updatedAt, isDeleted"})}}const V=new ts,jo="gym_web_auth";function Ar(){const a=localStorage.getItem(jo);try{return a?JSON.parse(a):null}catch{return null}}function Mo(a){localStorage.setItem(jo,JSON.stringify(a))}function Hi(){localStorage.removeItem(jo)}function Xi(){const a=Ar();if(!a)return null;const n=new URLSearchParams;return Object.entries(a).forEach(([i,s])=>{s!=null&&n.append(i,String(s))}),n.toString()}const es=Object.freeze(Object.defineProperty({__proto__:null,clearAuthData:Hi,getAuthData:Ar,getAuthString:Xi,saveAuthData:Mo},Symbol.toStringTag,{value:"Module"}));var Fi;const cr=(Fi=window.Telegram)==null?void 0:Fi.WebApp,Oi="https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4";class mo{static getHeaders(){const n={"Content-Type":"application/json"};if(cr!=null&&cr.initData)localStorage.getItem("skip_tma_auth")==="true"||(n["X-Telegram-Init-Data"]=cr.initData);else{const i=Xi();i&&(n["X-Telegram-Init-Data"]=i)}return n}static async sync(){if(!navigator.onLine)throw new Error("Offline");const n=this.getHeaders(),i=await fetch(Oi,{headers:n});if(!i.ok)throw i.status===401?new Error("Unauthorized"):new Error("Sync failed");const s=await i.json();await this.mergeData(s);const c=await this.readAll();await fetch(Oi,{method:"POST",headers:n,body:JSON.stringify(c)})}static async mergeData(n){await V.transaction("rw",V.workouts,V.logs,V.workoutTypes,V.profile,async()=>{if(await this.mergeTable(V.workouts,n.workouts),await this.mergeTable(V.logs,n.logs),await this.mergeTable(V.workoutTypes,n.workoutTypes),n.profile){const i={...n.profile,id:"me"};await this.mergeTable(V.profile,[i])}})}static async mergeTable(n,i=[]){const s=await n.toArray(),c=new Map(s.map(d=>[d.id,d]));for(const d of i){const h=c.get(d.id);if(!h)await n.put(d);else{const m=new Date(d.updatedAt).getTime(),v=new Date(h.updatedAt).getTime();m>v&&await n.put(d)}}}static async readAll(){return{workouts:await V.workouts.toArray(),logs:await V.logs.toArray(),workoutTypes:await V.workoutTypes.toArray(),profile:(await V.profile.toArray())[0]}}}const ns="gym_twa_data";var Wi;const on=(Wi=window.Telegram)==null?void 0:Wi.WebApp,go={workoutTypes:[{id:"1",name:"ÐÐ¸Ð¼ Ð»ÐµÐ¶Ð°",updatedAt:new Date().toISOString()},{id:"2",name:"ÐÑÐ¸ÑÐµÐ´Ð°Ð½Ð¸Ñ",updatedAt:new Date().toISOString()},{id:"3",name:"Ð¡ÑÐ°Ð½Ð¾Ð²Ð°Ñ ÑÑÐ³Ð°",updatedAt:new Date().toISOString()}],logs:[],workouts:[]};class rs{constructor(){pe(this,"onUpdateCallback");pe(this,"onSyncStatusChangeCallback");pe(this,"status","idle");pe(this,"cache",{...go});this.init()}async init(){await this.migrateFromLocalStorage(),this.sync().catch(console.error)}async migrateFromLocalStorage(){const n=localStorage.getItem(ns);if(n)try{const i=JSON.parse(n);if(await V.workoutTypes.count()===0){console.log("Migrating from localStorage to IDB...");const c=new Date().toISOString(),d=(i.workoutTypes||go.workoutTypes).map(v=>({...v,updatedAt:c}));await V.workoutTypes.bulkPut(d);const h=(i.logs||[]).map(v=>({...v,updatedAt:c,workoutId:v.workoutId||"legacy"}));await V.logs.bulkPut(h);const m=(i.workouts||[]).map(v=>({...v,updatedAt:c}));if(await V.workouts.bulkPut(m),i.profile){const v={...i.profile,id:"me",updatedAt:c};await V.profile.put(v)}}}catch(i){console.error("Migration failed",i)}else await V.workoutTypes.count()===0&&await V.workoutTypes.bulkPut(go.workoutTypes)}onUpdate(n){this.onUpdateCallback=n}onSyncStatusChange(n){this.onSyncStatusChangeCallback=n}setStatus(n){var i;this.status=n,(i=this.onSyncStatusChangeCallback)==null||i.call(this,n),n==="success"&&setTimeout(()=>{this.status==="success"&&this.setStatus("idle")},2e3)}async sync(){var i;const n=localStorage.getItem("skip_tma_auth")==="true";if(n&&!(await Yi(async()=>{const{getAuthString:c}=await Promise.resolve().then(()=>es);return{getAuthString:c}},void 0,import.meta.url)).getAuthString()){this.setStatus("idle");return}try{this.setStatus("saving"),await mo.sync(),this.setStatus("success"),(i=this.onUpdateCallback)==null||i.call(this)}catch(s){if(console.error("Sync failed",s),(s instanceof Error?s.message:String(s)).toLowerCase().includes("unauthorized")){if(n){this.setStatus("error");return}localStorage.setItem("skip_tma_auth","true"),Hi(),location.reload();return}s instanceof Error&&s.message==="Offline"?this.setStatus("idle"):this.setStatus("error")}}async reloadCache(){var n;this.cache=await mo.readAll(),(n=this.onUpdateCallback)==null||n.call(this)}getWorkoutTypes(){return this.cache.workoutTypes.filter(i=>!i.isDeleted).sort((i,s)=>(i.order??1/0)-(s.order??1/0))}getLogs(){return this.cache.logs.filter(n=>!n.isDeleted)}getWorkouts(){return this.cache.workouts.filter(n=>!n.isDeleted)}getActiveWorkout(){return this.cache.workouts.find(n=>!n.isDeleted&&(n.status==="active"||n.status==="paused"))}getProfile(){return this.cache.profile}async addWorkoutType(n,i="strength"){const s=this.getWorkoutTypes(),c=s.length>0?Math.max(...s.map(h=>h.order??0)):0,d={id:Date.now().toString(),name:n,category:i,order:c+1,updatedAt:new Date().toISOString()};return await V.workoutTypes.put(d),await this.reloadCache(),this.sync().catch(()=>{}),d}async deleteWorkoutType(n){const i=await V.workoutTypes.get(n);i&&(i.isDeleted=!0,i.updatedAt=new Date().toISOString(),await V.workoutTypes.put(i),await this.reloadCache(),this.sync().catch(()=>{}))}async updateWorkoutType(n,i,s){const c=await V.workoutTypes.get(n);c&&(c.name=i,s&&(c.category=s),c.updatedAt=new Date().toISOString(),await V.workoutTypes.put(c),await this.reloadCache(),this.sync().catch(()=>{}))}async startWorkout(n){this.getActiveWorkout()&&await this.finishWorkout();const s={id:Date.now().toString(),startTime:new Date().toISOString(),status:"active",name:n,isManual:!0,pauseIntervals:[],updatedAt:new Date().toISOString()};return await V.workouts.put(s),await this.reloadCache(),this.sync().catch(()=>{}),s}async pauseWorkout(){const n=this.getActiveWorkout();n&&n.status==="active"&&(n.status="paused",n.pauseIntervals.push({start:new Date().toISOString()}),n.updatedAt=new Date().toISOString(),await V.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{}))}async resumeWorkout(){const n=this.getActiveWorkout();if(n&&n.status==="paused"){n.status="active";const i=n.pauseIntervals[n.pauseIntervals.length-1];i&&!i.end&&(i.end=new Date().toISOString()),n.updatedAt=new Date().toISOString(),await V.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}async finishWorkout(){const n=this.getActiveWorkout();if(n){n.status="finished",n.endTime=new Date().toISOString();const i=n.pauseIntervals[n.pauseIntervals.length-1];i&&!i.end&&(i.end=n.endTime),n.updatedAt=new Date().toISOString(),await V.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}getWorkoutDuration(n){const i=new Date(n.startTime).getTime(),s=n.endTime?new Date(n.endTime).getTime():Date.now();let c=s-i;return n.pauseIntervals.forEach(h=>{const m=new Date(h.start).getTime(),v=h.end?new Date(h.end).getTime():n.status==="paused"?Date.now():s;v>m&&(c-=v-m)}),Math.floor(Math.max(0,c)/6e4)}async ensureActiveWorkout(){const n=this.getActiveWorkout();if(n)return n.id;const i=new Date().toISOString().split("T")[0],d=this.getWorkouts().filter(v=>v.startTime.startsWith(i)).sort((v,E)=>new Date(E.startTime).getTime()-new Date(v.startTime).getTime())[0];if(d&&!d.isManual&&d.status==="finished")return d.endTime=new Date().toISOString(),d.updatedAt=new Date().toISOString(),await V.workouts.put(d),await this.reloadCache(),this.sync().catch(()=>{}),d.id;const h=`implicit_${i}_${Date.now()}`,m={id:h,startTime:new Date().toISOString(),endTime:new Date().toISOString(),status:"finished",isManual:!1,pauseIntervals:[],updatedAt:new Date().toISOString()};return await V.workouts.put(m),await this.reloadCache(),this.sync().catch(()=>{}),h}async updateImplicitWorkoutBounds(n){const i=await V.workouts.get(n);if(!i||i.isManual)return;const c=(await V.logs.where("workoutId").equals(n).toArray()).filter(h=>!h.isDeleted);if(c.length===0)return;const d=c.sort((h,m)=>new Date(h.date).getTime()-new Date(m.date).getTime());i.startTime=d[0].date,i.endTime=d[d.length-1].date,i.status="finished",i.updatedAt=new Date().toISOString(),await V.workouts.put(i)}async addLog(n){const i=await this.ensureActiveWorkout(),s={...n,id:Date.now().toString(),date:new Date().toISOString(),workoutId:i,updatedAt:new Date().toISOString()};return await V.logs.put(s),await this.updateImplicitWorkoutBounds(i),await this.reloadCache(),this.sync().catch(()=>{}),s}async deleteLog(n){const i=await V.logs.get(n);if(i){const s=i.workoutId;i.isDeleted=!0,i.updatedAt=new Date().toISOString(),await V.logs.put(i),s&&await this.updateImplicitWorkoutBounds(s),await this.reloadCache(),this.sync().catch(()=>{})}}async updateLog(n){const i={...n,updatedAt:new Date().toISOString()};await V.logs.put(i),await this.reloadCache(),this.sync().catch(()=>{})}getProfileIdentifier(){var s,c;const n=this.cache.profile;if(n!=null&&n.telegramUsername)return n.telegramUsername;if(n!=null&&n.telegramUserId)return`id_${n.telegramUserId}`;const i=(c=(s=on==null?void 0:on.initDataUnsafe)==null?void 0:s.user)==null?void 0:c.id;return i?`id_${i}`:""}async updateProfileSettings(n){var h;const i=(h=on==null?void 0:on.initDataUnsafe)==null?void 0:h.user,s=i==null?void 0:i.id;let c=this.cache.profile;c?i!=null&&i.photo_url&&(c.photoUrl=i.photo_url):c={id:"me",isPublic:!1,showFullHistory:!1,telegramUserId:s||0,telegramUsername:i==null?void 0:i.username,photoUrl:i==null?void 0:i.photo_url,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};const d={...c,...n,updatedAt:new Date().toISOString()};await V.profile.put(d),await this.reloadCache(),this.sync().catch(()=>{})}async updateWorkoutTypeOrder(n){const i=n.map((s,c)=>{const d=this.cache.workoutTypes.find(h=>h.id===s);return d?{...d,order:c,updatedAt:new Date().toISOString()}:null}).filter(Boolean);i.length>0&&(await V.workoutTypes.bulkPut(i),await this.reloadCache(),this.sync().catch(()=>{}))}async getPublicProfile(n){try{const s=await fetch(`https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4?profile=${encodeURIComponent(n)}`);return s.ok?await s.json():null}catch{return null}}async exportData(){return await mo.readAll()}async importData(n){if(!n.logs||!n.workoutTypes)throw new Error("Invalid data format");await V.transaction("rw",V.workouts,V.logs,V.workoutTypes,V.profile,async()=>{var i,s,c;await V.workouts.clear(),await V.logs.clear(),await V.workoutTypes.clear(),await V.profile.clear(),(i=n.workouts)!=null&&i.length&&await V.workouts.bulkAdd(n.workouts),(s=n.logs)!=null&&s.length&&await V.logs.bulkAdd(n.logs),(c=n.workoutTypes)!=null&&c.length&&await V.workoutTypes.bulkAdd(n.workoutTypes),n.profile&&await V.profile.put({...n.profile,id:"me"})}),await this.reloadCache(),this.sync().catch(()=>{})}}const Q=new rs;Q.reloadCache().then(()=>{});function os(a=0,n=0){return n===1?a:Math.round(a*(1+n/30))}function is(a,n){const i=new Map;return a.filter(c=>c.workoutTypeId===n).forEach(c=>{const d=c.date.split("T")[0],h=os(c.weight||0,c.reps||0),m=i.get(d)||0;h>m&&i.set(d,h)}),i}function as(a,n){const i=new Set;return a.forEach(s=>i.add(s.startTime.split("T")[0])),n.forEach(s=>i.add(s.date.split("T")[0])),i}function ss(a){const n=a.filter(d=>d.endTime&&d.status==="finished");if(n.length===0)return{averageMinutes:0,totalMinutes:0,count:0};let i=0;n.forEach(d=>{const h=new Date(d.startTime).getTime(),m=new Date(d.endTime).getTime();let v=m-h;d.pauseIntervals&&d.pauseIntervals.forEach(E=>{const A=new Date(E.start).getTime(),C=E.end?new Date(E.end).getTime():m;v-=C-A}),i+=v});const s=Math.round(i/1e3/60);return{averageMinutes:Math.round(s/n.length),totalMinutes:s,count:n.length}}function Vi(a,n=6){const i=new Date,s=new Date(i);s.setMonth(i.getMonth()-n),s.setDate(s.getDate()-s.getDay());let c='<div class="heatmap-container"><div class="heatmap-grid">';const d=new Date(s),h=new Date(i);for(;d<=h;){const m=d.toISOString().split("T")[0],v=a.has(m),A=`heatmap-cell level-${v?4:0}`,C=`${m}: ${v?"Workout":"No workout"}`;c+=`<div class="${A}" title="${C}"></div>`,d.setDate(d.getDate()+1)}return c+="</div>",c+=`
        <div class="heatmap-legend">
            Less <div class="heatmap-cell level-0"></div>
            <div class="heatmap-cell level-4"></div> More
        </div>
    `,c+="</div>",c}function Ai(a){const n=new Map;a.forEach(c=>{const d=c.date.split("T")[0],h=(c.weight||0)*(c.reps||0);n.set(d,(n.get(d)||0)+h)});const i=Array.from(n.keys()).sort().slice(-10);if(i.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¾Ð±ÑÐµÐ¼Ð°</p>';const s=i.map(c=>({label:new Date(c).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:n.get(c)}));return cs(s,"ÐºÐ³")}function us(a){const n=Array.from(a.keys()).sort();if(n.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° 1RM</p>';const i=n.map(s=>({label:new Date(s).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:a.get(s)}));return Gi(i,"ÐºÐ³")}function ls(a){const n=a.filter(s=>s.status==="finished"&&s.endTime).sort((s,c)=>new Date(s.startTime).getTime()-new Date(c.startTime).getTime()).slice(-10);if(n.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÐ¸</p>';const i=n.map(s=>{const c=new Date(s.startTime).getTime(),d=new Date(s.endTime).getTime();let h=(d-c)/1e3/60;return s.pauseIntervals&&s.pauseIntervals.forEach(m=>{const v=new Date(m.start).getTime(),E=m.end?new Date(m.end).getTime():d;h-=(E-v)/1e3/60}),{label:new Date(s.startTime).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:Math.round(h)}});return Gi(i,"Ð¼Ð¸Ð½")}function cs(a,n){const c=Math.max(...a.map(h=>h.value))*1.1;return`
        <svg width="100%" height="150" preserveAspectRatio="none">
            ${a.map((h,m)=>{const v=h.value/c*100,E=m/a.length*100,A=1/a.length*80;return`
            <rect x="${E+5}%" y="${100-v}%" width="${A}%" height="${v}%" fill="var(--color-button)" rx="2" opacity="0.8">
               <title>${h.label}: ${h.value}${n}</title>
            </rect>
            <text x="${E+5+A/2}%" y="95%" font-size="10" text-anchor="middle" fill="var(--color-text)" style="pointer-events: none;">
                ${h.label}
            </text>
        `}).join("")}
        </svg>
    `}function Gi(a,n){const d=a.map(F=>F.value),h=Math.min(...d),m=Math.max(...d),v=m-h||1,E=F=>20+F/(a.length-1)*(400-2*20),A=F=>130-(F-h)/v*(150-2*20),C=a.map((F,U)=>`${E(U)},${A(F.value)}`).join(" "),B=a.map((F,U)=>`
        <circle cx="${E(U)}" cy="${A(F.value)}" r="4" fill="var(--color-bg)" stroke="var(--color-button)" stroke-width="2">
            <title>${F.label}: ${F.value}${n}</title>
        </circle>
    `).join("");return`
        <svg viewBox="0 0 400 150" class="chart">
             <polyline
                fill="none"
                stroke="var(--color-button)"
                stroke-width="3"
                stroke-linejoin="round"
                stroke-linecap="round"
                points="${C}"
            />
            ${B}
        </svg>
        <div style="display: flex; justify-content: space-between; margin-top: 4px; font-size: 12px; color: var(--color-hint);">
            <span>${Math.round(h)}${n}</span>
            <span>${Math.round(m)}${n}</span>
        </div>
    `}function ds(a,n){a.innerHTML=`
        <div class="page-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 24px;">ðï¸</div>
            <h1 class="title" style="margin-bottom: 12px;">ÐÐ¸Ð¼-Ð¶Ð¸Ð¼ 21</h1>
            <p class="subtitle" style="margin-bottom: 32px; opacity: 0.7;">ÐÐ¾Ð¹Ð´Ð¸ÑÐµ ÑÐµÑÐµÐ· Telegram, ÑÑÐ¾Ð±Ñ ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</p>
            <div id="telegram-login-container"></div>
        </div>
    `,window.onTelegramAuth=c=>{console.log("Telegram auth callback received:",c),Mo(c),localStorage.removeItem("skip_tma_auth"),n()};const i=document.createElement("script");i.src="https://telegram.org/js/telegram-widget.js?22",i.async=!0,i.setAttribute("data-telegram-login","gymgym21bot"),i.setAttribute("data-size","large"),i.setAttribute("data-radius","12"),i.setAttribute("data-onauth","onTelegramAuth(user)"),i.setAttribute("data-request-access","write");const s=document.getElementById("telegram-login-container");s&&s.appendChild(i)}function fs(a={}){const{immediate:n=!1,onNeedRefresh:i,onOfflineReady:s,onRegistered:c,onRegisteredSW:d,onRegisterError:h}=a;let m,v;const E=async(C=!0)=>{await v};async function A(){if("serviceWorker"in navigator){if(m=await Yi(async()=>{const{Workbox:C}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:C}},[],import.meta.url).then(({Workbox:C})=>new C("./sw.js",{scope:"./",type:"classic"})).catch(C=>{h==null||h(C)}),!m)return;m.addEventListener("activated",C=>{(C.isUpdate||C.isExternal)&&window.location.reload()}),m.addEventListener("installed",C=>{C.isUpdate||s==null||s()}),m.register({immediate:n}).then(C=>{d?d("./sw.js",C):c==null||c(C)}).catch(C=>{h==null||h(C)})}}return v=A(),E}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ci(a,n){var i=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),i.push.apply(i,s)}return i}function le(a){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Ci(Object(i),!0).forEach(function(s){hs(a,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):Ci(Object(i)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(i,s))})}return a}function gr(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?gr=function(n){return typeof n}:gr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},gr(a)}function hs(a,n,i){return n in a?Object.defineProperty(a,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[n]=i,a}function ve(){return ve=Object.assign||function(a){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(a[s]=i[s])}return a},ve.apply(this,arguments)}function ps(a,n){if(a==null)return{};var i={},s=Object.keys(a),c,d;for(d=0;d<s.length;d++)c=s[d],!(n.indexOf(c)>=0)&&(i[c]=a[c]);return i}function ms(a,n){if(a==null)return{};var i=ps(a,n),s,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);for(c=0;c<d.length;c++)s=d[c],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(a,s)&&(i[s]=a[s])}return i}var gs="1.15.6";function ge(a){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(a)}var ye=ge(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ln=ge(/Edge/i),Pi=ge(/firefox/i),Cn=ge(/safari/i)&&!ge(/chrome/i)&&!ge(/android/i),Lo=ge(/iP(ad|od|hone)/i),Qi=ge(/chrome/i)&&ge(/android/i),Ji={capture:!1,passive:!1};function ct(a,n,i){a.addEventListener(n,i,!ye&&Ji)}function at(a,n,i){a.removeEventListener(n,i,!ye&&Ji)}function Er(a,n){if(n){if(n[0]===">"&&(n=n.substring(1)),a)try{if(a.matches)return a.matches(n);if(a.msMatchesSelector)return a.msMatchesSelector(n);if(a.webkitMatchesSelector)return a.webkitMatchesSelector(n)}catch{return!1}return!1}}function Zi(a){return a.host&&a!==document&&a.host.nodeType?a.host:a.parentNode}function re(a,n,i,s){if(a){i=i||document;do{if(n!=null&&(n[0]===">"?a.parentNode===i&&Er(a,n):Er(a,n))||s&&a===i)return a;if(a===i)break}while(a=Zi(a))}return null}var $i=/\s+/g;function Ht(a,n,i){if(a&&n)if(a.classList)a.classList[i?"add":"remove"](n);else{var s=(" "+a.className+" ").replace($i," ").replace(" "+n+" "," ");a.className=(s+(i?" "+n:"")).replace($i," ")}}function J(a,n,i){var s=a&&a.style;if(s){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(a,""):a.currentStyle&&(i=a.currentStyle),n===void 0?i:i[n];!(n in s)&&n.indexOf("webkit")===-1&&(n="-webkit-"+n),s[n]=i+(typeof i=="string"?"":"px")}}function dn(a,n){var i="";if(typeof a=="string")i=a;else do{var s=J(a,"transform");s&&s!=="none"&&(i=s+" "+i)}while(!n&&(a=a.parentNode));var c=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return c&&new c(i)}function ta(a,n,i){if(a){var s=a.getElementsByTagName(n),c=0,d=s.length;if(i)for(;c<d;c++)i(s[c],c);return s}return[]}function ue(){var a=document.scrollingElement;return a||document.documentElement}function Ct(a,n,i,s,c){if(!(!a.getBoundingClientRect&&a!==window)){var d,h,m,v,E,A,C;if(a!==window&&a.parentNode&&a!==ue()?(d=a.getBoundingClientRect(),h=d.top,m=d.left,v=d.bottom,E=d.right,A=d.height,C=d.width):(h=0,m=0,v=window.innerHeight,E=window.innerWidth,A=window.innerHeight,C=window.innerWidth),(n||i)&&a!==window&&(c=c||a.parentNode,!ye))do if(c&&c.getBoundingClientRect&&(J(c,"transform")!=="none"||i&&J(c,"position")!=="static")){var B=c.getBoundingClientRect();h-=B.top+parseInt(J(c,"border-top-width")),m-=B.left+parseInt(J(c,"border-left-width")),v=h+d.height,E=m+d.width;break}while(c=c.parentNode);if(s&&a!==window){var F=dn(c||a),U=F&&F.a,X=F&&F.d;F&&(h/=X,m/=U,C/=U,A/=X,v=h+A,E=m+C)}return{top:h,left:m,bottom:v,right:E,width:C,height:A}}}function ji(a,n,i){for(var s=Ae(a,!0),c=Ct(a)[n];s;){var d=Ct(s)[i],h=void 0;if(h=c>=d,!h)return s;if(s===ue())break;s=Ae(s,!1)}return!1}function fn(a,n,i,s){for(var c=0,d=0,h=a.children;d<h.length;){if(h[d].style.display!=="none"&&h[d]!==Z.ghost&&(s||h[d]!==Z.dragged)&&re(h[d],i.draggable,a,!1)){if(c===n)return h[d];c++}d++}return null}function Ro(a,n){for(var i=a.lastElementChild;i&&(i===Z.ghost||J(i,"display")==="none"||n&&!Er(i,n));)i=i.previousElementSibling;return i||null}function Jt(a,n){var i=0;if(!a||!a.parentNode)return-1;for(;a=a.previousElementSibling;)a.nodeName.toUpperCase()!=="TEMPLATE"&&a!==Z.clone&&(!n||Er(a,n))&&i++;return i}function Mi(a){var n=0,i=0,s=ue();if(a)do{var c=dn(a),d=c.a,h=c.d;n+=a.scrollLeft*d,i+=a.scrollTop*h}while(a!==s&&(a=a.parentNode));return[n,i]}function vs(a,n){for(var i in a)if(a.hasOwnProperty(i)){for(var s in n)if(n.hasOwnProperty(s)&&n[s]===a[i][s])return Number(i)}return-1}function Ae(a,n){if(!a||!a.getBoundingClientRect)return ue();var i=a,s=!1;do if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var c=J(i);if(i.clientWidth<i.scrollWidth&&(c.overflowX=="auto"||c.overflowX=="scroll")||i.clientHeight<i.scrollHeight&&(c.overflowY=="auto"||c.overflowY=="scroll")){if(!i.getBoundingClientRect||i===document.body)return ue();if(s||n)return i;s=!0}}while(i=i.parentNode);return ue()}function ys(a,n){if(a&&n)for(var i in n)n.hasOwnProperty(i)&&(a[i]=n[i]);return a}function vo(a,n){return Math.round(a.top)===Math.round(n.top)&&Math.round(a.left)===Math.round(n.left)&&Math.round(a.height)===Math.round(n.height)&&Math.round(a.width)===Math.round(n.width)}var Pn;function ea(a,n){return function(){if(!Pn){var i=arguments,s=this;i.length===1?a.call(s,i[0]):a.apply(s,i),Pn=setTimeout(function(){Pn=void 0},n)}}}function bs(){clearTimeout(Pn),Pn=void 0}function na(a,n,i){a.scrollLeft+=n,a.scrollTop+=i}function ra(a){var n=window.Polymer,i=window.jQuery||window.Zepto;return n&&n.dom?n.dom(a).cloneNode(!0):i?i(a).clone(!0)[0]:a.cloneNode(!0)}function oa(a,n,i){var s={};return Array.from(a.children).forEach(function(c){var d,h,m,v;if(!(!re(c,n.draggable,a,!1)||c.animated||c===i)){var E=Ct(c);s.left=Math.min((d=s.left)!==null&&d!==void 0?d:1/0,E.left),s.top=Math.min((h=s.top)!==null&&h!==void 0?h:1/0,E.top),s.right=Math.max((m=s.right)!==null&&m!==void 0?m:-1/0,E.right),s.bottom=Math.max((v=s.bottom)!==null&&v!==void 0?v:-1/0,E.bottom)}}),s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}var qt="Sortable"+new Date().getTime();function ws(){var a=[],n;return{captureAnimationState:function(){if(a=[],!!this.options.animation){var s=[].slice.call(this.el.children);s.forEach(function(c){if(!(J(c,"display")==="none"||c===Z.ghost)){a.push({target:c,rect:Ct(c)});var d=le({},a[a.length-1].rect);if(c.thisAnimationDuration){var h=dn(c,!0);h&&(d.top-=h.f,d.left-=h.e)}c.fromRect=d}})}},addAnimationState:function(s){a.push(s)},removeAnimationState:function(s){a.splice(vs(a,{target:s}),1)},animateAll:function(s){var c=this;if(!this.options.animation){clearTimeout(n),typeof s=="function"&&s();return}var d=!1,h=0;a.forEach(function(m){var v=0,E=m.target,A=E.fromRect,C=Ct(E),B=E.prevFromRect,F=E.prevToRect,U=m.rect,X=dn(E,!0);X&&(C.top-=X.f,C.left-=X.e),E.toRect=C,E.thisAnimationDuration&&vo(B,C)&&!vo(A,C)&&(U.top-C.top)/(U.left-C.left)===(A.top-C.top)/(A.left-C.left)&&(v=ks(U,B,F,c.options)),vo(C,A)||(E.prevFromRect=A,E.prevToRect=C,v||(v=c.options.animation),c.animate(E,U,C,v)),v&&(d=!0,h=Math.max(h,v),clearTimeout(E.animationResetTimer),E.animationResetTimer=setTimeout(function(){E.animationTime=0,E.prevFromRect=null,E.fromRect=null,E.prevToRect=null,E.thisAnimationDuration=null},v),E.thisAnimationDuration=v)}),clearTimeout(n),d?n=setTimeout(function(){typeof s=="function"&&s()},h):typeof s=="function"&&s(),a=[]},animate:function(s,c,d,h){if(h){J(s,"transition",""),J(s,"transform","");var m=dn(this.el),v=m&&m.a,E=m&&m.d,A=(c.left-d.left)/(v||1),C=(c.top-d.top)/(E||1);s.animatingX=!!A,s.animatingY=!!C,J(s,"transform","translate3d("+A+"px,"+C+"px,0)"),this.forRepaintDummy=_s(s),J(s,"transition","transform "+h+"ms"+(this.options.easing?" "+this.options.easing:"")),J(s,"transform","translate3d(0,0,0)"),typeof s.animated=="number"&&clearTimeout(s.animated),s.animated=setTimeout(function(){J(s,"transition",""),J(s,"transform",""),s.animated=!1,s.animatingX=!1,s.animatingY=!1},h)}}}}function _s(a){return a.offsetWidth}function ks(a,n,i,s){return Math.sqrt(Math.pow(n.top-a.top,2)+Math.pow(n.left-a.left,2))/Math.sqrt(Math.pow(n.top-i.top,2)+Math.pow(n.left-i.left,2))*s.animation}var an=[],yo={initializeByDefault:!0},Rn={mount:function(n){for(var i in yo)yo.hasOwnProperty(i)&&!(i in n)&&(n[i]=yo[i]);an.forEach(function(s){if(s.pluginName===n.pluginName)throw"Sortable: Cannot mount plugin ".concat(n.pluginName," more than once")}),an.push(n)},pluginEvent:function(n,i,s){var c=this;this.eventCanceled=!1,s.cancel=function(){c.eventCanceled=!0};var d=n+"Global";an.forEach(function(h){i[h.pluginName]&&(i[h.pluginName][d]&&i[h.pluginName][d](le({sortable:i},s)),i.options[h.pluginName]&&i[h.pluginName][n]&&i[h.pluginName][n](le({sortable:i},s)))})},initializePlugins:function(n,i,s,c){an.forEach(function(m){var v=m.pluginName;if(!(!n.options[v]&&!m.initializeByDefault)){var E=new m(n,i,n.options);E.sortable=n,E.options=n.options,n[v]=E,ve(s,E.defaults)}});for(var d in n.options)if(n.options.hasOwnProperty(d)){var h=this.modifyOption(n,d,n.options[d]);typeof h<"u"&&(n.options[d]=h)}},getEventProperties:function(n,i){var s={};return an.forEach(function(c){typeof c.eventProperties=="function"&&ve(s,c.eventProperties.call(i[c.pluginName],n))}),s},modifyOption:function(n,i,s){var c;return an.forEach(function(d){n[d.pluginName]&&d.optionListeners&&typeof d.optionListeners[i]=="function"&&(c=d.optionListeners[i].call(n[d.pluginName],s))}),c}};function Ss(a){var n=a.sortable,i=a.rootEl,s=a.name,c=a.targetEl,d=a.cloneEl,h=a.toEl,m=a.fromEl,v=a.oldIndex,E=a.newIndex,A=a.oldDraggableIndex,C=a.newDraggableIndex,B=a.originalEvent,F=a.putSortable,U=a.extraEventProperties;if(n=n||i&&i[qt],!!n){var X,nt=n.options,ft="on"+s.charAt(0).toUpperCase()+s.substr(1);window.CustomEvent&&!ye&&!Ln?X=new CustomEvent(s,{bubbles:!0,cancelable:!0}):(X=document.createEvent("Event"),X.initEvent(s,!0,!0)),X.to=h||i,X.from=m||i,X.item=c||i,X.clone=d,X.oldIndex=v,X.newIndex=E,X.oldDraggableIndex=A,X.newDraggableIndex=C,X.originalEvent=B,X.pullMode=F?F.lastPutMode:void 0;var st=le(le({},U),Rn.getEventProperties(s,n));for(var et in st)X[et]=st[et];i&&i.dispatchEvent(X),nt[ft]&&nt[ft].call(n,X)}}var Es=["evt"],Bt=function(n,i){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=s.evt,d=ms(s,Es);Rn.pluginEvent.bind(Z)(n,i,le({dragEl:R,parentEl:xt,ghostEl:tt,rootEl:_t,nextEl:We,lastDownEl:vr,cloneEl:St,cloneHidden:Ie,dragStarted:Tn,putSortable:Mt,activeSortable:Z.active,originalEvent:c,oldIndex:ln,oldDraggableIndex:$n,newIndex:Xt,newDraggableIndex:Te,hideGhostForTarget:ua,unhideGhostForTarget:la,cloneNowHidden:function(){Ie=!0},cloneNowShown:function(){Ie=!1},dispatchSortableEvent:function(m){Kt({sortable:i,name:m,originalEvent:c})}},d))};function Kt(a){Ss(le({putSortable:Mt,cloneEl:St,targetEl:R,rootEl:_t,oldIndex:ln,oldDraggableIndex:$n,newIndex:Xt,newDraggableIndex:Te},a))}var R,xt,tt,_t,We,vr,St,Ie,ln,Xt,$n,Te,dr,Mt,un=!1,Dr=!1,xr=[],qe,ne,bo,wo,Li,Ri,Tn,sn,jn,Mn=!1,fr=!1,yr,Rt,_o=[],Io=!1,Tr=[],Cr=typeof document<"u",hr=Lo,Ki=Ln||ye?"cssFloat":"float",Ds=Cr&&!Qi&&!Lo&&"draggable"in document.createElement("div"),ia=function(){if(Cr){if(ye)return!1;var a=document.createElement("x");return a.style.cssText="pointer-events:auto",a.style.pointerEvents==="auto"}}(),aa=function(n,i){var s=J(n),c=parseInt(s.width)-parseInt(s.paddingLeft)-parseInt(s.paddingRight)-parseInt(s.borderLeftWidth)-parseInt(s.borderRightWidth),d=fn(n,0,i),h=fn(n,1,i),m=d&&J(d),v=h&&J(h),E=m&&parseInt(m.marginLeft)+parseInt(m.marginRight)+Ct(d).width,A=v&&parseInt(v.marginLeft)+parseInt(v.marginRight)+Ct(h).width;if(s.display==="flex")return s.flexDirection==="column"||s.flexDirection==="column-reverse"?"vertical":"horizontal";if(s.display==="grid")return s.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(d&&m.float&&m.float!=="none"){var C=m.float==="left"?"left":"right";return h&&(v.clear==="both"||v.clear===C)?"vertical":"horizontal"}return d&&(m.display==="block"||m.display==="flex"||m.display==="table"||m.display==="grid"||E>=c&&s[Ki]==="none"||h&&s[Ki]==="none"&&E+A>c)?"vertical":"horizontal"},xs=function(n,i,s){var c=s?n.left:n.top,d=s?n.right:n.bottom,h=s?n.width:n.height,m=s?i.left:i.top,v=s?i.right:i.bottom,E=s?i.width:i.height;return c===m||d===v||c+h/2===m+E/2},Ts=function(n,i){var s;return xr.some(function(c){var d=c[qt].options.emptyInsertThreshold;if(!(!d||Ro(c))){var h=Ct(c),m=n>=h.left-d&&n<=h.right+d,v=i>=h.top-d&&i<=h.bottom+d;if(m&&v)return s=c}}),s},sa=function(n){function i(d,h){return function(m,v,E,A){var C=m.options.group.name&&v.options.group.name&&m.options.group.name===v.options.group.name;if(d==null&&(h||C))return!0;if(d==null||d===!1)return!1;if(h&&d==="clone")return d;if(typeof d=="function")return i(d(m,v,E,A),h)(m,v,E,A);var B=(h?m:v).options.group.name;return d===!0||typeof d=="string"&&d===B||d.join&&d.indexOf(B)>-1}}var s={},c=n.group;(!c||gr(c)!="object")&&(c={name:c}),s.name=c.name,s.checkPull=i(c.pull,!0),s.checkPut=i(c.put),s.revertClone=c.revertClone,n.group=s},ua=function(){!ia&&tt&&J(tt,"display","none")},la=function(){!ia&&tt&&J(tt,"display","")};Cr&&!Qi&&document.addEventListener("click",function(a){if(Dr)return a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.stopImmediatePropagation&&a.stopImmediatePropagation(),Dr=!1,!1},!0);var Fe=function(n){if(R){n=n.touches?n.touches[0]:n;var i=Ts(n.clientX,n.clientY);if(i){var s={};for(var c in n)n.hasOwnProperty(c)&&(s[c]=n[c]);s.target=s.rootEl=i,s.preventDefault=void 0,s.stopPropagation=void 0,i[qt]._onDragOver(s)}}},Is=function(n){R&&R.parentNode[qt]._isOutsideThisEl(n.target)};function Z(a,n){if(!(a&&a.nodeType&&a.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(a));this.el=a,this.options=n=ve({},n),a[qt]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(a.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return aa(a,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(h,m){h.setData("Text",m.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:Z.supportPointer!==!1&&"PointerEvent"in window&&(!Cn||Lo),emptyInsertThreshold:5};Rn.initializePlugins(this,a,i);for(var s in i)!(s in n)&&(n[s]=i[s]);sa(n);for(var c in this)c.charAt(0)==="_"&&typeof this[c]=="function"&&(this[c]=this[c].bind(this));this.nativeDraggable=n.forceFallback?!1:Ds,this.nativeDraggable&&(this.options.touchStartThreshold=1),n.supportPointer?ct(a,"pointerdown",this._onTapStart):(ct(a,"mousedown",this._onTapStart),ct(a,"touchstart",this._onTapStart)),this.nativeDraggable&&(ct(a,"dragover",this),ct(a,"dragenter",this)),xr.push(this.el),n.store&&n.store.get&&this.sort(n.store.get(this)||[]),ve(this,ws())}Z.prototype={constructor:Z,_isOutsideThisEl:function(n){!this.el.contains(n)&&n!==this.el&&(sn=null)},_getDirection:function(n,i){return typeof this.options.direction=="function"?this.options.direction.call(this,n,i,R):this.options.direction},_onTapStart:function(n){if(n.cancelable){var i=this,s=this.el,c=this.options,d=c.preventOnFilter,h=n.type,m=n.touches&&n.touches[0]||n.pointerType&&n.pointerType==="touch"&&n,v=(m||n).target,E=n.target.shadowRoot&&(n.path&&n.path[0]||n.composedPath&&n.composedPath()[0])||v,A=c.filter;if(Ls(s),!R&&!(/mousedown|pointerdown/.test(h)&&n.button!==0||c.disabled)&&!E.isContentEditable&&!(!this.nativeDraggable&&Cn&&v&&v.tagName.toUpperCase()==="SELECT")&&(v=re(v,c.draggable,s,!1),!(v&&v.animated)&&vr!==v)){if(ln=Jt(v),$n=Jt(v,c.draggable),typeof A=="function"){if(A.call(this,n,v,this)){Kt({sortable:i,rootEl:E,name:"filter",targetEl:v,toEl:s,fromEl:s}),Bt("filter",i,{evt:n}),d&&n.preventDefault();return}}else if(A&&(A=A.split(",").some(function(C){if(C=re(E,C.trim(),s,!1),C)return Kt({sortable:i,rootEl:C,name:"filter",targetEl:v,fromEl:s,toEl:s}),Bt("filter",i,{evt:n}),!0}),A)){d&&n.preventDefault();return}c.handle&&!re(E,c.handle,s,!1)||this._prepareDragStart(n,m,v)}}},_prepareDragStart:function(n,i,s){var c=this,d=c.el,h=c.options,m=d.ownerDocument,v;if(s&&!R&&s.parentNode===d){var E=Ct(s);if(_t=d,R=s,xt=R.parentNode,We=R.nextSibling,vr=s,dr=h.group,Z.dragged=R,qe={target:R,clientX:(i||n).clientX,clientY:(i||n).clientY},Li=qe.clientX-E.left,Ri=qe.clientY-E.top,this._lastX=(i||n).clientX,this._lastY=(i||n).clientY,R.style["will-change"]="all",v=function(){if(Bt("delayEnded",c,{evt:n}),Z.eventCanceled){c._onDrop();return}c._disableDelayedDragEvents(),!Pi&&c.nativeDraggable&&(R.draggable=!0),c._triggerDragStart(n,i),Kt({sortable:c,name:"choose",originalEvent:n}),Ht(R,h.chosenClass,!0)},h.ignore.split(",").forEach(function(A){ta(R,A.trim(),ko)}),ct(m,"dragover",Fe),ct(m,"mousemove",Fe),ct(m,"touchmove",Fe),h.supportPointer?(ct(m,"pointerup",c._onDrop),!this.nativeDraggable&&ct(m,"pointercancel",c._onDrop)):(ct(m,"mouseup",c._onDrop),ct(m,"touchend",c._onDrop),ct(m,"touchcancel",c._onDrop)),Pi&&this.nativeDraggable&&(this.options.touchStartThreshold=4,R.draggable=!0),Bt("delayStart",this,{evt:n}),h.delay&&(!h.delayOnTouchOnly||i)&&(!this.nativeDraggable||!(Ln||ye))){if(Z.eventCanceled){this._onDrop();return}h.supportPointer?(ct(m,"pointerup",c._disableDelayedDrag),ct(m,"pointercancel",c._disableDelayedDrag)):(ct(m,"mouseup",c._disableDelayedDrag),ct(m,"touchend",c._disableDelayedDrag),ct(m,"touchcancel",c._disableDelayedDrag)),ct(m,"mousemove",c._delayedDragTouchMoveHandler),ct(m,"touchmove",c._delayedDragTouchMoveHandler),h.supportPointer&&ct(m,"pointermove",c._delayedDragTouchMoveHandler),c._dragStartTimer=setTimeout(v,h.delay)}else v()}},_delayedDragTouchMoveHandler:function(n){var i=n.touches?n.touches[0]:n;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){R&&ko(R),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var n=this.el.ownerDocument;at(n,"mouseup",this._disableDelayedDrag),at(n,"touchend",this._disableDelayedDrag),at(n,"touchcancel",this._disableDelayedDrag),at(n,"pointerup",this._disableDelayedDrag),at(n,"pointercancel",this._disableDelayedDrag),at(n,"mousemove",this._delayedDragTouchMoveHandler),at(n,"touchmove",this._delayedDragTouchMoveHandler),at(n,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(n,i){i=i||n.pointerType=="touch"&&n,!this.nativeDraggable||i?this.options.supportPointer?ct(document,"pointermove",this._onTouchMove):i?ct(document,"touchmove",this._onTouchMove):ct(document,"mousemove",this._onTouchMove):(ct(R,"dragend",this),ct(_t,"dragstart",this._onDragStart));try{document.selection?br(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(n,i){if(un=!1,_t&&R){Bt("dragStarted",this,{evt:i}),this.nativeDraggable&&ct(document,"dragover",Is);var s=this.options;!n&&Ht(R,s.dragClass,!1),Ht(R,s.ghostClass,!0),Z.active=this,n&&this._appendGhost(),Kt({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function(){if(ne){this._lastX=ne.clientX,this._lastY=ne.clientY,ua();for(var n=document.elementFromPoint(ne.clientX,ne.clientY),i=n;n&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(ne.clientX,ne.clientY),n!==i);)i=n;if(R.parentNode[qt]._isOutsideThisEl(n),i)do{if(i[qt]){var s=void 0;if(s=i[qt]._onDragOver({clientX:ne.clientX,clientY:ne.clientY,target:n,rootEl:i}),s&&!this.options.dragoverBubble)break}n=i}while(i=Zi(i));la()}},_onTouchMove:function(n){if(qe){var i=this.options,s=i.fallbackTolerance,c=i.fallbackOffset,d=n.touches?n.touches[0]:n,h=tt&&dn(tt,!0),m=tt&&h&&h.a,v=tt&&h&&h.d,E=hr&&Rt&&Mi(Rt),A=(d.clientX-qe.clientX+c.x)/(m||1)+(E?E[0]-_o[0]:0)/(m||1),C=(d.clientY-qe.clientY+c.y)/(v||1)+(E?E[1]-_o[1]:0)/(v||1);if(!Z.active&&!un){if(s&&Math.max(Math.abs(d.clientX-this._lastX),Math.abs(d.clientY-this._lastY))<s)return;this._onDragStart(n,!0)}if(tt){h?(h.e+=A-(bo||0),h.f+=C-(wo||0)):h={a:1,b:0,c:0,d:1,e:A,f:C};var B="matrix(".concat(h.a,",").concat(h.b,",").concat(h.c,",").concat(h.d,",").concat(h.e,",").concat(h.f,")");J(tt,"webkitTransform",B),J(tt,"mozTransform",B),J(tt,"msTransform",B),J(tt,"transform",B),bo=A,wo=C,ne=d}n.cancelable&&n.preventDefault()}},_appendGhost:function(){if(!tt){var n=this.options.fallbackOnBody?document.body:_t,i=Ct(R,!0,hr,!0,n),s=this.options;if(hr){for(Rt=n;J(Rt,"position")==="static"&&J(Rt,"transform")==="none"&&Rt!==document;)Rt=Rt.parentNode;Rt!==document.body&&Rt!==document.documentElement?(Rt===document&&(Rt=ue()),i.top+=Rt.scrollTop,i.left+=Rt.scrollLeft):Rt=ue(),_o=Mi(Rt)}tt=R.cloneNode(!0),Ht(tt,s.ghostClass,!1),Ht(tt,s.fallbackClass,!0),Ht(tt,s.dragClass,!0),J(tt,"transition",""),J(tt,"transform",""),J(tt,"box-sizing","border-box"),J(tt,"margin",0),J(tt,"top",i.top),J(tt,"left",i.left),J(tt,"width",i.width),J(tt,"height",i.height),J(tt,"opacity","0.8"),J(tt,"position",hr?"absolute":"fixed"),J(tt,"zIndex","100000"),J(tt,"pointerEvents","none"),Z.ghost=tt,n.appendChild(tt),J(tt,"transform-origin",Li/parseInt(tt.style.width)*100+"% "+Ri/parseInt(tt.style.height)*100+"%")}},_onDragStart:function(n,i){var s=this,c=n.dataTransfer,d=s.options;if(Bt("dragStart",this,{evt:n}),Z.eventCanceled){this._onDrop();return}Bt("setupClone",this),Z.eventCanceled||(St=ra(R),St.removeAttribute("id"),St.draggable=!1,St.style["will-change"]="",this._hideClone(),Ht(St,this.options.chosenClass,!1),Z.clone=St),s.cloneId=br(function(){Bt("clone",s),!Z.eventCanceled&&(s.options.removeCloneOnHide||_t.insertBefore(St,R),s._hideClone(),Kt({sortable:s,name:"clone"}))}),!i&&Ht(R,d.dragClass,!0),i?(Dr=!0,s._loopId=setInterval(s._emulateDragOver,50)):(at(document,"mouseup",s._onDrop),at(document,"touchend",s._onDrop),at(document,"touchcancel",s._onDrop),c&&(c.effectAllowed="move",d.setData&&d.setData.call(s,c,R)),ct(document,"drop",s),J(R,"transform","translateZ(0)")),un=!0,s._dragStartId=br(s._dragStarted.bind(s,i,n)),ct(document,"selectstart",s),Tn=!0,window.getSelection().removeAllRanges(),Cn&&J(document.body,"user-select","none")},_onDragOver:function(n){var i=this.el,s=n.target,c,d,h,m=this.options,v=m.group,E=Z.active,A=dr===v,C=m.sort,B=Mt||E,F,U=this,X=!1;if(Io)return;function nt(Ut,be){Bt(Ut,U,le({evt:n,isOwner:A,axis:F?"vertical":"horizontal",revert:h,dragRect:c,targetRect:d,canSort:C,fromSortable:B,target:s,completed:st,onMove:function(ze,ee){return pr(_t,i,R,c,ze,Ct(ze),n,ee)},changed:et},be))}function ft(){nt("dragOverAnimationCapture"),U.captureAnimationState(),U!==B&&B.captureAnimationState()}function st(Ut){return nt("dragOverCompleted",{insertion:Ut}),Ut&&(A?E._hideClone():E._showClone(U),U!==B&&(Ht(R,Mt?Mt.options.ghostClass:E.options.ghostClass,!1),Ht(R,m.ghostClass,!0)),Mt!==U&&U!==Z.active?Mt=U:U===Z.active&&Mt&&(Mt=null),B===U&&(U._ignoreWhileAnimating=s),U.animateAll(function(){nt("dragOverAnimationComplete"),U._ignoreWhileAnimating=null}),U!==B&&(B.animateAll(),B._ignoreWhileAnimating=null)),(s===R&&!R.animated||s===i&&!s.animated)&&(sn=null),!m.dragoverBubble&&!n.rootEl&&s!==document&&(R.parentNode[qt]._isOutsideThisEl(n.target),!Ut&&Fe(n)),!m.dragoverBubble&&n.stopPropagation&&n.stopPropagation(),X=!0}function et(){Xt=Jt(R),Te=Jt(R,m.draggable),Kt({sortable:U,name:"change",toEl:i,newIndex:Xt,newDraggableIndex:Te,originalEvent:n})}if(n.preventDefault!==void 0&&n.cancelable&&n.preventDefault(),s=re(s,m.draggable,i,!0),nt("dragOver"),Z.eventCanceled)return X;if(R.contains(n.target)||s.animated&&s.animatingX&&s.animatingY||U._ignoreWhileAnimating===s)return st(!1);if(Dr=!1,E&&!m.disabled&&(A?C||(h=xt!==_t):Mt===this||(this.lastPutMode=dr.checkPull(this,E,R,n))&&v.checkPut(this,E,R,n))){if(F=this._getDirection(n,s)==="vertical",c=Ct(R),nt("dragOverValid"),Z.eventCanceled)return X;if(h)return xt=_t,ft(),this._hideClone(),nt("revert"),Z.eventCanceled||(We?_t.insertBefore(R,We):_t.appendChild(R)),st(!0);var z=Ro(i,m.draggable);if(!z||Ps(n,F,this)&&!z.animated){if(z===R)return st(!1);if(z&&i===n.target&&(s=z),s&&(d=Ct(s)),pr(_t,i,R,c,s,d,n,!!s)!==!1)return ft(),z&&z.nextSibling?i.insertBefore(R,z.nextSibling):i.appendChild(R),xt=i,et(),st(!0)}else if(z&&Cs(n,F,this)){var ut=fn(i,0,m,!0);if(ut===R)return st(!1);if(s=ut,d=Ct(s),pr(_t,i,R,c,s,d,n,!1)!==!1)return ft(),i.insertBefore(R,ut),xt=i,et(),st(!0)}else if(s.parentNode===i){d=Ct(s);var mt=0,it,rt=R.parentNode!==i,gt=!xs(R.animated&&R.toRect||c,s.animated&&s.toRect||d,F),Zt=F?"top":"left",Wt=ji(s,"top","top")||ji(R,"top","top"),te=Wt?Wt.scrollTop:void 0;sn!==s&&(it=d[Zt],Mn=!1,fr=!gt&&m.invertSwap||rt),mt=$s(n,s,d,F,gt?1:m.swapThreshold,m.invertedSwapThreshold==null?m.swapThreshold:m.invertedSwapThreshold,fr,sn===s);var jt;if(mt!==0){var ce=Jt(R);do ce-=mt,jt=xt.children[ce];while(jt&&(J(jt,"display")==="none"||jt===tt))}if(mt===0||jt===s)return st(!1);sn=s,jn=mt;var de=s.nextElementSibling,Gt=!1;Gt=mt===1;var Ye=pr(_t,i,R,c,s,d,n,Gt);if(Ye!==!1)return(Ye===1||Ye===-1)&&(Gt=Ye===1),Io=!0,setTimeout(As,30),ft(),Gt&&!de?i.appendChild(R):s.parentNode.insertBefore(R,Gt?de:s),Wt&&na(Wt,0,te-Wt.scrollTop),xt=R.parentNode,it!==void 0&&!fr&&(yr=Math.abs(it-Ct(s)[Zt])),et(),st(!0)}if(i.contains(R))return st(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){at(document,"mousemove",this._onTouchMove),at(document,"touchmove",this._onTouchMove),at(document,"pointermove",this._onTouchMove),at(document,"dragover",Fe),at(document,"mousemove",Fe),at(document,"touchmove",Fe)},_offUpEvents:function(){var n=this.el.ownerDocument;at(n,"mouseup",this._onDrop),at(n,"touchend",this._onDrop),at(n,"pointerup",this._onDrop),at(n,"pointercancel",this._onDrop),at(n,"touchcancel",this._onDrop),at(document,"selectstart",this)},_onDrop:function(n){var i=this.el,s=this.options;if(Xt=Jt(R),Te=Jt(R,s.draggable),Bt("drop",this,{evt:n}),xt=R&&R.parentNode,Xt=Jt(R),Te=Jt(R,s.draggable),Z.eventCanceled){this._nulling();return}un=!1,fr=!1,Mn=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Oo(this.cloneId),Oo(this._dragStartId),this.nativeDraggable&&(at(document,"drop",this),at(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Cn&&J(document.body,"user-select",""),J(R,"transform",""),n&&(Tn&&(n.cancelable&&n.preventDefault(),!s.dropBubble&&n.stopPropagation()),tt&&tt.parentNode&&tt.parentNode.removeChild(tt),(_t===xt||Mt&&Mt.lastPutMode!=="clone")&&St&&St.parentNode&&St.parentNode.removeChild(St),R&&(this.nativeDraggable&&at(R,"dragend",this),ko(R),R.style["will-change"]="",Tn&&!un&&Ht(R,Mt?Mt.options.ghostClass:this.options.ghostClass,!1),Ht(R,this.options.chosenClass,!1),Kt({sortable:this,name:"unchoose",toEl:xt,newIndex:null,newDraggableIndex:null,originalEvent:n}),_t!==xt?(Xt>=0&&(Kt({rootEl:xt,name:"add",toEl:xt,fromEl:_t,originalEvent:n}),Kt({sortable:this,name:"remove",toEl:xt,originalEvent:n}),Kt({rootEl:xt,name:"sort",toEl:xt,fromEl:_t,originalEvent:n}),Kt({sortable:this,name:"sort",toEl:xt,originalEvent:n})),Mt&&Mt.save()):Xt!==ln&&Xt>=0&&(Kt({sortable:this,name:"update",toEl:xt,originalEvent:n}),Kt({sortable:this,name:"sort",toEl:xt,originalEvent:n})),Z.active&&((Xt==null||Xt===-1)&&(Xt=ln,Te=$n),Kt({sortable:this,name:"end",toEl:xt,originalEvent:n}),this.save()))),this._nulling()},_nulling:function(){Bt("nulling",this),_t=R=xt=tt=We=St=vr=Ie=qe=ne=Tn=Xt=Te=ln=$n=sn=jn=Mt=dr=Z.dragged=Z.ghost=Z.clone=Z.active=null,Tr.forEach(function(n){n.checked=!0}),Tr.length=bo=wo=0},handleEvent:function(n){switch(n.type){case"drop":case"dragend":this._onDrop(n);break;case"dragenter":case"dragover":R&&(this._onDragOver(n),Os(n));break;case"selectstart":n.preventDefault();break}},toArray:function(){for(var n=[],i,s=this.el.children,c=0,d=s.length,h=this.options;c<d;c++)i=s[c],re(i,h.draggable,this.el,!1)&&n.push(i.getAttribute(h.dataIdAttr)||Ms(i));return n},sort:function(n,i){var s={},c=this.el;this.toArray().forEach(function(d,h){var m=c.children[h];re(m,this.options.draggable,c,!1)&&(s[d]=m)},this),i&&this.captureAnimationState(),n.forEach(function(d){s[d]&&(c.removeChild(s[d]),c.appendChild(s[d]))}),i&&this.animateAll()},save:function(){var n=this.options.store;n&&n.set&&n.set(this)},closest:function(n,i){return re(n,i||this.options.draggable,this.el,!1)},option:function(n,i){var s=this.options;if(i===void 0)return s[n];var c=Rn.modifyOption(this,n,i);typeof c<"u"?s[n]=c:s[n]=i,n==="group"&&sa(s)},destroy:function(){Bt("destroy",this);var n=this.el;n[qt]=null,at(n,"mousedown",this._onTapStart),at(n,"touchstart",this._onTapStart),at(n,"pointerdown",this._onTapStart),this.nativeDraggable&&(at(n,"dragover",this),at(n,"dragenter",this)),Array.prototype.forEach.call(n.querySelectorAll("[draggable]"),function(i){i.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),xr.splice(xr.indexOf(this.el),1),this.el=n=null},_hideClone:function(){if(!Ie){if(Bt("hideClone",this),Z.eventCanceled)return;J(St,"display","none"),this.options.removeCloneOnHide&&St.parentNode&&St.parentNode.removeChild(St),Ie=!0}},_showClone:function(n){if(n.lastPutMode!=="clone"){this._hideClone();return}if(Ie){if(Bt("showClone",this),Z.eventCanceled)return;R.parentNode==_t&&!this.options.group.revertClone?_t.insertBefore(St,R):We?_t.insertBefore(St,We):_t.appendChild(St),this.options.group.revertClone&&this.animate(R,St),J(St,"display",""),Ie=!1}}};function Os(a){a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.cancelable&&a.preventDefault()}function pr(a,n,i,s,c,d,h,m){var v,E=a[qt],A=E.options.onMove,C;return window.CustomEvent&&!ye&&!Ln?v=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(v=document.createEvent("Event"),v.initEvent("move",!0,!0)),v.to=n,v.from=a,v.dragged=i,v.draggedRect=s,v.related=c||n,v.relatedRect=d||Ct(n),v.willInsertAfter=m,v.originalEvent=h,a.dispatchEvent(v),A&&(C=A.call(E,v,h)),C}function ko(a){a.draggable=!1}function As(){Io=!1}function Cs(a,n,i){var s=Ct(fn(i.el,0,i.options,!0)),c=oa(i.el,i.options,tt),d=10;return n?a.clientX<c.left-d||a.clientY<s.top&&a.clientX<s.right:a.clientY<c.top-d||a.clientY<s.bottom&&a.clientX<s.left}function Ps(a,n,i){var s=Ct(Ro(i.el,i.options.draggable)),c=oa(i.el,i.options,tt),d=10;return n?a.clientX>c.right+d||a.clientY>s.bottom&&a.clientX>s.left:a.clientY>c.bottom+d||a.clientX>s.right&&a.clientY>s.top}function $s(a,n,i,s,c,d,h,m){var v=s?a.clientY:a.clientX,E=s?i.height:i.width,A=s?i.top:i.left,C=s?i.bottom:i.right,B=!1;if(!h){if(m&&yr<E*c){if(!Mn&&(jn===1?v>A+E*d/2:v<C-E*d/2)&&(Mn=!0),Mn)B=!0;else if(jn===1?v<A+yr:v>C-yr)return-jn}else if(v>A+E*(1-c)/2&&v<C-E*(1-c)/2)return js(n)}return B=B||h,B&&(v<A+E*d/2||v>C-E*d/2)?v>A+E/2?1:-1:0}function js(a){return Jt(R)<Jt(a)?1:-1}function Ms(a){for(var n=a.tagName+a.className+a.src+a.href+a.textContent,i=n.length,s=0;i--;)s+=n.charCodeAt(i);return s.toString(36)}function Ls(a){Tr.length=0;for(var n=a.getElementsByTagName("input"),i=n.length;i--;){var s=n[i];s.checked&&Tr.push(s)}}function br(a){return setTimeout(a,0)}function Oo(a){return clearTimeout(a)}Cr&&ct(document,"touchmove",function(a){(Z.active||un)&&a.cancelable&&a.preventDefault()});Z.utils={on:ct,off:at,css:J,find:ta,is:function(n,i){return!!re(n,i,n,!1)},extend:ys,throttle:ea,closest:re,toggleClass:Ht,clone:ra,index:Jt,nextTick:br,cancelNextTick:Oo,detectDirection:aa,getChild:fn,expando:qt};Z.get=function(a){return a[qt]};Z.mount=function(){for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];n[0].constructor===Array&&(n=n[0]),n.forEach(function(s){if(!s.prototype||!s.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(s));s.utils&&(Z.utils=le(le({},Z.utils),s.utils)),Rn.mount(s)})};Z.create=function(a,n){return new Z(a,n)};Z.version=gs;var At=[],In,Ao,Co=!1,So,Eo,Ir,On;function Rs(){function a(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this))}return a.prototype={dragStarted:function(i){var s=i.originalEvent;this.sortable.nativeDraggable?ct(document,"dragover",this._handleAutoScroll):this.options.supportPointer?ct(document,"pointermove",this._handleFallbackAutoScroll):s.touches?ct(document,"touchmove",this._handleFallbackAutoScroll):ct(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(i){var s=i.originalEvent;!this.options.dragOverBubble&&!s.rootEl&&this._handleAutoScroll(s)},drop:function(){this.sortable.nativeDraggable?at(document,"dragover",this._handleAutoScroll):(at(document,"pointermove",this._handleFallbackAutoScroll),at(document,"touchmove",this._handleFallbackAutoScroll),at(document,"mousemove",this._handleFallbackAutoScroll)),Ni(),wr(),bs()},nulling:function(){Ir=Ao=In=Co=On=So=Eo=null,At.length=0},_handleFallbackAutoScroll:function(i){this._handleAutoScroll(i,!0)},_handleAutoScroll:function(i,s){var c=this,d=(i.touches?i.touches[0]:i).clientX,h=(i.touches?i.touches[0]:i).clientY,m=document.elementFromPoint(d,h);if(Ir=i,s||this.options.forceAutoScrollFallback||Ln||ye||Cn){Do(i,this.options,m,s);var v=Ae(m,!0);Co&&(!On||d!==So||h!==Eo)&&(On&&Ni(),On=setInterval(function(){var E=Ae(document.elementFromPoint(d,h),!0);E!==v&&(v=E,wr()),Do(i,c.options,E,s)},10),So=d,Eo=h)}else{if(!this.options.bubbleScroll||Ae(m,!0)===ue()){wr();return}Do(i,this.options,Ae(m,!1),!1)}}},ve(a,{pluginName:"scroll",initializeByDefault:!0})}function wr(){At.forEach(function(a){clearInterval(a.pid)}),At=[]}function Ni(){clearInterval(On)}var Do=ea(function(a,n,i,s){if(n.scroll){var c=(a.touches?a.touches[0]:a).clientX,d=(a.touches?a.touches[0]:a).clientY,h=n.scrollSensitivity,m=n.scrollSpeed,v=ue(),E=!1,A;Ao!==i&&(Ao=i,wr(),In=n.scroll,A=n.scrollFn,In===!0&&(In=Ae(i,!0)));var C=0,B=In;do{var F=B,U=Ct(F),X=U.top,nt=U.bottom,ft=U.left,st=U.right,et=U.width,z=U.height,ut=void 0,mt=void 0,it=F.scrollWidth,rt=F.scrollHeight,gt=J(F),Zt=F.scrollLeft,Wt=F.scrollTop;F===v?(ut=et<it&&(gt.overflowX==="auto"||gt.overflowX==="scroll"||gt.overflowX==="visible"),mt=z<rt&&(gt.overflowY==="auto"||gt.overflowY==="scroll"||gt.overflowY==="visible")):(ut=et<it&&(gt.overflowX==="auto"||gt.overflowX==="scroll"),mt=z<rt&&(gt.overflowY==="auto"||gt.overflowY==="scroll"));var te=ut&&(Math.abs(st-c)<=h&&Zt+et<it)-(Math.abs(ft-c)<=h&&!!Zt),jt=mt&&(Math.abs(nt-d)<=h&&Wt+z<rt)-(Math.abs(X-d)<=h&&!!Wt);if(!At[C])for(var ce=0;ce<=C;ce++)At[ce]||(At[ce]={});(At[C].vx!=te||At[C].vy!=jt||At[C].el!==F)&&(At[C].el=F,At[C].vx=te,At[C].vy=jt,clearInterval(At[C].pid),(te!=0||jt!=0)&&(E=!0,At[C].pid=setInterval((function(){s&&this.layer===0&&Z.active._onTouchMove(Ir);var de=At[this.layer].vy?At[this.layer].vy*m:0,Gt=At[this.layer].vx?At[this.layer].vx*m:0;typeof A=="function"&&A.call(Z.dragged.parentNode[qt],Gt,de,a,Ir,At[this.layer].el)!=="continue"||na(At[this.layer].el,Gt,de)}).bind({layer:C}),24))),C++}while(n.bubbleScroll&&B!==v&&(B=Ae(B,!1)));Co=E}},30),ca=function(n){var i=n.originalEvent,s=n.putSortable,c=n.dragEl,d=n.activeSortable,h=n.dispatchSortableEvent,m=n.hideGhostForTarget,v=n.unhideGhostForTarget;if(i){var E=s||d;m();var A=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,C=document.elementFromPoint(A.clientX,A.clientY);v(),E&&!E.el.contains(C)&&(h("spill"),this.onSpill({dragEl:c,putSortable:s}))}};function Ko(){}Ko.prototype={startIndex:null,dragStart:function(n){var i=n.oldDraggableIndex;this.startIndex=i},onSpill:function(n){var i=n.dragEl,s=n.putSortable;this.sortable.captureAnimationState(),s&&s.captureAnimationState();var c=fn(this.sortable.el,this.startIndex,this.options);c?this.sortable.el.insertBefore(i,c):this.sortable.el.appendChild(i),this.sortable.animateAll(),s&&s.animateAll()},drop:ca};ve(Ko,{pluginName:"revertOnSpill"});function No(){}No.prototype={onSpill:function(n){var i=n.dragEl,s=n.putSortable,c=s||this.sortable;c.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),c.animateAll()},drop:ca};ve(No,{pluginName:"removeOnSpill"});Z.mount(new Rs);Z.mount(No,Ko);function Bi(a,n,i){const s=new Blob([a],{type:i}),c=URL.createObjectURL(s),d=document.createElement("a");d.href=c,d.download=n,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c)}function Ks(a){const{profile:n,workoutTypes:i,workouts:s,logs:c}=a,d=[];d.push("# ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº"),n&&(d.push(`
## ÐÑÐ¾ÑÐ¸Ð»Ñ`),d.push(`- **ÐÐ¼Ñ:** ${n.displayName||"ÐÐµ ÑÐºÐ°Ð·Ð°Ð½Ð¾"}`),n.telegramUsername&&d.push(`- **Username:** @${n.telegramUsername}`),d.push(`- **ID:** ${n.id}`),d.push(`- **ÐÐ°ÑÐ° ÑÐµÐ³Ð¸ÑÑÑÐ°ÑÐ¸Ð¸:** ${new Date(n.createdAt).toLocaleDateString()}`)),d.push(`
## Ð¢Ð¸Ð¿Ñ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹`);const h=i.filter(E=>!E.isDeleted);if(h.length>0?h.sort((E,A)=>(E.order??0)-(A.order??0)).forEach(E=>{d.push(`- ${E.name} (${E.category==="time"?"ÐÐ° Ð²ÑÐµÐ¼Ñ":"Ð¡Ð¸Ð»Ð¾Ð²Ð¾Ðµ"})`)}):d.push("_ÐÐµÑ Ð°ÐºÑÐ¸Ð²Ð½ÑÑ ÑÐ¸Ð¿Ð¾Ð² ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹_"),d.push(`
## ÐÑÑÐ¾ÑÐ¸Ñ`),c.length===0)return d.push("_ÐÑÑÐ¾ÑÐ¸Ñ Ð¿ÑÑÑÐ°_"),d.join(`
`);const m=new Map;return[...c].filter(E=>!E.isDeleted).sort((E,A)=>new Date(A.date).getTime()-new Date(E.date).getTime()).forEach(E=>{const A=new Date(E.date).toLocaleDateString();m.has(A)||m.set(A,[]),m.get(A).push(E)}),m.forEach((E,A)=>{d.push(`
### ${A}`),Array.from(new Set(E.map(B=>B.workoutId).filter(Boolean))).forEach(B=>{const F=s.find(nt=>nt.id===B),U=E.filter(nt=>nt.workoutId===B);F&&F.name&&d.push(`
#### ${F.name}`);const X=new Map;U.forEach(nt=>{X.has(nt.workoutTypeId)||X.set(nt.workoutTypeId,[]),X.get(nt.workoutTypeId).push(nt)}),X.forEach((nt,ft)=>{const st=i.find(z=>z.id===ft),et=(st==null?void 0:st.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑÐ½Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ";d.push(`- **${et}**: ${nt.map(z=>Ns(z)).join(", ")}`)})})}),d.join(`
`)}function Ns(a){return a.duration?`${a.duration} Ð¼Ð¸Ð½`:`${a.weight}ÐºÐ³ Ã ${a.reps}`}fs({immediate:!0});var Ui;const Et=(Ui=window.Telegram)==null?void 0:Ui.WebApp;Et&&(Et.ready(),Et.expand());let Vt="main",cn="all",Ot=null,da=null,Or=null,Po=!1,An=null,Nt=null,_r="overview",Bo=!1,kr=!1;function Bs(a){Vt=a,yt()}let xo=null;function me(a){let n=document.querySelector(".toast");n||(n=document.createElement("div"),n.className="toast",document.body.appendChild(n)),n.textContent=a,n.classList.add("visible"),xo&&clearTimeout(xo),xo=setTimeout(()=>{n==null||n.classList.remove("visible")},2e3)}function yt(){const a=document.getElementById("app");if(!a)return;const n=localStorage.getItem("skip_tma_auth")==="true",i=!!(Et!=null&&Et.initData)&&!n,c=!!Ar();!i&&!c||(a.innerHTML=`
    <main class="content">
      ${qs()}
    </main>
    <nav class="navigation">
      <button class="navigation__item ${Vt==="main"?"navigation__item_active":""}" data-page="main">
        <span class="navigation__icon">ðï¸</span>
        <span class="navigation__label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Vt==="stats"?"navigation__item_active":""}" data-page="stats">
        <span class="navigation__icon">ð</span>
        <span class="navigation__label">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Vt==="profile-settings"?"navigation__item_active":""}" data-page="profile-settings">
        <span class="navigation__icon">ð¤</span>
        <span class="navigation__label">ÐÑÐ¾ÑÐ¸Ð»Ñ</span>
      </button>
      <button class="navigation__item ${Vt==="settings"?"navigation__item_active":""}" data-page="settings">
        <span class="navigation__icon">âï¸</span>
        <span class="navigation__label">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</span>
      </button>
    </nav>
    <div id="sync-status" class="sync-status"></div>
  `,a.querySelectorAll(".navigation__item").forEach(d=>{d.addEventListener("click",()=>{const h=d.getAttribute("data-page");Bs(h)})}),Qs(),Ws())}let fa="idle";Q.onSyncStatusChange(a=>{fa=a,qo()});function qo(){const a=document.getElementById("sync-status");if(!a)return;a.className="sync-status";let n="",i="";switch(fa){case"saving":n="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...",i="ð",a.classList.add("sync-status_saving");break;case"success":n="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾",i="â",a.classList.add("sync-status_success");break;case"error":n="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸",i="â ï¸",a.classList.add("sync-status_error");break;case"idle":if(!navigator.onLine)n="ÐÑÑÐ»Ð°Ð¹Ð½",i="ð¡",a.classList.add("sync-status_offline");else return;break}a.innerHTML=`${i} ${n}`}window.addEventListener("online",()=>{Q.sync(),qo()});window.addEventListener("offline",()=>qo());function qs(){switch(Vt){case"main":return Us();case"stats":return Vs();case"settings":return zs();case"profile-settings":return Hs();case"public-profile":return Xs();default:return""}}function Fs(){const a=Q.getActiveWorkout();if(a){const n=a.status==="paused";return`
      <div class="workout-controls card">
        <div class="workout-controls__header">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span class="workout-status ${n?"workout-status_paused":""}">
              ${n?"â¸ï¸ ÐÐ°ÑÐ·Ð°":"ð¥ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° Ð°ÐºÑÐ¸Ð²Ð½Ð°"}
            </span>
            <span class="workout-timer">00:00</span>
          </div>
          ${a.name?`<span class="workout-name">${a.name}</span>`:""}
        </div>
        <div class="workout-controls__actions">
          ${n?'<button class="button" id="resume-workout-btn">ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ</button>':'<button class="button button_secondary" id="pause-workout-btn">ÐÐ°ÑÐ·Ð°</button>'}
          <button class="button button_destructive" id="finish-workout-btn">ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ</button>
        </div>
      </div>
    `}return kr?`
      <div class="workout-controls card">
        <h3 class="subtitle" style="margin-top: 0">ÐÐ°ÑÐ°Ð»Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</h3>
        <form id="start-workout-form" style="display: flex; flex-direction: column; gap: 12px;">
          <input class="input" type="text" name="workoutName" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð¾Ð¿ÑÐ¸Ð¾Ð½Ð°Ð»ÑÐ½Ð¾)">
          <div style="display: flex; gap: 8px;">
            <button class="button" type="submit">ÐÐ°ÑÐ°ÑÑ</button>
            <button class="button button_secondary" type="button" id="cancel-start-workout-btn">ÐÑÐ¼ÐµÐ½Ð°</button>
          </div>
        </form>
      </div>
    `:`
    <button class="button" id="start-workout-btn" style="margin-bottom: 24px;">â¶ï¸ ÐÐ°ÑÐ°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ</button>
  `}let Oe=null;function qi(){const a=Q.getActiveWorkout(),n=document.querySelector(".workout-timer");if(!a||!n){Oe&&(clearInterval(Oe),Oe=null);return}const i=new Date(a.startTime).getTime(),s=Date.now();let c=s-i;a.pauseIntervals.forEach(v=>{const E=new Date(v.start).getTime(),A=v.end?new Date(v.end).getTime():(a.status==="paused",s);A>E&&(c-=A-E)});const d=Math.floor(Math.max(0,c)/1e3),h=Math.floor(d/60),m=d%60;n.textContent=`${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`}function Ws(){const a=Q.getActiveWorkout();qi(),a&&a.status==="active"?Oe||(Oe=setInterval(qi,1e3)):Oe&&(clearInterval(Oe),Oe=null)}let Ft=0,$o="";function Fo(a){const n=new Date;n.setHours(0,0,0,0);const i=new Date(n);i.setDate(n.getDate()-a*7),i.setHours(23,59,59,999);const s=new Date(i);return s.setDate(i.getDate()-6),s.setHours(0,0,0,0),{start:s,end:i,label:`${s.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})} - ${i.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}`}}function Us(){var h;const a=Q.getWorkoutTypes(),n=Q.getLogs(),i=n[n.length-1],s=i==null?void 0:i.workoutTypeId,c=Ot?n.find(m=>m.id===Ot):null,{label:d}=Fo(Ft);return`
    <div class="page-content" id="main-content">
      ${Fs()}
      <h1 class="title">${Ot?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´ÑÐ¾Ð´Ð°":"ÐÐ¾Ð²ÑÐ¹ Ð¿Ð¾Ð´ÑÐ¾Ð´"}</h1>
      <form class="workout-form" id="log-form">
        <div class="form-group">
          <label class="label">Ð¢Ð¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</label>
          <select class="select" name="typeId" id="workout-type-select" required>
            ${a.map(m=>`<option value="${m.id}" ${(Ot?c&&m.id===c.workoutTypeId:m.id===s)?"selected":""}>${m.name}</option>`).join("")}
          </select>
        </div>
        
        <div id="strength-inputs" style="display: none;">
            <div class="form-row">
              <div class="form-group">
                <label class="label">ÐÐµÑ (ÐºÐ³)</label>
                <input class="input" type="number" name="weight" step="0.5" placeholder="0" value="${Ot&&c?c.weight:""}">
              </div>
              <div class="form-group">
                <label class="label">ÐÐ¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</label>
                <input class="input" type="number" name="reps" placeholder="0" value="${Ot&&c?c.reps:""}">
              </div>
            </div>
        </div>

        <div id="time-inputs" style="display: none;">
            <div class="form-group">
                <label class="label">ÐÑÐµÐ¼Ñ (Ð¼Ð¸Ð½)</label>
                <input class="input" type="number" name="duration" placeholder="0" value="${Ot&&c&&c.duration||""}">
            </div>
        </div>

        <button class="button" type="submit">${Ot?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ":"ÐÐ°ÑÐ¸ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ"}</button>
        ${Ot?'<button class="button button_secondary" type="button" id="cancel-edit-btn" style="margin-top: 12px;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        ${!Ot&&i?`<button class="button button_secondary" type="button" id="duplicate-last-btn" style="margin-top: 12px;">ÐÐ¾Ð²ÑÐ¾ÑÐ¸ÑÑ: ${(h=a.find(m=>m.id===i.workoutTypeId))==null?void 0:h.name} ${i.weight?`${i.weight}ÐºÐ³ Ã ${i.reps}`:`${i.duration} Ð¼Ð¸Ð½`}</button>`:""}
      </form>
      <div class="recent-logs">
        <div class="recent-logs__header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
           <button class="icon-btn" id="prev-week-btn">âï¸</button>
           <div id="week-label-container" style="display: flex; align-items: center; gap: 8px; position: relative;">
             <span style="font-size: 18px; position: relative; display: inline-block;">
               ð
               <input type="date" id="calendar-input" value="${$o}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
             </span>
             <h2 class="subtitle" style="margin: 0;">${Ft===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":d}</h2>
             <label class="filter-toggle" title="Ð¤Ð¸Ð»ÑÑÑ Ð¿Ð¾ ÑÐ¸Ð¿Ñ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ">
               <input type="checkbox" id="filter-toggle-input" ${Bo?"checked":""}>
               <span class="filter-toggle__icon">ð</span>
             </label>
           </div>
           <button class="icon-btn" id="next-week-btn" ${Ft===0?"disabled":""} style="${Ft===0?"opacity: 0.3; cursor: default;":""}">â¶ï¸</button>
        </div>
        <div id="logs-list">
          ${ha()}
        </div>
      </div>
    </div>
  `}function ha(){var d;const a=Q.getLogs(),n=Q.getWorkoutTypes(),{start:i,end:s}=Fo(Ft);let c=a.filter(h=>{const m=new Date(h.date);return m>=i&&m<=s});if(Bo){const h=(d=document.querySelector('select[name="typeId"]'))==null?void 0:d.value;h&&(c=c.filter(m=>m.workoutTypeId===h))}return pa(c,n,!0)}function mr(){const a=document.getElementById("logs-list"),n=document.querySelector("#week-label-container .subtitle");if(a&&(a.innerHTML=ha(),Ys()),n){const{label:s}=Fo(Ft);n.textContent=Ft===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":s}const i=document.getElementById("next-week-btn");i&&(i.disabled=Ft===0,i.style.opacity=Ft===0?"0.3":"",i.style.cursor=Ft===0?"default":"")}function Ys(){document.querySelectorAll(".log-set__delete").forEach(a=>{a.addEventListener("click",async()=>{const n=a.getAttribute("data-id");n&&(Ot===n&&(Ot=null),await Q.deleteLog(n),yt())})}),document.querySelectorAll(".log-set__edit").forEach(a=>{a.addEventListener("click",()=>{Ot=a.getAttribute("data-id"),yt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(a=>{a.addEventListener("click",()=>{const n=a.getAttribute("data-date");n&&ma(n)})})}function pa(a,n,i){if(a.length===0)return'<p class="hint">ÐÐµÑ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð·Ð° ÑÑÐ¾Ñ Ð¿ÐµÑÐ¸Ð¾Ð´</p>';const s=new Map;[...a].sort((h,m)=>new Date(m.date).getTime()-new Date(h.date).getTime()).forEach(h=>{const v=new Date(h.date).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"});s.has(v)||s.set(v,[]),s.get(v).push(h)});const c=Q.getWorkouts();let d="";return s.forEach((h,m)=>{var X;const v=((X=h[0])==null?void 0:X.date.split("T")[0])||"",E=new Set;h.forEach(nt=>{nt.workoutId&&E.add(nt.workoutId)});const A=Array.from(E).sort((nt,ft)=>{var mt,it;const st=c.find(rt=>rt.id===nt),et=c.find(rt=>rt.id===ft),z=(st==null?void 0:st.startTime)||((mt=h.find(rt=>rt.workoutId===nt))==null?void 0:mt.date)||"",ut=(et==null?void 0:et.startTime)||((it=h.find(rt=>rt.workoutId===ft))==null?void 0:it.date)||"";return new Date(ut).getTime()-new Date(z).getTime()}),C=A.length===1?A[0]:null,B=C?c.find(nt=>nt.id===C):null,F=B&&B.name,U=B?Math.round(Q.getWorkoutDuration(B)):0;d+='<div class="log-day">',d+=`<div class="log-day__header">
      <span>${m}${F?` â¢ ${B.name}`:""}${B?` â¢ ${U} Ð¼Ð¸Ð½`:""}</span>
      ${i?`<button class="share-btn" data-date="${v}" title="ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ">ð¤</button>`:""}
    </div>`,A.forEach(nt=>{const ft=c.find(ut=>ut.id===nt),st=h.filter(ut=>ut.workoutId===nt);if(!(A.length===1&&(F||!(ft!=null&&ft.name)))){const ut=ft?Math.round(Q.getWorkoutDuration(ft)):0;d+=`<h3 class="workout-subheader">
                ${(ft==null?void 0:ft.name)||"Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°"} 
                <span class="workout-subheader__time">${ut} Ð¼Ð¸Ð½</span>
            </h3>`}const z=new Map;st.forEach(ut=>{z.has(ut.workoutTypeId)||z.set(ut.workoutTypeId,[]),z.get(ut.workoutTypeId).push(ut)}),z.forEach((ut,mt)=>{const it=n.find(rt=>rt.id===mt);d+=`
            <div class="log-exercise">
              <div class="log-exercise__name">${(it==null?void 0:it.name)||"Ð£Ð´Ð°Ð»ÐµÐ½Ð¾"}</div>
              <div class="log-exercise__sets">
                ${ut.map(rt=>`
                  <div class="log-set ${rt.id===Ot?"log-set_active-edit":""} ${rt.id===An?"log-set_new":""}">
                    <div class="log-set__info">
                      ${rt.weight!==void 0&&rt.reps!==void 0?`
                        <span class="log-set__weight">${rt.weight} ÐºÐ³</span>
                        <span class="log-set__times">Ã</span>
                        <span class="log-set__reps">${rt.reps}</span>
                      `:`
                        <span class="log-set__reps">â± ${rt.duration} Ð¼Ð¸Ð½</span>
                      `}
                    </div>
                    ${i?`
                    <div class="log-set__actions">
                      <button class="log-set__edit" data-id="${rt.id}">âï¸</button>
                      <button class="log-set__delete" data-id="${rt.id}">Ã</button>
                    </div>
                    `:""}
                  </div>
                `).join("")}
              </div>
            </div>
          `})}),d+="</div>"}),d}function zs(){const a=Q.getWorkoutTypes(),n=Nt?a.find(i=>i.id===Nt):null;return`
    <div class="page-content">
      <h1 class="title">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</h1>
      <div class="settings-section">
        <h2 class="subtitle">${Nt?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¿Ð°":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸"}</h2>
        <form class="add-type-form" id="add-type-form" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 8px; flex-direction: column;">
            <input class="input" type="text" id="new-type-name" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð½Ð°Ð¿Ñ. ÐÐ¸Ð¼ Ð³Ð°Ð½ÑÐµÐ»ÐµÐ¹)" required value="${n?n.name:""}">
            
            <div class="category-switch" style="display: flex; gap: 12px; margin-bottom: 8px;">
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="strength" ${!n||n.category!=="time"?"checked":""}>
                    Ð¡Ð¸Ð»Ð¾Ð²Ð¾Ðµ
                </label>
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="time" ${n&&n.category==="time"?"checked":""}>
                    ÐÐ° Ð²ÑÐµÐ¼Ñ
                </label>
            </div>

            <button class="button" type="submit">${Nt?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ"}</button>
          </div>
          ${Nt?'<button class="button button_secondary" type="button" id="cancel-edit-type-btn" style="margin-top: 8px; width: 100%;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        </form>

        <h2 class="subtitle">Ð¢Ð¸Ð¿Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
        <div class="type-list" id="workout-type-list">
          ${a.map(i=>`
            <div class="type-item" data-id="${i.id}">
              <span class="drag-handle" style="cursor: grab; margin-right: 12px; opacity: 0.5;">â®â®</span>
              <span style="flex-grow: 1;">${i.name}</span>
              <div style="display: flex; gap: 8px;">
                <button class="type-item__edit icon-btn" data-id="${i.id}" title="Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ">âï¸</button>
                <button class="type-item__delete icon-btn" data-id="${i.id}" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">Ã</button>
              </div>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `}function Hs(){var v,E;const a=Q.getProfile(),n=(a==null?void 0:a.isPublic)??!1,i=(a==null?void 0:a.displayName)||((E=(v=Et==null?void 0:Et.initDataUnsafe)==null?void 0:v.user)==null?void 0:E.first_name)||"",s=Q.getProfileIdentifier(),c=s?`https://t.me/gymgym21bot/app?startapp=profile_${s}`:"",d=Q.getLogs(),h=d.reduce((A,C)=>A+(C.weight||0)*(C.reps||0),0),m=new Set(d.map(A=>A.date.split("T")[0])).size;return`
    <div class="page-content profile-page">
      <h1 class="title">ÐÑÐ¾ÑÐ¸Ð»Ñ</h1>
      
      <div class="profile-header">
        <div class="profile-avatar">
          ${a!=null&&a.photoUrl?`<img src="${a.photoUrl}" alt="${i}" class="profile-avatar-img">`:i.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${i}</div>
        <div class="profile-subtitle">${n?"ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ":"ÐÑÐ¸Ð²Ð°ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ"}</div>
      </div>

      <div class="profile-settings">
        <div class="settings-section">
          <div class="settings-section-title">ÐÐ¸Ð´Ð¸Ð¼Ð¾ÑÑÑ</div>
          <div class="toggle-row">
            <div class="toggle-label">
              <span class="toggle-label-text">ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</span>
              <span class="toggle-label-hint">ÐÑÑÐ³Ð¸Ðµ ÑÐ¼Ð¾Ð³ÑÑ Ð²Ð¸Ð´ÐµÑÑ Ð²Ð°ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÑ</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="profile-public-toggle" ${n?"checked":""}>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="toggle-row" style="margin-top: 12px;">
            <div class="toggle-label">
              <span class="toggle-label-text">ÐÐ¾ÐºÐ°Ð·ÑÐ²Ð°ÑÑ Ð²ÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ</span>
              <span class="toggle-label-hint">ÐÐ¾Ð´ÑÐ¾Ð±Ð½ÑÐ¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð² Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ð¼ Ð¿ÑÐ¾ÑÐ¸Ð»Ðµ</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="profile-history-toggle" ${a!=null&&a.showFullHistory?"checked":""}>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-section">
          <div class="settings-section-title">ÐÐ¼Ñ</div>
          <input class="input" type="text" id="profile-display-name" value="${i}" placeholder="ÐÐ°ÑÐµ Ð¸Ð¼Ñ">
        </div>

        ${n&&s?`
          <div class="settings-section">
            <div class="settings-section-title">Ð¡ÑÑÐ»ÐºÐ° Ð½Ð° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</div>
            <div class="profile-link-section">
              <a href="${c}" target="_blank" class="profile-link-url">${c}</a>
              <div class="profile-link-actions">
                <button class="button button_secondary" id="copy-profile-link">ÐÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ</button>
                <button class="button" id="share-profile-link">ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ</button>
              </div>
            </div>
          </div>
        `:""}

        <div class="settings-section">
          <div class="settings-section-title">ÐÑÐµÐ²ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</div>
          <div class="profile-stats">
            <div class="stat-card">
              <div class="stat-value">${m}</div>
              <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">${Math.round(h/1e3)}Ñ</div>
              <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <div class="settings-section-title">Ð£Ð¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸</div>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <button class="button button_secondary" id="export-json-btn">Ð­ÐºÑÐ¿Ð¾ÑÑ JSON (Backup)</button>
            <button class="button button_secondary" id="export-md-btn">Ð­ÐºÑÐ¿Ð¾ÑÑ Markdown</button>
            <button class="button button_secondary" id="import-json-btn">ÐÐ¼Ð¿Ð¾ÑÑ JSON (Restore)</button>
            <input type="file" id="import-file-input" style="display: none" accept=".json">
          </div>
        </div>

        <button class="button" id="save-profile-btn">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
      </div>
    </div>
  `}function Xs(){if(!da)return`
      <div class="page-content">
        <div class="profile-not-found">
          <div class="profile-not-found-icon">ð</div>
          <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½</div>
        </div>
      </div>
    `;if(!Or)return Po?`
        <div class="page-content">
          <div class="profile-not-found">
            <div class="profile-not-found-icon">ð</div>
            <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐºÑÑÑ Ð¸Ð»Ð¸ Ð½Ðµ ÑÑÑÐµÑÑÐ²ÑÐµÑ</div>
          </div>
        </div>
      `:`
      <div class="page-content">
        <div class="profile-loading">ÐÐ°Ð³ÑÑÐ·ÐºÐ° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ...</div>
      </div>
    `;const a=Or;return a.logs&&(a.logs=a.logs.filter(n=>!n.isDeleted)),a.workoutTypes&&(a.workoutTypes=a.workoutTypes.filter(n=>!n.isDeleted)),`
    <div class="page-content profile-page">
      <div class="profile-header">
        <div class="profile-avatar">
          ${a.photoUrl?`<img src="${a.photoUrl}" alt="${a.displayName}" class="profile-avatar-img">`:a.displayName.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${a.displayName}</div>
        <div class="profile-subtitle">@${a.identifier}</div>
      </div>

      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-value">${a.stats.totalWorkouts}</div>
          <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${Math.round(a.stats.totalVolume/1e3)}Ñ</div>
          <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
        </div>
        ${a.stats.favoriteExercise?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${a.stats.favoriteExercise}</div>
            <div class="stat-label">ÐÑÐ±Ð¸Ð¼Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</div>
          </div>
        `:""}
        ${a.stats.lastWorkoutDate?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${new Date(a.stats.lastWorkoutDate).toLocaleDateString()}</div>
            <div class="stat-label">ÐÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</div>
          </div>
        `:""}
      </div>

      ${a.recentActivity.length>0?`
        <div class="activity-list">
          ${a.logs&&a.logs.length>0?`
          <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          <div class="heatmap-container" style="margin-bottom: 24px;">
            ${Vi(new Set(a.logs.map(n=>n.date.split("T")[0])))}
          </div>
          `:""}

          <h2 class="subtitle">ÐÐµÐ´Ð°Ð²Ð½ÑÑ Ð°ÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          ${a.recentActivity.map(n=>`
            <div class="activity-item">
              <span class="activity-date">${new Date(n.date).toLocaleDateString()}</span>
              <span class="activity-count">${n.exerciseCount} ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹</span>
            </div>
          `).join("")}
        </div>
      `:""}

      ${a.logs&&a.logs.length>0&&a.workoutTypes?`
        <div class="recent-logs">
          <h2 class="subtitle">ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
          <div id="logs-list">
            ${pa(a.logs,a.workoutTypes,!1)}
          </div>
        </div>
      `:""}
    </div>
  `}function Vs(){const a=Q.getLogs(),n=Q.getWorkouts(),i=Q.getWorkoutTypes();if(a.length===0)return`
      <div class="page-content">
        <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
        <p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</p>
      </div>
    `;const s=a.reduce((m,v)=>m+(v.weight||0)*(v.reps||0),0),c=a.reduce((m,v)=>m+(v.reps||0),0),d=ss(n);let h=`
    <div class="page-content">
      <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
      <div class="stats-tabs">
        <button class="stats-tab ${_r==="overview"?"active":""}" data-tab="overview">ÐÐ±Ð·Ð¾Ñ</button>
        <button class="stats-tab ${_r==="progress"?"active":""}" data-tab="progress">ÐÑÐ¾Ð³ÑÐµÑÑ</button>
      </div>
  `;if(_r==="overview"){const m=as(n,a);h+=`
        <div class="stats-section">
            <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
            ${Vi(m)}
        </div>

        <div class="stats-summary">
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
                <div class="stat-metric__value">${m.size}</div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">Ð¡ÑÐµÐ´. Ð´Ð»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ</div>
                <div class="stat-metric__value">${d.averageMinutes}<span class="stat-metric__unit">Ð¼Ð¸Ð½</span></div>
            </div>
             <div class="stat-metric">
                <div class="stat-metric__label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼</div>
                <div class="stat-metric__value">${Math.round(s/1e3)}<span class="stat-metric__unit">Ñ</span></div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ Ð¿Ð¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</div>
                <div class="stat-metric__value">${c}</div>
            </div>
        </div>

        <div class="charts-section">
            <h2 class="subtitle">ÐÐ»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
            <div class="chart-container">
                ${ls(n)}
            </div>
        </div>
     `}else if(h+=`
        <div class="form-group">
            <label class="label">Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</label>
            <select class="select" id="stat-type-select">
                <option value="all">ÐÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ (ÐÐ±ÑÐµÐ¼)</option>
                ${i.map(m=>`<option value="${m.id}" ${cn===m.id?"selected":""}>${m.name}</option>`).join("")}
            </select>
        </div>
    `,cn==="all")h+=`
            <div class="charts-section">
                <h2 class="subtitle">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼ Ð¿Ð¾ Ð´Ð½ÑÐ¼</h2>
                <div class="chart-container">
                    ${Ai(a)}
                </div>
            </div>
        `;else{const m=a.filter(E=>E.workoutTypeId===cn),v=is(m,cn);h+=`
             <div class="charts-section">
                <h2 class="subtitle">ÐÑÐ¾Ð³ÑÐµÑÑ ÑÐ¸Ð»Ð¾Ð²ÑÑ (1RM)</h2>
                <div class="chart-container">
                    ${us(v)}
                </div>
            </div>
            
            <div class="charts-section" style="margin-top: 24px;">
                <h2 class="subtitle">ÐÐ±ÑÐµÐ¼ Ð½Ð°Ð³ÑÑÐ·ÐºÐ¸</h2>
                 <div class="chart-container">
                    ${Ai(m)}
                </div>
            </div>
        `}return h+="</div>",h}function Gs(a){const n=Q.getLogs(),i=Q.getWorkoutTypes(),s=n.filter(E=>E.date.startsWith(a));if(s.length===0)return"";const d=new Date(s[0].date).toLocaleDateString("ru-RU",{day:"numeric",month:"long"}),h=new Map;s.forEach(E=>{h.has(E.workoutTypeId)||h.set(E.workoutTypeId,[]),h.get(E.workoutTypeId).push(E)});let m=`ðï¸ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° ${d}

`;h.forEach((E,A)=>{const C=i.find(B=>B.id===A);m+=`${(C==null?void 0:C.name)||"Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ"}:
`,E.forEach(B=>{B.duration?m+=`  â± ${B.duration} Ð¼Ð¸Ð½
`:m+=`  ${B.weight} ÐºÐ³ Ã ${B.reps}
`}),m+=`
`});const v=s.reduce((E,A)=>E+(A.weight&&A.reps?A.weight*A.reps:0),0);return v&&(m+=`ðª ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼: ${Math.round(v)} ÐºÐ³`),m}function ma(a){const n=Gs(a);if(n)if(Et!=null&&Et.openTelegramLink){const i=`https://t.me/share/url?url=${encodeURIComponent("https://t.me/gymgym21bot")}&text=${encodeURIComponent(n)}`;Et.openTelegramLink(i)}else navigator.clipboard.writeText(n).then(()=>{alert("Ð¢ÐµÐºÑÑ ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½ Ð² Ð±ÑÑÐµÑ Ð¾Ð±Ð¼ÐµÐ½Ð°")})}function Qs(){var a,n,i,s;if(Vt==="main"){const c=document.getElementById("start-workout-btn");c==null||c.addEventListener("click",()=>{kr=!0,yt()});const d=document.getElementById("cancel-start-workout-btn");d==null||d.addEventListener("click",()=>{kr=!1,yt()});const h=document.getElementById("start-workout-form");h==null||h.addEventListener("submit",async et=>{et.preventDefault();const ut=new FormData(h).get("workoutName");await Q.startWorkout(ut),kr=!1,yt()});const m=document.getElementById("pause-workout-btn");m==null||m.addEventListener("click",async()=>{await Q.pauseWorkout(),yt()});const v=document.getElementById("resume-workout-btn");v==null||v.addEventListener("click",async()=>{await Q.resumeWorkout(),yt()});const E=document.getElementById("finish-workout-btn");E==null||E.addEventListener("click",async()=>{confirm("ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ?")&&(await Q.finishWorkout(),yt())});const A=document.getElementById("log-form"),C=()=>{const et=document.getElementById("workout-type-select"),z=Q.getWorkoutTypes(),ut=et==null?void 0:et.value,mt=z.find(gt=>gt.id===ut),it=document.getElementById("strength-inputs"),rt=document.getElementById("time-inputs");mt&&mt.category==="time"?(it&&(it.style.display="none"),rt&&(rt.style.display="block"),A.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(gt=>gt.removeAttribute("required")),A.querySelectorAll('input[name="duration"]').forEach(gt=>gt.setAttribute("required","true"))):(it&&(it.style.display="block"),rt&&(rt.style.display="none"),A.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(gt=>gt.setAttribute("required","true")),A.querySelectorAll('input[name="duration"]').forEach(gt=>gt.removeAttribute("required")))};C();const B=document.getElementById("workout-type-select");B==null||B.addEventListener("change",C),A==null||A.addEventListener("submit",async et=>{et.preventDefault();const z=new FormData(A),ut=z.get("typeId"),it=Q.getWorkoutTypes().find(gt=>gt.id===ut),rt={workoutTypeId:ut};if((it==null?void 0:it.category)==="time"?rt.duration=parseInt(z.get("duration"),10):(rt.weight=parseFloat(z.get("weight")),rt.reps=parseInt(z.get("reps"),10)),Ot){const Zt=Q.getLogs().find(Wt=>Wt.id===Ot);Zt&&(await Q.updateLog({...Zt,...rt}),Ot=null)}else An=(await Q.addLog(rt)).id;yt(),An=null});const F=document.getElementById("duplicate-last-btn");F==null||F.addEventListener("click",async()=>{const et=Q.getLogs(),z=et[et.length-1];z&&(An=(await Q.addLog({workoutTypeId:z.workoutTypeId,weight:z.weight,reps:z.reps,duration:z.duration})).id,yt(),An=null)});const U=document.getElementById("cancel-edit-btn");U==null||U.addEventListener("click",()=>{Ot=null,yt()}),document.querySelectorAll(".log-set__delete").forEach(et=>{et.addEventListener("click",async()=>{const z=et.getAttribute("data-id");z&&(Ot===z&&(Ot=null),await Q.deleteLog(z),yt())})}),document.querySelectorAll(".log-set__edit").forEach(et=>{et.addEventListener("click",()=>{Ot=et.getAttribute("data-id"),yt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(et=>{et.addEventListener("click",()=>{const z=et.getAttribute("data-date");z&&ma(z)})});const X=document.getElementById("prev-week-btn");X==null||X.addEventListener("click",()=>{Ft++,mr()});const nt=document.getElementById("next-week-btn");nt==null||nt.addEventListener("click",()=>{Ft>0&&(Ft--,mr())});const ft=document.getElementById("calendar-input");ft==null||ft.addEventListener("change",()=>{if(!ft.value||ft.value===$o)return;$o=ft.value;const et=new Date(ft.value),z=new Date;z.setHours(0,0,0,0);const ut=z.getTime()-et.getTime(),mt=Math.floor(ut/(1e3*60*60*24));Ft=Math.max(0,Math.floor(mt/7)),mr()});const st=document.getElementById("filter-toggle-input");st==null||st.addEventListener("change",()=>{Bo=st.checked,mr()})}if(Vt==="settings"){const c=document.getElementById("add-type-form");c==null||c.addEventListener("submit",async h=>{var E;h.preventDefault();const m=document.getElementById("new-type-name"),v=(E=document.querySelector('input[name="new-type-category"]:checked'))==null?void 0:E.value;m.value&&(Nt?(await Q.updateWorkoutType(Nt,m.value,v),Nt=null):await Q.addWorkoutType(m.value,v),yt())});const d=document.getElementById("cancel-edit-type-btn");d==null||d.addEventListener("click",()=>{Nt=null,yt()}),document.querySelectorAll(".type-item__edit").forEach(h=>{h.addEventListener("click",()=>{Nt=h.getAttribute("data-id"),yt();const m=document.getElementById("new-type-name");m==null||m.focus()})}),document.querySelectorAll(".type-item__delete").forEach(h=>{h.addEventListener("click",async()=>{const m=h.getAttribute("data-id");m&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(Nt===m&&(Nt=null),await Q.deleteWorkoutType(m),yt())})})}if(Vt==="settings"){const c=document.getElementById("workout-type-list");c&&Z.create(c,{animation:150,handle:".drag-handle",onEnd:async()=>{const d=Array.from(c.children).map(h=>h.getAttribute("data-id")||"").filter(Boolean);await Q.updateWorkoutTypeOrder(d)}}),document.querySelectorAll(".type-item__edit").forEach(d=>{d.addEventListener("click",()=>{Nt=d.getAttribute("data-id"),yt();const h=document.getElementById("new-type-name");h==null||h.focus()})}),document.querySelectorAll(".type-item__delete").forEach(d=>{d.addEventListener("click",async()=>{const h=d.getAttribute("data-id");h&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(Nt===h&&(Nt=null),await Q.deleteWorkoutType(h),yt())})})}if(Vt==="stats"){const c=document.getElementById("stat-type-select");c==null||c.addEventListener("change",()=>{cn=c.value,yt()})}if(Vt==="profile-settings"){const c=document.getElementById("save-profile-btn");c==null||c.addEventListener("click",async()=>{const m=document.getElementById("profile-public-toggle"),v=document.getElementById("profile-history-toggle"),E=document.getElementById("profile-display-name");await Q.updateProfileSettings({isPublic:(m==null?void 0:m.checked)??!1,showFullHistory:(v==null?void 0:v.checked)??!1,displayName:(E==null?void 0:E.value)||void 0}),me("ÐÑÐ¾ÑÐ¸Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½"),yt()});const d=document.getElementById("copy-profile-link");d==null||d.addEventListener("click",()=>{const v=`https://t.me/gymgym21bot/app?startapp=profile_${Q.getProfileIdentifier()}`;navigator.clipboard.writeText(v).then(()=>{me("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})});const h=document.getElementById("share-profile-link");h==null||h.addEventListener("click",()=>{const v=`https://t.me/gymgym21bot/app?startapp=profile_${Q.getProfileIdentifier()}`;if(Et!=null&&Et.openTelegramLink){const E=`https://t.me/share/url?url=${encodeURIComponent(v)}&text=${encodeURIComponent("ÐÐ¾Ð¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº ðª")}`;Et.openTelegramLink(E)}else navigator.clipboard.writeText(v).then(()=>{me("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})}),(a=document.getElementById("export-json-btn"))==null||a.addEventListener("click",async()=>{try{const m=await Q.exportData(),v=`gym_backup_${new Date().toISOString().split("T")[0]}.json`;Bi(JSON.stringify(m,null,2),v,"application/json"),me("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(m){console.error(m),me("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(n=document.getElementById("export-md-btn"))==null||n.addEventListener("click",async()=>{try{const m=await Q.exportData(),v=Ks(m),E=`gym_history_${new Date().toISOString().split("T")[0]}.md`;Bi(v,E,"text/markdown"),me("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(m){console.error(m),me("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(i=document.getElementById("import-json-btn"))==null||i.addEventListener("click",()=>{var m;(m=document.getElementById("import-file-input"))==null||m.click()}),(s=document.getElementById("import-file-input"))==null||s.addEventListener("change",m=>{var A;const v=(A=m.target.files)==null?void 0:A[0];if(!v)return;const E=new FileReader;E.onload=async C=>{var B;try{const F=(B=C.target)==null?void 0:B.result,U=JSON.parse(F);confirm("ÐÐ½Ð¸Ð¼Ð°Ð½Ð¸Ðµ! ÐÑÐµ ÑÐµÐºÑÑÐ¸Ðµ Ð´Ð°Ð½Ð½ÑÐµ Ð±ÑÐ´ÑÑ Ð·Ð°Ð¼ÐµÐ½ÐµÐ½Ñ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸ Ð¸Ð· ÑÐ°Ð¹Ð»Ð°. ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ?")&&(await Q.importData(U),me("ÐÐ°Ð½Ð½ÑÐµ ÑÑÐ¿ÐµÑÐ½Ð¾ Ð¸Ð¼Ð¿Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°Ð½Ñ"),setTimeout(()=>location.reload(),1e3))}catch(F){console.error(F),me("ÐÑÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾ÑÑÐ°: ÐÐµÐ²ÐµÑÐ½ÑÐ¹ ÑÐ¾ÑÐ¼Ð°Ñ ÑÐ°Ð¹Ð»Ð°")}},E.readAsText(v),m.target.value=""})}if(Vt==="stats"){document.querySelectorAll(".stats-tab").forEach(h=>{h.addEventListener("click",()=>{const m=h.getAttribute("data-tab");(m==="overview"||m==="progress")&&(_r=m,yt())})});const d=document.getElementById("stat-type-select");d==null||d.addEventListener("change",h=>{cn=h.target.value,yt()})}}const Ue=document.createElement("div");Ue.className="sync-status";document.body.appendChild(Ue);function Js(a){switch(Ue.className="sync-status visible "+a,a){case"saving":Ue.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...";break;case"success":Ue.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð¾";break;case"error":Ue.textContent="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸";break;default:Ue.className="sync-status"}}Q.onUpdate(()=>yt());Q.onSyncStatusChange(Js);async function Zs(){var m;const a=new URLSearchParams(window.location.search);if(a.has("hash")&&a.has("id")){const v={id:parseInt(a.get("id")||"0",10),first_name:a.get("first_name")||"",last_name:a.get("last_name")||void 0,username:a.get("username")||void 0,photo_url:a.get("photo_url")||void 0,auth_date:parseInt(a.get("auth_date")||"0",10),hash:a.get("hash")||""};Mo(v),a.delete("hash"),a.delete("id"),a.delete("first_name"),a.delete("last_name"),a.delete("username"),a.delete("photo_url"),a.delete("auth_date"),a.delete("auth");const E=a.toString(),A=window.location.pathname+(E?"?"+E:"");window.history.replaceState({},document.title,A),location.reload();return}const n=localStorage.getItem("skip_tma_auth")==="true",i=!!(Et!=null&&Et.initData)&&!n,c=!!Ar();if(!i&&!c){ds(document.getElementById("app"),()=>{location.reload()});return}const h=new URLSearchParams(window.location.search).get("startapp")||((m=Et==null?void 0:Et.initDataUnsafe)==null?void 0:m.start_param);if(h&&h.startsWith("profile_")){const v=h.replace("profile_","");da=v,Vt="public-profile",Po=!1,yt(),Or=await Q.getPublicProfile(v),Or||(Po=!0),yt()}else yt();await Q.init()}Zs();
