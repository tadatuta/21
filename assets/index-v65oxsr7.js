var Ha=Object.defineProperty;var Ya=(y,u,c)=>u in y?Ha(y,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):y[u]=c;var jt=(y,u,c)=>Ya(y,typeof u!="symbol"?u+"":u,c);(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))g(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const S of T.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&g(S)}).observe(document,{childList:!0,subtree:!0});function c(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerPolicy&&(T.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?T.credentials="include":x.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function g(x){if(x.ep)return;x.ep=!0;const T=c(x);fetch(x.href,T)}})();const Ga="modulepreload",Qa=function(y,u){return new URL(y,u).href},Vr={},ea=function(u,c,g){let x=Promise.resolve();if(c&&c.length>0){const S=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),K=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));x=Promise.allSettled(c.map(M=>{if(M=Qa(M,g),M in Vr)return;Vr[M]=!0;const V=M.endsWith(".css"),B=V?'[rel="stylesheet"]':"";if(!!g)for(let Z=S.length-1;Z>=0;Z--){const ft=S[Z];if(ft.href===M&&(!V||ft.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${M}"]${B}`))return;const U=document.createElement("link");if(U.rel=V?"stylesheet":Ga,V||(U.as="script"),U.crossOrigin="",U.href=M,K&&U.setAttribute("nonce",K),document.head.appendChild(U),V)return new Promise((Z,ft)=>{U.addEventListener("load",Z),U.addEventListener("error",()=>ft(new Error(`Unable to preload CSS for ${M}`)))})}))}function T(S){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=S,window.dispatchEvent(E),!E.defaultPrevented)throw S}return x.then(S=>{for(const E of S||[])E.status==="rejected"&&T(E.reason);return u().catch(T)})};var zr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xa(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}var na={exports:{}};(function(y,u){((c,g)=>{y.exports=g()})(zr,function(){var c=function(t,e){return(c=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(n,r){n.__proto__=r}:function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}))(t,e)},g=function(){return(g=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function x(t,e,n){for(var r,a=0,i=e.length;a<i;a++)!r&&a in e||((r=r||Array.prototype.slice.call(e,0,a))[a]=e[a]);return t.concat(r||Array.prototype.slice.call(e))}var T=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:zr,S=Object.keys,E=Array.isArray;function K(t,e){return typeof e=="object"&&S(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||T.Promise||(T.Promise=Promise);var M=Object.getPrototypeOf,V={}.hasOwnProperty;function B(t,e){return V.call(t,e)}function z(t,e){typeof e=="function"&&(e=e(M(t))),(typeof Reflect>"u"?S:Reflect.ownKeys)(e).forEach(function(n){Z(t,n,e[n])})}var U=Object.defineProperty;function Z(t,e,n,r){U(t,e,K(n&&B(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ft(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Z(t.prototype,"constructor",t),{extend:z.bind(null,t.prototype)}}}}var vt=Object.getOwnPropertyDescriptor,gt=[].slice;function Et(t,e,n){return gt.call(t,e,n)}function Ut(t,e){return e(t)}function xt(t){if(!t)throw new Error("Assertion Failed")}function mt(t){T.setImmediate?setImmediate(t):setTimeout(t,0)}function bt(t,e){if(typeof e=="string"&&B(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,a=e.length;r<a;++r){var i=bt(t,e[r]);n.push(i)}return n}var o,s=e.indexOf(".");return s===-1||(o=t[e.substr(0,s)])==null?void 0:bt(o,e.substr(s+1))}function st(t,e,n){if(t&&e!==void 0&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){xt(typeof n!="string"&&"length"in n);for(var r=0,a=e.length;r<a;++r)st(t,e[r],n[r])}else{var i,o,s=e.indexOf(".");s!==-1?(i=e.substr(0,s),(s=e.substr(s+1))===""?n===void 0?E(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=n:st(o=(o=t[i])&&B(t,i)?o:t[i]={},s,n)):n===void 0?E(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function dt(t){var e,n={};for(e in t)B(t,e)&&(n[e]=t[e]);return n}var fa=[].concat;function or(t){return fa.apply([],t)}var Ct="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(or([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return T[t]}),sr=new Set(Ct.map(function(t){return T[t]})),ve=null;function Wt(t){return ve=new WeakMap,t=function e(n){if(!n||typeof n!="object")return n;var r=ve.get(n);if(r)return r;if(E(n)){r=[],ve.set(n,r);for(var a=0,i=n.length;a<i;++a)r.push(e(n[a]))}else if(sr.has(n.constructor))r=n;else{var o,s=M(n);for(o in r=s===Object.prototype?{}:Object.create(s),ve.set(n,r),n)B(n,o)&&(r[o]=e(n[o]))}return r}(t),ve=null,t}var pa={}.toString;function fn(t){return pa.call(t).slice(8,-1)}var pn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ha=typeof pn=="symbol"?function(t){var e;return t!=null&&(e=t[pn])&&e.apply(t)}:function(){return null};function Vt(t,e){e=t.indexOf(e),0<=e&&t.splice(e,1)}var re={};function Pt(t){var e,n,r,a;if(arguments.length===1){if(E(t))return t.slice();if(this===re&&typeof t=="string")return[t];if(a=ha(t))for(n=[];!(r=a.next()).done;)n.push(r.value);else{if(t==null)return[t];if(typeof(e=t.length)!="number")return[t];for(n=new Array(e);e--;)n[e]=t[e]}}else for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var hn=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Ct=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],_t=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Ct),ma={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ae(t,e){this.name=t,this.message=e}function ur(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,a){return a.indexOf(n)===r}).join(`
`)}function Ke(t,e,n,r){this.failures=e,this.failedKeys=r,this.successCount=n,this.message=ur(t,e)}function ie(t,e){this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=ur(t,this.failures)}ft(ae).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ft(Ke).from(ae),ft(ie).from(ae);var mn=_t.reduce(function(t,e){return t[e]=e+"Error",t},{}),ya=ae,N=_t.reduce(function(t,e){var n=e+"Error";function r(a,i){this.name=n,a?typeof a=="string"?(this.message="".concat(a).concat(i?`
 `+i:""),this.inner=i||null):typeof a=="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a):(this.message=ma[e]||n,this.inner=null)}return ft(r).from(ya),t[e]=r,t},{}),cr=(N.Syntax=SyntaxError,N.Type=TypeError,N.Range=RangeError,Ct.reduce(function(t,e){return t[e+"Error"]=N[e],t},{}));Ct=_t.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=N[e]),t},{});function tt(){}function ge(t){return t}function va(t,e){return t==null||t===ge?e:function(n){return e(t(n))}}function zt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ga(t,e){return t===tt?e:function(){var n=t.apply(this,arguments),r=(n!==void 0&&(arguments[0]=n),this.onsuccess),a=this.onerror,i=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return r&&(this.onsuccess=this.onsuccess?zt(r,this.onsuccess):r),a&&(this.onerror=this.onerror?zt(a,this.onerror):a),i!==void 0?i:n}}function ba(t,e){return t===tt?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?zt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?zt(r,this.onerror):r)}}function wa(t,e){return t===tt?e:function(a){var r=t.apply(this,arguments),a=(K(a,r),this.onsuccess),i=this.onerror,o=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return a&&(this.onsuccess=this.onsuccess?zt(a,this.onsuccess):a),i&&(this.onerror=this.onerror?zt(i,this.onerror):i),r===void 0?o===void 0?void 0:o:K(r,o)}}function _a(t,e){return t===tt?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function yn(t,e){return t===tt?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,a=arguments.length,i=new Array(a);a--;)i[a]=arguments[a];return n.then(function(){return e.apply(r,i)})}return e.apply(this,arguments)}}Ct.ModifyError=Ke,Ct.DexieError=ae,Ct.BulkError=ie;var It=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function lr(t){It=t}var be={},dr=100,we=typeof Promise>"u"?[]:(_t=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[we=crypto.subtle.digest("SHA-512",new Uint8Array([0])),M(we),_t]:[_t,M(_t),_t]),_t=we[0],pe=we[1],pe=pe&&pe.then,Ht=_t&&_t.constructor,vn=!!we[2],_e=function(t,e){ke.push([t,e]),$e&&(queueMicrotask(xa),$e=!1)},gn=!0,$e=!0,Yt=[],je=[],bn=ge,Lt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:tt,pgp:!1,env:{},finalize:tt},R=Lt,ke=[],Gt=0,Le=[];function $(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=R;if(typeof t!="function"){if(t!==be)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&_n(this,this._value)}else this._state=null,this._value=null,++e.ref,function n(r,a){try{a(function(i){if(r._state===null){if(i===r)throw new TypeError("A promise cannot be resolved with itself.");var o=r._lib&&oe();i&&typeof i.then=="function"?n(r,function(s,f){i instanceof $?i._then(s,f):i.then(s,f)}):(r._state=!0,r._value=i,pr(r)),o&&se()}},_n.bind(null,r))}catch(i){_n(r,i)}}(this,t)}var wn={get:function(){var t=R,e=Be;function n(r,a){var i=this,o=!t.global&&(t!==R||e!==Be),s=o&&!Mt(),f=new $(function(w,p){kn(i,new fr(mr(r,t,o,s),mr(a,t,o,s),w,p,t))});return this._consoleTask&&(f._consoleTask=this._consoleTask),f}return n.prototype=be,n},set:function(t){Z(this,"then",t&&t.prototype===be?wn:{get:function(){return t},set:wn.set})}};function fr(t,e,n,r,a){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=a}function _n(t,e){var n,r;je.push(e),t._state===null&&(n=t._lib&&oe(),e=bn(e),t._state=!1,t._value=e,r=t,Yt.some(function(a){return a._value===r._value})||Yt.push(r),pr(t),n)&&se()}function pr(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)kn(t,e[n]);var a=t._PSD;--a.ref||a.finalize(),Gt===0&&(++Gt,_e(function(){--Gt==0&&xn()},[]))}function kn(t,e){if(t._state===null)t._listeners.push(e);else{var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Gt,_e(ka,[n,t,e])}}function ka(t,e,n){try{var r,a=e._value;!e._state&&je.length&&(je=[]),r=It&&e._consoleTask?e._consoleTask.run(function(){return t(a)}):t(a),e._state||je.indexOf(a)!==-1||(i=>{for(var o=Yt.length;o;)if(Yt[--o]._value===i._value)return Yt.splice(o,1)})(e),n.resolve(r)}catch(i){n.reject(i)}finally{--Gt==0&&xn(),--n.psd.ref||n.psd.finalize()}}function xa(){Qt(Lt,function(){oe()&&se()})}function oe(){var t=gn;return $e=gn=!1,t}function se(){var t,e,n;do for(;0<ke.length;)for(t=ke,ke=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(0<ke.length);$e=gn=!0}function xn(){for(var t=Yt,e=(Yt=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)}),Le.slice(0)),n=e.length;n;)e[--n]()}function qe(t){return new $(be,!1,t)}function rt(t,e){var n=R;return function(){var r=oe(),a=R;try{return Rt(n,!0),t.apply(this,arguments)}catch(i){e&&e(i)}finally{Rt(a,!1),r&&se()}}}z($.prototype,{then:wn,_then:function(t,e){kn(this,new fr(null,null,t,e,R))},catch:function(t){var e,n;return arguments.length===1?this.then(null,t):(e=t,n=arguments[1],typeof e=="function"?this.then(null,function(r){return(r instanceof e?n:qe)(r)}):this.then(null,function(r){return(r&&r.name===e?n:qe)(r)}))},finally:function(t){return this.then(function(e){return $.resolve(t()).then(function(){return e})},function(e){return $.resolve(t()).then(function(){return qe(e)})})},timeout:function(t,e){var n=this;return t<1/0?new $(function(r,a){var i=setTimeout(function(){return a(new N.Timeout(e))},t);n.then(r,a).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Z($.prototype,Symbol.toStringTag,"Dexie.Promise"),Lt.env=hr(),z($,{all:function(){var t=Pt.apply(null,arguments).map(Ne);return new $(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(a,i){return $.resolve(a).then(function(o){t[i]=o,--r||e(t)},n)})})},resolve:function(t){return t instanceof $?t:t&&typeof t.then=="function"?new $(function(e,n){t.then(e,n)}):new $(be,!0,t)},reject:qe,race:function(){var t=Pt.apply(null,arguments).map(Ne);return new $(function(e,n){t.map(function(r){return $.resolve(r).then(e,n)})})},PSD:{get:function(){return R},set:function(t){return R=t}},totalEchoes:{get:function(){return Be}},newPSD:qt,usePSD:Qt,scheduler:{get:function(){return _e},set:function(t){_e=t}},rejectionMapper:{get:function(){return bn},set:function(t){bn=t}},follow:function(t,e){return new $(function(n,r){return qt(function(a,i){var o=R;o.unhandleds=[],o.onunhandled=i,o.finalize=zt(function(){var s,f=this;s=function(){f.unhandleds.length===0?a():i(f.unhandleds[0])},Le.push(function w(){s(),Le.splice(Le.indexOf(w),1)}),++Gt,_e(function(){--Gt==0&&xn()},[])},o.finalize),t()},e,n,r)})}}),Ht&&(Ht.allSettled&&Z($,"allSettled",function(){var t=Pt.apply(null,arguments).map(Ne);return new $(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(a,i){return $.resolve(a).then(function(o){return r[i]={status:"fulfilled",value:o}},function(o){return r[i]={status:"rejected",reason:o}}).then(function(){return--n||e(r)})})})}),Ht.any&&typeof AggregateError<"u"&&Z($,"any",function(){var t=Pt.apply(null,arguments).map(Ne);return new $(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,a=new Array(r);t.forEach(function(i,o){return $.resolve(i).then(function(s){return e(s)},function(s){a[o]=s,--r||n(new AggregateError(a))})})})}),Ht.withResolvers)&&($.withResolvers=Ht.withResolvers);var pt={awaits:0,echoes:0,id:0},Sa=0,Me=[],Re=0,Be=0,Ta=0;function qt(t,o,n,r){var a=R,i=Object.create(a),o=(i.parent=a,i.ref=0,i.global=!1,i.id=++Ta,Lt.env,i.env=vn?{Promise:$,PromiseProp:{value:$,configurable:!0,writable:!0},all:$.all,race:$.race,allSettled:$.allSettled,any:$.any,resolve:$.resolve,reject:$.reject}:{},o&&K(i,o),++a.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()},Qt(i,t,n,r));return i.ref===0&&i.finalize(),o}function ue(){return pt.id||(pt.id=++Sa),++pt.awaits,pt.echoes+=dr,pt.id}function Mt(){return!!pt.awaits&&(--pt.awaits==0&&(pt.id=0),pt.echoes=pt.awaits*dr,!0)}function Ne(t){return pt.echoes&&t&&t.constructor===Ht?(ue(),t.then(function(e){return Mt(),e},function(e){return Mt(),ut(e)})):t}function Da(){var t=Me[Me.length-1];Me.pop(),Rt(t,!1)}function Rt(t,e){var n,r,a=R;(e?!pt.echoes||Re++&&t===R:!Re||--Re&&t===R)||queueMicrotask(e?(function(i){++Be,pt.echoes&&--pt.echoes!=0||(pt.echoes=pt.awaits=pt.id=0),Me.push(R),Rt(i,!0)}).bind(null,t):Da),t!==R&&(R=t,a===Lt&&(Lt.env=hr()),vn)&&(n=Lt.env.Promise,r=t.env,a.global||t.global)&&(Object.defineProperty(T,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any)&&(n.any=r.any)}function hr(){var t=T.Promise;return vn?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(T,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function Qt(t,e,n,r,a){var i=R;try{return Rt(t,!0),e(n,r,a)}finally{Rt(i,!1)}}function mr(t,e,n,r){return typeof t!="function"?t:function(){var a=R;n&&ue(),Rt(e,!0);try{return t.apply(this,arguments)}finally{Rt(a,!1),r&&queueMicrotask(Mt)}}}function Sn(t){Promise===Ht&&pt.echoes===0?Re===0?t():enqueueNativeMicroTask(t):setTimeout(t,0)}(""+pe).indexOf("[native code]")===-1&&(ue=Mt=tt);var ut=$.reject,Xt="ï¿¿",Kt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",yr="String expected.",ce=[],Fe="__dbnames",Tn="readonly",Dn="readwrite";function Jt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var vr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ue(t){return typeof t!="string"||/\./.test(t)?function(e){return e}:function(e){return e[t]===void 0&&t in e&&delete(e=Wt(e))[t],e}}function gr(){throw N.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function G(t,e){try{var n=br(t),r=br(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e<t?1:t<e?-1:0;case"binary":for(var a=wr(t),i=wr(e),o=a.length,s=i.length,f=o<s?o:s,w=0;w<f;++w)if(a[w]!==i[w])return a[w]<i[w]?-1:1;return o===s?0:o<s?-1:1;case"Array":for(var p=t,l=e,m=p.length,v=l.length,h=m<v?m:v,d=0;d<h;++d){var _=G(p[d],l[d]);if(_!==0)return _}return m===v?0:m<v?-1:1}}catch{}return NaN}function br(t){var e=typeof t;return e=="object"&&(ArrayBuffer.isView(t)||(e=fn(t))==="ArrayBuffer")?"binary":e}function wr(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}function We(t,e,n){var r=t.schema.yProps;return r?(e&&0<n.numFailures&&(e=e.filter(function(a,i){return!n.failures[i]})),Promise.all(r.map(function(a){return a=a.updatesTable,e?t.db.table(a).where("k").anyOf(e).delete():t.db.table(a).clear()})).then(function(){return n})):n}_r.prototype.execute=function(t){var e=this["@@propmod"];if(e.add!==void 0){var n=e.add;if(E(n))return x(x([],E(t)?t:[],!0),n).sort();if(typeof n=="number")return(Number(t)||0)+n;if(typeof n=="bigint")try{return BigInt(t)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(e.remove!==void 0){var r=e.remove;if(E(r))return E(t)?t.filter(function(a){return!r.includes(a)}).sort():[];if(typeof r=="number")return Number(t)-r;if(typeof r=="bigint")try{return BigInt(t)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return n=(n=e.replacePrefix)==null?void 0:n[0],n&&typeof t=="string"&&t.startsWith(n)?e.replacePrefix[1]+t.substring(n.length):t};var xe=_r;function _r(t){this["@@propmod"]=t}function kr(t,e){for(var n=S(e),r=n.length,a=!1,i=0;i<r;++i){var o=n[i],s=e[o],f=bt(t,o);s instanceof xe?(st(t,o,s.execute(f)),a=!0):f!==s&&(st(t,o,s),a=!0)}return a}et.prototype._trans=function(t,e,n){var r=this._tx||R.trans,a=this.name,i=It&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function o(w,p,l){if(l.schema[a])return e(l.idbtrans,l);throw new N.NotFound("Table "+a+" not part of transaction")}var s=oe();try{var f=r&&r.db._novip===this.db._novip?r===R.trans?r._promise(t,o,n):qt(function(){return r._promise(t,o,n)},{trans:r,transless:R.transless||R}):function w(p,l,m,v){if(p.idbdb&&(p._state.openComplete||R.letThrough||p._vip)){var h=p._createTransaction(l,m,p._dbSchema);try{h.create(),p._state.PR1398_maxLoop=3}catch(d){return d.name===mn.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return w(p,l,m,v)})):ut(d)}return h._promise(l,function(d,_){return qt(function(){return R.trans=h,v(d,_,h)})}).then(function(d){if(l==="readwrite")try{h.idbtrans.commit()}catch{}return l==="readonly"?d:h._completion.then(function(){return d})})}if(p._state.openComplete)return ut(new N.DatabaseClosed(p._state.dbOpenError));if(!p._state.isBeingOpened){if(!p._state.autoOpen)return ut(new N.DatabaseClosed);p.open().catch(tt)}return p._state.dbReadyPromise.then(function(){return w(p,l,m,v)})}(this.db,t,[this.name],o);return i&&(f._consoleTask=i,f=f.catch(function(w){return console.trace(w),ut(w)})),f}finally{s&&se()}},et.prototype.get=function(t,e){var n=this;return t&&t.constructor===Object?this.where(t).first(e):t==null?ut(new N.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:t}).then(function(a){return n.hook.reading.fire(a)})}).then(e)},et.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(E(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var e=S(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(s){if(s.compound&&e.every(function(w){return 0<=s.keyPath.indexOf(w)})){for(var f=0;f<e.length;++f)if(e.indexOf(s.keyPath[f])===-1)return!1;return!0}return!1}).sort(function(s,f){return s.keyPath.length-f.keyPath.length})[0];if(n&&this.db._maxKey!==Xt)return o=n.keyPath.slice(0,e.length),this.where(o).equals(o.map(function(s){return t[s]}));!n&&It&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(e.join("+"),"]"));var r=this.schema.idxByName;function a(s,f){return G(s,f)===0}var o=e.reduce(function(p,f){var w=p[0],p=p[1],l=r[f],m=t[f];return[w||l,w||!l?Jt(p,l&&l.multi?function(v){return v=bt(v,f),E(v)&&v.some(function(h){return a(m,h)})}:function(v){return a(m,bt(v,f))}):p]},[null,null]),i=o[0],o=o[1];return i?this.where(i.name).equals(t[i.keyPath]).filter(o):n?this.filter(o):this.where(e).equals("")},et.prototype.filter=function(t){return this.toCollection().and(t)},et.prototype.count=function(t){return this.toCollection().count(t)},et.prototype.offset=function(t){return this.toCollection().offset(t)},et.prototype.limit=function(t){return this.toCollection().limit(t)},et.prototype.each=function(t){return this.toCollection().each(t)},et.prototype.toArray=function(t){return this.toCollection().toArray(t)},et.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},et.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,E(t)?"[".concat(t.join("+"),"]"):t))},et.prototype.reverse=function(){return this.toCollection().reverse()},et.prototype.mapToClass=function(t){for(var e=this.db,n=this.name,r=((this.schema.mappedClass=t).prototype instanceof gr&&(t=(o=>{var s=p,f=o;if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function w(){this.constructor=s}function p(){return o!==null&&o.apply(this,arguments)||this}return c(s,f),s.prototype=f===null?Object.create(f):(w.prototype=f.prototype,new w),Object.defineProperty(p.prototype,"db",{get:function(){return e},enumerable:!1,configurable:!0}),p.prototype.table=function(){return n},p})(t)),new Set),a=t.prototype;a;a=M(a))Object.getOwnPropertyNames(a).forEach(function(o){return r.add(o)});function i(o){if(!o)return o;var s,f=Object.create(t.prototype);for(s in o)if(!r.has(s))try{f[s]=o[s]}catch{}return f}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=i,this.hook("reading",i),t},et.prototype.defineClass=function(){return this.mapToClass(function(t){K(this,t)})},et.prototype.add=function(t,e){var n=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=t;return i&&a&&(o=Ue(i)(t)),this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"add",keys:e!=null?[e]:null,values:[o]})}).then(function(s){return s.numFailures?$.reject(s.failures[0]):s.lastResult}).then(function(s){if(i)try{st(t,i,s)}catch{}return s})},et.prototype.upsert=function(t,e){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(a){return n.core.get({trans:a,key:t}).then(function(i){var o=i??{};return kr(o,e),r&&st(o,r,t),n.core.mutate({trans:a,type:"put",values:[o],keys:[t],upsert:!0,updates:{keys:[t],changeSpecs:[e]}}).then(function(s){return s.numFailures?$.reject(s.failures[0]):!!i})})})},et.prototype.update=function(t,e){return typeof t!="object"||E(t)?this.where(":id").equals(t).modify(e):(t=bt(t,this.schema.primKey.keyPath))===void 0?ut(new N.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(e)},et.prototype.put=function(t,e){var n=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=t;return i&&a&&(o=Ue(i)(t)),this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"put",values:[o],keys:e!=null?[e]:null})}).then(function(s){return s.numFailures?$.reject(s.failures[0]):s.lastResult}).then(function(s){if(i)try{st(t,i,s)}catch{}return s})},et.prototype.delete=function(t){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"delete",keys:[t]}).then(function(r){return We(e,[t],r)}).then(function(r){return r.numFailures?$.reject(r.failures[0]):void 0})})},et.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:vr}).then(function(n){return We(t,null,n)})}).then(function(e){return e.numFailures?$.reject(e.failures[0]):void 0})},et.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",function(n){return e.core.getMany({keys:t,trans:n}).then(function(r){return r.map(function(a){return e.hook.reading.fire(a)})})})},et.prototype.bulkAdd=function(t,e,n){var r=this,a=Array.isArray(e)?e:void 0,i=(n=n||(a?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(o){var s=r.schema.primKey,w=s.auto,s=s.keyPath;if(s&&a)throw new N.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");var f=t.length,w=s&&w?t.map(Ue(s)):t;return r.core.mutate({trans:o,type:"add",keys:a,values:w,wantResults:i}).then(function(p){var l=p.numFailures,m=p.failures;if(l===0)return i?p.results:p.lastResult;throw new ie("".concat(r.name,".bulkAdd(): ").concat(l," of ").concat(f," operations failed"),m)})})},et.prototype.bulkPut=function(t,e,n){var r=this,a=Array.isArray(e)?e:void 0,i=(n=n||(a?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(o){var s=r.schema.primKey,w=s.auto,s=s.keyPath;if(s&&a)throw new N.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");var f=t.length,w=s&&w?t.map(Ue(s)):t;return r.core.mutate({trans:o,type:"put",keys:a,values:w,wantResults:i}).then(function(p){var l=p.numFailures,m=p.failures;if(l===0)return i?p.results:p.lastResult;throw new ie("".concat(r.name,".bulkPut(): ").concat(l," of ").concat(f," operations failed"),m)})})},et.prototype.bulkUpdate=function(t){var e=this,n=this.core,r=t.map(function(o){return o.key}),a=t.map(function(o){return o.changes}),i=[];return this._trans("readwrite",function(o){return n.getMany({trans:o,keys:r,cache:"clone"}).then(function(s){var f=[],w=[],p=(t.forEach(function(l,m){var v=l.key,h=l.changes,d=s[m];if(d){for(var _=0,k=Object.keys(h);_<k.length;_++){var b=k[_],D=h[b];if(b===e.schema.primKey.keyPath){if(G(D,v)!==0)throw new N.Constraint("Cannot update primary key in bulkUpdate()")}else st(d,b,D)}i.push(m),f.push(v),w.push(d)}}),f.length);return n.mutate({trans:o,type:"put",keys:f,values:w,updates:{keys:r,changeSpecs:a}}).then(function(l){var m=l.numFailures,v=l.failures;if(m===0)return p;for(var h=0,d=Object.keys(v);h<d.length;h++){var _,k=d[h],b=i[Number(k)];b!=null&&(_=v[k],delete v[k],v[b]=_)}throw new ie("".concat(e.name,".bulkUpdate(): ").concat(m," of ").concat(p," operations failed"),v)})})})},et.prototype.bulkDelete=function(t){var e=this,n=t.length;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"delete",keys:t}).then(function(a){return We(e,t,a)})}).then(function(r){var a=r.numFailures,i=r.failures;if(a===0)return r.lastResult;throw new ie("".concat(e.name,".bulkDelete(): ").concat(a," of ").concat(n," operations failed"),i)})};var xr=et;function et(){}function Se(t){function e(o,s){if(s){for(var f=arguments.length,w=new Array(f-1);--f;)w[f-1]=arguments[f];return n[o].subscribe.apply(null,w),t}if(typeof o=="string")return n[o]}var n={};e.addEventType=i;for(var r=1,a=arguments.length;r<a;++r)i(arguments[r]);return e;function i(o,s,f){var w,p;if(typeof o!="object")return s=s||_a,p={subscribers:[],fire:f=f||tt,subscribe:function(l){p.subscribers.indexOf(l)===-1&&(p.subscribers.push(l),p.fire=s(p.fire,l))},unsubscribe:function(l){p.subscribers=p.subscribers.filter(function(m){return m!==l}),p.fire=p.subscribers.reduce(s,f)}},n[o]=e[o]=p;S(w=o).forEach(function(l){var m=w[l];if(E(m))i(l,w[l][0],w[l][1]);else{if(m!=="asap")throw new N.InvalidArgument("Invalid event config");var v=i(l,ge,function(){for(var h=arguments.length,d=new Array(h);h--;)d[h]=arguments[h];v.subscribers.forEach(function(_){mt(function(){_.apply(null,d)})})})}})}}function Te(t,e){return ft(e).from({prototype:t}),e}function le(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function En(t,e){t.filter=Jt(t.filter,e)}function In(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Jt(r(),e())}:e,t.justLimit=n&&!r}function Ve(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(n)return n;throw new N.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed")}function Sr(t,e,n){var r=Ve(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function ze(t,e,n,r){var a,i,o=t.replayFilter?Jt(t.filter,t.replayFilter()):t.filter;return t.or?(a={},i=function(s,f,w){var p,l;o&&!o(f,w,function(m){return f.stop(m)},function(m){return f.fail(m)})||((l=""+(p=f.primaryKey))=="[object ArrayBuffer]"&&(l=""+new Uint8Array(p)),B(a,l))||(a[l]=!0,e(s,f,w))},Promise.all([t.or._iterate(i,n),Tr(Sr(t,r,n),t.algorithm,i,!t.keysOnly&&t.valueMapper)])):Tr(Sr(t,r,n),Jt(t.algorithm,o),e,!t.keysOnly&&t.valueMapper)}function Tr(t,e,n,r){var a=rt(r?function(i,o,s){return n(r(i),o,s)}:n);return t.then(function(i){if(i)return i.start(function(){var o=function(){return i.continue()};e&&!e(i,function(s){return o=s},function(s){i.stop(s),o=tt},function(s){i.fail(s),o=tt})||a(i.value,i,function(s){return o=s}),o()})})}X.prototype._read=function(t,e){var n=this._ctx;return n.error?n.table._trans(null,ut.bind(null,n.error)):n.table._trans("readonly",t).then(e)},X.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,ut.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},X.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Jt(e.algorithm,t)},X.prototype._iterate=function(t,e){return ze(this._ctx,t,e,this._ctx.table.core)},X.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&K(n,t),e._ctx=n,e},X.prototype.raw=function(){return this._ctx.valueMapper=null,this},X.prototype.each=function(t){var e=this._ctx;return this._read(function(n){return ze(e,t,n,e.table.core)})},X.prototype.count=function(t){var e=this;return this._read(function(n){var r,a=e._ctx,i=a.table.core;return le(a,!0)?i.count({trans:n,query:{index:Ve(a,i.schema),range:a.range}}).then(function(o){return Math.min(o,a.limit)}):(r=0,ze(a,function(){return++r,!1},n,i).then(function(){return r}))}).then(t)},X.prototype.sortBy=function(t,e){var n=t.split(".").reverse(),r=n[0],a=n.length-1;function i(f,w){return w?i(f[n[w]],w-1):f[r]}var o=this._ctx.dir==="next"?1:-1;function s(f,w){return G(i(f,a),i(w,a))*o}return this.toArray(function(f){return f.sort(s)}).then(e)},X.prototype.toArray=function(t){var e=this;return this._read(function(n){var r,a,i,o=e._ctx;return o.dir==="next"&&le(o,!0)&&0<o.limit?(r=o.valueMapper,a=Ve(o,o.table.core.schema),o.table.core.query({trans:n,limit:o.limit,values:!0,query:{index:a,range:o.range}}).then(function(s){return s=s.result,r?s.map(r):s})):(i=[],ze(o,function(s){return i.push(s)},n,o.table.core).then(function(){return i}))},t)},X.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,le(e)?In(e,function(){var n=t;return function(r,a){return n===0||(n===1?--n:a(function(){r.advance(n),n=0}),!1)}}):In(e,function(){var n=t;return function(){return--n<0}})),this},X.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),In(this._ctx,function(){var e=t;return function(n,r,a){return--e<=0&&r(a),0<=e}},!0),this},X.prototype.until=function(t,e){return En(this._ctx,function(n,r,a){return!t(n.value)||(r(a),e)}),this},X.prototype.first=function(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)},X.prototype.last=function(t){return this.reverse().first(t)},X.prototype.filter=function(t){var e;return En(this._ctx,function(n){return t(n.value)}),(e=this._ctx).isMatch=Jt(e.isMatch,t),this},X.prototype.and=function(t){return this.filter(t)},X.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},X.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},X.prototype.desc=function(){return this.reverse()},X.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(n,r){t(r.key,r)})},X.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},X.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(n,r){t(r.primaryKey,r)})},X.prototype.keys=function(t){var e=this._ctx,n=(e.keysOnly=!e.isMatch,[]);return this.each(function(r,a){n.push(a.key)}).then(function(){return n}).then(t)},X.prototype.primaryKeys=function(t){var e=this._ctx;if(e.dir==="next"&&le(e,!0)&&0<e.limit)return this._read(function(r){var a=Ve(e,e.table.core.schema);return e.table.core.query({trans:r,values:!1,limit:e.limit,query:{index:a,range:e.range}})}).then(function(r){return r.result}).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each(function(r,a){n.push(a.primaryKey)}).then(function(){return n}).then(t)},X.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},X.prototype.firstKey=function(t){return this.limit(1).keys(function(e){return e[0]}).then(t)},X.prototype.lastKey=function(t){return this.reverse().firstKey(t)},X.prototype.distinct=function(){var t,e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];return e&&e.multi&&(t={},En(this._ctx,function(r){var r=r.primaryKey.toString(),a=B(t,r);return t[r]=!0,!a})),this},X.prototype.modify=function(t){var e=this,n=this._ctx;return this._write(function(r){function a(d,_){var k=_.failures;m+=d-_.numFailures;for(var b=0,D=S(k);b<D.length;b++){var I=D[b];l.push(k[I])}}var i=typeof t=="function"?t:function(d){return kr(d,t)},o=n.table.core,p=o.schema.primaryKey,s=p.outbound,f=p.extractKey,w=200,p=e.db._options.modifyChunkSize,l=(p&&(w=typeof p=="object"?p[o.name]||p["*"]||200:p),[]),m=0,v=[],h=t===Dr;return e.clone().primaryKeys().then(function(d){function _(b){var D=Math.min(w,d.length-b),I=d.slice(b,b+D);return(h?Promise.resolve([]):o.getMany({trans:r,keys:I,cache:"immutable"})).then(function(P){var C=[],O=[],L=s?[]:null,j=h?I:[];if(!h)for(var A=0;A<D;++A){var q=P[A],Q={value:Wt(q),primKey:d[b+A]};i.call(Q,Q.value,Q)!==!1&&(Q.value==null?j.push(d[b+A]):s||G(f(q),f(Q.value))===0?(O.push(Q.value),s&&L.push(d[b+A])):(j.push(d[b+A]),C.push(Q.value)))}return Promise.resolve(0<C.length&&o.mutate({trans:r,type:"add",values:C}).then(function(J){for(var F in J.failures)j.splice(parseInt(F),1);a(C.length,J)})).then(function(){return(0<O.length||k&&typeof t=="object")&&o.mutate({trans:r,type:"put",keys:L,values:O,criteria:k,changeSpec:typeof t!="function"&&t,isAdditionalChunk:0<b}).then(function(J){return a(O.length,J)})}).then(function(){return(0<j.length||k&&h)&&o.mutate({trans:r,type:"delete",keys:j,criteria:k,isAdditionalChunk:0<b}).then(function(J){return We(n.table,j,J)}).then(function(J){return a(j.length,J)})}).then(function(){return d.length>b+D&&_(b+w)})})}var k=le(n)&&n.limit===1/0&&(typeof t!="function"||h)&&{index:n.index,range:n.range};return _(0).then(function(){if(0<l.length)throw new Ke("Error modifying one or more objects",l,m,v);return d.length})})})},X.prototype.delete=function(){var t=this._ctx,e=t.range;return!le(t)||t.table.schema.yProps||!t.isPrimKey&&e.type!==3?this.modify(Dr):this._write(function(n){var r=t.table.core.schema.primaryKey,a=e;return t.table.core.count({trans:n,query:{index:r,range:a}}).then(function(i){return t.table.core.mutate({trans:n,type:"deleteRange",range:a}).then(function(f){var s=f.failures,f=f.numFailures;if(f)throw new Ke("Could not delete some values",Object.keys(s).map(function(w){return s[w]}),i-f);return i-f})})})};var Ea=X;function X(){}var Dr=function(t,e){return e.value=null};function Ia(t,e){return t<e?-1:t===e?0:1}function Oa(t,e){return e<t?-1:t===e?0:1}function kt(t,e,n){return t=t instanceof Ir?new t.Collection(t):t,t._ctx.error=new(n||TypeError)(e),t}function de(t){return new t.Collection(t,function(){return Er("")}).limit(0)}function He(v,e,n,r){var a,i,o,s,f,w,p,l=n.length;if(!n.every(function(d){return typeof d=="string"}))return kt(v,yr);function m(d){a=d==="next"?function(k){return k.toUpperCase()}:function(k){return k.toLowerCase()},i=d==="next"?function(k){return k.toLowerCase()}:function(k){return k.toUpperCase()},o=d==="next"?Ia:Oa;var _=n.map(function(k){return{lower:i(k),upper:a(k)}}).sort(function(k,b){return o(k.lower,b.lower)});s=_.map(function(k){return k.upper}),f=_.map(function(k){return k.lower}),p=(w=d)==="next"?"":r}m("next");var v=new v.Collection(v,function(){return Bt(s[0],f[l-1]+r)}),h=(v._ondirectionchange=function(d){m(d)},0);return v._addAlgorithm(function(d,_,k){var b=d.key;if(typeof b=="string"){var D=i(b);if(e(D,f,h))return!0;for(var I=null,P=h;P<l;++P){var C=((O,L,j,A,q,Q)=>{for(var J=Math.min(O.length,A.length),F=-1,H=0;H<J;++H){var at=L[H];if(at!==A[H])return q(O[H],j[H])<0?O.substr(0,H)+j[H]+j.substr(H+1):q(O[H],A[H])<0?O.substr(0,H)+A[H]+j.substr(H+1):0<=F?O.substr(0,F)+L[F]+j.substr(F+1):null;q(O[H],at)<0&&(F=H)}return J<A.length&&Q==="next"?O+j.substr(O.length):J<O.length&&Q==="prev"?O.substr(0,j.length):F<0?null:O.substr(0,F)+A[F]+j.substr(F+1)})(b,D,s[P],f[P],o,w);C===null&&I===null?h=P+1:(I===null||0<o(I,C))&&(I=C)}_(I!==null?function(){d.continue(I+p)}:k)}return!1}),v}function Bt(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Er(t){return{type:1,lower:t,upper:t}}Object.defineProperty(ht.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ht.prototype.between=function(t,e,n,r){n=n!==!1,r=r===!0;try{return 0<this._cmp(t,e)||this._cmp(t,e)===0&&(n||r)&&(!n||!r)?de(this):new this.Collection(this,function(){return Bt(t,e,!n,!r)})}catch{return kt(this,Kt)}},ht.prototype.equals=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Er(t)})},ht.prototype.above=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(t,void 0,!0)})},ht.prototype.aboveOrEqual=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(t,void 0,!1)})},ht.prototype.below=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(void 0,t,!1,!0)})},ht.prototype.belowOrEqual=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(void 0,t)})},ht.prototype.startsWith=function(t){return typeof t!="string"?kt(this,yr):this.between(t,t+Xt,!0,!0)},ht.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):He(this,function(e,n){return e.indexOf(n[0])===0},[t],Xt)},ht.prototype.equalsIgnoreCase=function(t){return He(this,function(e,n){return e===n[0]},[t],"")},ht.prototype.anyOfIgnoreCase=function(){var t=Pt.apply(re,arguments);return t.length===0?de(this):He(this,function(e,n){return n.indexOf(e)!==-1},t,"")},ht.prototype.startsWithAnyOfIgnoreCase=function(){var t=Pt.apply(re,arguments);return t.length===0?de(this):He(this,function(e,n){return n.some(function(r){return e.indexOf(r)===0})},t,Xt)},ht.prototype.anyOf=function(){var t,e,n=this,r=Pt.apply(re,arguments),a=this._cmp;try{r.sort(a)}catch{return kt(this,Kt)}return r.length===0?de(this):((t=new this.Collection(this,function(){return Bt(r[0],r[r.length-1])}))._ondirectionchange=function(i){a=i==="next"?n._ascending:n._descending,r.sort(a)},e=0,t._addAlgorithm(function(i,o,s){for(var f=i.key;0<a(f,r[e]);)if(++e===r.length)return o(s),!1;return a(f,r[e])===0||(o(function(){i.continue(r[e])}),!1)}),t)},ht.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ht.prototype.noneOf=function(){var t=Pt.apply(re,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return kt(this,Kt)}var e=t.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},ht.prototype.inAnyRange=function(t,k){var n=this,r=this._cmp,a=this._ascending,i=this._descending,o=this._min,s=this._max;if(t.length===0)return de(this);if(!t.every(function(b){return b[0]!==void 0&&b[1]!==void 0&&a(b[0],b[1])<=0}))return kt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",N.InvalidArgument);var f=!k||k.includeLowers!==!1,w=k&&k.includeUppers===!0,p,l=a;function m(b,D){return l(b[0],D[0])}try{(p=t.reduce(function(b,D){for(var I=0,P=b.length;I<P;++I){var C=b[I];if(r(D[0],C[1])<0&&0<r(D[1],C[0])){C[0]=o(C[0],D[0]),C[1]=s(C[1],D[1]);break}}return I===P&&b.push(D),b},[])).sort(m)}catch{return kt(this,Kt)}var v=0,h=w?function(b){return 0<a(b,p[v][1])}:function(b){return 0<=a(b,p[v][1])},d=f?function(b){return 0<i(b,p[v][0])}:function(b){return 0<=i(b,p[v][0])},_=h,k=new this.Collection(this,function(){return Bt(p[0][0],p[p.length-1][1],!f,!w)});return k._ondirectionchange=function(b){l=b==="next"?(_=h,a):(_=d,i),p.sort(m)},k._addAlgorithm(function(b,D,I){for(var P,C=b.key;_(C);)if(++v===p.length)return D(I),!1;return!h(P=C)&&!d(P)||(n._cmp(C,p[v][1])===0||n._cmp(C,p[v][0])===0||D(function(){l===a?b.continue(p[v][0]):b.continue(p[v][1])}),!1)}),k},ht.prototype.startsWithAnyOf=function(){var t=Pt.apply(re,arguments);return t.every(function(e){return typeof e=="string"})?t.length===0?de(this):this.inAnyRange(t.map(function(e){return[e,e+Xt]})):kt(this,"startsWithAnyOf() only works with strings")};var Ir=ht;function ht(){}function Ot(t){return rt(function(e){return De(e),t(e.target.error),!1})}function De(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Ee="storagemutated",On="x-storagemutated-1",Nt=Se(null,Ee),Aa=(At.prototype._lock=function(){return xt(!R.global),++this._reculock,this._reculock!==1||R.global||(R.lockOwnerFor=this),this},At.prototype._unlock=function(){if(xt(!R.global),--this._reculock==0)for(R.global||(R.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{Qt(t[1],t[0])}catch{}}return this},At.prototype._locked=function(){return this._reculock&&R.lockOwnerFor!==this},At.prototype.create=function(t){var e=this;if(this.mode){var n=this.db.idbdb,r=this.db._state.dbOpenError;if(xt(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new N.DatabaseClosed(r);case"MissingAPIError":throw new N.MissingAPI(r.message,r);default:throw new N.OpenFailed(r)}if(!this.active)throw new N.TransactionInactive;xt(this._completion._state===null),(t=this.idbtrans=t||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=rt(function(a){De(a),e._reject(t.error)}),t.onabort=rt(function(a){De(a),e.active&&e._reject(new N.Abort(t.error)),e.active=!1,e.on("abort").fire(a)}),t.oncomplete=rt(function(){e.active=!1,e._resolve(),"mutatedParts"in t&&Nt.storagemutated.fire(t.mutatedParts)})}return this},At.prototype._promise=function(t,e,n){var r,a=this;return t==="readwrite"&&this.mode!=="readwrite"?ut(new N.ReadOnly("Transaction is readonly")):this.active?this._locked()?new $(function(i,o){a._blockedFuncs.push([function(){a._promise(t,e,n).then(i,o)},R])}):n?qt(function(){var i=new $(function(o,s){a._lock();var f=e(o,s,a);f&&f.then&&f.then(o,s)});return i.finally(function(){return a._unlock()}),i._lib=!0,i}):((r=new $(function(i,o){var s=e(i,o,a);s&&s.then&&s.then(i,o)}))._lib=!0,r):ut(new N.TransactionInactive)},At.prototype._root=function(){return this.parent?this.parent._root():this},At.prototype.waitFor=function(t){var e,n=this._root(),r=$.resolve(t),a=(n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],e=n.idbtrans.objectStore(n.storeNames[0]),function i(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(e.get(-1/0).onsuccess=i)}()),n._waitingFor);return new $(function(i,o){r.then(function(s){return n._waitingQueue.push(rt(i.bind(null,s)))},function(s){return n._waitingQueue.push(rt(o.bind(null,s)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},At.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new N.Abort))},At.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(B(e,t))return e[t];var n=this.schema[t];if(n)return(n=new this.db.Table(t,n,this)).core=this.db.core.table(t),e[t]=n;throw new N.NotFound("Table "+t+" not part of transaction")},At);function At(){}function An(t,e,n,r,a,i,o,s){return{name:t,keyPath:e,unique:n,multi:r,auto:a,compound:i,src:(n&&!o?"&":"")+(r?"*":"")+(a?"++":"")+Or(e),type:s}}function Or(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Pn(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:(r=function(a){return[a.name,a]},n.reduce(function(a,i,o){return i=r(i,o),i&&(a[i[0]]=i[1]),a},{}))};var r}var Ie=function(t){try{return t.only([[]]),Ie=function(){return[[]]},[[]]}catch{return Ie=function(){return Xt},Xt}};function Cn(t){return t==null?function(){}:typeof t=="string"?(e=t).split(".").length===1?function(n){return n[e]}:function(n){return bt(n,e)}:function(n){return bt(n,t)};var e}function Ar(t){return[].slice.call(t)}var Pa=0;function Oe(t){return t==null?":id":typeof t=="string"?t:"[".concat(t.join("+"),"]")}function Ca(t,e,f){function r(h){if(h.type===3)return null;if(h.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var l=h.lower,m=h.upper,v=h.lowerOpen,h=h.upperOpen;return l===void 0?m===void 0?null:e.upperBound(m,!!h):m===void 0?e.lowerBound(l,!!v):e.bound(l,m,!!v,!!h)}function a(p){var l,m=p.name;return{name:m,schema:p,mutate:function(v){var h=v.trans,d=v.type,_=v.keys,k=v.values,b=v.range;return new Promise(function(D,I){D=rt(D);var P=h.objectStore(m),C=P.keyPath==null,O=d==="put"||d==="add";if(!O&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);var L,j=(_||k||{length:1}).length;if(_&&k&&_.length!==k.length)throw new Error("Given keys array must have same length as given values array.");if(j===0)return D({numFailures:0,failures:{},results:[],lastResult:void 0});function A(ot){++J,De(ot)}var q=[],Q=[],J=0;if(d==="deleteRange"){if(b.type===4)return D({numFailures:J,failures:Q,results:[],lastResult:void 0});b.type===3?q.push(L=P.clear()):q.push(L=P.delete(r(b)))}else{var C=O?C?[k,_]:[k,null]:[_,null],F=C[0],H=C[1];if(O)for(var at=0;at<j;++at)q.push(L=H&&H[at]!==void 0?P[d](F[at],H[at]):P[d](F[at])),L.onerror=A;else for(at=0;at<j;++at)q.push(L=P[d](F[at])),L.onerror=A}function St(ot){ot=ot.target.result,q.forEach(function(ee,Qn){return ee.error!=null&&(Q[Qn]=ee.error)}),D({numFailures:J,failures:Q,results:d==="delete"?_:q.map(function(ee){return ee.result}),lastResult:ot})}L.onerror=function(ot){A(ot),St(ot)},L.onsuccess=St})},getMany:function(v){var h=v.trans,d=v.keys;return new Promise(function(_,k){_=rt(_);for(var b,D=h.objectStore(m),I=d.length,P=new Array(I),C=0,O=0,L=function(q){q=q.target,P[q._pos]=q.result,++O===C&&_(P)},j=Ot(k),A=0;A<I;++A)d[A]!=null&&((b=D.get(d[A]))._pos=A,b.onsuccess=L,b.onerror=j,++C);C===0&&_(P)})},get:function(v){var h=v.trans,d=v.key;return new Promise(function(_,k){_=rt(_);var b=h.objectStore(m).get(d);b.onsuccess=function(D){return _(D.target.result)},b.onerror=Ot(k)})},query:(l=s,function(v){return new Promise(function(h,d){h=rt(h);var _,k,b,O=v.trans,D=v.values,I=v.limit,C=v.query,P=I===1/0?void 0:I,L=C.index,C=C.range,O=O.objectStore(m),O=L.isPrimaryKey?O:O.index(L.name),L=r(C);if(I===0)return h({result:[]});l?((C=D?O.getAll(L,P):O.getAllKeys(L,P)).onsuccess=function(j){return h({result:j.target.result})},C.onerror=Ot(d)):(_=0,k=!D&&"openKeyCursor"in O?O.openKeyCursor(L):O.openCursor(L),b=[],k.onsuccess=function(j){var A=k.result;return!A||(b.push(D?A.value:A.primaryKey),++_===I)?h({result:b}):void A.continue()},k.onerror=Ot(d))})}),openCursor:function(v){var h=v.trans,d=v.values,_=v.query,k=v.reverse,b=v.unique;return new Promise(function(D,I){D=rt(D);var O=_.index,P=_.range,C=h.objectStore(m),C=O.isPrimaryKey?C:C.index(O.name),O=k?b?"prevunique":"prev":b?"nextunique":"next",L=!d&&"openKeyCursor"in C?C.openKeyCursor(r(P),O):C.openCursor(r(P),O);L.onerror=Ot(I),L.onsuccess=rt(function(j){var A,q,Q,J,F=L.result;F?(F.___id=++Pa,F.done=!1,A=F.continue.bind(F),q=(q=F.continuePrimaryKey)&&q.bind(F),Q=F.advance.bind(F),J=function(){throw new Error("Cursor not stopped")},F.trans=h,F.stop=F.continue=F.continuePrimaryKey=F.advance=function(){throw new Error("Cursor not started")},F.fail=rt(I),F.next=function(){var H=this,at=1;return this.start(function(){return at--?H.continue():H.stop()}).then(function(){return H})},F.start=function(H){function at(){if(L.result)try{H()}catch(ot){F.fail(ot)}else F.done=!0,F.start=function(){throw new Error("Cursor behind last entry")},F.stop()}var St=new Promise(function(ot,ee){ot=rt(ot),L.onerror=Ot(ee),F.fail=ee,F.stop=function(Qn){F.stop=F.continue=F.continuePrimaryKey=F.advance=J,ot(Qn)}});return L.onsuccess=rt(function(ot){L.onsuccess=at,at()}),F.continue=A,F.continuePrimaryKey=q,F.advance=Q,at(),St},D(F)):D(null)},I)})},count:function(v){var h=v.query,d=v.trans,_=h.index,k=h.range;return new Promise(function(b,D){var I=d.objectStore(m),I=_.isPrimaryKey?I:I.index(_.name),P=r(k),P=P?I.count(P):I.count();P.onsuccess=rt(function(C){return b(C.target.result)}),P.onerror=Ot(D)})}}}i=f,o=Ar((f=t).objectStoreNames);var i,f={schema:{name:f.name,tables:o.map(function(p){return i.objectStore(p)}).map(function(p){var l=p.keyPath,m=p.autoIncrement,h=E(l),v={},h={name:p.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:l==null,compound:h,keyPath:l,autoIncrement:m,unique:!0,extractKey:Cn(l)},indexes:Ar(p.indexNames).map(function(d){return p.index(d)}).map(function(b){var D=b.name,_=b.unique,k=b.multiEntry,b=b.keyPath,D={name:D,compound:E(b),keyPath:b,unique:_,multiEntry:k,extractKey:Cn(b)};return v[Oe(b)]=D}),getIndexByKeyPath:function(d){return v[Oe(d)]}};return v[":id"]=h.primaryKey,l!=null&&(v[Oe(l)]=h.primaryKey),h})},hasGetAll:0<o.length&&"getAll"in i.objectStore(o[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},o=f.schema,s=f.hasGetAll,f=o.tables.map(a),w={};return f.forEach(function(p){return w[p.name]=p}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(p){if(w[p])return w[p];throw new Error("Table '".concat(p,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Ie(e),schema:o}}function Ka(t,e,n,r){return n=n.IDBKeyRange,e=Ca(e,n,r),{dbcore:t.dbcore.reduce(function(a,i){return i=i.create,g(g({},a),i(a))},e)}}function Ye(t,e){var n=e.db,n=Ka(t._middlewares,n,t._deps,e);t.core=n.dbcore,t.tables.forEach(function(r){var a=r.name;t.core.schema.tables.some(function(i){return i.name===a})&&(r.core=t.core.table(a),t[a]instanceof t.Table)&&(t[a].core=r.core)})}function Ge(t,e,n,r){n.forEach(function(a){var i=r[a];e.forEach(function(o){var s=function f(w,p){return vt(w,p)||(w=M(w))&&f(w,p)}(o,a);(!s||"value"in s&&s.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?Z(o,a,{get:function(){return this.table(a)},set:function(f){U(this,a,{value:f,writable:!0,configurable:!0,enumerable:!0})}}):o[a]=new t.Table(a,i))})})}function Kn(t,e){e.forEach(function(n){for(var r in n)n[r]instanceof t.Table&&delete n[r]})}function $a(t,e){return t._cfg.version-e._cfg.version}function ja(t,e,n,r){var a=t._dbSchema,i=(n.objectStoreNames.contains("$meta")&&!a.$meta&&(a.$meta=Pn("$meta",Cr("")[0],[]),t._storeNames.push("$meta")),t._createTransaction("readwrite",t._storeNames,a)),o=(i.create(n),i._completion.catch(r),i._reject.bind(i)),s=R.transless||R;qt(function(){if(R.trans=i,R.transless=s,e!==0)return Ye(t,n),w=e,((f=i).storeNames.includes("$meta")?f.table("$meta").get("version").then(function(p){return p??w}):$.resolve(w)).then(function(_){var l=t,m=_,v=i,h=n,d=[],_=l._versions,k=l._dbSchema=Xe(0,l.idbdb,h);return(_=_.filter(function(b){return b._cfg.version>=m})).length===0?$.resolve():(_.forEach(function(b){d.push(function(){var D,I,P,C=k,O=b._cfg.dbschema,L=(Je(l,C,h),Je(l,O,h),k=l._dbSchema=O,$n(C,O)),j=(L.add.forEach(function(A){jn(h,A[0],A[1].primKey,A[1].indexes)}),L.change.forEach(function(A){if(A.recreate)throw new N.Upgrade("Not yet support for changing primary key");var q=h.objectStore(A.name);A.add.forEach(function(Q){return Qe(q,Q)}),A.change.forEach(function(Q){q.deleteIndex(Q.name),Qe(q,Q)}),A.del.forEach(function(Q){return q.deleteIndex(Q)})}),b._cfg.contentUpgrade);if(j&&b._cfg.version>m)return Ye(l,h),v._memoizedTables={},D=dt(O),L.del.forEach(function(A){D[A]=C[A]}),Kn(l,[l.Transaction.prototype]),Ge(l,[l.Transaction.prototype],S(D),D),v.schema=D,(I=hn(j))&&ue(),O=$.follow(function(){var A;(P=j(v))&&I&&(A=Mt.bind(null,null),P.then(A,A))}),P&&typeof P.then=="function"?$.resolve(P):O.then(function(){return P})}),d.push(function(D){var I,P,C=b._cfg.dbschema;I=C,P=D,[].slice.call(P.db.objectStoreNames).forEach(function(O){return I[O]==null&&P.db.deleteObjectStore(O)}),Kn(l,[l.Transaction.prototype]),Ge(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),v.schema=l._dbSchema}),d.push(function(D){l.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(l.idbdb.version/10)===b._cfg.version?(l.idbdb.deleteObjectStore("$meta"),delete l._dbSchema.$meta,l._storeNames=l._storeNames.filter(function(I){return I!=="$meta"})):D.objectStore("$meta").put(b._cfg.version,"version"))})}),function b(){return d.length?$.resolve(d.shift()(v.idbtrans)).then(b):$.resolve()}().then(function(){Pr(k,h)}))}).catch(o);var f,w;S(a).forEach(function(p){jn(n,p,a[p].primKey,a[p].indexes)}),Ye(t,n),$.follow(function(){return t.on.populate.fire(i)}).catch(o)})}function La(t,e){Pr(t._dbSchema,e),e.db.version%10!=0||e.objectStoreNames.contains("$meta")||e.db.createObjectStore("$meta").add(Math.ceil(e.db.version/10-1),"version");var n=Xe(0,t.idbdb,e);Je(t,t._dbSchema,e);for(var r=0,a=$n(n,t._dbSchema).change;r<a.length;r++){var i=(o=>{if(o.change.length||o.recreate)return console.warn("Unable to patch indexes of table ".concat(o.name," because it has changes on the type of index or primary key.")),{value:void 0};var s=e.objectStore(o.name);o.add.forEach(function(f){It&&console.debug("Dexie upgrade patch: Creating missing index ".concat(o.name,".").concat(f.src)),Qe(s,f)})})(a[r]);if(typeof i=="object")return i.value}}function $n(t,e){var n,r={del:[],add:[],change:[]};for(n in t)e[n]||r.del.push(n);for(n in e){var a=t[n],i=e[n];if(a){var o={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||a.primKey.auto!==i.primKey.auto)o.recreate=!0,r.change.push(o);else{var s=a.idxByName,f=i.idxByName,w=void 0;for(w in s)f[w]||o.del.push(w);for(w in f){var p=s[w],l=f[w];p?p.src!==l.src&&o.change.push(l):o.add.push(l)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([n,i])}return r}function jn(t,e,n,r){var a=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});r.forEach(function(i){return Qe(a,i)})}function Pr(t,e){S(t).forEach(function(n){e.db.objectStoreNames.contains(n)||(It&&console.debug("Dexie: Creating missing table",n),jn(e,n,t[n].primKey,t[n].indexes))})}function Qe(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Xe(t,e,n){var r={};return Et(e.objectStoreNames,0).forEach(function(a){for(var i=n.objectStore(a),o=An(Or(w=i.keyPath),w||"",!0,!1,!!i.autoIncrement,w&&typeof w!="string",!0),s=[],f=0;f<i.indexNames.length;++f){var p=i.index(i.indexNames[f]),w=p.keyPath,p=An(p.name,w,!!p.unique,!!p.multiEntry,!1,w&&typeof w!="string",!1);s.push(p)}r[a]=Pn(a,o,s)}),r}function Je(t,e,n){for(var r=n.db.objectStoreNames,a=0;a<r.length;++a){var i=r[a],o=n.objectStore(i);t._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var f,w=o.indexNames[s],p=o.index(w).keyPath,p=typeof p=="string"?p:"["+Et(p).join("+")+"]";e[i]&&(f=e[i].idxByName[p])&&(f.name=w,delete e[i].idxByName[p],e[i].idxByName[w]=f)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&T.WorkerGlobalScope&&T instanceof T.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function Cr(t){return t.split(",").map(function(e,n){var a=e.split(":"),r=(r=a[1])==null?void 0:r.trim(),a=(e=a[0].trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return An(a,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),E(i),n===0,r)})}fe.prototype._createTableSchema=Pn,fe.prototype._parseIndexSyntax=Cr,fe.prototype._parseStoresSpec=function(t,e){var n=this;S(t).forEach(function(r){if(t[r]!==null){var a=n._parseIndexSyntax(t[r]),i=a.shift();if(!i)throw new N.Schema("Invalid schema for table "+r+": "+t[r]);if(i.unique=!0,i.multi)throw new N.Schema("Primary key cannot be multiEntry*");a.forEach(function(o){if(o.auto)throw new N.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new N.Schema("Index must have a name and cannot be an empty string")}),i=n._createTableSchema(r,i,a),e[r]=i}})},fe.prototype.stores=function(n){var e=this.db,n=(this._cfg.storesSource=this._cfg.storesSource?K(this._cfg.storesSource,n):n,e._versions),r={},a={};return n.forEach(function(i){K(r,i._cfg.storesSource),a=i._cfg.dbschema={},i._parseStoresSpec(r,a)}),e._dbSchema=a,Kn(e,[e._allTables,e,e.Transaction.prototype]),Ge(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],S(a),a),e._storeNames=S(a),this},fe.prototype.upgrade=function(t){return this._cfg.contentUpgrade=yn(this._cfg.contentUpgrade||tt,t),this};var qa=fe;function fe(){}function Ln(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new $t(Fe,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function qn(t){return t&&typeof t.databases=="function"}function Mn(t){return qt(function(){return R.letThrough=!0,t()})}function Rn(t){return!("from"in t)}var yt=function(t,e){var n;if(!this)return n=new yt,t&&"d"in t&&K(n,t),n;K(this,arguments.length?{d:1,from:t,to:1<arguments.length?e:t}:{d:0})};function Ae(t,e,n){var r=G(e,n);if(!isNaN(r)){if(0<r)throw RangeError();if(Rn(t))return K(t,{from:e,to:n,d:1});var r=t.l,a=t.r;if(G(n,t.from)<0)return r?Ae(r,e,n):t.l={from:e,to:n,d:1,l:null,r:null},$r(t);if(0<G(e,t.to))return a?Ae(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},$r(t);G(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),0<G(n,t.to)&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1),e=!t.r,r&&!t.l&&Pe(t,r),a&&e&&Pe(t,a)}}function Pe(t,e){Rn(e)||function n(r,a){var i=a.from,o=a.l,s=a.r;Ae(r,i,a.to),o&&n(r,o),s&&n(r,s)}(t,e)}function Kr(t,e){var n=Ze(e),r=n.next();if(!r.done)for(var a=r.value,i=Ze(t),o=i.next(a.from),s=o.value;!r.done&&!o.done;){if(G(s.from,a.to)<=0&&0<=G(s.to,a.from))return!0;G(a.from,s.from)<0?a=(r=n.next(s.from)).value:s=(o=i.next(a.from)).value}return!1}function Ze(t){var e=Rn(t)?null:{s:0,n:t};return{next:function(n){for(var r=0<arguments.length;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&G(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||G(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function $r(t){var e,n,r,a=(((a=t.r)==null?void 0:a.d)||0)-(((a=t.l)==null?void 0:a.d)||0),a=1<a?"r":a<-1?"l":"";a&&(e=a=="r"?"l":"r",n=g({},t),r=t[a],t.from=r.from,t.to=r.to,t[a]=r[a],n[a]=r[e],(t[e]=n).d=jr(n)),t.d=jr(t)}function jr(n){var e=n.r,n=n.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}function tn(t,e){return S(e).forEach(function(n){t[n]?Pe(t[n],e[n]):t[n]=function r(a){var i,o,s={};for(i in a)B(a,i)&&(o=a[i],s[i]=!o||typeof o!="object"||sr.has(o.constructor)?o:r(o));return s}(e[n])}),t}function Bn(t,e){return t.all||e.all||Object.keys(t).some(function(n){return e[n]&&Kr(e[n],t[n])})}z(yt.prototype,((_t={add:function(t){return Pe(this,t),this},addKey:function(t){return Ae(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return Ae(e,n,n)}),this},hasKey:function(t){var e=Ze(this).next(t).value;return e&&G(e.from,t)<=0&&0<=G(e.to,t)}})[pn]=function(){return Ze(this)},_t));var Zt={},Nn={},Fn=!1;function en(t){tn(Nn,t),Fn||(Fn=!0,setTimeout(function(){Fn=!1,Un(Nn,!(Nn={}))},0))}function Un(t,e){e===void 0&&(e=!1);var n=new Set;if(t.all)for(var r=0,a=Object.values(Zt);r<a.length;r++)Lr(s=a[r],t,n,e);else for(var i in t){var o,s,i=/^idb\:\/\/(.*)\/(.*)\//.exec(i);i&&(o=i[1],i=i[2],s=Zt["idb://".concat(o,"/").concat(i)])&&Lr(s,t,n,e)}n.forEach(function(f){return f()})}function Lr(t,e,n,r){for(var a=[],i=0,o=Object.entries(t.queries.query);i<o.length;i++){for(var s=o[i],f=s[0],w=[],p=0,l=s[1];p<l.length;p++){var m=l[p];Bn(e,m.obsSet)?m.subscribers.forEach(function(_){return n.add(_)}):r&&w.push(m)}r&&a.push([f,w])}if(r)for(var v=0,h=a;v<h.length;v++){var d=h[v],f=d[0],w=d[1];t.queries.query[f]=w}}function Ma(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?ut(e.dbOpenError):t});e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller,a=Math.round(10*t.verno),i=!1;function o(){if(e.openCanceller!==r)throw new N.DatabaseClosed("db.open() was cancelled")}function s(){return new $(function(m,v){if(o(),!n)throw new N.MissingAPI;var h=t.name,d=e.autoSchema||!a?n.open(h):n.open(h,a);if(!d)throw new N.MissingAPI;d.onerror=Ot(v),d.onblocked=rt(t._fireOnBlocked),d.onupgradeneeded=rt(function(_){var k;p=d.transaction,e.autoSchema&&!t._options.allowEmptyDB?(d.onerror=De,p.abort(),d.result.close(),(k=n.deleteDatabase(h)).onsuccess=k.onerror=rt(function(){v(new N.NoSuchDatabase("Database ".concat(h," doesnt exist")))})):(p.onerror=Ot(v),k=_.oldVersion>Math.pow(2,62)?0:_.oldVersion,l=k<1,t.idbdb=d.result,i&&La(t,p),ja(t,k/10,p,v))},v),d.onsuccess=rt(function(){p=null;var _,k,b,D,I,P,C=t.idbdb=d.result,O=Et(C.objectStoreNames);if(0<O.length)try{var L=C.transaction((I=O).length===1?I[0]:I,"readonly");if(e.autoSchema)P=C,D=L,(b=t).verno=P.version/10,D=b._dbSchema=Xe(0,P,D),b._storeNames=Et(P.objectStoreNames,0),Ge(b,[b._allTables],S(D),D);else if(Je(t,t._dbSchema,L),k=L,((k=$n(Xe(0,(_=t).idbdb,k),_._dbSchema)).add.length||k.change.some(function(j){return j.add.length||j.change.length}))&&!i)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),C.close(),a=C.version+1,i=!0,m(s());Ye(t,L)}catch{}ce.push(t),C.onversionchange=rt(function(j){e.vcFired=!0,t.on("versionchange").fire(j)}),C.onclose=rt(function(){t.close({disableAutoOpen:!1})}),l&&(O=t._deps,I=h,qn(P=O.indexedDB)||I===Fe||Ln(P,O.IDBKeyRange).put({name:I}).catch(tt)),m()},v)}).catch(function(m){switch(m==null?void 0:m.name){case"UnknownError":if(0<e.PR1398_maxLoop)return e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),s();break;case"VersionError":if(0<a)return a=0,s()}return $.reject(m)})}var f,w=e.dbReadyResolve,p=null,l=!1;return $.race([r,(typeof navigator>"u"?$.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(m){function v(){return indexedDB.databases().finally(m)}f=setInterval(v,100),v()}).finally(function(){return clearInterval(f)}):Promise.resolve()).then(s)]).then(function(){return o(),e.onReadyBeingFired=[],$.resolve(Mn(function(){return t.on.ready.fire(t.vip)})).then(function m(){var v;if(0<e.onReadyBeingFired.length)return v=e.onReadyBeingFired.reduce(yn,tt),e.onReadyBeingFired=[],$.resolve(Mn(function(){return v(t.vip)})).then(m)})}).finally(function(){e.openCanceller===r&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)}).catch(function(m){e.dbOpenError=m;try{p&&p.abort()}catch{}return r===e.openCanceller&&t._close(),ut(m)}).finally(function(){e.openComplete=!0,w()}).then(function(){var m;return l&&(m={},t.tables.forEach(function(v){v.schema.indexes.forEach(function(h){h.name&&(m["idb://".concat(t.name,"/").concat(v.name,"/").concat(h.name)]=new yt(-1/0,[[[]]]))}),m["idb://".concat(t.name,"/").concat(v.name,"/")]=m["idb://".concat(t.name,"/").concat(v.name,"/:dels")]=new yt(-1/0,[[[]]])}),Nt(Ee).fire(m),Un(m,!0)),t})}function Wn(t){function e(i){return t.next(i)}var n=a(e),r=a(function(i){return t.throw(i)});function a(i){return function(s){var s=i(s),f=s.value;return s.done?f:f&&typeof f.then=="function"?f.then(n,r):E(f)?Promise.all(f).then(n,r):n(f)}}return a(e)()}function nn(t,e,n){for(var r=E(t)?t.slice():[t],a=0;a<n;++a)r.push(e);return r}var Ra={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return g(g({},t),{table:function(r){var n=t.table(r),r=n.schema,a={},i=[];function o(m,v,h){var b=Oe(m),d=a[b]=a[b]||[],_=m==null?0:typeof m=="string"?1:m.length,k=0<v,b=g(g({},h),{name:k?"".concat(b,"(virtual-from:").concat(h.name,")"):h.name,lowLevelIndex:h,isVirtual:k,keyTail:v,keyLength:_,extractKey:Cn(m),unique:!k&&h.unique});return d.push(b),b.isPrimaryKey||i.push(b),1<_&&o(_===2?m[0]:m.slice(0,_-1),v+1,h),d.sort(function(D,I){return D.keyTail-I.keyTail}),b}var s=o(r.primaryKey.keyPath,0,r.primaryKey);a[":id"]=[s];for(var f=0,w=r.indexes;f<w.length;f++){var p=w[f];o(p.keyPath,0,p)}function l(m){var v,h=m.query.index;return h.isVirtual?g(g({},m),{query:{index:h.lowLevelIndex,range:(v=m.query.range,h=h.keyTail,{type:v.type===1?2:v.type,lower:nn(v.lower,v.lowerOpen?t.MAX_KEY:t.MIN_KEY,h),lowerOpen:!0,upper:nn(v.upper,v.upperOpen?t.MIN_KEY:t.MAX_KEY,h),upperOpen:!0})}}):m}return g(g({},n),{schema:g(g({},r),{primaryKey:s,indexes:i,getIndexByKeyPath:function(m){return(m=a[Oe(m)])&&m[0]}}),count:function(m){return n.count(l(m))},query:function(m){return n.query(l(m))},openCursor:function(m){var v=m.query.index,h=v.keyTail,d=v.keyLength;return v.isVirtual?n.openCursor(l(m)).then(function(k){return k&&_(k)}):n.openCursor(m);function _(k){return Object.create(k,{continue:{value:function(b){b!=null?k.continue(nn(b,m.reverse?t.MAX_KEY:t.MIN_KEY,h)):m.unique?k.continue(k.key.slice(0,d).concat(m.reverse?t.MIN_KEY:t.MAX_KEY,h)):k.continue()}},continuePrimaryKey:{value:function(b,D){k.continuePrimaryKey(nn(b,t.MAX_KEY,h),D)}},primaryKey:{get:function(){return k.primaryKey}},key:{get:function(){var b=k.key;return d===1?b[0]:b.slice(0,d)}},value:{get:function(){return k.value}}})}}})}})}};function Vn(t,e,n,r){return n=n||{},r=r||"",S(t).forEach(function(a){var i,o,s;B(e,a)?(i=t[a],o=e[a],typeof i=="object"&&typeof o=="object"&&i&&o?(s=fn(i))!==fn(o)?n[r+a]=e[a]:s==="Object"?Vn(i,o,n,r+a+"."):i!==o&&(n[r+a]=e[a]):i!==o&&(n[r+a]=e[a])):n[r+a]=void 0}),S(e).forEach(function(a){B(t,a)||(n[r+a]=e[a])}),n}function zn(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Ba={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return g(g({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey;return g(g({},n),{mutate:function(a){var i=R.trans,o=i.table(e).hook,s=o.deleting,f=o.creating,w=o.updating;switch(a.type){case"add":if(f.fire===tt)break;return i._promise("readwrite",function(){return p(a)},!0);case"put":if(f.fire===tt&&w.fire===tt)break;return i._promise("readwrite",function(){return p(a)},!0);case"delete":if(s.fire===tt)break;return i._promise("readwrite",function(){return p(a)},!0);case"deleteRange":if(s.fire===tt)break;return i._promise("readwrite",function(){return function l(m,v,h){return n.query({trans:m,values:!1,query:{index:r,range:v},limit:h}).then(function(d){var _=d.result;return p({type:"delete",keys:_,trans:m}).then(function(k){return 0<k.numFailures?Promise.reject(k.failures[0]):_.length<h?{failures:[],numFailures:0,lastResult:void 0}:l(m,g(g({},v),{lower:_[_.length-1],lowerOpen:!0}),h)})})}(a.trans,a.range,1e4)},!0)}return n.mutate(a);function p(l){var m,v,h,d=R.trans,_=l.keys||zn(r,l);if(_)return(l=l.type==="add"||l.type==="put"?g(g({},l),{keys:_}):g({},l)).type!=="delete"&&(l.values=x([],l.values)),l.keys&&(l.keys=x([],l.keys)),m=n,h=_,((v=l).type==="add"?Promise.resolve([]):m.getMany({trans:v.trans,keys:h,cache:"immutable"})).then(function(k){var b=_.map(function(D,I){var P,C,O,L=k[I],j={onerror:null,onsuccess:null};return l.type==="delete"?s.fire.call(j,D,L,d):l.type==="add"||L===void 0?(P=f.fire.call(j,D,l.values[I],d),D==null&&P!=null&&(l.keys[I]=D=P,r.outbound||st(l.values[I],r.keyPath,D))):(P=Vn(L,l.values[I]),(C=w.fire.call(j,P,D,L,d))&&(O=l.values[I],Object.keys(C).forEach(function(A){B(O,A)?O[A]=C[A]:st(O,A,C[A])}))),j});return n.mutate(l).then(function(D){for(var I=D.failures,P=D.results,C=D.numFailures,D=D.lastResult,O=0;O<_.length;++O){var L=(P||_)[O],j=b[O];L==null?j.onerror&&j.onerror(I[O]):j.onsuccess&&j.onsuccess(l.type==="put"&&k[O]?l.values[O]:L)}return{failures:I,results:P,numFailures:C,lastResult:D}}).catch(function(D){return b.forEach(function(I){return I.onerror&&I.onerror(D)}),Promise.reject(D)})});throw new Error("Keys missing")}}})}})}};function qr(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],a=0,i=0;a<e.keys.length&&i<t.length;++a)G(e.keys[a],t[i])===0&&(r.push(n?Wt(e.values[a]):e.values[a]),++i);return r.length===t.length?r:null}catch{return null}}var Na={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return g(g({},n),{getMany:function(r){var a;return r.cache?(a=qr(r.keys,r.trans._cache,r.cache==="clone"))?$.resolve(a):n.getMany(r).then(function(i){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Wt(i):i},i}):n.getMany(r)},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function Mr(t,e){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!e.schema.primaryKey.outbound}function Rr(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Fa={stack:"dbcore",level:0,name:"Observability",create:function(t){var e=t.schema.name,n=new yt(t.MIN_KEY,t.MAX_KEY);return g(g({},t),{transaction:function(r,a,i){if(R.subscr&&a!=="readonly")throw new N.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(R.querier));return t.transaction(r,a,i)},table:function(r){function a(_){var d,_=_.query;return[d=_.index,new yt((d=(_=_.range).lower)!=null?d:t.MIN_KEY,(d=_.upper)!=null?d:t.MAX_KEY)]}var i=t.table(r),o=i.schema,s=o.primaryKey,f=o.indexes,w=s.extractKey,p=s.outbound,l=s.autoIncrement&&f.filter(function(h){return h.compound&&h.keyPath.includes(s.keyPath)}),m=g(g({},i),{mutate:function(h){function d(q){return q="idb://".concat(e,"/").concat(r,"/").concat(q),I[q]||(I[q]=new yt)}var _,k,b,D=h.trans,I=h.mutatedParts||(h.mutatedParts={}),P=d(""),C=d(":dels"),O=h.type,j=h.type==="deleteRange"?[h.range]:h.type==="delete"?[h.keys]:h.values.length<50?[zn(s,h).filter(function(q){return q}),h.values]:[],L=j[0],j=j[1],A=h.trans._cache;return E(L)?(P.addKeys(L),(O=O==="delete"||L.length===j.length?qr(L,A):null)||C.addKeys(L),(O||j)&&(_=d,k=O,b=j,o.indexes.forEach(function(q){var Q=_(q.name||"");function J(H){return H!=null?q.extractKey(H):null}function F(H){q.multiEntry&&E(H)?H.forEach(function(at){return Q.addKey(at)}):Q.addKey(H)}(k||b).forEach(function(H,ot){var St=k&&J(k[ot]),ot=b&&J(b[ot]);G(St,ot)!==0&&(St!=null&&F(St),ot!=null)&&F(ot)})}))):L?(j={from:(A=L.lower)!=null?A:t.MIN_KEY,to:(O=L.upper)!=null?O:t.MAX_KEY},C.add(j),P.add(j)):(P.add(n),C.add(n),o.indexes.forEach(function(q){return d(q.name).add(n)})),i.mutate(h).then(function(q){return!L||h.type!=="add"&&h.type!=="put"||(P.addKeys(q.results),l&&l.forEach(function(Q){for(var J=h.values.map(function(St){return Q.extractKey(St)}),F=Q.keyPath.findIndex(function(St){return St===s.keyPath}),H=0,at=q.results.length;H<at;++H)J[H][F]=q.results[H];d(Q.name).addKeys(J)})),D.mutatedParts=tn(D.mutatedParts||{},I),q})}}),v={get:function(h){return[s,new yt(h.key)]},getMany:function(h){return[s,new yt().addKeys(h.keys)]},count:a,query:a,openCursor:a};return S(v).forEach(function(h){m[h]=function(d){var _=R.subscr,k=!!_,b=Mr(R,i)&&Rr(h,d)?d.obsSet={}:_;if(k){var D,_=function(j){return j="idb://".concat(e,"/").concat(r,"/").concat(j),b[j]||(b[j]=new yt)},I=_(""),P=_(":dels"),k=v[h](d),C=k[0],k=k[1];if((h==="query"&&C.isPrimaryKey&&!d.values?P:_(C.name||"")).add(k),!C.isPrimaryKey){if(h!=="count")return D=h==="query"&&p&&d.values&&i.query(g(g({},d),{values:!1})),i[h].apply(this,arguments).then(function(j){if(h==="query"){if(p&&d.values)return D.then(function(J){return J=J.result,I.addKeys(J),j});var A=d.values?j.result.map(w):j.result;(d.values?I:P).addKeys(A)}else{var q,Q;if(h==="openCursor")return Q=d.values,(q=j)&&Object.create(q,{key:{get:function(){return P.addKey(q.primaryKey),q.key}},primaryKey:{get:function(){var J=q.primaryKey;return P.addKey(J),J}},value:{get:function(){return Q&&I.addKey(q.primaryKey),q.value}}})}return j});P.add(n)}}return i[h].apply(this,arguments)}}),m}})}};function Br(t,e,n){var r;return n.numFailures===0?e:e.type==="deleteRange"||(r=e.keys?e.keys.length:"values"in e&&e.values?e.values.length:1,n.numFailures===r)?null:(r=g({},e),E(r.keys)&&(r.keys=r.keys.filter(function(a,i){return!(i in n.failures)})),"values"in r&&E(r.values)&&(r.values=r.values.filter(function(a,i){return!(i in n.failures)})),r)}function Hn(t,e){return n=t,((r=e).lower===void 0||(r.lowerOpen?0<G(n,r.lower):0<=G(n,r.lower)))&&(n=t,(r=e).upper===void 0||(r.upperOpen?G(n,r.upper)<0:G(n,r.upper)<=0));var n,r}function Nr(t,e,n,r,a,i){var o,s,f,w,p,l;return!n||n.length===0||(o=e.query.index,s=o.multiEntry,f=e.query.range,w=r.schema.primaryKey.extractKey,p=o.extractKey,l=(o.lowLevelIndex||o).extractKey,(r=n.reduce(function(m,v){var h=m,d=[];if(v.type==="add"||v.type==="put")for(var _=new yt,k=v.values.length-1;0<=k;--k){var b,D=v.values[k],I=w(D);!_.hasKey(I)&&(b=p(D),s&&E(b)?b.some(function(j){return Hn(j,f)}):Hn(b,f))&&(_.addKey(I),d.push(D))}switch(v.type){case"add":var P=new yt().addKeys(e.values?m.map(function(A){return w(A)}):m),h=m.concat(e.values?d.filter(function(A){return A=w(A),!P.hasKey(A)&&(P.addKey(A),!0)}):d.map(function(A){return w(A)}).filter(function(A){return!P.hasKey(A)&&(P.addKey(A),!0)}));break;case"put":var C=new yt().addKeys(v.values.map(function(A){return w(A)}));h=m.filter(function(A){return!C.hasKey(e.values?w(A):A)}).concat(e.values?d:d.map(function(A){return w(A)}));break;case"delete":var O=new yt().addKeys(v.keys);h=m.filter(function(A){return!O.hasKey(e.values?w(A):A)});break;case"deleteRange":var L=v.range;h=m.filter(function(A){return!Hn(w(A),L)})}return h},t))===t)?t:(r.sort(function(m,v){return G(l(m),l(v))||G(w(m),w(v))}),e.limit&&e.limit<1/0&&(r.length>e.limit?r.length=e.limit:t.length===e.limit&&r.length<e.limit&&(a.dirty=!0)),i?Object.freeze(r):r)}function Fr(t,e){return G(t.lower,e.lower)===0&&G(t.upper,e.upper)===0&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function Ua(t,e){return((n,r,a,i)=>{if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((n=G(n,r))===0){if(a&&i)return 0;if(a)return 1;if(i)return-1}return n})(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&0<=((n,r,a,i)=>{if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((n=G(n,r))===0){if(a&&i)return 0;if(a)return-1;if(i)return 1}return n})(t.upper,e.upper,t.upperOpen,e.upperOpen)}function Wa(t,e,n,r){t.subscribers.add(n),r.addEventListener("abort",function(){var a,i;t.subscribers.delete(n),t.subscribers.size===0&&(a=t,i=e,setTimeout(function(){a.subscribers.size===0&&Vt(i,a)},3e3))})}var Va={stack:"dbcore",level:0,name:"Cache",create:function(t){var e=t.schema.name;return g(g({},t),{transaction:function(n,r,a){var i,o,s=t.transaction(n,r,a);return r==="readwrite"&&(a=(i=new AbortController).signal,s.addEventListener("abort",(o=function(f){return function(){if(i.abort(),r==="readwrite"){for(var w=new Set,p=0,l=n;p<l.length;p++){var m=l[p],v=Zt["idb://".concat(e,"/").concat(m)];if(v){var h=t.table(m),d=v.optimisticOps.filter(function(q){return q.trans===s});if(s._explicit&&f&&s.mutatedParts)for(var _=0,k=Object.values(v.queries.query);_<k.length;_++)for(var b=0,D=(C=k[_]).slice();b<D.length;b++)Bn((O=D[b]).obsSet,s.mutatedParts)&&(Vt(C,O),O.subscribers.forEach(function(q){return w.add(q)}));else if(0<d.length){v.optimisticOps=v.optimisticOps.filter(function(q){return q.trans!==s});for(var I=0,P=Object.values(v.queries.query);I<P.length;I++)for(var C,O,L,j=0,A=(C=P[I]).slice();j<A.length;j++)(O=A[j]).res!=null&&s.mutatedParts&&(f&&!O.dirty?(L=Object.isFrozen(O.res),L=Nr(O.res,O.req,d,h,O,L),O.dirty?(Vt(C,O),O.subscribers.forEach(function(q){return w.add(q)})):L!==O.res&&(O.res=L,O.promise=$.resolve({result:L}))):(O.dirty&&Vt(C,O),O.subscribers.forEach(function(q){return w.add(q)})))}}}w.forEach(function(q){return q()})}}})(!1),{signal:a}),s.addEventListener("error",o(!1),{signal:a}),s.addEventListener("complete",o(!0),{signal:a})),s},table:function(n){var r=t.table(n),a=r.schema.primaryKey;return g(g({},r),{mutate:function(i){var o,s=R.trans;return!a.outbound&&s.db._options.cache!=="disabled"&&!s.explicit&&s.idbtrans.mode==="readwrite"&&(o=Zt["idb://".concat(e,"/").concat(n)])?(s=r.mutate(i),i.type!=="add"&&i.type!=="put"||!(50<=i.values.length||zn(a,i).some(function(f){return f==null}))?(o.optimisticOps.push(i),i.mutatedParts&&en(i.mutatedParts),s.then(function(f){0<f.numFailures&&(Vt(o.optimisticOps,i),(f=Br(0,i,f))&&o.optimisticOps.push(f),i.mutatedParts)&&en(i.mutatedParts)}),s.catch(function(){Vt(o.optimisticOps,i),i.mutatedParts&&en(i.mutatedParts)})):s.then(function(f){var w=Br(0,g(g({},i),{values:i.values.map(function(p,l){var m;return f.failures[l]?p:(st(m=(m=a.keyPath)!=null&&m.includes(".")?Wt(p):g({},p),a.keyPath,f.results[l]),m)})}),f);o.optimisticOps.push(w),queueMicrotask(function(){return i.mutatedParts&&en(i.mutatedParts)})}),s):r.mutate(i)},query:function(i){var o,s,f,w,p,l,m;return Mr(R,r)&&Rr("query",i)?(o=((f=R.trans)==null?void 0:f.db._options.cache)==="immutable",s=(f=R).requery,f=f.signal,l=((v,h,d,_)=>{var k=Zt["idb://".concat(v,"/").concat(h)];if(!k)return[];if(!(v=k.queries[d]))return[null,!1,k,null];var b=v[(_.query?_.query.index.name:null)||""];if(!b)return[null,!1,k,null];switch(d){case"query":var D=b.find(function(I){return I.req.limit===_.limit&&I.req.values===_.values&&Fr(I.req.query.range,_.query.range)});return D?[D,!0,k,b]:[b.find(function(I){return("limit"in I.req?I.req.limit:1/0)>=_.limit&&(!_.values||I.req.values)&&Ua(I.req.query.range,_.query.range)}),!1,k,b];case"count":return D=b.find(function(I){return Fr(I.req.query.range,_.query.range)}),[D,!!D,k,b]}})(e,n,"query",i),m=l[0],w=l[2],p=l[3],m&&l[1]?m.obsSet=i.obsSet:(l=r.query(i).then(function(v){var h=v.result;if(m&&(m.res=h),o){for(var d=0,_=h.length;d<_;++d)Object.freeze(h[d]);Object.freeze(h)}else v.result=Wt(h);return v}).catch(function(v){return p&&m&&Vt(p,m),Promise.reject(v)}),m={obsSet:i.obsSet,promise:l,subscribers:new Set,type:"query",req:i,dirty:!1},p?p.push(m):(p=[m],(w=w||(Zt["idb://".concat(e,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[i.query.index.name||""]=p)),Wa(m,p,s,f),m.promise.then(function(v){return{result:Nr(v.result,i,w==null?void 0:w.optimisticOps,r,m,o)}})):r.query(i)}})}})}};function rn(t,e){return new Proxy(t,{get:function(n,r,a){return r==="db"?e:Reflect.get(n,r,a)}})}ct.prototype.version=function(t){if(isNaN(t)||t<.1)throw new N.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new N.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,n=e.filter(function(r){return r._cfg.version===t})[0];return n||(n=new this.Version(t),e.push(n),e.sort($a),n.stores({}),this._state.autoSchema=!1),n},ct.prototype._whenReady=function(t){var e=this;return this.idbdb&&(this._state.openComplete||R.letThrough||this._vip)?t():new $(function(n,r){if(e._state.openComplete)return r(new N.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return void r(new N.DatabaseClosed);e.open().catch(tt)}e._state.dbReadyPromise.then(n,r)}).then(t)},ct.prototype.use=function(a){var e=a.stack,n=a.create,r=a.level,a=a.name,i=(a&&this.unuse({stack:e,name:a}),this._middlewares[e]||(this._middlewares[e]=[]));return i.push({stack:e,create:n,level:r??10,name:a}),i.sort(function(o,s){return o.level-s.level}),this},ct.prototype.unuse=function(t){var e=t.stack,n=t.name,r=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(a){return r?a.create!==r:!!n&&a.name!==n})),this},ct.prototype.open=function(){var t=this;return Qt(Lt,function(){return Ma(t)})},ct.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var t=this._state,e=ce.indexOf(this);if(0<=e&&ce.splice(e,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new $(function(n){t.dbReadyResolve=n}),t.openCanceller=new $(function(n,r){t.cancelOpen=r}))},ct.prototype.close=function(e){var e=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;e?(n.isBeingOpened&&n.cancelOpen(new N.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new N.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},ct.prototype.delete=function(t){var e=this,n=(t===void 0&&(t={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),r=this._state;return new $(function(a,i){function o(){e.close(t);var s=e._deps.indexedDB.deleteDatabase(e.name);s.onsuccess=rt(function(){var f,w,p;f=e._deps,w=e.name,qn(p=f.indexedDB)||w===Fe||Ln(p,f.IDBKeyRange).delete(w).catch(tt),a()}),s.onerror=Ot(i),s.onblocked=e._fireOnBlocked}if(n)throw new N.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},ct.prototype.backendDB=function(){return this.idbdb},ct.prototype.isOpen=function(){return this.idbdb!==null},ct.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},ct.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ct.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ct.prototype,"tables",{get:function(){var t=this;return S(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!1,configurable:!0}),ct.prototype.transaction=function(){var t=(function(e,n,r){var a=arguments.length;if(a<2)throw new N.InvalidArgument("Too few arguments");for(var i=new Array(a-1);--a;)i[a-1]=arguments[a];return r=i.pop(),[e,or(i),r]}).apply(this,arguments);return this._transaction.apply(this,t)},ct.prototype._transaction=function(t,e,n){var r,a,i=this,o=R.trans,s=(o&&o.db===this&&t.indexOf("!")===-1||(o=null),t.indexOf("?")!==-1);t=t.replace("!","").replace("?","");try{if(a=e.map(function(w){if(w=w instanceof i.Table?w.name:w,typeof w!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return w}),t=="r"||t===Tn)r=Tn;else{if(t!="rw"&&t!=Dn)throw new N.InvalidArgument("Invalid transaction mode: "+t);r=Dn}if(o){if(o.mode===Tn&&r===Dn){if(!s)throw new N.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&a.forEach(function(w){if(o&&o.storeNames.indexOf(w)===-1){if(!s)throw new N.SubTransaction("Table "+w+" not included in parent transaction.");o=null}}),s&&o&&!o.active&&(o=null)}}catch(w){return o?o._promise(null,function(p,l){l(w)}):ut(w)}var f=(function w(p,l,m,v,h){return $.resolve().then(function(){var b=R.transless||R,d=p._createTransaction(l,m,p._dbSchema,v),b=(d.explicit=!0,{trans:d,transless:b});if(v)d.idbtrans=v.idbtrans;else try{d.create(),d.idbtrans._explicit=!0,p._state.PR1398_maxLoop=3}catch(D){return D.name===mn.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return w(p,l,m,null,h)})):ut(D)}var _,k=hn(h),b=(k&&ue(),$.follow(function(){var D;(_=h.call(d,d))&&(k?(D=Mt.bind(null,null),_.then(D,D)):typeof _.next=="function"&&typeof _.throw=="function"&&(_=Wn(_)))},b));return(_&&typeof _.then=="function"?$.resolve(_).then(function(D){return d.active?D:ut(new N.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):b.then(function(){return _})).then(function(D){return v&&d._resolve(),d._completion.then(function(){return D})}).catch(function(D){return d._reject(D),ut(D)})})}).bind(null,this,r,a,o,n);return o?o._promise(r,f,"lock"):R.trans?Qt(R.transless,function(){return i._whenReady(f)}):this._whenReady(f)},ct.prototype.table=function(t){if(B(this._allTables,t))return this._allTables[t];throw new N.InvalidTable("Table ".concat(t," does not exist"))};var $t=ct;function ct(t,e){var n,r,a,i,o,s=this,f=(this._middlewares={},this.verno=0,ct.dependencies),f=(this._options=e=g({addons:ct.addons,autoOpen:!0,indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange,cache:"cloned"},e),this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange},e.addons),w=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:tt,dbReadyPromise:null,cancelOpen:tt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:e.autoOpen}),p=(w.dbReadyPromise=new $(function(l){w.dbReadyResolve=l}),w.openCanceller=new $(function(l,m){w.cancelOpen=m}),this._state=w,this.name=t,this.on=Se(this,"populate","blocked","versionchange","close",{ready:[yn,tt]}),this.once=function(l,m){var v=function(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];s.on(l).unsubscribe(v),m.apply(s,h)};return s.on(l,v)},this.on.ready.subscribe=Ut(this.on.ready.subscribe,function(l){return function(m,v){ct.vip(function(){var h,d=s._state;d.openComplete?(d.dbOpenError||$.resolve().then(m),v&&l(m)):d.onReadyBeingFired?(d.onReadyBeingFired.push(m),v&&l(m)):(l(m),h=s,v||l(function _(){h.on.ready.unsubscribe(m),h.on.ready.unsubscribe(_)}))})}}),this.Collection=(n=this,Te(Ea.prototype,function(_,d){this.db=n;var v=vr,h=null;if(d)try{v=d()}catch(b){h=b}var d=_._ctx,_=d.table,k=_.hook.reading.fire;this._ctx={table:_,index:d.index,isPrimKey:!d.index||_.schema.primKey.keyPath&&d.index===_.schema.primKey.name,range:v,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:h,or:d.or,valueMapper:k!==ge?k:null}})),this.Table=(r=this,Te(xr.prototype,function(l,m,v){this.db=r,this._tx=v,this.name=l,this.schema=m,this.hook=r._allTables[l]?r._allTables[l].hook:Se(null,{creating:[ga,tt],reading:[va,ge],updating:[wa,tt],deleting:[ba,tt]})})),this.Transaction=(a=this,Te(Aa.prototype,function(l,m,v,h,d){var _=this;l!=="readonly"&&m.forEach(function(k){k=(k=v[k])==null?void 0:k.yProps,k&&(m=m.concat(k.map(function(b){return b.updatesTable})))}),this.db=a,this.mode=l,this.storeNames=m,this.schema=v,this.chromeTransactionDurability=h,this.idbtrans=null,this.on=Se(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $(function(k,b){_._resolve=k,_._reject=b}),this._completion.then(function(){_.active=!1,_.on.complete.fire()},function(k){var b=_.active;return _.active=!1,_.on.error.fire(k),_.parent?_.parent._reject(k):b&&_.idbtrans&&_.idbtrans.abort(),ut(k)})})),this.Version=(i=this,Te(qa.prototype,function(l){this.db=i,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(o=this,Te(Ir.prototype,function(l,m,v){if(this.db=o,this._ctx={table:l,index:m===":id"?null:m,or:v},this._cmp=this._ascending=G,this._descending=function(h,d){return G(d,h)},this._max=function(h,d){return 0<G(h,d)?h:d},this._min=function(h,d){return G(h,d)<0?h:d},this._IDBKeyRange=o._deps.IDBKeyRange,!this._IDBKeyRange)throw new N.MissingAPI})),this.on("versionchange",function(l){0<l.newVersion?console.warn("Another connection wants to upgrade database '".concat(s.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(s.name,"'. Closing db now to resume the delete request.")),s.close({disableAutoOpen:!1})}),this.on("blocked",function(l){!l.newVersion||l.newVersion<l.oldVersion?console.warn("Dexie.delete('".concat(s.name,"') was blocked")):console.warn("Upgrade '".concat(s.name,"' blocked by other connection holding version ").concat(l.oldVersion/10))}),this._maxKey=Ie(e.IDBKeyRange),this._createTransaction=function(l,m,v,h){return new s.Transaction(l,m,v,s._options.chromeTransactionDurability,h)},this._fireOnBlocked=function(l){s.on("blocked").fire(l),ce.filter(function(m){return m.name===s.name&&m!==s&&!m._state.vcFired}).map(function(m){return m.on("versionchange").fire(l)})},this.use(Na),this.use(Va),this.use(Fa),this.use(Ra),this.use(Ba),new Proxy(this,{get:function(l,m,v){var h;return m==="_vip"||(m==="table"?function(d){return rn(s.table(d),p)}:(h=Reflect.get(l,m,v))instanceof xr?rn(h,p):m==="tables"?h.map(function(d){return rn(d,p)}):m==="_createTransaction"?function(){return rn(h.apply(this,arguments),p)}:h)}}));this.vip=p,f.forEach(function(l){return l(s)})}var an,pe=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",za=(Yn.prototype.subscribe=function(t,e,n){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:e,complete:n})},Yn.prototype[pe]=function(){return this},Yn);function Yn(t){this._subscribe=t}try{an={indexedDB:T.indexedDB||T.mozIndexedDB||T.webkitIndexedDB||T.msIndexedDB,IDBKeyRange:T.IDBKeyRange||T.webkitIDBKeyRange}}catch{an={indexedDB:null,IDBKeyRange:null}}function Ur(t){var e,n=!1,r=new za(function(a){var i=hn(t),o,s=!1,f={},w={},p={get closed(){return s},unsubscribe:function(){s||(s=!0,o&&o.abort(),l&&Nt.storagemutated.unsubscribe(v))}},l=(a.start&&a.start(p),!1),m=function(){return Sn(h)},v=function(d){tn(f,d),Bn(w,f)&&m()},h=function(){var d,_,k;!s&&an.indexedDB&&(f={},d={},o&&o.abort(),o=new AbortController,k=(b=>{var D=oe();try{i&&ue();var I=qt(t,b);return I=i?I.finally(Mt):I}finally{D&&se()}})(_={subscr:d,signal:o.signal,requery:m,querier:t,trans:null}),Promise.resolve(k).then(function(b){n=!0,e=b,s||_.signal.aborted||(f={},(D=>{for(var I in D)if(B(D,I))return;return 1})(w=d)||l||(Nt(Ee,v),l=!0),Sn(function(){return!s&&a.next&&a.next(b)}))},function(b){n=!1,["DatabaseClosedError","AbortError"].includes(b==null?void 0:b.name)||s||Sn(function(){s||a.error&&a.error(b)})}))};return setTimeout(m,0),p});return r.hasValue=function(){return n},r.getValue=function(){return e},r}var te=$t;function Gn(t){var e=Ft;try{Ft=!0,Nt.storagemutated.fire(t),Un(t,!0)}finally{Ft=e}}z(te,g(g({},Ct),{delete:function(t){return new te(t,{addons:[]}).delete()},exists:function(t){return new te(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return e=te.dependencies,n=e.indexedDB,e=e.IDBKeyRange,(qn(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(a){return a.name}).filter(function(a){return a!==Fe})}):Ln(n,e).toCollection().primaryKeys()).then(t)}catch{return ut(new N.MissingAPI)}var e,n},defineClass:function(){return function(t){K(this,t)}},ignoreTransaction:function(t){return R.trans?Qt(R.transless,t):t()},vip:Mn,async:function(t){return function(){try{var e=Wn(t.apply(this,arguments));return e&&typeof e.then=="function"?e:$.resolve(e)}catch(n){return ut(n)}}},spawn:function(t,e,n){try{var r=Wn(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:$.resolve(r)}catch(a){return ut(a)}},currentTransaction:{get:function(){return R.trans||null}},waitFor:function(t,e){return t=$.resolve(typeof t=="function"?te.ignoreTransaction(t):t).timeout(e||6e4),R.trans?R.trans.waitFor(t):t},Promise:$,debug:{get:function(){return It},set:function(t){lr(t)}},derive:ft,extend:K,props:z,override:Ut,Events:Se,on:Nt,liveQuery:Ur,extendObservabilitySet:tn,getByKeyPath:bt,setByKeyPath:st,delByKeyPath:function(t,e){typeof e=="string"?st(t,e,void 0):"length"in e&&[].map.call(e,function(n){st(t,n,void 0)})},shallowClone:dt,deepClone:Wt,getObjectDiff:Vn,cmp:G,asap:mt,minKey:-1/0,addons:[],connections:ce,errnames:mn,dependencies:an,cache:Zt,semVer:"4.3.0",version:"4.3.0".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,2*n)})})),te.maxKey=Ie(te.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Nt(Ee,function(t){Ft||(t=new CustomEvent(On,{detail:t}),Ft=!0,dispatchEvent(t),Ft=!1)}),addEventListener(On,function(t){t=t.detail,Ft||Gn(t)}));var he,Ft=!1,Wr=function(){};return typeof BroadcastChannel<"u"&&((Wr=function(){(he=new BroadcastChannel(On)).onmessage=function(t){return t.data&&Gn(t.data)}})(),typeof he.unref=="function"&&he.unref(),Nt(Ee,function(t){Ft||he.postMessage(t)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(t){if(!$t.disableBfCache&&t.persisted){It&&console.debug("Dexie: handling persisted pagehide"),he!=null&&he.close();for(var e=0,n=ce;e<n.length;e++)n[e].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(t){!$t.disableBfCache&&t.persisted&&(It&&console.debug("Dexie: handling persisted pageshow"),Wr(),Gn({all:new yt(-1/0,[[]])}))})),$.rejectionMapper=function(t,e){return!t||t instanceof ae||t instanceof TypeError||t instanceof SyntaxError||!t.name||!cr[t.name]?t:(e=new cr[t.name](e||t.message,t),"stack"in t&&Z(e,"stack",{get:function(){return this.inner.stack}}),e)},lr(It),g($t,Object.freeze({__proto__:null,Dexie:$t,Entity:gr,PropModification:xe,RangeSet:yt,add:function(t){return new xe({add:t})},cmp:G,default:$t,liveQuery:Ur,mergeRanges:Pe,rangesOverlap:Kr,remove:function(t){return new xe({remove:t})},replacePrefix:function(t,e){return new xe({replacePrefix:[t,e]})}}),{default:$t}),$t})})(na);var Ja=na.exports;const tr=Xa(Ja),Hr=Symbol.for("Dexie"),cn=globalThis[Hr]||(globalThis[Hr]=tr);if(tr.semVer!==cn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${tr.semVer} and ${cn.semVer}`);const{liveQuery:Ii,mergeRanges:Oi,rangesOverlap:Ai,RangeSet:Pi,cmp:Ci,Entity:Ki,PropModification:$i,replacePrefix:ji,add:Li,remove:qi,DexieYProvider:Mi}=cn;class Za extends cn{constructor(){super("GymDatabase");jt(this,"workouts");jt(this,"logs");jt(this,"workoutTypes");jt(this,"profile");this.version(1).stores({workouts:"id, status, startTime, updatedAt, isDeleted",logs:"id, workoutId, workoutTypeId, date, updatedAt, isDeleted",workoutTypes:"id, updatedAt, isDeleted",profile:"id, updatedAt, isDeleted"})}}const Y=new Za,rr="gym_web_auth";function dn(){const y=localStorage.getItem(rr);try{return y?JSON.parse(y):null}catch{return null}}function ra(y){localStorage.setItem(rr,JSON.stringify(y))}function aa(){localStorage.removeItem(rr)}function ia(){const y=dn();if(!y)return null;const u=new URLSearchParams;return Object.entries(y).forEach(([c,g])=>{g!=null&&u.append(c,String(g))}),u.toString()}const ti=Object.freeze(Object.defineProperty({__proto__:null,clearAuthData:aa,getAuthData:dn,getAuthString:ia,saveAuthData:ra},Symbol.toStringTag,{value:"Module"}));var Jr;const on=(Jr=window.Telegram)==null?void 0:Jr.WebApp,Yr="https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4";class Gr{static getHeaders(){const u={"Content-Type":"application/json"};if(on!=null&&on.initData)localStorage.getItem("skip_tma_auth")==="true"||(u["X-Telegram-Init-Data"]=on.initData);else{const c=ia();c&&(u["X-Telegram-Init-Data"]=c)}return u}static async sync(){if(!navigator.onLine)throw new Error("Offline");const u=this.getHeaders(),c=await fetch(Yr,{headers:u});if(!c.ok)throw c.status===401?new Error("Unauthorized"):new Error("Sync failed");const g=await c.json();await this.mergeData(g);const x=await this.readAll();await fetch(Yr,{method:"POST",headers:u,body:JSON.stringify(x)})}static async mergeData(u){await Y.transaction("rw",Y.workouts,Y.logs,Y.workoutTypes,Y.profile,async()=>{if(await this.mergeTable(Y.workouts,u.workouts),await this.mergeTable(Y.logs,u.logs),await this.mergeTable(Y.workoutTypes,u.workoutTypes),u.profile){const c={...u.profile,id:"me"};await this.mergeTable(Y.profile,[c])}})}static async mergeTable(u,c=[]){const g=await u.toArray(),x=new Map(g.map(T=>[T.id,T]));for(const T of c){const S=x.get(T.id);if(!S)await u.put(T);else{const E=new Date(T.updatedAt).getTime(),K=new Date(S.updatedAt).getTime();E>K&&await u.put(T)}}}static async readAll(){return{workouts:await Y.workouts.toArray(),logs:await Y.logs.toArray(),workoutTypes:await Y.workoutTypes.toArray(),profile:(await Y.profile.toArray())[0]}}}const ei="gym_twa_data";var Zr;const me=(Zr=window.Telegram)==null?void 0:Zr.WebApp,Xn={workoutTypes:[{id:"1",name:"ÐÐ¸Ð¼ Ð»ÐµÐ¶Ð°",updatedAt:new Date().toISOString()},{id:"2",name:"ÐÑÐ¸ÑÐµÐ´Ð°Ð½Ð¸Ñ",updatedAt:new Date().toISOString()},{id:"3",name:"Ð¡ÑÐ°Ð½Ð¾Ð²Ð°Ñ ÑÑÐ³Ð°",updatedAt:new Date().toISOString()}],logs:[],workouts:[]};class ni{constructor(){jt(this,"onUpdateCallback");jt(this,"onSyncStatusChangeCallback");jt(this,"status","idle");jt(this,"cache",{...Xn});this.init()}async init(){await this.migrateFromLocalStorage(),this.sync().catch(console.error)}async migrateFromLocalStorage(){const u=localStorage.getItem(ei);if(u)try{const c=JSON.parse(u);if(await Y.workoutTypes.count()===0){console.log("Migrating from localStorage to IDB...");const x=new Date().toISOString(),T=(c.workoutTypes||Xn.workoutTypes).map(K=>({...K,updatedAt:x}));await Y.workoutTypes.bulkPut(T);const S=(c.logs||[]).map(K=>({...K,updatedAt:x,workoutId:K.workoutId||"legacy"}));await Y.logs.bulkPut(S);const E=(c.workouts||[]).map(K=>({...K,updatedAt:x}));if(await Y.workouts.bulkPut(E),c.profile){const K={...c.profile,id:"me",updatedAt:x};await Y.profile.put(K)}}}catch(c){console.error("Migration failed",c)}else await Y.workoutTypes.count()===0&&await Y.workoutTypes.bulkPut(Xn.workoutTypes)}onUpdate(u){this.onUpdateCallback=u}onSyncStatusChange(u){this.onSyncStatusChangeCallback=u}setStatus(u){var c;this.status=u,(c=this.onSyncStatusChangeCallback)==null||c.call(this,u),u==="success"&&setTimeout(()=>{this.status==="success"&&this.setStatus("idle")},2e3)}async sync(){var c,g;const u=localStorage.getItem("skip_tma_auth")==="true";if(u&&!(await ea(async()=>{const{getAuthString:T}=await Promise.resolve().then(()=>ti);return{getAuthString:T}},void 0,import.meta.url)).getAuthString()){this.setStatus("idle");return}try{this.setStatus("saving"),await Gr.sync(),this.setStatus("success"),(c=this.onUpdateCallback)==null||c.call(this)}catch(x){if(console.error("Sync failed",x),(((g=x.message)==null?void 0:g.toLowerCase())||"").includes("unauthorized")){if(u){this.setStatus("error");return}localStorage.setItem("skip_tma_auth","true"),aa(),location.reload();return}x.message!=="Offline"?this.setStatus("error"):this.setStatus("idle")}}async reloadCache(){var u;this.cache=await Gr.readAll(),(u=this.onUpdateCallback)==null||u.call(this)}getWorkoutTypes(){return this.cache.workoutTypes.filter(u=>!u.isDeleted)}getLogs(){return this.cache.logs.filter(u=>!u.isDeleted)}getWorkouts(){return this.cache.workouts.filter(u=>!u.isDeleted)}getActiveWorkout(){return this.cache.workouts.find(u=>!u.isDeleted&&(u.status==="active"||u.status==="paused"))}getProfile(){return this.cache.profile}async addWorkoutType(u){const c={id:Date.now().toString(),name:u,updatedAt:new Date().toISOString()};return await Y.workoutTypes.put(c),await this.reloadCache(),this.sync().catch(()=>{}),c}async deleteWorkoutType(u){const c=await Y.workoutTypes.get(u);c&&(c.isDeleted=!0,c.updatedAt=new Date().toISOString(),await Y.workoutTypes.put(c),await this.reloadCache(),this.sync().catch(()=>{}))}async updateWorkoutType(u,c){const g=await Y.workoutTypes.get(u);g&&(g.name=c,g.updatedAt=new Date().toISOString(),await Y.workoutTypes.put(g),await this.reloadCache(),this.sync().catch(()=>{}))}async startWorkout(u){this.getActiveWorkout()&&await this.finishWorkout();const g={id:Date.now().toString(),startTime:new Date().toISOString(),status:"active",name:u,isManual:!0,pauseIntervals:[],updatedAt:new Date().toISOString()};return await Y.workouts.put(g),await this.reloadCache(),this.sync().catch(()=>{}),g}async pauseWorkout(){const u=this.getActiveWorkout();u&&u.status==="active"&&(u.status="paused",u.pauseIntervals.push({start:new Date().toISOString()}),u.updatedAt=new Date().toISOString(),await Y.workouts.put(u),await this.reloadCache(),this.sync().catch(()=>{}))}async resumeWorkout(){const u=this.getActiveWorkout();if(u&&u.status==="paused"){u.status="active";const c=u.pauseIntervals[u.pauseIntervals.length-1];c&&!c.end&&(c.end=new Date().toISOString()),u.updatedAt=new Date().toISOString(),await Y.workouts.put(u),await this.reloadCache(),this.sync().catch(()=>{})}}async finishWorkout(){const u=this.getActiveWorkout();if(u){u.status="finished",u.endTime=new Date().toISOString();const c=u.pauseIntervals[u.pauseIntervals.length-1];c&&!c.end&&(c.end=u.endTime),u.updatedAt=new Date().toISOString(),await Y.workouts.put(u),await this.reloadCache(),this.sync().catch(()=>{})}}getWorkoutDuration(u){const c=new Date(u.startTime).getTime(),g=u.endTime?new Date(u.endTime).getTime():Date.now();let x=g-c;return u.pauseIntervals.forEach(S=>{const E=new Date(S.start).getTime(),K=S.end?new Date(S.end).getTime():u.status==="paused"?Date.now():g;K>E&&(x-=K-E)}),Math.floor(Math.max(0,x)/6e4)}async ensureActiveWorkout(){const u=this.getActiveWorkout();if(u)return u.id;const c=new Date().toISOString().split("T")[0],T=this.getWorkouts().filter(K=>K.startTime.startsWith(c)).sort((K,M)=>new Date(M.startTime).getTime()-new Date(K.startTime).getTime())[0];if(T&&!T.isManual&&T.status==="finished")return T.endTime=new Date().toISOString(),T.updatedAt=new Date().toISOString(),await Y.workouts.put(T),await this.reloadCache(),this.sync().catch(()=>{}),T.id;const S=`implicit_${c}_${Date.now()}`,E={id:S,startTime:new Date().toISOString(),endTime:new Date().toISOString(),status:"finished",isManual:!1,pauseIntervals:[],updatedAt:new Date().toISOString()};return await Y.workouts.put(E),await this.reloadCache(),this.sync().catch(()=>{}),S}async updateImplicitWorkoutBounds(u){const c=await Y.workouts.get(u);if(!c||c.isManual)return;const x=(await Y.logs.where("workoutId").equals(u).toArray()).filter(S=>!S.isDeleted);if(x.length===0)return;const T=x.sort((S,E)=>new Date(S.date).getTime()-new Date(E.date).getTime());c.startTime=T[0].date,c.endTime=T[T.length-1].date,c.status="finished",c.updatedAt=new Date().toISOString(),await Y.workouts.put(c)}async addLog(u){const c=await this.ensureActiveWorkout(),g={...u,id:Date.now().toString(),date:new Date().toISOString(),workoutId:c,updatedAt:new Date().toISOString()};return await Y.logs.put(g),await this.updateImplicitWorkoutBounds(c),await this.reloadCache(),this.sync().catch(()=>{}),g}async deleteLog(u){const c=await Y.logs.get(u);if(c){const g=c.workoutId;c.isDeleted=!0,c.updatedAt=new Date().toISOString(),await Y.logs.put(c),g&&await this.updateImplicitWorkoutBounds(g),await this.reloadCache(),this.sync().catch(()=>{})}}async updateLog(u){const c={...u,updatedAt:new Date().toISOString()};await Y.logs.put(c),await this.reloadCache(),this.sync().catch(()=>{})}getProfileIdentifier(){var g,x;const u=this.cache.profile;if(u!=null&&u.telegramUsername)return u.telegramUsername;if(u!=null&&u.telegramUserId)return`id_${u.telegramUserId}`;const c=(x=(g=me==null?void 0:me.initDataUnsafe)==null?void 0:g.user)==null?void 0:x.id;return c?`id_${c}`:""}async updateProfileSettings(u){var S;const c=(S=me==null?void 0:me.initDataUnsafe)==null?void 0:S.user,g=c==null?void 0:c.id;let x=this.cache.profile;x?c!=null&&c.photo_url&&(x.photoUrl=c.photo_url):x={id:"me",isPublic:!1,showFullHistory:!1,telegramUserId:g||0,telegramUsername:c==null?void 0:c.username,photoUrl:c==null?void 0:c.photo_url,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};const T={...x,...u,updatedAt:new Date().toISOString()};await Y.profile.put(T),await this.reloadCache(),this.sync().catch(()=>{})}async getPublicProfile(u){try{const g=await fetch(`https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4?profile=${encodeURIComponent(u)}`);return g.ok?await g.json():null}catch{return null}}}const W=new ni;W.reloadCache().then(()=>{});function ri(y,u){return u===1?y:Math.round(y*(1+u/30))}function ai(y,u){const c=new Map;return y.filter(x=>x.workoutTypeId===u).forEach(x=>{const T=x.date.split("T")[0],S=ri(x.weight,x.reps),E=c.get(T)||0;S>E&&c.set(T,S)}),c}function ii(y,u){const c=new Set;return y.forEach(g=>c.add(g.startTime.split("T")[0])),u.forEach(g=>c.add(g.date.split("T")[0])),c}function oi(y){const u=y.filter(T=>T.endTime&&T.status==="finished");if(u.length===0)return{averageMinutes:0,totalMinutes:0,count:0};let c=0;u.forEach(T=>{const S=new Date(T.startTime).getTime(),E=new Date(T.endTime).getTime();let K=E-S;T.pauseIntervals&&T.pauseIntervals.forEach(M=>{const V=new Date(M.start).getTime(),B=M.end?new Date(M.end).getTime():E;K-=B-V}),c+=K});const g=Math.round(c/1e3/60);return{averageMinutes:Math.round(g/u.length),totalMinutes:g,count:u.length}}function si(y,u=6){const c=new Date,g=new Date(c);g.setMonth(c.getMonth()-u),g.setDate(g.getDate()-g.getDay());let x='<div class="heatmap-container"><div class="heatmap-grid">';const T=new Date(g),S=new Date(c);for(;T<=S;){const E=T.toISOString().split("T")[0],K=y.has(E),V=`heatmap-cell level-${K?4:0}`,B=`${E}: ${K?"Workout":"No workout"}`;x+=`<div class="${V}" title="${B}"></div>`,T.setDate(T.getDate()+1)}return x+="</div>",x+=`
        <div class="heatmap-legend">
            Less <div class="heatmap-cell level-0"></div>
            <div class="heatmap-cell level-4"></div> More
        </div>
    `,x+="</div>",x}function Qr(y){const u=new Map;y.forEach(x=>{const T=x.date.split("T")[0],S=x.weight*x.reps;u.set(T,(u.get(T)||0)+S)});const c=Array.from(u.keys()).sort().slice(-10);if(c.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¾Ð±ÑÐµÐ¼Ð°</p>';const g=c.map(x=>({label:new Date(x).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:u.get(x)}));return li(g,"ÐºÐ³")}function ui(y){const u=Array.from(y.keys()).sort();if(u.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° 1RM</p>';const c=u.map(g=>({label:new Date(g).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:y.get(g)}));return oa(c,"ÐºÐ³")}function ci(y){const u=y.filter(g=>g.status==="finished"&&g.endTime).sort((g,x)=>new Date(g.startTime).getTime()-new Date(x.startTime).getTime()).slice(-10);if(u.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÐ¸</p>';const c=u.map(g=>{const x=new Date(g.startTime).getTime(),T=new Date(g.endTime).getTime();let S=(T-x)/1e3/60;return g.pauseIntervals&&g.pauseIntervals.forEach(E=>{const K=new Date(E.start).getTime(),M=E.end?new Date(E.end).getTime():T;S-=(M-K)/1e3/60}),{label:new Date(g.startTime).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:Math.round(S)}});return oa(c,"Ð¼Ð¸Ð½")}function li(y,u){const x=Math.max(...y.map(S=>S.value))*1.1;return`
        <svg width="100%" height="150" preserveAspectRatio="none">
            ${y.map((S,E)=>{const K=S.value/x*100,M=E/y.length*100,V=1/y.length*80;return`
            <rect x="${M+5}%" y="${100-K}%" width="${V}%" height="${K}%" fill="var(--color-button)" rx="2" opacity="0.8">
               <title>${S.label}: ${S.value}${u}</title>
            </rect>
            <text x="${M+5+V/2}%" y="95%" font-size="10" text-anchor="middle" fill="var(--color-text)" style="pointer-events: none;">
                ${S.label}
            </text>
        `}).join("")}
        </svg>
    `}function oa(y,u){const T=y.map(U=>U.value),S=Math.min(...T),E=Math.max(...T),K=E-S||1,M=U=>20+U/(y.length-1)*(400-2*20),V=U=>130-(U-S)/K*(150-2*20),B=y.map((U,Z)=>`${M(Z)},${V(U.value)}`).join(" "),z=y.map((U,Z)=>`
        <circle cx="${M(Z)}" cy="${V(U.value)}" r="4" fill="var(--color-bg)" stroke="var(--color-button)" stroke-width="2">
            <title>${U.label}: ${U.value}${u}</title>
        </circle>
    `).join("");return`
        <svg viewBox="0 0 400 150" class="chart">
             <polyline
                fill="none"
                stroke="var(--color-button)"
                stroke-width="3"
                stroke-linejoin="round"
                stroke-linecap="round"
                points="${B}"
            />
            ${z}
        </svg>
        <div style="display: flex; justify-content: space-between; margin-top: 4px; font-size: 12px; color: var(--color-hint);">
            <span>${Math.round(S)}${u}</span>
            <span>${Math.round(E)}${u}</span>
        </div>
    `}function di(){return!!(navigator.standalone===!0||window.matchMedia("(display-mode: standalone)").matches)}function fi(y,u){const c=di(),g=window.location.origin+window.location.pathname;if(c){y.innerHTML=`
            <div class="page-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center; padding: 20px;">
                <div style="font-size: 48px; margin-bottom: 24px;">ðï¸</div>
                <h1 class="title" style="margin-bottom: 12px;">ÐÐ¸Ð¼-Ð¶Ð¸Ð¼ 21</h1>
                <p class="subtitle" style="margin-bottom: 24px; opacity: 0.7;">ÐÐ»Ñ Ð¿ÐµÑÐ²Ð¾Ð¹ Ð°Ð²ÑÐ¾ÑÐ¸Ð·Ð°ÑÐ¸Ð¸ Ð¾ÑÐºÑÐ¾Ð¹ÑÐµ Ð¿ÑÐ¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð² Safari</p>
                <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px; max-width: 300px;">
                    <p style="font-size: 14px; opacity: 0.8; margin-bottom: 16px;">
                        1. Ð¡ÐºÐ¾Ð¿Ð¸ÑÑÐ¹ÑÐµ ÑÑÑÐ»ÐºÑ<br>
                        2. ÐÑÐºÑÐ¾Ð¹ÑÐµ Safari<br>
                        3. ÐÑÑÐ°Ð²ÑÑÐµ Ð¸ Ð¿ÐµÑÐµÐ¹Ð´Ð¸ÑÐµ<br>
                        4. ÐÐ²ÑÐ¾ÑÐ¸Ð·ÑÐ¹ÑÐµÑÑ ÑÐµÑÐµÐ· Telegram<br>
                        5. ÐÐµÑÐ½Ð¸ÑÐµÑÑ Ð² Ð¿ÑÐ¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
                    </p>
                    <button id="copy-link-btn" style="background: var(--tg-theme-button-color, #3390ec); color: var(--tg-theme-button-text-color, white); border: none; border-radius: 8px; padding: 12px 24px; font-size: 16px; cursor: pointer; width: 100%;">
                        ð Ð¡ÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ ÑÑÑÐ»ÐºÑ
                    </button>
                    <p id="copy-feedback" style="font-size: 12px; margin-top: 8px; opacity: 0; transition: opacity 0.3s;">â Ð¡ÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð¾!</p>
                </div>
                <p style="font-size: 12px; opacity: 0.5;">ÐÐ¾ÑÐ»Ðµ Ð°Ð²ÑÐ¾ÑÐ¸Ð·Ð°ÑÐ¸Ð¸ Ð² Safari Ð´Ð°Ð½Ð½ÑÐµ Ð°Ð²ÑÐ¾Ð¼Ð°ÑÐ¸ÑÐµÑÐºÐ¸ ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÑÑÑÑÑ</p>
            </div>
        `;const S=document.getElementById("copy-link-btn"),E=document.getElementById("copy-feedback");S==null||S.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(g),E&&(E.style.opacity="1",setTimeout(()=>{E.style.opacity="0"},2e3))}catch{prompt("Ð¡ÐºÐ¾Ð¿Ð¸ÑÑÐ¹ÑÐµ ÑÑÑÐ»ÐºÑ:",g)}});return}y.innerHTML=`
        <div class="page-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 24px;">ðï¸</div>
            <h1 class="title" style="margin-bottom: 12px;">ÐÐ¸Ð¼-Ð¶Ð¸Ð¼ 21</h1>
            <p class="subtitle" style="margin-bottom: 32px; opacity: 0.7;">ÐÐ¾Ð¹Ð´Ð¸ÑÐµ ÑÐµÑÐµÐ· Telegram, ÑÑÐ¾Ð±Ñ ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</p>
            <div id="telegram-login-container"></div>
        </div>
    `;const x=document.createElement("script");x.src="https://telegram.org/js/telegram-widget.js?22",x.async=!0,x.setAttribute("data-telegram-login","gymgym21bot"),x.setAttribute("data-size","large"),x.setAttribute("data-radius","12"),x.setAttribute("data-auth-url",window.location.href),x.setAttribute("data-request-access","write");const T=document.getElementById("telegram-login-container");T&&T.appendChild(x)}function pi(y={}){const{immediate:u=!1,onNeedRefresh:c,onOfflineReady:g,onRegistered:x,onRegisteredSW:T,onRegisterError:S}=y;let E,K;const M=async(B=!0)=>{await K};async function V(){if("serviceWorker"in navigator){if(E=await ea(async()=>{const{Workbox:B}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:B}},[],import.meta.url).then(({Workbox:B})=>new B("./sw.js",{scope:"./",type:"classic"})).catch(B=>{S==null||S(B)}),!E)return;E.addEventListener("activated",B=>{(B.isUpdate||B.isExternal)&&window.location.reload()}),E.addEventListener("installed",B=>{B.isUpdate||g==null||g()}),E.register({immediate:u}).then(B=>{T?T("./sw.js",B):x==null||x(B)}).catch(B=>{S==null||S(B)})}}return K=V(),M}pi({immediate:!0});var ta;const it=(ta=window.Telegram)==null?void 0:ta.WebApp;it&&(it.ready(),it.expand());let Dt="main",ye="all",lt=null,sa=null,ln=null,er=!1,Ce=null,Tt=null,sn="overview",un=!1;function hi(y){Dt=y,nt()}let Jn=null;function Xr(y){let u=document.querySelector(".toast");u||(u=document.createElement("div"),u.className="toast",document.body.appendChild(u)),u.textContent=y,u.classList.add("visible"),Jn&&clearTimeout(Jn),Jn=setTimeout(()=>{u==null||u.classList.remove("visible")},2e3)}function nt(){const y=document.getElementById("app");if(!y)return;const u=localStorage.getItem("skip_tma_auth")==="true",c=!!(it!=null&&it.initData)&&!u,x=!!dn();!c&&!x||(y.innerHTML=`
    <main class="content">
      ${mi()}
    </main>
    <nav class="navigation">
      <button class="navigation__item ${Dt==="main"?"navigation__item_active":""}" data-page="main">
        <span class="navigation__icon">ðï¸</span>
        <span class="navigation__label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Dt==="stats"?"navigation__item_active":""}" data-page="stats">
        <span class="navigation__icon">ð</span>
        <span class="navigation__label">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Dt==="profile-settings"?"navigation__item_active":""}" data-page="profile-settings">
        <span class="navigation__icon">ð¤</span>
        <span class="navigation__label">ÐÑÐ¾ÑÐ¸Ð»Ñ</span>
      </button>
      <button class="navigation__item ${Dt==="settings"?"navigation__item_active":""}" data-page="settings">
        <span class="navigation__icon">âï¸</span>
        <span class="navigation__label">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</span>
      </button>
    </nav>
    <div id="sync-status" class="sync-status"></div>
  `,y.querySelectorAll(".navigation__item").forEach(T=>{T.addEventListener("click",()=>{const S=T.getAttribute("data-page");hi(S)})}),Si())}let ua="idle";W.onSyncStatusChange(y=>{ua=y,ar()});function ar(){const y=document.getElementById("sync-status");if(!y)return;y.className="sync-status";let u="",c="";switch(ua){case"saving":u="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...",c="ð",y.classList.add("sync-status_saving");break;case"success":u="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾",c="â",y.classList.add("sync-status_success");break;case"error":u="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸",c="â ï¸",y.classList.add("sync-status_error");break;case"idle":if(!navigator.onLine)u="ÐÑÑÐ»Ð°Ð¹Ð½",c="ð¡",y.classList.add("sync-status_offline");else return;break}y.innerHTML=`${c} ${u}`}window.addEventListener("online",()=>{W.sync(),ar()});window.addEventListener("offline",()=>ar());function mi(){switch(Dt){case"main":return vi();case"stats":return ki();case"settings":return bi();case"profile-settings":return wi();case"public-profile":return _i();default:return""}}function yi(){const y=W.getActiveWorkout();if(y){const u=y.status==="paused";return`
      <div class="workout-controls card">
        <div class="workout-controls__header">
          <span class="workout-status ${u?"workout-status_paused":""}">
            ${u?"â¸ï¸ ÐÐ°ÑÐ·Ð°":"ð¥ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° Ð°ÐºÑÐ¸Ð²Ð½Ð°"}
          </span>
          ${y.name?`<span class="workout-name">${y.name}</span>`:""}
        </div>
        <div class="workout-controls__actions">
          ${u?'<button class="button" id="resume-workout-btn">ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ</button>':'<button class="button button_secondary" id="pause-workout-btn">ÐÐ°ÑÐ·Ð°</button>'}
          <button class="button button_destructive" id="finish-workout-btn">ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ</button>
        </div>
      </div>
    `}return un?`
      <div class="workout-controls card">
        <h3 class="subtitle" style="margin-top: 0">ÐÐ°ÑÐ°Ð»Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</h3>
        <form id="start-workout-form" style="display: flex; flex-direction: column; gap: 12px;">
          <input class="input" type="text" name="workoutName" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð¾Ð¿ÑÐ¸Ð¾Ð½Ð°Ð»ÑÐ½Ð¾)">
          <div style="display: flex; gap: 8px;">
            <button class="button" type="submit">ÐÐ°ÑÐ°ÑÑ</button>
            <button class="button button_secondary" type="button" id="cancel-start-workout-btn">ÐÑÐ¼ÐµÐ½Ð°</button>
          </div>
        </form>
      </div>
    `:`
    <button class="button" id="start-workout-btn" style="margin-bottom: 24px;">â¶ï¸ ÐÐ°ÑÐ°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ</button>
  `}let wt=0,nr="";function ir(y){const u=new Date;u.setHours(0,0,0,0);const c=new Date(u);c.setDate(u.getDate()-y*7),c.setHours(23,59,59,999);const g=new Date(c);return g.setDate(c.getDate()-6),g.setHours(0,0,0,0),{start:g,end:c,label:`${g.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})} - ${c.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}`}}function vi(){var S;const y=W.getWorkoutTypes(),u=W.getLogs(),c=u[u.length-1],g=c==null?void 0:c.workoutTypeId,x=lt?u.find(E=>E.id===lt):null,{label:T}=ir(wt);return`
    <div class="page-content" id="main-content">
      ${yi()}
      <h1 class="title">${lt?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´ÑÐ¾Ð´Ð°":"ÐÐ¾Ð²ÑÐ¹ Ð¿Ð¾Ð´ÑÐ¾Ð´"}</h1>
      <form class="workout-form" id="log-form">
        <div class="form-group">
          <label class="label">Ð¢Ð¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</label>
          <select class="select" name="typeId" required>
            ${y.map(E=>`<option value="${E.id}" ${(lt?x&&E.id===x.workoutTypeId:E.id===g)?"selected":""}>${E.name}</option>`).join("")}
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="label">ÐÐµÑ (ÐºÐ³)</label>
            <input class="input" type="number" name="weight" step="0.5" required placeholder="0" value="${lt&&x?x.weight:""}">
          </div>
          <div class="form-group">
            <label class="label">ÐÐ¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</label>
            <input class="input" type="number" name="reps" required placeholder="0" value="${lt&&x?x.reps:""}">
          </div>
        </div>
        <button class="button" type="submit">${lt?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ":"ÐÐ°ÑÐ¸ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ"}</button>
        ${lt?'<button class="button button_secondary" type="button" id="cancel-edit-btn" style="margin-top: 12px;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        ${!lt&&c?`<button class="button button_secondary" type="button" id="duplicate-last-btn" style="margin-top: 12px;">ÐÐ¾Ð²ÑÐ¾ÑÐ¸ÑÑ: ${(S=y.find(E=>E.id===c.workoutTypeId))==null?void 0:S.name} ${c.weight}ÐºÐ³ Ã ${c.reps}</button>`:""}
      </form>
      <div class="recent-logs">
        <div class="recent-logs__header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
           <button class="icon-btn" id="prev-week-btn">âï¸</button>
           <div id="week-label-container" style="display: flex; align-items: center; gap: 8px; position: relative;">
             <h2 class="subtitle" style="margin: 0;">${wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":T}</h2>
             <span style="font-size: 18px; position: relative; display: inline-block;">
               ð
               <input type="date" id="calendar-input" value="${nr}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
             </span>
           </div>
           <button class="icon-btn" id="next-week-btn" ${wt===0?"disabled":""} style="${wt===0?"opacity: 0.3; cursor: default;":""}">â¶ï¸</button>
        </div>
        <div id="logs-list">
          ${ca()}
        </div>
      </div>
    </div>
  `}function ca(){const y=W.getLogs(),u=W.getWorkoutTypes(),{start:c,end:g}=ir(wt),x=y.filter(T=>{const S=new Date(T.date);return S>=c&&S<=g});return la(x,u,!0)}function Zn(){const y=document.getElementById("logs-list"),u=document.querySelector("#week-label-container .subtitle");if(y&&(y.innerHTML=ca(),gi()),u){const{label:g}=ir(wt);u.textContent=wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":g}const c=document.getElementById("next-week-btn");c&&(c.disabled=wt===0,c.style.opacity=wt===0?"0.3":"",c.style.cursor=wt===0?"default":"")}function gi(){document.querySelectorAll(".log-set__delete").forEach(y=>{y.addEventListener("click",async()=>{const u=y.getAttribute("data-id");u&&(lt===u&&(lt=null),await W.deleteLog(u),nt())})}),document.querySelectorAll(".log-set__edit").forEach(y=>{y.addEventListener("click",()=>{lt=y.getAttribute("data-id"),nt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(y=>{y.addEventListener("click",()=>{const u=y.getAttribute("data-date");u&&da(u)})})}function la(y,u,c){if(y.length===0)return'<p class="hint">ÐÐµÑ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð·Ð° ÑÑÐ¾Ñ Ð¿ÐµÑÐ¸Ð¾Ð´</p>';const g=new Map;[...y].sort((S,E)=>new Date(E.date).getTime()-new Date(S.date).getTime()).forEach(S=>{const K=new Date(S.date).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"});g.has(K)||g.set(K,[]),g.get(K).push(S)});const x=W.getWorkouts();let T="";return g.forEach((S,E)=>{var ft;const K=((ft=S[0])==null?void 0:ft.date.split("T")[0])||"",M=new Set;S.forEach(vt=>{vt.workoutId&&M.add(vt.workoutId)});const V=Array.from(M).sort((vt,gt)=>{var bt,st;const Et=x.find(dt=>dt.id===vt),Ut=x.find(dt=>dt.id===gt),xt=(Et==null?void 0:Et.startTime)||((bt=S.find(dt=>dt.workoutId===vt))==null?void 0:bt.date)||"",mt=(Ut==null?void 0:Ut.startTime)||((st=S.find(dt=>dt.workoutId===gt))==null?void 0:st.date)||"";return new Date(mt).getTime()-new Date(xt).getTime()}),B=V.length===1?V[0]:null,z=B?x.find(vt=>vt.id===B):null,U=z&&z.name,Z=z?Math.round(W.getWorkoutDuration(z)):0;T+='<div class="log-day">',T+=`<div class="log-day__header">
      <span>${E}${U?` â¢ ${z.name}`:""}${z?` â¢ ${Z} Ð¼Ð¸Ð½`:""}</span>
      ${c?`<button class="share-btn" data-date="${K}" title="ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ">ð¤</button>`:""}
    </div>`,V.forEach(vt=>{const gt=x.find(mt=>mt.id===vt),Et=S.filter(mt=>mt.workoutId===vt);if(!(V.length===1&&(U||!(gt!=null&&gt.name)))){const mt=gt?Math.round(W.getWorkoutDuration(gt)):0;T+=`<h3 class="workout-subheader">
                ${(gt==null?void 0:gt.name)||"Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°"} 
                <span class="workout-subheader__time">${mt} Ð¼Ð¸Ð½</span>
            </h3>`}const xt=new Map;Et.forEach(mt=>{xt.has(mt.workoutTypeId)||xt.set(mt.workoutTypeId,[]),xt.get(mt.workoutTypeId).push(mt)}),xt.forEach((mt,bt)=>{const st=u.find(dt=>dt.id===bt);T+=`
            <div class="log-exercise">
              <div class="log-exercise__name">${(st==null?void 0:st.name)||"Ð£Ð´Ð°Ð»ÐµÐ½Ð¾"}</div>
              <div class="log-exercise__sets">
                ${mt.map(dt=>`
                  <div class="log-set ${dt.id===lt?"log-set_active-edit":""} ${dt.id===Ce?"log-set_new":""}">
                    <div class="log-set__info">
                      <span class="log-set__weight">${dt.weight} ÐºÐ³</span>
                      <span class="log-set__times">Ã</span>
                      <span class="log-set__reps">${dt.reps}</span>
                    </div>
                    ${c?`
                    <div class="log-set__actions">
                      <button class="log-set__edit" data-id="${dt.id}">âï¸</button>
                      <button class="log-set__delete" data-id="${dt.id}">Ã</button>
                    </div>
                    `:""}
                  </div>
                `).join("")}
              </div>
            </div>
          `})}),T+="</div>"}),T}function bi(){const y=W.getWorkoutTypes(),u=Tt?y.find(c=>c.id===Tt):null;return`
    <div class="page-content">
      <h1 class="title">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</h1>
      <div class="settings-section">
        <h2 class="subtitle">${Tt?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¿Ð°":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸"}</h2>
        <form class="add-type-form" id="add-type-form" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 8px;">
            <input class="input" type="text" id="new-type-name" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð½Ð°Ð¿Ñ. ÐÐ¸Ð¼ Ð³Ð°Ð½ÑÐµÐ»ÐµÐ¹)" required value="${u?u.name:""}">
            <button class="button" type="submit">${Tt?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ"}</button>
          </div>
          ${Tt?'<button class="button button_secondary" type="button" id="cancel-edit-type-btn" style="margin-top: 8px; width: 100%;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        </form>

        <h2 class="subtitle">Ð¢Ð¸Ð¿Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
        <div class="type-list">
          ${y.map(c=>`
            <div class="type-item">
              <span>${c.name}</span>
              <div style="display: flex; gap: 8px;">
                <button class="type-item__edit icon-btn" data-id="${c.id}" title="Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ">âï¸</button>
                <button class="type-item__delete icon-btn" data-id="${c.id}" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">Ã</button>
              </div>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `}function wi(){var K,M;const y=W.getProfile(),u=(y==null?void 0:y.isPublic)??!1,c=(y==null?void 0:y.displayName)||((M=(K=it==null?void 0:it.initDataUnsafe)==null?void 0:K.user)==null?void 0:M.first_name)||"",g=W.getProfileIdentifier(),x=g?`https://t.me/gymgym21bot/app?startapp=profile_${g}`:"",T=W.getLogs(),S=T.reduce((V,B)=>V+B.weight*B.reps,0),E=new Set(T.map(V=>V.date.split("T")[0])).size;return`
    <div class="page-content profile-page">
      <h1 class="title">ÐÑÐ¾ÑÐ¸Ð»Ñ</h1>
      
      <div class="profile-header">
        <div class="profile-avatar">
          ${y!=null&&y.photoUrl?`<img src="${y.photoUrl}" alt="${c}" class="profile-avatar-img">`:c.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${c}</div>
        <div class="profile-subtitle">${u?"ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ":"ÐÑÐ¸Ð²Ð°ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ"}</div>
      </div>

      <div class="profile-settings">
        <div class="settings-section">
          <div class="settings-section-title">ÐÐ¸Ð´Ð¸Ð¼Ð¾ÑÑÑ</div>
          <div class="toggle-row">
            <div class="toggle-label">
              <span class="toggle-label-text">ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</span>
              <span class="toggle-label-hint">ÐÑÑÐ³Ð¸Ðµ ÑÐ¼Ð¾Ð³ÑÑ Ð²Ð¸Ð´ÐµÑÑ Ð²Ð°ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÑ</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="profile-public-toggle" ${u?"checked":""}>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="toggle-row" style="margin-top: 12px;">
            <div class="toggle-label">
              <span class="toggle-label-text">ÐÐ¾ÐºÐ°Ð·ÑÐ²Ð°ÑÑ Ð²ÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ</span>
              <span class="toggle-label-hint">ÐÐ¾Ð´ÑÐ¾Ð±Ð½ÑÐ¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð² Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ð¼ Ð¿ÑÐ¾ÑÐ¸Ð»Ðµ</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="profile-history-toggle" ${y!=null&&y.showFullHistory?"checked":""}>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-section">
          <div class="settings-section-title">ÐÐ¼Ñ</div>
          <input class="input" type="text" id="profile-display-name" value="${c}" placeholder="ÐÐ°ÑÐµ Ð¸Ð¼Ñ">
        </div>

        ${u&&g?`
          <div class="settings-section">
            <div class="settings-section-title">Ð¡ÑÑÐ»ÐºÐ° Ð½Ð° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</div>
            <div class="profile-link-section">
              <a href="${x}" target="_blank" class="profile-link-url">${x}</a>
              <div class="profile-link-actions">
                <button class="button button_secondary" id="copy-profile-link">ÐÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ</button>
                <button class="button" id="share-profile-link">ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ</button>
              </div>
            </div>
          </div>
        `:""}

        <div class="settings-section">
          <div class="settings-section-title">ÐÑÐµÐ²ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</div>
          <div class="profile-stats">
            <div class="stat-card">
              <div class="stat-value">${E}</div>
              <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">${Math.round(S/1e3)}Ñ</div>
              <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
            </div>
          </div>
        </div>

        <button class="button" id="save-profile-btn">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
      </div>
    </div>
  `}function _i(){if(!sa)return`
      <div class="page-content">
        <div class="profile-not-found">
          <div class="profile-not-found-icon">ð</div>
          <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½</div>
        </div>
      </div>
    `;if(!ln)return er?`
        <div class="page-content">
          <div class="profile-not-found">
            <div class="profile-not-found-icon">ð</div>
            <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐºÑÑÑ Ð¸Ð»Ð¸ Ð½Ðµ ÑÑÑÐµÑÑÐ²ÑÐµÑ</div>
          </div>
        </div>
      `:`
      <div class="page-content">
        <div class="profile-loading">ÐÐ°Ð³ÑÑÐ·ÐºÐ° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ...</div>
      </div>
    `;const y=ln;return`
    <div class="page-content profile-page">
      <div class="profile-header">
        <div class="profile-avatar">
          ${y.photoUrl?`<img src="${y.photoUrl}" alt="${y.displayName}" class="profile-avatar-img">`:y.displayName.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${y.displayName}</div>
        <div class="profile-subtitle">@${y.identifier}</div>
      </div>

      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-value">${y.stats.totalWorkouts}</div>
          <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${Math.round(y.stats.totalVolume/1e3)}Ñ</div>
          <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
        </div>
        ${y.stats.favoriteExercise?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${y.stats.favoriteExercise}</div>
            <div class="stat-label">ÐÑÐ±Ð¸Ð¼Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</div>
          </div>
        `:""}
        ${y.stats.lastWorkoutDate?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${new Date(y.stats.lastWorkoutDate).toLocaleDateString()}</div>
            <div class="stat-label">ÐÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</div>
          </div>
        `:""}
      </div>

      ${y.recentActivity.length>0?`
        <div class="activity-list">
          <h2 class="subtitle">ÐÐµÐ´Ð°Ð²Ð½ÑÑ Ð°ÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          ${y.recentActivity.map(u=>`
            <div class="activity-item">
              <span class="activity-date">${new Date(u.date).toLocaleDateString()}</span>
              <span class="activity-count">${u.exerciseCount} ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹</span>
            </div>
          `).join("")}
        </div>
      `:""}

      ${y.logs&&y.logs.length>0&&y.workoutTypes?`
        <div class="recent-logs">
          <h2 class="subtitle">ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
          <div id="logs-list">
            ${la(y.logs,y.workoutTypes,!1)}
          </div>
        </div>
      `:""}
    </div>
  `}function ki(){const y=W.getLogs(),u=W.getWorkouts(),c=W.getWorkoutTypes();if(y.length===0)return`
      <div class="page-content">
        <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
        <p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</p>
      </div>
    `;const g=y.reduce((E,K)=>E+K.weight*K.reps,0),x=y.reduce((E,K)=>E+K.reps,0),T=oi(u);let S=`
    <div class="page-content">
      <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
      <div class="stats-tabs">
        <button class="stats-tab ${sn==="overview"?"active":""}" data-tab="overview">ÐÐ±Ð·Ð¾Ñ</button>
        <button class="stats-tab ${sn==="progress"?"active":""}" data-tab="progress">ÐÑÐ¾Ð³ÑÐµÑÑ</button>
      </div>
  `;if(sn==="overview"){const E=ii(u,y);S+=`
        <div class="stats-section">
            <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
            ${si(E)}
        </div>

        <div class="stats-summary">
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
                <div class="stat-metric__value">${E.size}</div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">Ð¡ÑÐµÐ´. Ð´Ð»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ</div>
                <div class="stat-metric__value">${T.averageMinutes}<span class="stat-metric__unit">Ð¼Ð¸Ð½</span></div>
            </div>
             <div class="stat-metric">
                <div class="stat-metric__label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼</div>
                <div class="stat-metric__value">${Math.round(g/1e3)}<span class="stat-metric__unit">Ñ</span></div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ Ð¿Ð¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</div>
                <div class="stat-metric__value">${x}</div>
            </div>
        </div>

        <div class="charts-section">
            <h2 class="subtitle">ÐÐ»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
            <div class="chart-container">
                ${ci(u)}
            </div>
        </div>
     `}else if(S+=`
        <div class="form-group">
            <label class="label">Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</label>
            <select class="select" id="stat-type-select">
                <option value="all">ÐÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ (ÐÐ±ÑÐµÐ¼)</option>
                ${c.map(E=>`<option value="${E.id}" ${ye===E.id?"selected":""}>${E.name}</option>`).join("")}
            </select>
        </div>
    `,ye==="all")S+=`
            <div class="charts-section">
                <h2 class="subtitle">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼ Ð¿Ð¾ Ð´Ð½ÑÐ¼</h2>
                <div class="chart-container">
                    ${Qr(y)}
                </div>
            </div>
        `;else{const E=y.filter(M=>M.workoutTypeId===ye),K=ai(E,ye);S+=`
             <div class="charts-section">
                <h2 class="subtitle">ÐÑÐ¾Ð³ÑÐµÑÑ ÑÐ¸Ð»Ð¾Ð²ÑÑ (1RM)</h2>
                <div class="chart-container">
                    ${ui(K)}
                </div>
            </div>
            
            <div class="charts-section" style="margin-top: 24px;">
                <h2 class="subtitle">ÐÐ±ÑÐµÐ¼ Ð½Ð°Ð³ÑÑÐ·ÐºÐ¸</h2>
                 <div class="chart-container">
                    ${Qr(E)}
                </div>
            </div>
        `}return S+="</div>",S}function xi(y){const u=W.getLogs(),c=W.getWorkoutTypes(),g=u.filter(M=>M.date.startsWith(y));if(g.length===0)return"";const T=new Date(g[0].date).toLocaleDateString("ru-RU",{day:"numeric",month:"long"}),S=new Map;g.forEach(M=>{S.has(M.workoutTypeId)||S.set(M.workoutTypeId,[]),S.get(M.workoutTypeId).push(M)});let E=`ðï¸ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° ${T}

`;S.forEach((M,V)=>{const B=c.find(z=>z.id===V);E+=`${(B==null?void 0:B.name)||"Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ"}:
`,M.forEach(z=>{E+=`  ${z.weight} ÐºÐ³ Ã ${z.reps}
`}),E+=`
`});const K=g.reduce((M,V)=>M+V.weight*V.reps,0);return E+=`ðª ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼: ${Math.round(K)} ÐºÐ³`,E}function da(y){const u=xi(y);if(u)if(it!=null&&it.openTelegramLink){const c=`https://t.me/share/url?url=${encodeURIComponent("https://t.me/gymgym21bot")}&text=${encodeURIComponent(u)}`;it.openTelegramLink(c)}else navigator.clipboard.writeText(u).then(()=>{alert("Ð¢ÐµÐºÑÑ ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½ Ð² Ð±ÑÑÐµÑ Ð¾Ð±Ð¼ÐµÐ½Ð°")})}function Si(){if(Dt==="main"){const y=document.getElementById("start-workout-btn");y==null||y.addEventListener("click",()=>{un=!0,nt()});const u=document.getElementById("cancel-start-workout-btn");u==null||u.addEventListener("click",()=>{un=!1,nt()});const c=document.getElementById("start-workout-form");c==null||c.addEventListener("submit",async z=>{z.preventDefault();const Z=new FormData(c).get("workoutName");await W.startWorkout(Z),un=!1,nt()});const g=document.getElementById("pause-workout-btn");g==null||g.addEventListener("click",async()=>{await W.pauseWorkout(),nt()});const x=document.getElementById("resume-workout-btn");x==null||x.addEventListener("click",async()=>{await W.resumeWorkout(),nt()});const T=document.getElementById("finish-workout-btn");T==null||T.addEventListener("click",async()=>{confirm("ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ?")&&(await W.finishWorkout(),nt())});const S=document.getElementById("log-form");S==null||S.addEventListener("submit",async z=>{z.preventDefault();const U=new FormData(S),Z={workoutTypeId:U.get("typeId"),weight:parseFloat(U.get("weight")),reps:parseInt(U.get("reps"),10)};if(lt){const vt=W.getLogs().find(gt=>gt.id===lt);vt&&(await W.updateLog({...vt,...Z}),lt=null)}else Ce=(await W.addLog(Z)).id;nt(),Ce=null});const E=document.getElementById("duplicate-last-btn");E==null||E.addEventListener("click",async()=>{const z=W.getLogs(),U=z[z.length-1];U&&(Ce=(await W.addLog({workoutTypeId:U.workoutTypeId,weight:U.weight,reps:U.reps})).id,nt(),Ce=null)});const K=document.getElementById("cancel-edit-btn");K==null||K.addEventListener("click",()=>{lt=null,nt()}),document.querySelectorAll(".log-set__delete").forEach(z=>{z.addEventListener("click",async()=>{const U=z.getAttribute("data-id");U&&(lt===U&&(lt=null),await W.deleteLog(U),nt())})}),document.querySelectorAll(".log-set__edit").forEach(z=>{z.addEventListener("click",()=>{lt=z.getAttribute("data-id"),nt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(z=>{z.addEventListener("click",()=>{const U=z.getAttribute("data-date");U&&da(U)})});const M=document.getElementById("prev-week-btn");M==null||M.addEventListener("click",()=>{wt++,Zn()});const V=document.getElementById("next-week-btn");V==null||V.addEventListener("click",()=>{wt>0&&(wt--,Zn())});const B=document.getElementById("calendar-input");B==null||B.addEventListener("change",()=>{if(!B.value||B.value===nr)return;nr=B.value;const z=new Date(B.value),U=new Date;U.setHours(0,0,0,0);const Z=U.getTime()-z.getTime(),ft=Math.floor(Z/(1e3*60*60*24));wt=Math.max(0,Math.floor(ft/7)),Zn()})}if(Dt==="settings"){const y=document.getElementById("add-type-form");y==null||y.addEventListener("submit",async c=>{c.preventDefault();const g=document.getElementById("new-type-name");g.value&&(Tt?(await W.updateWorkoutType(Tt,g.value),Tt=null):await W.addWorkoutType(g.value),nt())});const u=document.getElementById("cancel-edit-type-btn");u==null||u.addEventListener("click",()=>{Tt=null,nt()}),document.querySelectorAll(".type-item__edit").forEach(c=>{c.addEventListener("click",()=>{Tt=c.getAttribute("data-id"),nt();const g=document.getElementById("new-type-name");g==null||g.focus()})}),document.querySelectorAll(".type-item__delete").forEach(c=>{c.addEventListener("click",async()=>{const g=c.getAttribute("data-id");g&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(Tt===g&&(Tt=null),await W.deleteWorkoutType(g),nt())})})}if(Dt==="stats"){const y=document.getElementById("stat-type-select");y==null||y.addEventListener("change",()=>{ye=y.value,nt()})}if(Dt==="profile-settings"){const y=document.getElementById("save-profile-btn");y==null||y.addEventListener("click",async()=>{const g=document.getElementById("profile-public-toggle"),x=document.getElementById("profile-history-toggle"),T=document.getElementById("profile-display-name");await W.updateProfileSettings({isPublic:(g==null?void 0:g.checked)??!1,showFullHistory:(x==null?void 0:x.checked)??!1,displayName:(T==null?void 0:T.value)||void 0}),nt()});const u=document.getElementById("copy-profile-link");u==null||u.addEventListener("click",()=>{const x=`https://t.me/gymgym21bot/app?startapp=profile_${W.getProfileIdentifier()}`;navigator.clipboard.writeText(x).then(()=>{Xr("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})});const c=document.getElementById("share-profile-link");c==null||c.addEventListener("click",()=>{const x=`https://t.me/gymgym21bot/app?startapp=profile_${W.getProfileIdentifier()}`;if(it!=null&&it.openTelegramLink){const T=`https://t.me/share/url?url=${encodeURIComponent(x)}&text=${encodeURIComponent("ÐÐ¾Ð¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº ðª")}`;it.openTelegramLink(T)}else navigator.clipboard.writeText(x).then(()=>{Xr("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})})}if(Dt==="stats"){document.querySelectorAll(".stats-tab").forEach(c=>{c.addEventListener("click",()=>{const g=c.getAttribute("data-tab");(g==="overview"||g==="progress")&&(sn=g,nt())})});const u=document.getElementById("stat-type-select");u==null||u.addEventListener("change",c=>{ye=c.target.value,nt()})}}const ne=document.createElement("div");ne.className="sync-status";document.body.appendChild(ne);function Ti(y){switch(ne.className="sync-status visible "+y,y){case"saving":ne.textContent="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ðµ...";break;case"success":ne.textContent="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾";break;case"error":ne.textContent="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ";break;default:ne.className="sync-status"}}W.onUpdate(()=>nt());W.onSyncStatusChange(Ti);async function Di(){var E;const y=new URLSearchParams(window.location.search);if(y.has("hash")&&y.has("id")){const K={id:parseInt(y.get("id")||"0",10),first_name:y.get("first_name")||"",last_name:y.get("last_name")||void 0,username:y.get("username")||void 0,photo_url:y.get("photo_url")||void 0,auth_date:parseInt(y.get("auth_date")||"0",10),hash:y.get("hash")||""};ra(K),y.delete("hash"),y.delete("id"),y.delete("first_name"),y.delete("last_name"),y.delete("username"),y.delete("photo_url"),y.delete("auth_date"),y.delete("auth");const M=y.toString(),V=window.location.pathname+(M?"?"+M:"");window.history.replaceState({},document.title,V),location.reload();return}const u=localStorage.getItem("skip_tma_auth")==="true",c=!!(it!=null&&it.initData)&&!u,x=!!dn();if(!c&&!x){fi(document.getElementById("app"));return}const S=new URLSearchParams(window.location.search).get("startapp")||((E=it==null?void 0:it.initDataUnsafe)==null?void 0:E.start_param);if(S&&S.startsWith("profile_")){const K=S.replace("profile_","");sa=K,Dt="public-profile",er=!1,nt(),ln=await W.getPublicProfile(K),ln||(er=!0),nt()}else nt();await W.init()}Di();
