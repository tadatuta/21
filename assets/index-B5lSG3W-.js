var Qa=Object.defineProperty;var Ja=(o,n,i)=>n in o?Qa(o,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[n]=i;var de=(o,n,i)=>Ja(o,typeof n!="symbol"?n+"":n,i);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function i(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(c){if(c.ep)return;c.ep=!0;const d=i(c);fetch(c.href,d)}})();var Ao=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Za(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Xo={exports:{}};(function(o,n){((i,s)=>{o.exports=s()})(Ao,function(){var i=function(t,e){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(r,a){r.__proto__=a}:function(r,a){for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(r[u]=a[u])}))(t,e)},s=function(){return(s=Object.assign||function(t){for(var e,r=1,a=arguments.length;r<a;r++)for(var u in e=arguments[r])Object.prototype.hasOwnProperty.call(e,u)&&(t[u]=e[u]);return t}).apply(this,arguments)};function c(t,e,r){for(var a,u=0,l=e.length;u<l;u++)!a&&u in e||((a=a||Array.prototype.slice.call(e,0,u))[u]=e[u]);return t.concat(a||Array.prototype.slice.call(e))}var d=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ao,p=Object.keys,m=Array.isArray;function _(t,e){return typeof e=="object"&&p(e).forEach(function(r){t[r]=e[r]}),t}typeof Promise>"u"||d.Promise||(d.Promise=Promise);var E=Object.getPrototypeOf,O={}.hasOwnProperty;function A(t,e){return O.call(t,e)}function j(t,e){typeof e=="function"&&(e=e(E(t))),(typeof Reflect>"u"?p:Reflect.ownKeys)(e).forEach(function(r){F(t,r,e[r])})}var K=Object.defineProperty;function F(t,e,r,a){K(t,e,_(r&&A(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},a))}function Y(t){return{from:function(e){return t.prototype=Object.create(e.prototype),F(t.prototype,"constructor",t),{extend:j.bind(null,t.prototype)}}}}var tt=Object.getOwnPropertyDescriptor,Z=[].slice;function Q(t,e,r){return Z.call(t,e,r)}function rt(t,e){return e(t)}function V(t){if(!t)throw new Error("Assertion Failed")}function lt(t){d.setImmediate?setImmediate(t):setTimeout(t,0)}function gt(t,e){if(typeof e=="string"&&A(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],a=0,u=e.length;a<u;++a){var l=gt(t,e[a]);r.push(l)}return r}var f,h=e.indexOf(".");return h===-1||(f=t[e.substr(0,h)])==null?void 0:gt(f,e.substr(h+1))}function st(t,e,r){if(t&&e!==void 0&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){V(typeof r!="string"&&"length"in r);for(var a=0,u=e.length;a<u;++a)st(t,e[a],r[a])}else{var l,f,h=e.indexOf(".");h!==-1?(l=e.substr(0,h),(h=e.substr(h+1))===""?r===void 0?m(t)&&!isNaN(parseInt(l))?t.splice(l,1):delete t[l]:t[l]=r:st(f=(f=t[l])&&A(t,l)?f:t[l]={},h,r)):r===void 0?m(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function ot(t){var e,r={};for(e in t)A(t,e)&&(r[e]=t[e]);return r}var vt=[].concat;function Bt(t){return vt.apply([],t)}var ie="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Bt([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return d[t]}),Lt=new Set(ie.map(function(t){return d[t]})),Ft=null;function At(t){return Ft=new WeakMap,t=function e(r){if(!r||typeof r!="object")return r;var a=Ft.get(r);if(a)return a;if(m(r)){a=[],Ft.set(r,a);for(var u=0,l=r.length;u<l;++u)a.push(e(r[u]))}else if(Lt.has(r.constructor))a=r;else{var f,h=E(r);for(f in a=h===Object.prototype?{}:Object.create(h),Ft.set(r,a),r)A(r,f)&&(a[f]=e(r[f]))}return a}(t),Ft=null,t}var ne={}.toString;function re(t){return ne.call(t).slice(8,-1)}var Wt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Ve=typeof Wt=="symbol"?function(t){var e;return t!=null&&(e=t[Wt])&&e.apply(t)}:function(){return null};function Ht(t,e){e=t.indexOf(e),0<=e&&t.splice(e,1)}var be={};function se(t){var e,r,a,u;if(arguments.length===1){if(m(t))return t.slice();if(this===be&&typeof t=="string")return[t];if(u=Ve(t))for(r=[];!(a=u.next()).done;)r.push(a.value);else{if(t==null)return[t];if(typeof(e=t.length)!="number")return[t];for(r=new Array(e);e--;)r[e]=t[e]}}else for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var He=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ie=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Xt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ie),ba={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Xe(t,e){this.name=t,this.message=e}function zi(t,e){return t+". Errors: "+Object.keys(e).map(function(r){return e[r].toString()}).filter(function(r,a,u){return u.indexOf(r)===a}).join(`
`)}function Kn(t,e,r,a){this.failures=e,this.failedKeys=a,this.successCount=r,this.message=zi(t,e)}function Ge(t,e){this.name="BulkError",this.failures=Object.keys(e).map(function(r){return e[r]}),this.failuresByPos=e,this.message=zi(t,this.failures)}Y(Xe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),Y(Kn).from(Xe),Y(Ge).from(Xe);var jr=Xt.reduce(function(t,e){return t[e]=e+"Error",t},{}),wa=Xe,X=Xt.reduce(function(t,e){var r=e+"Error";function a(u,l){this.name=r,u?typeof u=="string"?(this.message="".concat(u).concat(l?`
 `+l:""),this.inner=l||null):typeof u=="object"&&(this.message="".concat(u.name," ").concat(u.message),this.inner=u):(this.message=ba[e]||r,this.inner=null)}return Y(a).from(wa),t[e]=a,t},{}),Vi=(X.Syntax=SyntaxError,X.Type=TypeError,X.Range=RangeError,ie.reduce(function(t,e){return t[e+"Error"]=X[e],t},{}));ie=Xt.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=X[e]),t},{});function yt(){}function mn(t){return t}function _a(t,e){return t==null||t===mn?e:function(r){return e(t(r))}}function Ce(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ka(t,e){return t===yt?e:function(){var r=t.apply(this,arguments),a=(r!==void 0&&(arguments[0]=r),this.onsuccess),u=this.onerror,l=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return a&&(this.onsuccess=this.onsuccess?Ce(a,this.onsuccess):a),u&&(this.onerror=this.onerror?Ce(u,this.onerror):u),l!==void 0?l:r}}function Sa(t,e){return t===yt?e:function(){t.apply(this,arguments);var r=this.onsuccess,a=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Ce(r,this.onsuccess):r),a&&(this.onerror=this.onerror?Ce(a,this.onerror):a)}}function Ea(t,e){return t===yt?e:function(u){var a=t.apply(this,arguments),u=(_(u,a),this.onsuccess),l=this.onerror,f=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return u&&(this.onsuccess=this.onsuccess?Ce(u,this.onsuccess):u),l&&(this.onerror=this.onerror?Ce(l,this.onerror):l),a===void 0?f===void 0?void 0:f:_(a,f)}}function Da(t,e){return t===yt?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function Lr(t,e){return t===yt?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var a=this,u=arguments.length,l=new Array(u);u--;)l[u]=arguments[u];return r.then(function(){return e.apply(a,l)})}return e.apply(this,arguments)}}ie.ModifyError=Kn,ie.DexieError=Xe,ie.BulkError=Ge;var ue=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Hi(t){ue=t}var gn={},Xi=100,vn=typeof Promise>"u"?[]:(Xt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[vn=crypto.subtle.digest("SHA-512",new Uint8Array([0])),E(vn),Xt]:[Xt,E(Xt),Xt]),Xt=vn[0],on=vn[1],on=on&&on.then,$e=Xt&&Xt.constructor,Rr=!!vn[2],yn=function(t,e){bn.push([t,e]),qn&&(queueMicrotask(Ta),qn=!1)},Nr=!0,qn=!0,Me=[],Fn=[],Br=mn,we={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:yt,pgp:!1,env:{},finalize:yt},H=we,bn=[],je=0,Wn=[];function B(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=H;if(typeof t!="function"){if(t!==gn)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&qr(this,this._value)}else this._state=null,this._value=null,++e.ref,function r(a,u){try{u(function(l){if(a._state===null){if(l===a)throw new TypeError("A promise cannot be resolved with itself.");var f=a._lib&&Qe();l&&typeof l.then=="function"?r(a,function(h,y){l instanceof B?l._then(h,y):l.then(h,y)}):(a._state=!0,a._value=l,Qi(a)),f&&Je()}},qr.bind(null,a))}catch(l){qr(a,l)}}(this,t)}var Kr={get:function(){var t=H,e=Vn;function r(a,u){var l=this,f=!t.global&&(t!==H||e!==Vn),h=f&&!ke(),y=new B(function(x,b){Fr(l,new Gi(Zi(a,t,f,h),Zi(u,t,f,h),x,b,t))});return this._consoleTask&&(y._consoleTask=this._consoleTask),y}return r.prototype=gn,r},set:function(t){F(this,"then",t&&t.prototype===gn?Kr:{get:function(){return t},set:Kr.set})}};function Gi(t,e,r,a,u){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=a,this.psd=u}function qr(t,e){var r,a;Fn.push(e),t._state===null&&(r=t._lib&&Qe(),e=Br(e),t._state=!1,t._value=e,a=t,Me.some(function(u){return u._value===a._value})||Me.push(a),Qi(t),r)&&Je()}function Qi(t){var e=t._listeners;t._listeners=[];for(var r=0,a=e.length;r<a;++r)Fr(t,e[r]);var u=t._PSD;--u.ref||u.finalize(),je===0&&(++je,yn(function(){--je==0&&Wr()},[]))}function Fr(t,e){if(t._state===null)t._listeners.push(e);else{var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++je,yn(xa,[r,t,e])}}function xa(t,e,r){try{var a,u=e._value;!e._state&&Fn.length&&(Fn=[]),a=ue&&e._consoleTask?e._consoleTask.run(function(){return t(u)}):t(u),e._state||Fn.indexOf(u)!==-1||(l=>{for(var f=Me.length;f;)if(Me[--f]._value===l._value)return Me.splice(f,1)})(e),r.resolve(a)}catch(l){r.reject(l)}finally{--je==0&&Wr(),--r.psd.ref||r.psd.finalize()}}function Ta(){Le(we,function(){Qe()&&Je()})}function Qe(){var t=Nr;return qn=Nr=!1,t}function Je(){var t,e,r;do for(;0<bn.length;)for(t=bn,bn=[],r=t.length,e=0;e<r;++e){var a=t[e];a[0].apply(null,a[1])}while(0<bn.length);qn=Nr=!0}function Wr(){for(var t=Me,e=(Me=[],t.forEach(function(a){a._PSD.onunhandled.call(null,a._value,a)}),Wn.slice(0)),r=e.length;r;)e[--r]()}function Un(t){return new B(gn,!1,t)}function wt(t,e){var r=H;return function(){var a=Qe(),u=H;try{return Se(r,!0),t.apply(this,arguments)}catch(l){e&&e(l)}finally{Se(u,!1),a&&Je()}}}j(B.prototype,{then:Kr,_then:function(t,e){Fr(this,new Gi(null,null,t,e,H))},catch:function(t){var e,r;return arguments.length===1?this.then(null,t):(e=t,r=arguments[1],typeof e=="function"?this.then(null,function(a){return(a instanceof e?r:Un)(a)}):this.then(null,function(a){return(a&&a.name===e?r:Un)(a)}))},finally:function(t){return this.then(function(e){return B.resolve(t()).then(function(){return e})},function(e){return B.resolve(t()).then(function(){return Un(e)})})},timeout:function(t,e){var r=this;return t<1/0?new B(function(a,u){var l=setTimeout(function(){return u(new X.Timeout(e))},t);r.then(a,u).finally(clearTimeout.bind(null,l))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&F(B.prototype,Symbol.toStringTag,"Dexie.Promise"),we.env=Ji(),j(B,{all:function(){var t=se.apply(null,arguments).map(Hn);return new B(function(e,r){t.length===0&&e([]);var a=t.length;t.forEach(function(u,l){return B.resolve(u).then(function(f){t[l]=f,--a||e(t)},r)})})},resolve:function(t){return t instanceof B?t:t&&typeof t.then=="function"?new B(function(e,r){t.then(e,r)}):new B(gn,!0,t)},reject:Un,race:function(){var t=se.apply(null,arguments).map(Hn);return new B(function(e,r){t.map(function(a){return B.resolve(a).then(e,r)})})},PSD:{get:function(){return H},set:function(t){return H=t}},totalEchoes:{get:function(){return Vn}},newPSD:_e,usePSD:Le,scheduler:{get:function(){return yn},set:function(t){yn=t}},rejectionMapper:{get:function(){return Br},set:function(t){Br=t}},follow:function(t,e){return new B(function(r,a){return _e(function(u,l){var f=H;f.unhandleds=[],f.onunhandled=l,f.finalize=Ce(function(){var h,y=this;h=function(){y.unhandleds.length===0?u():l(y.unhandleds[0])},Wn.push(function x(){h(),Wn.splice(Wn.indexOf(x),1)}),++je,yn(function(){--je==0&&Wr()},[])},f.finalize),t()},e,r,a)})}}),$e&&($e.allSettled&&F(B,"allSettled",function(){var t=se.apply(null,arguments).map(Hn);return new B(function(e){t.length===0&&e([]);var r=t.length,a=new Array(r);t.forEach(function(u,l){return B.resolve(u).then(function(f){return a[l]={status:"fulfilled",value:f}},function(f){return a[l]={status:"rejected",reason:f}}).then(function(){return--r||e(a)})})})}),$e.any&&typeof AggregateError<"u"&&F(B,"any",function(){var t=se.apply(null,arguments).map(Hn);return new B(function(e,r){t.length===0&&r(new AggregateError([]));var a=t.length,u=new Array(a);t.forEach(function(l,f){return B.resolve(l).then(function(h){return e(h)},function(h){u[f]=h,--a||r(new AggregateError(u))})})})}),$e.withResolvers)&&(B.withResolvers=$e.withResolvers);var $t={awaits:0,echoes:0,id:0},Ia=0,Yn=[],zn=0,Vn=0,Oa=0;function _e(t,f,r,a){var u=H,l=Object.create(u),f=(l.parent=u,l.ref=0,l.global=!1,l.id=++Oa,we.env,l.env=Rr?{Promise:B,PromiseProp:{value:B,configurable:!0,writable:!0},all:B.all,race:B.race,allSettled:B.allSettled,any:B.any,resolve:B.resolve,reject:B.reject}:{},f&&_(l,f),++u.ref,l.finalize=function(){--this.parent.ref||this.parent.finalize()},Le(l,t,r,a));return l.ref===0&&l.finalize(),f}function Ze(){return $t.id||($t.id=++Ia),++$t.awaits,$t.echoes+=Xi,$t.id}function ke(){return!!$t.awaits&&(--$t.awaits==0&&($t.id=0),$t.echoes=$t.awaits*Xi,!0)}function Hn(t){return $t.echoes&&t&&t.constructor===$e?(Ze(),t.then(function(e){return ke(),e},function(e){return ke(),It(e)})):t}function Aa(){var t=Yn[Yn.length-1];Yn.pop(),Se(t,!1)}function Se(t,e){var r,a,u=H;(e?!$t.echoes||zn++&&t===H:!zn||--zn&&t===H)||queueMicrotask(e?(function(l){++Vn,$t.echoes&&--$t.echoes!=0||($t.echoes=$t.awaits=$t.id=0),Yn.push(H),Se(l,!0)}).bind(null,t):Aa),t!==H&&(H=t,u===we&&(we.env=Ji()),Rr)&&(r=we.env.Promise,a=t.env,u.global||t.global)&&(Object.defineProperty(d,"Promise",a.PromiseProp),r.all=a.all,r.race=a.race,r.resolve=a.resolve,r.reject=a.reject,a.allSettled&&(r.allSettled=a.allSettled),a.any)&&(r.any=a.any)}function Ji(){var t=d.Promise;return Rr?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(d,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function Le(t,e,r,a,u){var l=H;try{return Se(t,!0),e(r,a,u)}finally{Se(l,!1)}}function Zi(t,e,r,a){return typeof t!="function"?t:function(){var u=H;r&&Ze(),Se(e,!0);try{return t.apply(this,arguments)}finally{Se(u,!1),a&&queueMicrotask(ke)}}}function Ur(t){Promise===$e&&$t.echoes===0?zn===0?t():enqueueNativeMicroTask(t):setTimeout(t,0)}(""+on).indexOf("[native code]")===-1&&(Ze=ke=yt);var It=B.reject,Re="ï¿¿",he="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",to="String expected.",tn=[],Xn="__dbnames",Yr="readonly",zr="readwrite";function Ne(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var eo={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Gn(t){return typeof t!="string"||/\./.test(t)?function(e){return e}:function(e){return e[t]===void 0&&t in e&&delete(e=At(e))[t],e}}function no(){throw X.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ct(t,e){try{var r=ro(t),a=ro(e);if(r!==a)return r==="Array"?1:a==="Array"?-1:r==="binary"?1:a==="binary"?-1:r==="string"?1:a==="string"?-1:r==="Date"?1:a!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return e<t?1:t<e?-1:0;case"binary":for(var u=io(t),l=io(e),f=u.length,h=l.length,y=f<h?f:h,x=0;x<y;++x)if(u[x]!==l[x])return u[x]<l[x]?-1:1;return f===h?0:f<h?-1:1;case"Array":for(var b=t,g=e,k=b.length,S=g.length,w=k<S?k:S,v=0;v<w;++v){var T=ct(b[v],g[v]);if(T!==0)return T}return k===S?0:k<S?-1:1}}catch{}return NaN}function ro(t){var e=typeof t;return e=="object"&&(ArrayBuffer.isView(t)||(e=re(t))==="ArrayBuffer")?"binary":e}function io(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}function Qn(t,e,r){var a=t.schema.yProps;return a?(e&&0<r.numFailures&&(e=e.filter(function(u,l){return!r.failures[l]})),Promise.all(a.map(function(u){return u=u.updatesTable,e?t.db.table(u).where("k").anyOf(e).delete():t.db.table(u).clear()})).then(function(){return r})):r}oo.prototype.execute=function(t){var e=this["@@propmod"];if(e.add!==void 0){var r=e.add;if(m(r))return c(c([],m(t)?t:[],!0),r).sort();if(typeof r=="number")return(Number(t)||0)+r;if(typeof r=="bigint")try{return BigInt(t)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(e.remove!==void 0){var a=e.remove;if(m(a))return m(t)?t.filter(function(u){return!a.includes(u)}).sort():[];if(typeof a=="number")return Number(t)-a;if(typeof a=="bigint")try{return BigInt(t)-a}catch{return BigInt(0)-a}throw new TypeError("Invalid subtrahend ".concat(a))}return r=(r=e.replacePrefix)==null?void 0:r[0],r&&typeof t=="string"&&t.startsWith(r)?e.replacePrefix[1]+t.substring(r.length):t};var wn=oo;function oo(t){this["@@propmod"]=t}function ao(t,e){for(var r=p(e),a=r.length,u=!1,l=0;l<a;++l){var f=r[l],h=e[f],y=gt(t,f);h instanceof wn?(st(t,f,h.execute(y)),u=!0):y!==h&&(st(t,f,h),u=!0)}return u}bt.prototype._trans=function(t,e,r){var a=this._tx||H.trans,u=this.name,l=ue&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function f(x,b,g){if(g.schema[u])return e(g.idbtrans,g);throw new X.NotFound("Table "+u+" not part of transaction")}var h=Qe();try{var y=a&&a.db._novip===this.db._novip?a===H.trans?a._promise(t,f,r):_e(function(){return a._promise(t,f,r)},{trans:a,transless:H.transless||H}):function x(b,g,k,S){if(b.idbdb&&(b._state.openComplete||H.letThrough||b._vip)){var w=b._createTransaction(g,k,b._dbSchema);try{w.create(),b._state.PR1398_maxLoop=3}catch(v){return v.name===jr.InvalidState&&b.isOpen()&&0<--b._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),b.close({disableAutoOpen:!1}),b.open().then(function(){return x(b,g,k,S)})):It(v)}return w._promise(g,function(v,T){return _e(function(){return H.trans=w,S(v,T,w)})}).then(function(v){if(g==="readwrite")try{w.idbtrans.commit()}catch{}return g==="readonly"?v:w._completion.then(function(){return v})})}if(b._state.openComplete)return It(new X.DatabaseClosed(b._state.dbOpenError));if(!b._state.isBeingOpened){if(!b._state.autoOpen)return It(new X.DatabaseClosed);b.open().catch(yt)}return b._state.dbReadyPromise.then(function(){return x(b,g,k,S)})}(this.db,t,[this.name],f);return l&&(y._consoleTask=l,y=y.catch(function(x){return console.trace(x),It(x)})),y}finally{h&&Je()}},bt.prototype.get=function(t,e){var r=this;return t&&t.constructor===Object?this.where(t).first(e):t==null?It(new X.Type("Invalid argument to Table.get()")):this._trans("readonly",function(a){return r.core.get({trans:a,key:t}).then(function(u){return r.hook.reading.fire(u)})}).then(e)},bt.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(m(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var e=p(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(h){if(h.compound&&e.every(function(x){return 0<=h.keyPath.indexOf(x)})){for(var y=0;y<e.length;++y)if(e.indexOf(h.keyPath[y])===-1)return!1;return!0}return!1}).sort(function(h,y){return h.keyPath.length-y.keyPath.length})[0];if(r&&this.db._maxKey!==Re)return f=r.keyPath.slice(0,e.length),this.where(f).equals(f.map(function(h){return t[h]}));!r&&ue&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(e.join("+"),"]"));var a=this.schema.idxByName;function u(h,y){return ct(h,y)===0}var f=e.reduce(function(b,y){var x=b[0],b=b[1],g=a[y],k=t[y];return[x||g,x||!g?Ne(b,g&&g.multi?function(S){return S=gt(S,y),m(S)&&S.some(function(w){return u(k,w)})}:function(S){return u(k,gt(S,y))}):b]},[null,null]),l=f[0],f=f[1];return l?this.where(l.name).equals(t[l.keyPath]).filter(f):r?this.filter(f):this.where(e).equals("")},bt.prototype.filter=function(t){return this.toCollection().and(t)},bt.prototype.count=function(t){return this.toCollection().count(t)},bt.prototype.offset=function(t){return this.toCollection().offset(t)},bt.prototype.limit=function(t){return this.toCollection().limit(t)},bt.prototype.each=function(t){return this.toCollection().each(t)},bt.prototype.toArray=function(t){return this.toCollection().toArray(t)},bt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},bt.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,m(t)?"[".concat(t.join("+"),"]"):t))},bt.prototype.reverse=function(){return this.toCollection().reverse()},bt.prototype.mapToClass=function(t){for(var e=this.db,r=this.name,a=((this.schema.mappedClass=t).prototype instanceof no&&(t=(f=>{var h=b,y=f;if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function x(){this.constructor=h}function b(){return f!==null&&f.apply(this,arguments)||this}return i(h,y),h.prototype=y===null?Object.create(y):(x.prototype=y.prototype,new x),Object.defineProperty(b.prototype,"db",{get:function(){return e},enumerable:!1,configurable:!0}),b.prototype.table=function(){return r},b})(t)),new Set),u=t.prototype;u;u=E(u))Object.getOwnPropertyNames(u).forEach(function(f){return a.add(f)});function l(f){if(!f)return f;var h,y=Object.create(t.prototype);for(h in f)if(!a.has(h))try{y[h]=f[h]}catch{}return y}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=l,this.hook("reading",l),t},bt.prototype.defineClass=function(){return this.mapToClass(function(t){_(this,t)})},bt.prototype.add=function(t,e){var r=this,a=this.schema.primKey,u=a.auto,l=a.keyPath,f=t;return l&&u&&(f=Gn(l)(t)),this._trans("readwrite",function(h){return r.core.mutate({trans:h,type:"add",keys:e!=null?[e]:null,values:[f]})}).then(function(h){return h.numFailures?B.reject(h.failures[0]):h.lastResult}).then(function(h){if(l)try{st(t,l,h)}catch{}return h})},bt.prototype.upsert=function(t,e){var r=this,a=this.schema.primKey.keyPath;return this._trans("readwrite",function(u){return r.core.get({trans:u,key:t}).then(function(l){var f=l??{};return ao(f,e),a&&st(f,a,t),r.core.mutate({trans:u,type:"put",values:[f],keys:[t],upsert:!0,updates:{keys:[t],changeSpecs:[e]}}).then(function(h){return h.numFailures?B.reject(h.failures[0]):!!l})})})},bt.prototype.update=function(t,e){return typeof t!="object"||m(t)?this.where(":id").equals(t).modify(e):(t=gt(t,this.schema.primKey.keyPath))===void 0?It(new X.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(e)},bt.prototype.put=function(t,e){var r=this,a=this.schema.primKey,u=a.auto,l=a.keyPath,f=t;return l&&u&&(f=Gn(l)(t)),this._trans("readwrite",function(h){return r.core.mutate({trans:h,type:"put",values:[f],keys:e!=null?[e]:null})}).then(function(h){return h.numFailures?B.reject(h.failures[0]):h.lastResult}).then(function(h){if(l)try{st(t,l,h)}catch{}return h})},bt.prototype.delete=function(t){var e=this;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"delete",keys:[t]}).then(function(a){return Qn(e,[t],a)}).then(function(a){return a.numFailures?B.reject(a.failures[0]):void 0})})},bt.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:eo}).then(function(r){return Qn(t,null,r)})}).then(function(e){return e.numFailures?B.reject(e.failures[0]):void 0})},bt.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",function(r){return e.core.getMany({keys:t,trans:r}).then(function(a){return a.map(function(u){return e.hook.reading.fire(u)})})})},bt.prototype.bulkAdd=function(t,e,r){var a=this,u=Array.isArray(e)?e:void 0,l=(r=r||(u?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",function(f){var h=a.schema.primKey,x=h.auto,h=h.keyPath;if(h&&u)throw new X.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(u&&u.length!==t.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var y=t.length,x=h&&x?t.map(Gn(h)):t;return a.core.mutate({trans:f,type:"add",keys:u,values:x,wantResults:l}).then(function(b){var g=b.numFailures,k=b.failures;if(g===0)return l?b.results:b.lastResult;throw new Ge("".concat(a.name,".bulkAdd(): ").concat(g," of ").concat(y," operations failed"),k)})})},bt.prototype.bulkPut=function(t,e,r){var a=this,u=Array.isArray(e)?e:void 0,l=(r=r||(u?void 0:e))?r.allKeys:void 0;return this._trans("readwrite",function(f){var h=a.schema.primKey,x=h.auto,h=h.keyPath;if(h&&u)throw new X.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(u&&u.length!==t.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var y=t.length,x=h&&x?t.map(Gn(h)):t;return a.core.mutate({trans:f,type:"put",keys:u,values:x,wantResults:l}).then(function(b){var g=b.numFailures,k=b.failures;if(g===0)return l?b.results:b.lastResult;throw new Ge("".concat(a.name,".bulkPut(): ").concat(g," of ").concat(y," operations failed"),k)})})},bt.prototype.bulkUpdate=function(t){var e=this,r=this.core,a=t.map(function(f){return f.key}),u=t.map(function(f){return f.changes}),l=[];return this._trans("readwrite",function(f){return r.getMany({trans:f,keys:a,cache:"clone"}).then(function(h){var y=[],x=[],b=(t.forEach(function(g,k){var S=g.key,w=g.changes,v=h[k];if(v){for(var T=0,I=Object.keys(w);T<I.length;T++){var D=I[T],P=w[D];if(D===e.schema.primKey.keyPath){if(ct(P,S)!==0)throw new X.Constraint("Cannot update primary key in bulkUpdate()")}else st(v,D,P)}l.push(k),y.push(S),x.push(v)}}),y.length);return r.mutate({trans:f,type:"put",keys:y,values:x,updates:{keys:a,changeSpecs:u}}).then(function(g){var k=g.numFailures,S=g.failures;if(k===0)return b;for(var w=0,v=Object.keys(S);w<v.length;w++){var T,I=v[w],D=l[Number(I)];D!=null&&(T=S[I],delete S[I],S[D]=T)}throw new Ge("".concat(e.name,".bulkUpdate(): ").concat(k," of ").concat(b," operations failed"),S)})})})},bt.prototype.bulkDelete=function(t){var e=this,r=t.length;return this._trans("readwrite",function(a){return e.core.mutate({trans:a,type:"delete",keys:t}).then(function(u){return Qn(e,t,u)})}).then(function(a){var u=a.numFailures,l=a.failures;if(u===0)return a.lastResult;throw new Ge("".concat(e.name,".bulkDelete(): ").concat(u," of ").concat(r," operations failed"),l)})};var so=bt;function bt(){}function _n(t){function e(f,h){if(h){for(var y=arguments.length,x=new Array(y-1);--y;)x[y-1]=arguments[y];return r[f].subscribe.apply(null,x),t}if(typeof f=="string")return r[f]}var r={};e.addEventType=l;for(var a=1,u=arguments.length;a<u;++a)l(arguments[a]);return e;function l(f,h,y){var x,b;if(typeof f!="object")return h=h||Da,b={subscribers:[],fire:y=y||yt,subscribe:function(g){b.subscribers.indexOf(g)===-1&&(b.subscribers.push(g),b.fire=h(b.fire,g))},unsubscribe:function(g){b.subscribers=b.subscribers.filter(function(k){return k!==g}),b.fire=b.subscribers.reduce(h,y)}},r[f]=e[f]=b;p(x=f).forEach(function(g){var k=x[g];if(m(k))l(g,x[g][0],x[g][1]);else{if(k!=="asap")throw new X.InvalidArgument("Invalid event config");var S=l(g,mn,function(){for(var w=arguments.length,v=new Array(w);w--;)v[w]=arguments[w];S.subscribers.forEach(function(T){lt(function(){T.apply(null,v)})})})}})}}function kn(t,e){return Y(e).from({prototype:t}),e}function en(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Vr(t,e){t.filter=Ne(t.filter,e)}function Hr(t,e,r){var a=t.replayFilter;t.replayFilter=a?function(){return Ne(a(),e())}:e,t.justLimit=r&&!a}function Jn(t,e){if(t.isPrimKey)return e.primaryKey;var r=e.getIndexByKeyPath(t.index);if(r)return r;throw new X.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed")}function uo(t,e,r){var a=Jn(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:a,range:t.range}})}function Zn(t,e,r,a){var u,l,f=t.replayFilter?Ne(t.filter,t.replayFilter()):t.filter;return t.or?(u={},l=function(h,y,x){var b,g;f&&!f(y,x,function(k){return y.stop(k)},function(k){return y.fail(k)})||((g=""+(b=y.primaryKey))=="[object ArrayBuffer]"&&(g=""+new Uint8Array(b)),A(u,g))||(u[g]=!0,e(h,y,x))},Promise.all([t.or._iterate(l,r),lo(uo(t,a,r),t.algorithm,l,!t.keysOnly&&t.valueMapper)])):lo(uo(t,a,r),Ne(t.algorithm,f),e,!t.keysOnly&&t.valueMapper)}function lo(t,e,r,a){var u=wt(a?function(l,f,h){return r(a(l),f,h)}:r);return t.then(function(l){if(l)return l.start(function(){var f=function(){return l.continue()};e&&!e(l,function(h){return f=h},function(h){l.stop(h),f=yt},function(h){l.fail(h),f=yt})||u(l.value,l,function(h){return f=h}),f()})})}ht.prototype._read=function(t,e){var r=this._ctx;return r.error?r.table._trans(null,It.bind(null,r.error)):r.table._trans("readonly",t).then(e)},ht.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,It.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},ht.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Ne(e.algorithm,t)},ht.prototype._iterate=function(t,e){return Zn(this._ctx,t,e,this._ctx.table.core)},ht.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&_(r,t),e._ctx=r,e},ht.prototype.raw=function(){return this._ctx.valueMapper=null,this},ht.prototype.each=function(t){var e=this._ctx;return this._read(function(r){return Zn(e,t,r,e.table.core)})},ht.prototype.count=function(t){var e=this;return this._read(function(r){var a,u=e._ctx,l=u.table.core;return en(u,!0)?l.count({trans:r,query:{index:Jn(u,l.schema),range:u.range}}).then(function(f){return Math.min(f,u.limit)}):(a=0,Zn(u,function(){return++a,!1},r,l).then(function(){return a}))}).then(t)},ht.prototype.sortBy=function(t,e){var r=t.split(".").reverse(),a=r[0],u=r.length-1;function l(y,x){return x?l(y[r[x]],x-1):y[a]}var f=this._ctx.dir==="next"?1:-1;function h(y,x){return ct(l(y,u),l(x,u))*f}return this.toArray(function(y){return y.sort(h)}).then(e)},ht.prototype.toArray=function(t){var e=this;return this._read(function(r){var a,u,l,f=e._ctx;return f.dir==="next"&&en(f,!0)&&0<f.limit?(a=f.valueMapper,u=Jn(f,f.table.core.schema),f.table.core.query({trans:r,limit:f.limit,values:!0,query:{index:u,range:f.range}}).then(function(h){return h=h.result,a?h.map(a):h})):(l=[],Zn(f,function(h){return l.push(h)},r,f.table.core).then(function(){return l}))},t)},ht.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,en(e)?Hr(e,function(){var r=t;return function(a,u){return r===0||(r===1?--r:u(function(){a.advance(r),r=0}),!1)}}):Hr(e,function(){var r=t;return function(){return--r<0}})),this},ht.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Hr(this._ctx,function(){var e=t;return function(r,a,u){return--e<=0&&a(u),0<=e}},!0),this},ht.prototype.until=function(t,e){return Vr(this._ctx,function(r,a,u){return!t(r.value)||(a(u),e)}),this},ht.prototype.first=function(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)},ht.prototype.last=function(t){return this.reverse().first(t)},ht.prototype.filter=function(t){var e;return Vr(this._ctx,function(r){return t(r.value)}),(e=this._ctx).isMatch=Ne(e.isMatch,t),this},ht.prototype.and=function(t){return this.filter(t)},ht.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},ht.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ht.prototype.desc=function(){return this.reverse()},ht.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(r,a){t(a.key,a)})},ht.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},ht.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(r,a){t(a.primaryKey,a)})},ht.prototype.keys=function(t){var e=this._ctx,r=(e.keysOnly=!e.isMatch,[]);return this.each(function(a,u){r.push(u.key)}).then(function(){return r}).then(t)},ht.prototype.primaryKeys=function(t){var e=this._ctx;if(e.dir==="next"&&en(e,!0)&&0<e.limit)return this._read(function(a){var u=Jn(e,e.table.core.schema);return e.table.core.query({trans:a,values:!1,limit:e.limit,query:{index:u,range:e.range}})}).then(function(a){return a.result}).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each(function(a,u){r.push(u.primaryKey)}).then(function(){return r}).then(t)},ht.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},ht.prototype.firstKey=function(t){return this.limit(1).keys(function(e){return e[0]}).then(t)},ht.prototype.lastKey=function(t){return this.reverse().firstKey(t)},ht.prototype.distinct=function(){var t,e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];return e&&e.multi&&(t={},Vr(this._ctx,function(a){var a=a.primaryKey.toString(),u=A(t,a);return t[a]=!0,!u})),this},ht.prototype.modify=function(t){var e=this,r=this._ctx;return this._write(function(a){function u(v,T){var I=T.failures;k+=v-T.numFailures;for(var D=0,P=p(I);D<P.length;D++){var C=P[D];g.push(I[C])}}var l=typeof t=="function"?t:function(v){return ao(v,t)},f=r.table.core,b=f.schema.primaryKey,h=b.outbound,y=b.extractKey,x=200,b=e.db._options.modifyChunkSize,g=(b&&(x=typeof b=="object"?b[f.name]||b["*"]||200:b),[]),k=0,S=[],w=t===co;return e.clone().primaryKeys().then(function(v){function T(D){var P=Math.min(x,v.length-D),C=v.slice(D,D+P);return(w?Promise.resolve([]):f.getMany({trans:a,keys:C,cache:"immutable"})).then(function(L){var R=[],$=[],W=h?[]:null,q=w?C:[];if(!w)for(var M=0;M<P;++M){var U=L[M],ft={value:At(U),primKey:v[D+M]};l.call(ft,ft.value,ft)!==!1&&(ft.value==null?q.push(v[D+M]):h||ct(y(U),y(ft.value))===0?($.push(ft.value),h&&W.push(v[D+M])):(q.push(v[D+M]),R.push(ft.value)))}return Promise.resolve(0<R.length&&f.mutate({trans:a,type:"add",values:R}).then(function(mt){for(var J in mt.failures)q.splice(parseInt(J),1);u(R.length,mt)})).then(function(){return(0<$.length||I&&typeof t=="object")&&f.mutate({trans:a,type:"put",keys:W,values:$,criteria:I,changeSpec:typeof t!="function"&&t,isAdditionalChunk:0<D}).then(function(mt){return u($.length,mt)})}).then(function(){return(0<q.length||I&&w)&&f.mutate({trans:a,type:"delete",keys:q,criteria:I,isAdditionalChunk:0<D}).then(function(mt){return Qn(r.table,q,mt)}).then(function(mt){return u(q.length,mt)})}).then(function(){return v.length>D+P&&T(D+x)})})}var I=en(r)&&r.limit===1/0&&(typeof t!="function"||w)&&{index:r.index,range:r.range};return T(0).then(function(){if(0<g.length)throw new Kn("Error modifying one or more objects",g,k,S);return v.length})})})},ht.prototype.delete=function(){var t=this._ctx,e=t.range;return!en(t)||t.table.schema.yProps||!t.isPrimKey&&e.type!==3?this.modify(co):this._write(function(r){var a=t.table.core.schema.primaryKey,u=e;return t.table.core.count({trans:r,query:{index:a,range:u}}).then(function(l){return t.table.core.mutate({trans:r,type:"deleteRange",range:u}).then(function(y){var h=y.failures,y=y.numFailures;if(y)throw new Kn("Could not delete some values",Object.keys(h).map(function(x){return h[x]}),l-y);return l-y})})})};var Pa=ht;function ht(){}var co=function(t,e){return e.value=null};function Ca(t,e){return t<e?-1:t===e?0:1}function $a(t,e){return e<t?-1:t===e?0:1}function Gt(t,e,r){return t=t instanceof po?new t.Collection(t):t,t._ctx.error=new(r||TypeError)(e),t}function nn(t){return new t.Collection(t,function(){return fo("")}).limit(0)}function tr(S,e,r,a){var u,l,f,h,y,x,b,g=r.length;if(!r.every(function(v){return typeof v=="string"}))return Gt(S,to);function k(v){u=v==="next"?function(I){return I.toUpperCase()}:function(I){return I.toLowerCase()},l=v==="next"?function(I){return I.toLowerCase()}:function(I){return I.toUpperCase()},f=v==="next"?Ca:$a;var T=r.map(function(I){return{lower:l(I),upper:u(I)}}).sort(function(I,D){return f(I.lower,D.lower)});h=T.map(function(I){return I.upper}),y=T.map(function(I){return I.lower}),b=(x=v)==="next"?"":a}k("next");var S=new S.Collection(S,function(){return Ee(h[0],y[g-1]+a)}),w=(S._ondirectionchange=function(v){k(v)},0);return S._addAlgorithm(function(v,T,I){var D=v.key;if(typeof D=="string"){var P=l(D);if(e(P,y,w))return!0;for(var C=null,L=w;L<g;++L){var R=(($,W,q,M,U,ft)=>{for(var mt=Math.min($.length,M.length),J=-1,at=0;at<mt;++at){var kt=W[at];if(kt!==M[at])return U($[at],q[at])<0?$.substr(0,at)+q[at]+q.substr(at+1):U($[at],M[at])<0?$.substr(0,at)+M[at]+q.substr(at+1):0<=J?$.substr(0,J)+W[J]+q.substr(J+1):null;U($[at],kt)<0&&(J=at)}return mt<M.length&&ft==="next"?$+q.substr($.length):mt<$.length&&ft==="prev"?$.substr(0,q.length):J<0?null:$.substr(0,J)+M[J]+q.substr(J+1)})(D,P,h[L],y[L],f,x);R===null&&C===null?w=L+1:(C===null||0<f(C,R))&&(C=R)}T(C!==null?function(){v.continue(C+b)}:I)}return!1}),S}function Ee(t,e,r,a){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:a}}function fo(t){return{type:1,lower:t,upper:t}}Object.defineProperty(Mt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Mt.prototype.between=function(t,e,r,a){r=r!==!1,a=a===!0;try{return 0<this._cmp(t,e)||this._cmp(t,e)===0&&(r||a)&&(!r||!a)?nn(this):new this.Collection(this,function(){return Ee(t,e,!r,!a)})}catch{return Gt(this,he)}},Mt.prototype.equals=function(t){return t==null?Gt(this,he):new this.Collection(this,function(){return fo(t)})},Mt.prototype.above=function(t){return t==null?Gt(this,he):new this.Collection(this,function(){return Ee(t,void 0,!0)})},Mt.prototype.aboveOrEqual=function(t){return t==null?Gt(this,he):new this.Collection(this,function(){return Ee(t,void 0,!1)})},Mt.prototype.below=function(t){return t==null?Gt(this,he):new this.Collection(this,function(){return Ee(void 0,t,!1,!0)})},Mt.prototype.belowOrEqual=function(t){return t==null?Gt(this,he):new this.Collection(this,function(){return Ee(void 0,t)})},Mt.prototype.startsWith=function(t){return typeof t!="string"?Gt(this,to):this.between(t,t+Re,!0,!0)},Mt.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):tr(this,function(e,r){return e.indexOf(r[0])===0},[t],Re)},Mt.prototype.equalsIgnoreCase=function(t){return tr(this,function(e,r){return e===r[0]},[t],"")},Mt.prototype.anyOfIgnoreCase=function(){var t=se.apply(be,arguments);return t.length===0?nn(this):tr(this,function(e,r){return r.indexOf(e)!==-1},t,"")},Mt.prototype.startsWithAnyOfIgnoreCase=function(){var t=se.apply(be,arguments);return t.length===0?nn(this):tr(this,function(e,r){return r.some(function(a){return e.indexOf(a)===0})},t,Re)},Mt.prototype.anyOf=function(){var t,e,r=this,a=se.apply(be,arguments),u=this._cmp;try{a.sort(u)}catch{return Gt(this,he)}return a.length===0?nn(this):((t=new this.Collection(this,function(){return Ee(a[0],a[a.length-1])}))._ondirectionchange=function(l){u=l==="next"?r._ascending:r._descending,a.sort(u)},e=0,t._addAlgorithm(function(l,f,h){for(var y=l.key;0<u(y,a[e]);)if(++e===a.length)return f(h),!1;return u(y,a[e])===0||(f(function(){l.continue(a[e])}),!1)}),t)},Mt.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Mt.prototype.noneOf=function(){var t=se.apply(be,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return Gt(this,he)}var e=t.reduce(function(r,a){return r?r.concat([[r[r.length-1][1],a]]):[[-1/0,a]]},null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},Mt.prototype.inAnyRange=function(t,I){var r=this,a=this._cmp,u=this._ascending,l=this._descending,f=this._min,h=this._max;if(t.length===0)return nn(this);if(!t.every(function(D){return D[0]!==void 0&&D[1]!==void 0&&u(D[0],D[1])<=0}))return Gt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",X.InvalidArgument);var y=!I||I.includeLowers!==!1,x=I&&I.includeUppers===!0,b,g=u;function k(D,P){return g(D[0],P[0])}try{(b=t.reduce(function(D,P){for(var C=0,L=D.length;C<L;++C){var R=D[C];if(a(P[0],R[1])<0&&0<a(P[1],R[0])){R[0]=f(R[0],P[0]),R[1]=h(R[1],P[1]);break}}return C===L&&D.push(P),D},[])).sort(k)}catch{return Gt(this,he)}var S=0,w=x?function(D){return 0<u(D,b[S][1])}:function(D){return 0<=u(D,b[S][1])},v=y?function(D){return 0<l(D,b[S][0])}:function(D){return 0<=l(D,b[S][0])},T=w,I=new this.Collection(this,function(){return Ee(b[0][0],b[b.length-1][1],!y,!x)});return I._ondirectionchange=function(D){g=D==="next"?(T=w,u):(T=v,l),b.sort(k)},I._addAlgorithm(function(D,P,C){for(var L,R=D.key;T(R);)if(++S===b.length)return P(C),!1;return!w(L=R)&&!v(L)||(r._cmp(R,b[S][1])===0||r._cmp(R,b[S][0])===0||P(function(){g===u?D.continue(b[S][0]):D.continue(b[S][1])}),!1)}),I},Mt.prototype.startsWithAnyOf=function(){var t=se.apply(be,arguments);return t.every(function(e){return typeof e=="string"})?t.length===0?nn(this):this.inAnyRange(t.map(function(e){return[e,e+Re]})):Gt(this,"startsWithAnyOf() only works with strings")};var po=Mt;function Mt(){}function le(t){return wt(function(e){return Sn(e),t(e.target.error),!1})}function Sn(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var En="storagemutated",Xr="x-storagemutated-1",De=_n(null,En),Ma=(ce.prototype._lock=function(){return V(!H.global),++this._reculock,this._reculock!==1||H.global||(H.lockOwnerFor=this),this},ce.prototype._unlock=function(){if(V(!H.global),--this._reculock==0)for(H.global||(H.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{Le(t[1],t[0])}catch{}}return this},ce.prototype._locked=function(){return this._reculock&&H.lockOwnerFor!==this},ce.prototype.create=function(t){var e=this;if(this.mode){var r=this.db.idbdb,a=this.db._state.dbOpenError;if(V(!this.idbtrans),!t&&!r)switch(a&&a.name){case"DatabaseClosedError":throw new X.DatabaseClosed(a);case"MissingAPIError":throw new X.MissingAPI(a.message,a);default:throw new X.OpenFailed(a)}if(!this.active)throw new X.TransactionInactive;V(this._completion._state===null),(t=this.idbtrans=t||(this.db.core||r).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=wt(function(u){Sn(u),e._reject(t.error)}),t.onabort=wt(function(u){Sn(u),e.active&&e._reject(new X.Abort(t.error)),e.active=!1,e.on("abort").fire(u)}),t.oncomplete=wt(function(){e.active=!1,e._resolve(),"mutatedParts"in t&&De.storagemutated.fire(t.mutatedParts)})}return this},ce.prototype._promise=function(t,e,r){var a,u=this;return t==="readwrite"&&this.mode!=="readwrite"?It(new X.ReadOnly("Transaction is readonly")):this.active?this._locked()?new B(function(l,f){u._blockedFuncs.push([function(){u._promise(t,e,r).then(l,f)},H])}):r?_e(function(){var l=new B(function(f,h){u._lock();var y=e(f,h,u);y&&y.then&&y.then(f,h)});return l.finally(function(){return u._unlock()}),l._lib=!0,l}):((a=new B(function(l,f){var h=e(l,f,u);h&&h.then&&h.then(l,f)}))._lib=!0,a):It(new X.TransactionInactive)},ce.prototype._root=function(){return this.parent?this.parent._root():this},ce.prototype.waitFor=function(t){var e,r=this._root(),a=B.resolve(t),u=(r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return a}):(r._waitingFor=a,r._waitingQueue=[],e=r.idbtrans.objectStore(r.storeNames[0]),function l(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(e.get(-1/0).onsuccess=l)}()),r._waitingFor);return new B(function(l,f){a.then(function(h){return r._waitingQueue.push(wt(l.bind(null,h)))},function(h){return r._waitingQueue.push(wt(f.bind(null,h)))}).finally(function(){r._waitingFor===u&&(r._waitingFor=null)})})},ce.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new X.Abort))},ce.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(A(e,t))return e[t];var r=this.schema[t];if(r)return(r=new this.db.Table(t,r,this)).core=this.db.core.table(t),e[t]=r;throw new X.NotFound("Table "+t+" not part of transaction")},ce);function ce(){}function Gr(t,e,r,a,u,l,f,h){return{name:t,keyPath:e,unique:r,multi:a,auto:u,compound:l,src:(r&&!f?"&":"")+(a?"*":"")+(u?"++":"")+ho(e),type:h}}function ho(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Qr(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:(a=function(u){return[u.name,u]},r.reduce(function(u,l,f){return l=a(l,f),l&&(u[l[0]]=l[1]),u},{}))};var a}var Dn=function(t){try{return t.only([[]]),Dn=function(){return[[]]},[[]]}catch{return Dn=function(){return Re},Re}};function Jr(t){return t==null?function(){}:typeof t=="string"?(e=t).split(".").length===1?function(r){return r[e]}:function(r){return gt(r,e)}:function(r){return gt(r,t)};var e}function mo(t){return[].slice.call(t)}var ja=0;function xn(t){return t==null?":id":typeof t=="string"?t:"[".concat(t.join("+"),"]")}function La(t,e,y){function a(w){if(w.type===3)return null;if(w.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var g=w.lower,k=w.upper,S=w.lowerOpen,w=w.upperOpen;return g===void 0?k===void 0?null:e.upperBound(k,!!w):k===void 0?e.lowerBound(g,!!S):e.bound(g,k,!!S,!!w)}function u(b){var g,k=b.name;return{name:k,schema:b,mutate:function(S){var w=S.trans,v=S.type,T=S.keys,I=S.values,D=S.range;return new Promise(function(P,C){P=wt(P);var L=w.objectStore(k),R=L.keyPath==null,$=v==="put"||v==="add";if(!$&&v!=="delete"&&v!=="deleteRange")throw new Error("Invalid operation type: "+v);var W,q=(T||I||{length:1}).length;if(T&&I&&T.length!==I.length)throw new Error("Given keys array must have same length as given values array.");if(q===0)return P({numFailures:0,failures:{},results:[],lastResult:void 0});function M(xt){++mt,Sn(xt)}var U=[],ft=[],mt=0;if(v==="deleteRange"){if(D.type===4)return P({numFailures:mt,failures:ft,results:[],lastResult:void 0});D.type===3?U.push(W=L.clear()):U.push(W=L.delete(a(D)))}else{var R=$?R?[I,T]:[I,null]:[T,null],J=R[0],at=R[1];if($)for(var kt=0;kt<q;++kt)U.push(W=at&&at[kt]!==void 0?L[v](J[kt],at[kt]):L[v](J[kt])),W.onerror=M;else for(kt=0;kt<q;++kt)U.push(W=L[v](J[kt])),W.onerror=M}function Zt(xt){xt=xt.target.result,U.forEach(function(qe,gi){return qe.error!=null&&(ft[gi]=qe.error)}),P({numFailures:mt,failures:ft,results:v==="delete"?T:U.map(function(qe){return qe.result}),lastResult:xt})}W.onerror=function(xt){M(xt),Zt(xt)},W.onsuccess=Zt})},getMany:function(S){var w=S.trans,v=S.keys;return new Promise(function(T,I){T=wt(T);for(var D,P=w.objectStore(k),C=v.length,L=new Array(C),R=0,$=0,W=function(U){U=U.target,L[U._pos]=U.result,++$===R&&T(L)},q=le(I),M=0;M<C;++M)v[M]!=null&&((D=P.get(v[M]))._pos=M,D.onsuccess=W,D.onerror=q,++R);R===0&&T(L)})},get:function(S){var w=S.trans,v=S.key;return new Promise(function(T,I){T=wt(T);var D=w.objectStore(k).get(v);D.onsuccess=function(P){return T(P.target.result)},D.onerror=le(I)})},query:(g=h,function(S){return new Promise(function(w,v){w=wt(w);var T,I,D,$=S.trans,P=S.values,C=S.limit,R=S.query,L=C===1/0?void 0:C,W=R.index,R=R.range,$=$.objectStore(k),$=W.isPrimaryKey?$:$.index(W.name),W=a(R);if(C===0)return w({result:[]});g?((R=P?$.getAll(W,L):$.getAllKeys(W,L)).onsuccess=function(q){return w({result:q.target.result})},R.onerror=le(v)):(T=0,I=!P&&"openKeyCursor"in $?$.openKeyCursor(W):$.openCursor(W),D=[],I.onsuccess=function(q){var M=I.result;return!M||(D.push(P?M.value:M.primaryKey),++T===C)?w({result:D}):void M.continue()},I.onerror=le(v))})}),openCursor:function(S){var w=S.trans,v=S.values,T=S.query,I=S.reverse,D=S.unique;return new Promise(function(P,C){P=wt(P);var $=T.index,L=T.range,R=w.objectStore(k),R=$.isPrimaryKey?R:R.index($.name),$=I?D?"prevunique":"prev":D?"nextunique":"next",W=!v&&"openKeyCursor"in R?R.openKeyCursor(a(L),$):R.openCursor(a(L),$);W.onerror=le(C),W.onsuccess=wt(function(q){var M,U,ft,mt,J=W.result;J?(J.___id=++ja,J.done=!1,M=J.continue.bind(J),U=(U=J.continuePrimaryKey)&&U.bind(J),ft=J.advance.bind(J),mt=function(){throw new Error("Cursor not stopped")},J.trans=w,J.stop=J.continue=J.continuePrimaryKey=J.advance=function(){throw new Error("Cursor not started")},J.fail=wt(C),J.next=function(){var at=this,kt=1;return this.start(function(){return kt--?at.continue():at.stop()}).then(function(){return at})},J.start=function(at){function kt(){if(W.result)try{at()}catch(xt){J.fail(xt)}else J.done=!0,J.start=function(){throw new Error("Cursor behind last entry")},J.stop()}var Zt=new Promise(function(xt,qe){xt=wt(xt),W.onerror=le(qe),J.fail=qe,J.stop=function(gi){J.stop=J.continue=J.continuePrimaryKey=J.advance=mt,xt(gi)}});return W.onsuccess=wt(function(xt){W.onsuccess=kt,kt()}),J.continue=M,J.continuePrimaryKey=U,J.advance=ft,kt(),Zt},P(J)):P(null)},C)})},count:function(S){var w=S.query,v=S.trans,T=w.index,I=w.range;return new Promise(function(D,P){var C=v.objectStore(k),C=T.isPrimaryKey?C:C.index(T.name),L=a(I),L=L?C.count(L):C.count();L.onsuccess=wt(function(R){return D(R.target.result)}),L.onerror=le(P)})}}}l=y,f=mo((y=t).objectStoreNames);var l,y={schema:{name:y.name,tables:f.map(function(b){return l.objectStore(b)}).map(function(b){var g=b.keyPath,k=b.autoIncrement,w=m(g),S={},w={name:b.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g==null,compound:w,keyPath:g,autoIncrement:k,unique:!0,extractKey:Jr(g)},indexes:mo(b.indexNames).map(function(v){return b.index(v)}).map(function(D){var P=D.name,T=D.unique,I=D.multiEntry,D=D.keyPath,P={name:P,compound:m(D),keyPath:D,unique:T,multiEntry:I,extractKey:Jr(D)};return S[xn(D)]=P}),getIndexByKeyPath:function(v){return S[xn(v)]}};return S[":id"]=w.primaryKey,g!=null&&(S[xn(g)]=w.primaryKey),w})},hasGetAll:0<f.length&&"getAll"in l.objectStore(f[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},f=y.schema,h=y.hasGetAll,y=f.tables.map(u),x={};return y.forEach(function(b){return x[b.name]=b}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(b){if(x[b])return x[b];throw new Error("Table '".concat(b,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Dn(e),schema:f}}function Ra(t,e,r,a){return r=r.IDBKeyRange,e=La(e,r,a),{dbcore:t.dbcore.reduce(function(u,l){return l=l.create,s(s({},u),l(u))},e)}}function er(t,e){var r=e.db,r=Ra(t._middlewares,r,t._deps,e);t.core=r.dbcore,t.tables.forEach(function(a){var u=a.name;t.core.schema.tables.some(function(l){return l.name===u})&&(a.core=t.core.table(u),t[u]instanceof t.Table)&&(t[u].core=a.core)})}function nr(t,e,r,a){r.forEach(function(u){var l=a[u];e.forEach(function(f){var h=function y(x,b){return tt(x,b)||(x=E(x))&&y(x,b)}(f,u);(!h||"value"in h&&h.value===void 0)&&(f===t.Transaction.prototype||f instanceof t.Transaction?F(f,u,{get:function(){return this.table(u)},set:function(y){K(this,u,{value:y,writable:!0,configurable:!0,enumerable:!0})}}):f[u]=new t.Table(u,l))})})}function Zr(t,e){e.forEach(function(r){for(var a in r)r[a]instanceof t.Table&&delete r[a]})}function Na(t,e){return t._cfg.version-e._cfg.version}function Ba(t,e,r,a){var u=t._dbSchema,l=(r.objectStoreNames.contains("$meta")&&!u.$meta&&(u.$meta=Qr("$meta",vo("")[0],[]),t._storeNames.push("$meta")),t._createTransaction("readwrite",t._storeNames,u)),f=(l.create(r),l._completion.catch(a),l._reject.bind(l)),h=H.transless||H;_e(function(){if(H.trans=l,H.transless=h,e!==0)return er(t,r),x=e,((y=l).storeNames.includes("$meta")?y.table("$meta").get("version").then(function(b){return b??x}):B.resolve(x)).then(function(T){var g=t,k=T,S=l,w=r,v=[],T=g._versions,I=g._dbSchema=ir(0,g.idbdb,w);return(T=T.filter(function(D){return D._cfg.version>=k})).length===0?B.resolve():(T.forEach(function(D){v.push(function(){var P,C,L,R=I,$=D._cfg.dbschema,W=(or(g,R,w),or(g,$,w),I=g._dbSchema=$,ti(R,$)),q=(W.add.forEach(function(M){ei(w,M[0],M[1].primKey,M[1].indexes)}),W.change.forEach(function(M){if(M.recreate)throw new X.Upgrade("Not yet support for changing primary key");var U=w.objectStore(M.name);M.add.forEach(function(ft){return rr(U,ft)}),M.change.forEach(function(ft){U.deleteIndex(ft.name),rr(U,ft)}),M.del.forEach(function(ft){return U.deleteIndex(ft)})}),D._cfg.contentUpgrade);if(q&&D._cfg.version>k)return er(g,w),S._memoizedTables={},P=ot($),W.del.forEach(function(M){P[M]=R[M]}),Zr(g,[g.Transaction.prototype]),nr(g,[g.Transaction.prototype],p(P),P),S.schema=P,(C=He(q))&&Ze(),$=B.follow(function(){var M;(L=q(S))&&C&&(M=ke.bind(null,null),L.then(M,M))}),L&&typeof L.then=="function"?B.resolve(L):$.then(function(){return L})}),v.push(function(P){var C,L,R=D._cfg.dbschema;C=R,L=P,[].slice.call(L.db.objectStoreNames).forEach(function($){return C[$]==null&&L.db.deleteObjectStore($)}),Zr(g,[g.Transaction.prototype]),nr(g,[g.Transaction.prototype],g._storeNames,g._dbSchema),S.schema=g._dbSchema}),v.push(function(P){g.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(g.idbdb.version/10)===D._cfg.version?(g.idbdb.deleteObjectStore("$meta"),delete g._dbSchema.$meta,g._storeNames=g._storeNames.filter(function(C){return C!=="$meta"})):P.objectStore("$meta").put(D._cfg.version,"version"))})}),function D(){return v.length?B.resolve(v.shift()(S.idbtrans)).then(D):B.resolve()}().then(function(){go(I,w)}))}).catch(f);var y,x;p(u).forEach(function(b){ei(r,b,u[b].primKey,u[b].indexes)}),er(t,r),B.follow(function(){return t.on.populate.fire(l)}).catch(f)})}function Ka(t,e){go(t._dbSchema,e),e.db.version%10!=0||e.objectStoreNames.contains("$meta")||e.db.createObjectStore("$meta").add(Math.ceil(e.db.version/10-1),"version");var r=ir(0,t.idbdb,e);or(t,t._dbSchema,e);for(var a=0,u=ti(r,t._dbSchema).change;a<u.length;a++){var l=(f=>{if(f.change.length||f.recreate)return console.warn("Unable to patch indexes of table ".concat(f.name," because it has changes on the type of index or primary key.")),{value:void 0};var h=e.objectStore(f.name);f.add.forEach(function(y){ue&&console.debug("Dexie upgrade patch: Creating missing index ".concat(f.name,".").concat(y.src)),rr(h,y)})})(u[a]);if(typeof l=="object")return l.value}}function ti(t,e){var r,a={del:[],add:[],change:[]};for(r in t)e[r]||a.del.push(r);for(r in e){var u=t[r],l=e[r];if(u){var f={name:r,def:l,recreate:!1,del:[],add:[],change:[]};if(""+(u.primKey.keyPath||"")!=""+(l.primKey.keyPath||"")||u.primKey.auto!==l.primKey.auto)f.recreate=!0,a.change.push(f);else{var h=u.idxByName,y=l.idxByName,x=void 0;for(x in h)y[x]||f.del.push(x);for(x in y){var b=h[x],g=y[x];b?b.src!==g.src&&f.change.push(g):f.add.push(g)}(0<f.del.length||0<f.add.length||0<f.change.length)&&a.change.push(f)}}else a.add.push([r,l])}return a}function ei(t,e,r,a){var u=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});a.forEach(function(l){return rr(u,l)})}function go(t,e){p(t).forEach(function(r){e.db.objectStoreNames.contains(r)||(ue&&console.debug("Dexie: Creating missing table",r),ei(e,r,t[r].primKey,t[r].indexes))})}function rr(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function ir(t,e,r){var a={};return Q(e.objectStoreNames,0).forEach(function(u){for(var l=r.objectStore(u),f=Gr(ho(x=l.keyPath),x||"",!0,!1,!!l.autoIncrement,x&&typeof x!="string",!0),h=[],y=0;y<l.indexNames.length;++y){var b=l.index(l.indexNames[y]),x=b.keyPath,b=Gr(b.name,x,!!b.unique,!!b.multiEntry,!1,x&&typeof x!="string",!1);h.push(b)}a[u]=Qr(u,f,h)}),a}function or(t,e,r){for(var a=r.db.objectStoreNames,u=0;u<a.length;++u){var l=a[u],f=r.objectStore(l);t._hasGetAll="getAll"in f;for(var h=0;h<f.indexNames.length;++h){var y,x=f.indexNames[h],b=f.index(x).keyPath,b=typeof b=="string"?b:"["+Q(b).join("+")+"]";e[l]&&(y=e[l].idxByName[b])&&(y.name=x,delete e[l].idxByName[b],e[l].idxByName[x]=y)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&d.WorkerGlobalScope&&d instanceof d.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function vo(t){return t.split(",").map(function(e,r){var u=e.split(":"),a=(a=u[1])==null?void 0:a.trim(),u=(e=u[0].trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Gr(u,l||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),m(l),r===0,a)})}rn.prototype._createTableSchema=Qr,rn.prototype._parseIndexSyntax=vo,rn.prototype._parseStoresSpec=function(t,e){var r=this;p(t).forEach(function(a){if(t[a]!==null){var u=r._parseIndexSyntax(t[a]),l=u.shift();if(!l)throw new X.Schema("Invalid schema for table "+a+": "+t[a]);if(l.unique=!0,l.multi)throw new X.Schema("Primary key cannot be multiEntry*");u.forEach(function(f){if(f.auto)throw new X.Schema("Only primary key can be marked as autoIncrement (++)");if(!f.keyPath)throw new X.Schema("Index must have a name and cannot be an empty string")}),l=r._createTableSchema(a,l,u),e[a]=l}})},rn.prototype.stores=function(r){var e=this.db,r=(this._cfg.storesSource=this._cfg.storesSource?_(this._cfg.storesSource,r):r,e._versions),a={},u={};return r.forEach(function(l){_(a,l._cfg.storesSource),u=l._cfg.dbschema={},l._parseStoresSpec(a,u)}),e._dbSchema=u,Zr(e,[e._allTables,e,e.Transaction.prototype]),nr(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],p(u),u),e._storeNames=p(u),this},rn.prototype.upgrade=function(t){return this._cfg.contentUpgrade=Lr(this._cfg.contentUpgrade||yt,t),this};var qa=rn;function rn(){}function ni(t,e){var r=t._dbNamesDB;return r||(r=t._dbNamesDB=new me(Xn,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function ri(t){return t&&typeof t.databases=="function"}function ii(t){return _e(function(){return H.letThrough=!0,t()})}function oi(t){return!("from"in t)}var Rt=function(t,e){var r;if(!this)return r=new Rt,t&&"d"in t&&_(r,t),r;_(this,arguments.length?{d:1,from:t,to:1<arguments.length?e:t}:{d:0})};function Tn(t,e,r){var a=ct(e,r);if(!isNaN(a)){if(0<a)throw RangeError();if(oi(t))return _(t,{from:e,to:r,d:1});var a=t.l,u=t.r;if(ct(r,t.from)<0)return a?Tn(a,e,r):t.l={from:e,to:r,d:1,l:null,r:null},bo(t);if(0<ct(e,t.to))return u?Tn(u,e,r):t.r={from:e,to:r,d:1,l:null,r:null},bo(t);ct(e,t.from)<0&&(t.from=e,t.l=null,t.d=u?u.d+1:1),0<ct(r,t.to)&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1),e=!t.r,a&&!t.l&&In(t,a),u&&e&&In(t,u)}}function In(t,e){oi(e)||function r(a,u){var l=u.from,f=u.l,h=u.r;Tn(a,l,u.to),f&&r(a,f),h&&r(a,h)}(t,e)}function yo(t,e){var r=ar(e),a=r.next();if(!a.done)for(var u=a.value,l=ar(t),f=l.next(u.from),h=f.value;!a.done&&!f.done;){if(ct(h.from,u.to)<=0&&0<=ct(h.to,u.from))return!0;ct(u.from,h.from)<0?u=(a=r.next(h.from)).value:h=(f=l.next(u.from)).value}return!1}function ar(t){var e=oi(t)?null:{s:0,n:t};return{next:function(r){for(var a=0<arguments.length;e;)switch(e.s){case 0:if(e.s=1,a)for(;e.n.l&&ct(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!a||ct(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function bo(t){var e,r,a,u=(((u=t.r)==null?void 0:u.d)||0)-(((u=t.l)==null?void 0:u.d)||0),u=1<u?"r":u<-1?"l":"";u&&(e=u=="r"?"l":"r",r=s({},t),a=t[u],t.from=a.from,t.to=a.to,t[u]=a[u],r[u]=a[e],(t[e]=r).d=wo(r)),t.d=wo(t)}function wo(r){var e=r.r,r=r.l;return(e?r?Math.max(e.d,r.d):e.d:r?r.d:0)+1}function sr(t,e){return p(e).forEach(function(r){t[r]?In(t[r],e[r]):t[r]=function a(u){var l,f,h={};for(l in u)A(u,l)&&(f=u[l],h[l]=!f||typeof f!="object"||Lt.has(f.constructor)?f:a(f));return h}(e[r])}),t}function ai(t,e){return t.all||e.all||Object.keys(t).some(function(r){return e[r]&&yo(e[r],t[r])})}j(Rt.prototype,((Xt={add:function(t){return In(this,t),this},addKey:function(t){return Tn(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(r){return Tn(e,r,r)}),this},hasKey:function(t){var e=ar(this).next(t).value;return e&&ct(e.from,t)<=0&&0<=ct(e.to,t)}})[Wt]=function(){return ar(this)},Xt));var Be={},si={},ui=!1;function ur(t){sr(si,t),ui||(ui=!0,setTimeout(function(){ui=!1,li(si,!(si={}))},0))}function li(t,e){e===void 0&&(e=!1);var r=new Set;if(t.all)for(var a=0,u=Object.values(Be);a<u.length;a++)_o(h=u[a],t,r,e);else for(var l in t){var f,h,l=/^idb\:\/\/(.*)\/(.*)\//.exec(l);l&&(f=l[1],l=l[2],h=Be["idb://".concat(f,"/").concat(l)])&&_o(h,t,r,e)}r.forEach(function(y){return y()})}function _o(t,e,r,a){for(var u=[],l=0,f=Object.entries(t.queries.query);l<f.length;l++){for(var h=f[l],y=h[0],x=[],b=0,g=h[1];b<g.length;b++){var k=g[b];ai(e,k.obsSet)?k.subscribers.forEach(function(T){return r.add(T)}):a&&x.push(k)}a&&u.push([y,x])}if(a)for(var S=0,w=u;S<w.length;S++){var v=w[S],y=v[0],x=v[1];t.queries.query[y]=x}}function Fa(t){var e=t._state,r=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?It(e.dbOpenError):t});e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var a=e.openCanceller,u=Math.round(10*t.verno),l=!1;function f(){if(e.openCanceller!==a)throw new X.DatabaseClosed("db.open() was cancelled")}function h(){return new B(function(k,S){if(f(),!r)throw new X.MissingAPI;var w=t.name,v=e.autoSchema||!u?r.open(w):r.open(w,u);if(!v)throw new X.MissingAPI;v.onerror=le(S),v.onblocked=wt(t._fireOnBlocked),v.onupgradeneeded=wt(function(T){var I;b=v.transaction,e.autoSchema&&!t._options.allowEmptyDB?(v.onerror=Sn,b.abort(),v.result.close(),(I=r.deleteDatabase(w)).onsuccess=I.onerror=wt(function(){S(new X.NoSuchDatabase("Database ".concat(w," doesnt exist")))})):(b.onerror=le(S),I=T.oldVersion>Math.pow(2,62)?0:T.oldVersion,g=I<1,t.idbdb=v.result,l&&Ka(t,b),Ba(t,I/10,b,S))},S),v.onsuccess=wt(function(){b=null;var T,I,D,P,C,L,R=t.idbdb=v.result,$=Q(R.objectStoreNames);if(0<$.length)try{var W=R.transaction((C=$).length===1?C[0]:C,"readonly");if(e.autoSchema)L=R,P=W,(D=t).verno=L.version/10,P=D._dbSchema=ir(0,L,P),D._storeNames=Q(L.objectStoreNames,0),nr(D,[D._allTables],p(P),P);else if(or(t,t._dbSchema,W),I=W,((I=ti(ir(0,(T=t).idbdb,I),T._dbSchema)).add.length||I.change.some(function(q){return q.add.length||q.change.length}))&&!l)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),R.close(),u=R.version+1,l=!0,k(h());er(t,W)}catch{}tn.push(t),R.onversionchange=wt(function(q){e.vcFired=!0,t.on("versionchange").fire(q)}),R.onclose=wt(function(){t.close({disableAutoOpen:!1})}),g&&($=t._deps,C=w,ri(L=$.indexedDB)||C===Xn||ni(L,$.IDBKeyRange).put({name:C}).catch(yt)),k()},S)}).catch(function(k){switch(k==null?void 0:k.name){case"UnknownError":if(0<e.PR1398_maxLoop)return e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),h();break;case"VersionError":if(0<u)return u=0,h()}return B.reject(k)})}var y,x=e.dbReadyResolve,b=null,g=!1;return B.race([a,(typeof navigator>"u"?B.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(k){function S(){return indexedDB.databases().finally(k)}y=setInterval(S,100),S()}).finally(function(){return clearInterval(y)}):Promise.resolve()).then(h)]).then(function(){return f(),e.onReadyBeingFired=[],B.resolve(ii(function(){return t.on.ready.fire(t.vip)})).then(function k(){var S;if(0<e.onReadyBeingFired.length)return S=e.onReadyBeingFired.reduce(Lr,yt),e.onReadyBeingFired=[],B.resolve(ii(function(){return S(t.vip)})).then(k)})}).finally(function(){e.openCanceller===a&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)}).catch(function(k){e.dbOpenError=k;try{b&&b.abort()}catch{}return a===e.openCanceller&&t._close(),It(k)}).finally(function(){e.openComplete=!0,x()}).then(function(){var k;return g&&(k={},t.tables.forEach(function(S){S.schema.indexes.forEach(function(w){w.name&&(k["idb://".concat(t.name,"/").concat(S.name,"/").concat(w.name)]=new Rt(-1/0,[[[]]]))}),k["idb://".concat(t.name,"/").concat(S.name,"/")]=k["idb://".concat(t.name,"/").concat(S.name,"/:dels")]=new Rt(-1/0,[[[]]])}),De(En).fire(k),li(k,!0)),t})}function ci(t){function e(l){return t.next(l)}var r=u(e),a=u(function(l){return t.throw(l)});function u(l){return function(h){var h=l(h),y=h.value;return h.done?y:y&&typeof y.then=="function"?y.then(r,a):m(y)?Promise.all(y).then(r,a):r(y)}}return u(e)()}function lr(t,e,r){for(var a=m(t)?t.slice():[t],u=0;u<r;++u)a.push(e);return a}var Wa={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return s(s({},t),{table:function(a){var r=t.table(a),a=r.schema,u={},l=[];function f(k,S,w){var D=xn(k),v=u[D]=u[D]||[],T=k==null?0:typeof k=="string"?1:k.length,I=0<S,D=s(s({},w),{name:I?"".concat(D,"(virtual-from:").concat(w.name,")"):w.name,lowLevelIndex:w,isVirtual:I,keyTail:S,keyLength:T,extractKey:Jr(k),unique:!I&&w.unique});return v.push(D),D.isPrimaryKey||l.push(D),1<T&&f(T===2?k[0]:k.slice(0,T-1),S+1,w),v.sort(function(P,C){return P.keyTail-C.keyTail}),D}var h=f(a.primaryKey.keyPath,0,a.primaryKey);u[":id"]=[h];for(var y=0,x=a.indexes;y<x.length;y++){var b=x[y];f(b.keyPath,0,b)}function g(k){var S,w=k.query.index;return w.isVirtual?s(s({},k),{query:{index:w.lowLevelIndex,range:(S=k.query.range,w=w.keyTail,{type:S.type===1?2:S.type,lower:lr(S.lower,S.lowerOpen?t.MAX_KEY:t.MIN_KEY,w),lowerOpen:!0,upper:lr(S.upper,S.upperOpen?t.MIN_KEY:t.MAX_KEY,w),upperOpen:!0})}}):k}return s(s({},r),{schema:s(s({},a),{primaryKey:h,indexes:l,getIndexByKeyPath:function(k){return(k=u[xn(k)])&&k[0]}}),count:function(k){return r.count(g(k))},query:function(k){return r.query(g(k))},openCursor:function(k){var S=k.query.index,w=S.keyTail,v=S.keyLength;return S.isVirtual?r.openCursor(g(k)).then(function(I){return I&&T(I)}):r.openCursor(k);function T(I){return Object.create(I,{continue:{value:function(D){D!=null?I.continue(lr(D,k.reverse?t.MAX_KEY:t.MIN_KEY,w)):k.unique?I.continue(I.key.slice(0,v).concat(k.reverse?t.MIN_KEY:t.MAX_KEY,w)):I.continue()}},continuePrimaryKey:{value:function(D,P){I.continuePrimaryKey(lr(D,t.MAX_KEY,w),P)}},primaryKey:{get:function(){return I.primaryKey}},key:{get:function(){var D=I.key;return v===1?D[0]:D.slice(0,v)}},value:{get:function(){return I.value}}})}}})}})}};function di(t,e,r,a){return r=r||{},a=a||"",p(t).forEach(function(u){var l,f,h;A(e,u)?(l=t[u],f=e[u],typeof l=="object"&&typeof f=="object"&&l&&f?(h=re(l))!==re(f)?r[a+u]=e[u]:h==="Object"?di(l,f,r,a+u+"."):l!==f&&(r[a+u]=e[u]):l!==f&&(r[a+u]=e[u])):r[a+u]=void 0}),p(e).forEach(function(u){A(t,u)||(r[a+u]=e[u])}),r}function fi(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Ua={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return s(s({},t),{table:function(e){var r=t.table(e),a=r.schema.primaryKey;return s(s({},r),{mutate:function(u){var l=H.trans,f=l.table(e).hook,h=f.deleting,y=f.creating,x=f.updating;switch(u.type){case"add":if(y.fire===yt)break;return l._promise("readwrite",function(){return b(u)},!0);case"put":if(y.fire===yt&&x.fire===yt)break;return l._promise("readwrite",function(){return b(u)},!0);case"delete":if(h.fire===yt)break;return l._promise("readwrite",function(){return b(u)},!0);case"deleteRange":if(h.fire===yt)break;return l._promise("readwrite",function(){return function g(k,S,w){return r.query({trans:k,values:!1,query:{index:a,range:S},limit:w}).then(function(v){var T=v.result;return b({type:"delete",keys:T,trans:k}).then(function(I){return 0<I.numFailures?Promise.reject(I.failures[0]):T.length<w?{failures:[],numFailures:0,lastResult:void 0}:g(k,s(s({},S),{lower:T[T.length-1],lowerOpen:!0}),w)})})}(u.trans,u.range,1e4)},!0)}return r.mutate(u);function b(g){var k,S,w,v=H.trans,T=g.keys||fi(a,g);if(T)return(g=g.type==="add"||g.type==="put"?s(s({},g),{keys:T}):s({},g)).type!=="delete"&&(g.values=c([],g.values)),g.keys&&(g.keys=c([],g.keys)),k=r,w=T,((S=g).type==="add"?Promise.resolve([]):k.getMany({trans:S.trans,keys:w,cache:"immutable"})).then(function(I){var D=T.map(function(P,C){var L,R,$,W=I[C],q={onerror:null,onsuccess:null};return g.type==="delete"?h.fire.call(q,P,W,v):g.type==="add"||W===void 0?(L=y.fire.call(q,P,g.values[C],v),P==null&&L!=null&&(g.keys[C]=P=L,a.outbound||st(g.values[C],a.keyPath,P))):(L=di(W,g.values[C]),(R=x.fire.call(q,L,P,W,v))&&($=g.values[C],Object.keys(R).forEach(function(M){A($,M)?$[M]=R[M]:st($,M,R[M])}))),q});return r.mutate(g).then(function(P){for(var C=P.failures,L=P.results,R=P.numFailures,P=P.lastResult,$=0;$<T.length;++$){var W=(L||T)[$],q=D[$];W==null?q.onerror&&q.onerror(C[$]):q.onsuccess&&q.onsuccess(g.type==="put"&&I[$]?g.values[$]:W)}return{failures:C,results:L,numFailures:R,lastResult:P}}).catch(function(P){return D.forEach(function(C){return C.onerror&&C.onerror(P)}),Promise.reject(P)})});throw new Error("Keys missing")}}})}})}};function ko(t,e,r){try{if(!e||e.keys.length<t.length)return null;for(var a=[],u=0,l=0;u<e.keys.length&&l<t.length;++u)ct(e.keys[u],t[l])===0&&(a.push(r?At(e.values[u]):e.values[u]),++l);return a.length===t.length?a:null}catch{return null}}var Ya={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var r=t.table(e);return s(s({},r),{getMany:function(a){var u;return a.cache?(u=ko(a.keys,a.trans._cache,a.cache==="clone"))?B.resolve(u):r.getMany(a).then(function(l){return a.trans._cache={keys:a.keys,values:a.cache==="clone"?At(l):l},l}):r.getMany(a)},mutate:function(a){return a.type!=="add"&&(a.trans._cache=null),r.mutate(a)}})}}}};function So(t,e){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!e.schema.primaryKey.outbound}function Eo(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var za={stack:"dbcore",level:0,name:"Observability",create:function(t){var e=t.schema.name,r=new Rt(t.MIN_KEY,t.MAX_KEY);return s(s({},t),{transaction:function(a,u,l){if(H.subscr&&u!=="readonly")throw new X.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(H.querier));return t.transaction(a,u,l)},table:function(a){function u(T){var v,T=T.query;return[v=T.index,new Rt((v=(T=T.range).lower)!=null?v:t.MIN_KEY,(v=T.upper)!=null?v:t.MAX_KEY)]}var l=t.table(a),f=l.schema,h=f.primaryKey,y=f.indexes,x=h.extractKey,b=h.outbound,g=h.autoIncrement&&y.filter(function(w){return w.compound&&w.keyPath.includes(h.keyPath)}),k=s(s({},l),{mutate:function(w){function v(U){return U="idb://".concat(e,"/").concat(a,"/").concat(U),C[U]||(C[U]=new Rt)}var T,I,D,P=w.trans,C=w.mutatedParts||(w.mutatedParts={}),L=v(""),R=v(":dels"),$=w.type,q=w.type==="deleteRange"?[w.range]:w.type==="delete"?[w.keys]:w.values.length<50?[fi(h,w).filter(function(U){return U}),w.values]:[],W=q[0],q=q[1],M=w.trans._cache;return m(W)?(L.addKeys(W),($=$==="delete"||W.length===q.length?ko(W,M):null)||R.addKeys(W),($||q)&&(T=v,I=$,D=q,f.indexes.forEach(function(U){var ft=T(U.name||"");function mt(at){return at!=null?U.extractKey(at):null}function J(at){U.multiEntry&&m(at)?at.forEach(function(kt){return ft.addKey(kt)}):ft.addKey(at)}(I||D).forEach(function(at,xt){var Zt=I&&mt(I[xt]),xt=D&&mt(D[xt]);ct(Zt,xt)!==0&&(Zt!=null&&J(Zt),xt!=null)&&J(xt)})}))):W?(q={from:(M=W.lower)!=null?M:t.MIN_KEY,to:($=W.upper)!=null?$:t.MAX_KEY},R.add(q),L.add(q)):(L.add(r),R.add(r),f.indexes.forEach(function(U){return v(U.name).add(r)})),l.mutate(w).then(function(U){return!W||w.type!=="add"&&w.type!=="put"||(L.addKeys(U.results),g&&g.forEach(function(ft){for(var mt=w.values.map(function(Zt){return ft.extractKey(Zt)}),J=ft.keyPath.findIndex(function(Zt){return Zt===h.keyPath}),at=0,kt=U.results.length;at<kt;++at)mt[at][J]=U.results[at];v(ft.name).addKeys(mt)})),P.mutatedParts=sr(P.mutatedParts||{},C),U})}}),S={get:function(w){return[h,new Rt(w.key)]},getMany:function(w){return[h,new Rt().addKeys(w.keys)]},count:u,query:u,openCursor:u};return p(S).forEach(function(w){k[w]=function(v){var T=H.subscr,I=!!T,D=So(H,l)&&Eo(w,v)?v.obsSet={}:T;if(I){var P,T=function(q){return q="idb://".concat(e,"/").concat(a,"/").concat(q),D[q]||(D[q]=new Rt)},C=T(""),L=T(":dels"),I=S[w](v),R=I[0],I=I[1];if((w==="query"&&R.isPrimaryKey&&!v.values?L:T(R.name||"")).add(I),!R.isPrimaryKey){if(w!=="count")return P=w==="query"&&b&&v.values&&l.query(s(s({},v),{values:!1})),l[w].apply(this,arguments).then(function(q){if(w==="query"){if(b&&v.values)return P.then(function(mt){return mt=mt.result,C.addKeys(mt),q});var M=v.values?q.result.map(x):q.result;(v.values?C:L).addKeys(M)}else{var U,ft;if(w==="openCursor")return ft=v.values,(U=q)&&Object.create(U,{key:{get:function(){return L.addKey(U.primaryKey),U.key}},primaryKey:{get:function(){var mt=U.primaryKey;return L.addKey(mt),mt}},value:{get:function(){return ft&&C.addKey(U.primaryKey),U.value}}})}return q});L.add(r)}}return l[w].apply(this,arguments)}}),k}})}};function Do(t,e,r){var a;return r.numFailures===0?e:e.type==="deleteRange"||(a=e.keys?e.keys.length:"values"in e&&e.values?e.values.length:1,r.numFailures===a)?null:(a=s({},e),m(a.keys)&&(a.keys=a.keys.filter(function(u,l){return!(l in r.failures)})),"values"in a&&m(a.values)&&(a.values=a.values.filter(function(u,l){return!(l in r.failures)})),a)}function pi(t,e){return r=t,((a=e).lower===void 0||(a.lowerOpen?0<ct(r,a.lower):0<=ct(r,a.lower)))&&(r=t,(a=e).upper===void 0||(a.upperOpen?ct(r,a.upper)<0:ct(r,a.upper)<=0));var r,a}function xo(t,e,r,a,u,l){var f,h,y,x,b,g;return!r||r.length===0||(f=e.query.index,h=f.multiEntry,y=e.query.range,x=a.schema.primaryKey.extractKey,b=f.extractKey,g=(f.lowLevelIndex||f).extractKey,(a=r.reduce(function(k,S){var w=k,v=[];if(S.type==="add"||S.type==="put")for(var T=new Rt,I=S.values.length-1;0<=I;--I){var D,P=S.values[I],C=x(P);!T.hasKey(C)&&(D=b(P),h&&m(D)?D.some(function(q){return pi(q,y)}):pi(D,y))&&(T.addKey(C),v.push(P))}switch(S.type){case"add":var L=new Rt().addKeys(e.values?k.map(function(M){return x(M)}):k),w=k.concat(e.values?v.filter(function(M){return M=x(M),!L.hasKey(M)&&(L.addKey(M),!0)}):v.map(function(M){return x(M)}).filter(function(M){return!L.hasKey(M)&&(L.addKey(M),!0)}));break;case"put":var R=new Rt().addKeys(S.values.map(function(M){return x(M)}));w=k.filter(function(M){return!R.hasKey(e.values?x(M):M)}).concat(e.values?v:v.map(function(M){return x(M)}));break;case"delete":var $=new Rt().addKeys(S.keys);w=k.filter(function(M){return!$.hasKey(e.values?x(M):M)});break;case"deleteRange":var W=S.range;w=k.filter(function(M){return!pi(x(M),W)})}return w},t))===t)?t:(a.sort(function(k,S){return ct(g(k),g(S))||ct(x(k),x(S))}),e.limit&&e.limit<1/0&&(a.length>e.limit?a.length=e.limit:t.length===e.limit&&a.length<e.limit&&(u.dirty=!0)),l?Object.freeze(a):a)}function To(t,e){return ct(t.lower,e.lower)===0&&ct(t.upper,e.upper)===0&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function Va(t,e){return((r,a,u,l)=>{if(r===void 0)return a!==void 0?-1:0;if(a===void 0)return 1;if((r=ct(r,a))===0){if(u&&l)return 0;if(u)return 1;if(l)return-1}return r})(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&0<=((r,a,u,l)=>{if(r===void 0)return a!==void 0?1:0;if(a===void 0)return-1;if((r=ct(r,a))===0){if(u&&l)return 0;if(u)return-1;if(l)return 1}return r})(t.upper,e.upper,t.upperOpen,e.upperOpen)}function Ha(t,e,r,a){t.subscribers.add(r),a.addEventListener("abort",function(){var u,l;t.subscribers.delete(r),t.subscribers.size===0&&(u=t,l=e,setTimeout(function(){u.subscribers.size===0&&Ht(l,u)},3e3))})}var Xa={stack:"dbcore",level:0,name:"Cache",create:function(t){var e=t.schema.name;return s(s({},t),{transaction:function(r,a,u){var l,f,h=t.transaction(r,a,u);return a==="readwrite"&&(u=(l=new AbortController).signal,h.addEventListener("abort",(f=function(y){return function(){if(l.abort(),a==="readwrite"){for(var x=new Set,b=0,g=r;b<g.length;b++){var k=g[b],S=Be["idb://".concat(e,"/").concat(k)];if(S){var w=t.table(k),v=S.optimisticOps.filter(function(U){return U.trans===h});if(h._explicit&&y&&h.mutatedParts)for(var T=0,I=Object.values(S.queries.query);T<I.length;T++)for(var D=0,P=(R=I[T]).slice();D<P.length;D++)ai(($=P[D]).obsSet,h.mutatedParts)&&(Ht(R,$),$.subscribers.forEach(function(U){return x.add(U)}));else if(0<v.length){S.optimisticOps=S.optimisticOps.filter(function(U){return U.trans!==h});for(var C=0,L=Object.values(S.queries.query);C<L.length;C++)for(var R,$,W,q=0,M=(R=L[C]).slice();q<M.length;q++)($=M[q]).res!=null&&h.mutatedParts&&(y&&!$.dirty?(W=Object.isFrozen($.res),W=xo($.res,$.req,v,w,$,W),$.dirty?(Ht(R,$),$.subscribers.forEach(function(U){return x.add(U)})):W!==$.res&&($.res=W,$.promise=B.resolve({result:W}))):($.dirty&&Ht(R,$),$.subscribers.forEach(function(U){return x.add(U)})))}}}x.forEach(function(U){return U()})}}})(!1),{signal:u}),h.addEventListener("error",f(!1),{signal:u}),h.addEventListener("complete",f(!0),{signal:u})),h},table:function(r){var a=t.table(r),u=a.schema.primaryKey;return s(s({},a),{mutate:function(l){var f,h=H.trans;return!u.outbound&&h.db._options.cache!=="disabled"&&!h.explicit&&h.idbtrans.mode==="readwrite"&&(f=Be["idb://".concat(e,"/").concat(r)])?(h=a.mutate(l),l.type!=="add"&&l.type!=="put"||!(50<=l.values.length||fi(u,l).some(function(y){return y==null}))?(f.optimisticOps.push(l),l.mutatedParts&&ur(l.mutatedParts),h.then(function(y){0<y.numFailures&&(Ht(f.optimisticOps,l),(y=Do(0,l,y))&&f.optimisticOps.push(y),l.mutatedParts)&&ur(l.mutatedParts)}),h.catch(function(){Ht(f.optimisticOps,l),l.mutatedParts&&ur(l.mutatedParts)})):h.then(function(y){var x=Do(0,s(s({},l),{values:l.values.map(function(b,g){var k;return y.failures[g]?b:(st(k=(k=u.keyPath)!=null&&k.includes(".")?At(b):s({},b),u.keyPath,y.results[g]),k)})}),y);f.optimisticOps.push(x),queueMicrotask(function(){return l.mutatedParts&&ur(l.mutatedParts)})}),h):a.mutate(l)},query:function(l){var f,h,y,x,b,g,k;return So(H,a)&&Eo("query",l)?(f=((y=H.trans)==null?void 0:y.db._options.cache)==="immutable",h=(y=H).requery,y=y.signal,g=((S,w,v,T)=>{var I=Be["idb://".concat(S,"/").concat(w)];if(!I)return[];if(!(S=I.queries[v]))return[null,!1,I,null];var D=S[(T.query?T.query.index.name:null)||""];if(!D)return[null,!1,I,null];switch(v){case"query":var P=D.find(function(C){return C.req.limit===T.limit&&C.req.values===T.values&&To(C.req.query.range,T.query.range)});return P?[P,!0,I,D]:[D.find(function(C){return("limit"in C.req?C.req.limit:1/0)>=T.limit&&(!T.values||C.req.values)&&Va(C.req.query.range,T.query.range)}),!1,I,D];case"count":return P=D.find(function(C){return To(C.req.query.range,T.query.range)}),[P,!!P,I,D]}})(e,r,"query",l),k=g[0],x=g[2],b=g[3],k&&g[1]?k.obsSet=l.obsSet:(g=a.query(l).then(function(S){var w=S.result;if(k&&(k.res=w),f){for(var v=0,T=w.length;v<T;++v)Object.freeze(w[v]);Object.freeze(w)}else S.result=At(w);return S}).catch(function(S){return b&&k&&Ht(b,k),Promise.reject(S)}),k={obsSet:l.obsSet,promise:g,subscribers:new Set,type:"query",req:l,dirty:!1},b?b.push(k):(b=[k],(x=x||(Be["idb://".concat(e,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[l.query.index.name||""]=b)),Ha(k,b,h,y),k.promise.then(function(S){return{result:xo(S.result,l,x==null?void 0:x.optimisticOps,a,k,f)}})):a.query(l)}})}})}};function cr(t,e){return new Proxy(t,{get:function(r,a,u){return a==="db"?e:Reflect.get(r,a,u)}})}Ot.prototype.version=function(t){if(isNaN(t)||t<.1)throw new X.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new X.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,r=e.filter(function(a){return a._cfg.version===t})[0];return r||(r=new this.Version(t),e.push(r),e.sort(Na),r.stores({}),this._state.autoSchema=!1),r},Ot.prototype._whenReady=function(t){var e=this;return this.idbdb&&(this._state.openComplete||H.letThrough||this._vip)?t():new B(function(r,a){if(e._state.openComplete)return a(new X.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return void a(new X.DatabaseClosed);e.open().catch(yt)}e._state.dbReadyPromise.then(r,a)}).then(t)},Ot.prototype.use=function(u){var e=u.stack,r=u.create,a=u.level,u=u.name,l=(u&&this.unuse({stack:e,name:u}),this._middlewares[e]||(this._middlewares[e]=[]));return l.push({stack:e,create:r,level:a??10,name:u}),l.sort(function(f,h){return f.level-h.level}),this},Ot.prototype.unuse=function(t){var e=t.stack,r=t.name,a=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(u){return a?u.create!==a:!!r&&u.name!==r})),this},Ot.prototype.open=function(){var t=this;return Le(we,function(){return Fa(t)})},Ot.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var t=this._state,e=tn.indexOf(this);if(0<=e&&tn.splice(e,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new B(function(r){t.dbReadyResolve=r}),t.openCanceller=new B(function(r,a){t.cancelOpen=a}))},Ot.prototype.close=function(e){var e=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,r=this._state;e?(r.isBeingOpened&&r.cancelOpen(new X.DatabaseClosed),this._close(),r.autoOpen=!1,r.dbOpenError=new X.DatabaseClosed):(this._close(),r.autoOpen=this._options.autoOpen||r.isBeingOpened,r.openComplete=!1,r.dbOpenError=null)},Ot.prototype.delete=function(t){var e=this,r=(t===void 0&&(t={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),a=this._state;return new B(function(u,l){function f(){e.close(t);var h=e._deps.indexedDB.deleteDatabase(e.name);h.onsuccess=wt(function(){var y,x,b;y=e._deps,x=e.name,ri(b=y.indexedDB)||x===Xn||ni(b,y.IDBKeyRange).delete(x).catch(yt),u()}),h.onerror=le(l),h.onblocked=e._fireOnBlocked}if(r)throw new X.InvalidArgument("Invalid closeOptions argument to db.delete()");a.isBeingOpened?a.dbReadyPromise.then(f):f()})},Ot.prototype.backendDB=function(){return this.idbdb},Ot.prototype.isOpen=function(){return this.idbdb!==null},Ot.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},Ot.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ot.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ot.prototype,"tables",{get:function(){var t=this;return p(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!1,configurable:!0}),Ot.prototype.transaction=function(){var t=(function(e,r,a){var u=arguments.length;if(u<2)throw new X.InvalidArgument("Too few arguments");for(var l=new Array(u-1);--u;)l[u-1]=arguments[u];return a=l.pop(),[e,Bt(l),a]}).apply(this,arguments);return this._transaction.apply(this,t)},Ot.prototype._transaction=function(t,e,r){var a,u,l=this,f=H.trans,h=(f&&f.db===this&&t.indexOf("!")===-1||(f=null),t.indexOf("?")!==-1);t=t.replace("!","").replace("?","");try{if(u=e.map(function(x){if(x=x instanceof l.Table?x.name:x,typeof x!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return x}),t=="r"||t===Yr)a=Yr;else{if(t!="rw"&&t!=zr)throw new X.InvalidArgument("Invalid transaction mode: "+t);a=zr}if(f){if(f.mode===Yr&&a===zr){if(!h)throw new X.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");f=null}f&&u.forEach(function(x){if(f&&f.storeNames.indexOf(x)===-1){if(!h)throw new X.SubTransaction("Table "+x+" not included in parent transaction.");f=null}}),h&&f&&!f.active&&(f=null)}}catch(x){return f?f._promise(null,function(b,g){g(x)}):It(x)}var y=(function x(b,g,k,S,w){return B.resolve().then(function(){var D=H.transless||H,v=b._createTransaction(g,k,b._dbSchema,S),D=(v.explicit=!0,{trans:v,transless:D});if(S)v.idbtrans=S.idbtrans;else try{v.create(),v.idbtrans._explicit=!0,b._state.PR1398_maxLoop=3}catch(P){return P.name===jr.InvalidState&&b.isOpen()&&0<--b._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),b.close({disableAutoOpen:!1}),b.open().then(function(){return x(b,g,k,null,w)})):It(P)}var T,I=He(w),D=(I&&Ze(),B.follow(function(){var P;(T=w.call(v,v))&&(I?(P=ke.bind(null,null),T.then(P,P)):typeof T.next=="function"&&typeof T.throw=="function"&&(T=ci(T)))},D));return(T&&typeof T.then=="function"?B.resolve(T).then(function(P){return v.active?P:It(new X.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):D.then(function(){return T})).then(function(P){return S&&v._resolve(),v._completion.then(function(){return P})}).catch(function(P){return v._reject(P),It(P)})})}).bind(null,this,a,u,f,r);return f?f._promise(a,y,"lock"):H.trans?Le(H.transless,function(){return l._whenReady(y)}):this._whenReady(y)},Ot.prototype.table=function(t){if(A(this._allTables,t))return this._allTables[t];throw new X.InvalidTable("Table ".concat(t," does not exist"))};var me=Ot;function Ot(t,e){var r,a,u,l,f,h=this,y=(this._middlewares={},this.verno=0,Ot.dependencies),y=(this._options=e=s({addons:Ot.addons,autoOpen:!0,indexedDB:y.indexedDB,IDBKeyRange:y.IDBKeyRange,cache:"cloned"},e),this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange},e.addons),x=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:yt,dbReadyPromise:null,cancelOpen:yt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:e.autoOpen}),b=(x.dbReadyPromise=new B(function(g){x.dbReadyResolve=g}),x.openCanceller=new B(function(g,k){x.cancelOpen=k}),this._state=x,this.name=t,this.on=_n(this,"populate","blocked","versionchange","close",{ready:[Lr,yt]}),this.once=function(g,k){var S=function(){for(var w=[],v=0;v<arguments.length;v++)w[v]=arguments[v];h.on(g).unsubscribe(S),k.apply(h,w)};return h.on(g,S)},this.on.ready.subscribe=rt(this.on.ready.subscribe,function(g){return function(k,S){Ot.vip(function(){var w,v=h._state;v.openComplete?(v.dbOpenError||B.resolve().then(k),S&&g(k)):v.onReadyBeingFired?(v.onReadyBeingFired.push(k),S&&g(k)):(g(k),w=h,S||g(function T(){w.on.ready.unsubscribe(k),w.on.ready.unsubscribe(T)}))})}}),this.Collection=(r=this,kn(Pa.prototype,function(T,v){this.db=r;var S=eo,w=null;if(v)try{S=v()}catch(D){w=D}var v=T._ctx,T=v.table,I=T.hook.reading.fire;this._ctx={table:T,index:v.index,isPrimKey:!v.index||T.schema.primKey.keyPath&&v.index===T.schema.primKey.name,range:S,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:w,or:v.or,valueMapper:I!==mn?I:null}})),this.Table=(a=this,kn(so.prototype,function(g,k,S){this.db=a,this._tx=S,this.name=g,this.schema=k,this.hook=a._allTables[g]?a._allTables[g].hook:_n(null,{creating:[ka,yt],reading:[_a,mn],updating:[Ea,yt],deleting:[Sa,yt]})})),this.Transaction=(u=this,kn(Ma.prototype,function(g,k,S,w,v){var T=this;g!=="readonly"&&k.forEach(function(I){I=(I=S[I])==null?void 0:I.yProps,I&&(k=k.concat(I.map(function(D){return D.updatesTable})))}),this.db=u,this.mode=g,this.storeNames=k,this.schema=S,this.chromeTransactionDurability=w,this.idbtrans=null,this.on=_n(this,"complete","error","abort"),this.parent=v||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new B(function(I,D){T._resolve=I,T._reject=D}),this._completion.then(function(){T.active=!1,T.on.complete.fire()},function(I){var D=T.active;return T.active=!1,T.on.error.fire(I),T.parent?T.parent._reject(I):D&&T.idbtrans&&T.idbtrans.abort(),It(I)})})),this.Version=(l=this,kn(qa.prototype,function(g){this.db=l,this._cfg={version:g,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(f=this,kn(po.prototype,function(g,k,S){if(this.db=f,this._ctx={table:g,index:k===":id"?null:k,or:S},this._cmp=this._ascending=ct,this._descending=function(w,v){return ct(v,w)},this._max=function(w,v){return 0<ct(w,v)?w:v},this._min=function(w,v){return ct(w,v)<0?w:v},this._IDBKeyRange=f._deps.IDBKeyRange,!this._IDBKeyRange)throw new X.MissingAPI})),this.on("versionchange",function(g){0<g.newVersion?console.warn("Another connection wants to upgrade database '".concat(h.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(h.name,"'. Closing db now to resume the delete request.")),h.close({disableAutoOpen:!1})}),this.on("blocked",function(g){!g.newVersion||g.newVersion<g.oldVersion?console.warn("Dexie.delete('".concat(h.name,"') was blocked")):console.warn("Upgrade '".concat(h.name,"' blocked by other connection holding version ").concat(g.oldVersion/10))}),this._maxKey=Dn(e.IDBKeyRange),this._createTransaction=function(g,k,S,w){return new h.Transaction(g,k,S,h._options.chromeTransactionDurability,w)},this._fireOnBlocked=function(g){h.on("blocked").fire(g),tn.filter(function(k){return k.name===h.name&&k!==h&&!k._state.vcFired}).map(function(k){return k.on("versionchange").fire(g)})},this.use(Ya),this.use(Xa),this.use(za),this.use(Wa),this.use(Ua),new Proxy(this,{get:function(g,k,S){var w;return k==="_vip"||(k==="table"?function(v){return cr(h.table(v),b)}:(w=Reflect.get(g,k,S))instanceof so?cr(w,b):k==="tables"?w.map(function(v){return cr(v,b)}):k==="_createTransaction"?function(){return cr(w.apply(this,arguments),b)}:w)}}));this.vip=b,y.forEach(function(g){return g(h)})}var dr,on=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ga=(hi.prototype.subscribe=function(t,e,r){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:e,complete:r})},hi.prototype[on]=function(){return this},hi);function hi(t){this._subscribe=t}try{dr={indexedDB:d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,IDBKeyRange:d.IDBKeyRange||d.webkitIDBKeyRange}}catch{dr={indexedDB:null,IDBKeyRange:null}}function Io(t){var e,r=!1,a=new Ga(function(u){var l=He(t),f,h=!1,y={},x={},b={get closed(){return h},unsubscribe:function(){h||(h=!0,f&&f.abort(),g&&De.storagemutated.unsubscribe(S))}},g=(u.start&&u.start(b),!1),k=function(){return Ur(w)},S=function(v){sr(y,v),ai(x,y)&&k()},w=function(){var v,T,I;!h&&dr.indexedDB&&(y={},v={},f&&f.abort(),f=new AbortController,I=(D=>{var P=Qe();try{l&&Ze();var C=_e(t,D);return C=l?C.finally(ke):C}finally{P&&Je()}})(T={subscr:v,signal:f.signal,requery:k,querier:t,trans:null}),Promise.resolve(I).then(function(D){r=!0,e=D,h||T.signal.aborted||(y={},(P=>{for(var C in P)if(A(P,C))return;return 1})(x=v)||g||(De(En,S),g=!0),Ur(function(){return!h&&u.next&&u.next(D)}))},function(D){r=!1,["DatabaseClosedError","AbortError"].includes(D==null?void 0:D.name)||h||Ur(function(){h||u.error&&u.error(D)})}))};return setTimeout(k,0),b});return a.hasValue=function(){return r},a.getValue=function(){return e},a}var Ke=me;function mi(t){var e=xe;try{xe=!0,De.storagemutated.fire(t),li(t,!0)}finally{xe=e}}j(Ke,s(s({},ie),{delete:function(t){return new Ke(t,{addons:[]}).delete()},exists:function(t){return new Ke(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return e=Ke.dependencies,r=e.indexedDB,e=e.IDBKeyRange,(ri(r)?Promise.resolve(r.databases()).then(function(a){return a.map(function(u){return u.name}).filter(function(u){return u!==Xn})}):ni(r,e).toCollection().primaryKeys()).then(t)}catch{return It(new X.MissingAPI)}var e,r},defineClass:function(){return function(t){_(this,t)}},ignoreTransaction:function(t){return H.trans?Le(H.transless,t):t()},vip:ii,async:function(t){return function(){try{var e=ci(t.apply(this,arguments));return e&&typeof e.then=="function"?e:B.resolve(e)}catch(r){return It(r)}}},spawn:function(t,e,r){try{var a=ci(t.apply(r,e||[]));return a&&typeof a.then=="function"?a:B.resolve(a)}catch(u){return It(u)}},currentTransaction:{get:function(){return H.trans||null}},waitFor:function(t,e){return t=B.resolve(typeof t=="function"?Ke.ignoreTransaction(t):t).timeout(e||6e4),H.trans?H.trans.waitFor(t):t},Promise:B,debug:{get:function(){return ue},set:function(t){Hi(t)}},derive:Y,extend:_,props:j,override:rt,Events:_n,on:De,liveQuery:Io,extendObservabilitySet:sr,getByKeyPath:gt,setByKeyPath:st,delByKeyPath:function(t,e){typeof e=="string"?st(t,e,void 0):"length"in e&&[].map.call(e,function(r){st(t,r,void 0)})},shallowClone:ot,deepClone:At,getObjectDiff:di,cmp:ct,asap:lt,minKey:-1/0,addons:[],connections:tn,errnames:jr,dependencies:dr,cache:Be,semVer:"4.3.0",version:"4.3.0".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,r){return t+e/Math.pow(10,2*r)})})),Ke.maxKey=Dn(Ke.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(De(En,function(t){xe||(t=new CustomEvent(Xr,{detail:t}),xe=!0,dispatchEvent(t),xe=!1)}),addEventListener(Xr,function(t){t=t.detail,xe||mi(t)}));var an,xe=!1,Oo=function(){};return typeof BroadcastChannel<"u"&&((Oo=function(){(an=new BroadcastChannel(Xr)).onmessage=function(t){return t.data&&mi(t.data)}})(),typeof an.unref=="function"&&an.unref(),De(En,function(t){xe||an.postMessage(t)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(t){if(!me.disableBfCache&&t.persisted){ue&&console.debug("Dexie: handling persisted pagehide"),an!=null&&an.close();for(var e=0,r=tn;e<r.length;e++)r[e].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(t){!me.disableBfCache&&t.persisted&&(ue&&console.debug("Dexie: handling persisted pageshow"),Oo(),mi({all:new Rt(-1/0,[[]])}))})),B.rejectionMapper=function(t,e){return!t||t instanceof Xe||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Vi[t.name]?t:(e=new Vi[t.name](e||t.message,t),"stack"in t&&F(e,"stack",{get:function(){return this.inner.stack}}),e)},Hi(ue),s(me,Object.freeze({__proto__:null,Dexie:me,Entity:no,PropModification:wn,RangeSet:Rt,add:function(t){return new wn({add:t})},cmp:ct,default:me,liveQuery:Io,mergeRanges:In,rangesOverlap:yo,remove:function(t){return new wn({remove:t})},replacePrefix:function(t,e){return new wn({replacePrefix:[t,e]})}}),{default:me}),me})})(Xo);var ts=Xo.exports;const Oi=Za(ts),Po=Symbol.for("Dexie"),Dr=globalThis[Po]||(globalThis[Po]=Oi);if(Oi.semVer!==Dr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Oi.semVer} and ${Dr.semVer}`);const{liveQuery:ou,mergeRanges:au,rangesOverlap:su,RangeSet:uu,cmp:lu,Entity:cu,PropModification:du,replacePrefix:fu,add:pu,remove:hu,DexieYProvider:mu}=Dr;class es extends Dr{constructor(){super("GymDatabase");de(this,"workouts");de(this,"logs");de(this,"workoutTypes");de(this,"profile");this.version(1).stores({workouts:"id, status, startTime, updatedAt, isDeleted",logs:"id, workoutId, workoutTypeId, date, updatedAt, isDeleted",workoutTypes:"id, updatedAt, isDeleted",profile:"id, updatedAt, isDeleted"})}}const G=new es,Ri="gym_web_auth";function Ni(){const o=localStorage.getItem(Ri);try{return o?JSON.parse(o):null}catch{return null}}function Go(o){localStorage.setItem(Ri,JSON.stringify(o))}function ns(){localStorage.removeItem(Ri)}function Ai(){const o=Ni();if(!o)return null;const n=new URLSearchParams;return Object.entries(o).forEach(([i,s])=>{s!=null&&n.append(i,String(s))}),n.toString()}var zo;const fr=(zo=window.Telegram)==null?void 0:zo.WebApp,Co="https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4";class vi{static getHeaders(){const n={"Content-Type":"application/json"};if(fr!=null&&fr.initData)localStorage.getItem("skip_tma_auth")==="true"||(n["X-Telegram-Init-Data"]=fr.initData);else{const i=Ai();i&&(n["X-Telegram-Init-Data"]=i)}return n}static async sync(){if(!navigator.onLine)throw new Error("Offline");const n=this.getHeaders(),i=await fetch(Co,{headers:n});if(!i.ok)throw i.status===401?new Error("Unauthorized"):new Error("Sync failed");const s=await i.json();await this.mergeData(s);const c=await this.readAll();await fetch(Co,{method:"POST",headers:n,body:JSON.stringify(c)})}static async mergeData(n){await G.transaction("rw",G.workouts,G.logs,G.workoutTypes,G.profile,async()=>{if(await this.mergeTable(G.workouts,n.workouts),await this.mergeTable(G.logs,n.logs),await this.mergeTable(G.workoutTypes,n.workoutTypes),n.profile){const i={...n.profile,id:"me"};await this.mergeTable(G.profile,[i])}})}static async mergeTable(n,i=[]){const s=await n.toArray(),c=new Map(s.map(d=>[d.id,d]));for(const d of i){const p=c.get(d.id);if(!p)await n.put(d);else{const m=new Date(d.updatedAt).getTime(),_=new Date(p.updatedAt).getTime();m>_&&await n.put(d)}}}static async readAll(){return{workouts:await G.workouts.toArray(),logs:await G.logs.toArray(),workoutTypes:await G.workoutTypes.toArray(),profile:(await G.profile.toArray())[0]}}}const rs="gym_twa_data";var Vo;const sn=(Vo=window.Telegram)==null?void 0:Vo.WebApp,yi={workoutTypes:[{id:"1",name:"ÐÐ¸Ð¼ Ð»ÐµÐ¶Ð°",updatedAt:new Date().toISOString()},{id:"2",name:"ÐÑÐ¸ÑÐµÐ´Ð°Ð½Ð¸Ñ",updatedAt:new Date().toISOString()},{id:"3",name:"Ð¡ÑÐ°Ð½Ð¾Ð²Ð°Ñ ÑÑÐ³Ð°",updatedAt:new Date().toISOString()}],logs:[],workouts:[]};class is{constructor(){de(this,"onUpdateCallback");de(this,"onSyncStatusChangeCallback");de(this,"status","idle");de(this,"cache",{...yi});de(this,"SERVER_URL","https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4");this.init()}async init(){await this.migrateFromLocalStorage(),this.sync().catch(console.error)}async migrateFromLocalStorage(){const n=localStorage.getItem(rs);if(n)try{const i=JSON.parse(n);if(await G.workoutTypes.count()===0){console.log("Migrating from localStorage to IDB...");const c=new Date().toISOString(),d=(i.workoutTypes||yi.workoutTypes).map(_=>({..._,updatedAt:c}));await G.workoutTypes.bulkPut(d);const p=(i.logs||[]).map(_=>({..._,updatedAt:c,workoutId:_.workoutId||"legacy"}));await G.logs.bulkPut(p);const m=(i.workouts||[]).map(_=>({..._,updatedAt:c}));if(await G.workouts.bulkPut(m),i.profile){const _={...i.profile,id:"me",updatedAt:c};await G.profile.put(_)}}}catch(i){console.error("Migration failed",i)}else await G.workoutTypes.count()===0&&await G.workoutTypes.bulkPut(yi.workoutTypes)}onUpdate(n){this.onUpdateCallback=n}onSyncStatusChange(n){this.onSyncStatusChangeCallback=n}setStatus(n){var i;this.status=n,(i=this.onSyncStatusChangeCallback)==null||i.call(this,n),n==="success"&&setTimeout(()=>{this.status==="success"&&this.setStatus("idle")},2e3)}async sync(){var i;const n=localStorage.getItem("skip_tma_auth")==="true";if(n&&!Ai()){this.setStatus("idle");return}try{this.setStatus("saving"),await vi.sync(),this.setStatus("success"),(i=this.onUpdateCallback)==null||i.call(this)}catch(s){if(console.error("Sync failed",s),(s instanceof Error?s.message:String(s)).toLowerCase().includes("unauthorized")){if(n){this.setStatus("error");return}localStorage.setItem("skip_tma_auth","true"),ns(),location.reload();return}s instanceof Error&&s.message==="Offline"?this.setStatus("idle"):this.setStatus("error")}}async reloadCache(){var n;this.cache=await vi.readAll(),(n=this.onUpdateCallback)==null||n.call(this)}getWorkoutTypes(){return this.cache.workoutTypes.filter(i=>!i.isDeleted).sort((i,s)=>(i.order??1/0)-(s.order??1/0))}getLogs(){return this.cache.logs.filter(n=>!n.isDeleted)}getWorkouts(){return this.cache.workouts.filter(n=>!n.isDeleted)}getActiveWorkout(){return this.cache.workouts.find(n=>!n.isDeleted&&(n.status==="active"||n.status==="paused"))}getProfile(){return this.cache.profile}async addWorkoutType(n,i="strength"){const s=this.getWorkoutTypes(),c=s.length>0?Math.max(...s.map(p=>p.order??0)):0,d={id:Date.now().toString(),name:n,category:i,order:c+1,updatedAt:new Date().toISOString()};return await G.workoutTypes.put(d),await this.reloadCache(),this.sync().catch(()=>{}),d}async deleteWorkoutType(n){const i=await G.workoutTypes.get(n);i&&(i.isDeleted=!0,i.updatedAt=new Date().toISOString(),await G.workoutTypes.put(i),await this.reloadCache(),this.sync().catch(()=>{}))}async updateWorkoutType(n,i,s){const c=await G.workoutTypes.get(n);c&&(c.name=i,s&&(c.category=s),c.updatedAt=new Date().toISOString(),await G.workoutTypes.put(c),await this.reloadCache(),this.sync().catch(()=>{}))}async startWorkout(n){this.getActiveWorkout()&&await this.finishWorkout();const s={id:Date.now().toString(),startTime:new Date().toISOString(),status:"active",name:n,isManual:!0,pauseIntervals:[],updatedAt:new Date().toISOString()};return await G.workouts.put(s),await this.reloadCache(),this.sync().catch(()=>{}),s}async pauseWorkout(){const n=this.getActiveWorkout();n&&n.status==="active"&&(n.status="paused",n.pauseIntervals.push({start:new Date().toISOString()}),n.updatedAt=new Date().toISOString(),await G.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{}))}async resumeWorkout(){const n=this.getActiveWorkout();if(n&&n.status==="paused"){n.status="active";const i=n.pauseIntervals[n.pauseIntervals.length-1];i&&!i.end&&(i.end=new Date().toISOString()),n.updatedAt=new Date().toISOString(),await G.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}async finishWorkout(){const n=this.getActiveWorkout();if(n){n.status="finished",n.endTime=new Date().toISOString();const i=n.pauseIntervals[n.pauseIntervals.length-1];i&&!i.end&&(i.end=n.endTime),n.updatedAt=new Date().toISOString(),await G.workouts.put(n),await this.reloadCache(),this.sync().catch(()=>{})}}getWorkoutDuration(n){const i=new Date(n.startTime).getTime(),s=n.endTime?new Date(n.endTime).getTime():Date.now();let c=s-i;n.pauseIntervals.forEach(_=>{const E=new Date(_.start).getTime(),O=_.end?new Date(_.end).getTime():n.status==="paused"?Date.now():s;O>E&&(c-=O-E)});const d=Math.floor(Math.max(0,c)/6e4),m=this.cache.logs.filter(_=>_.workoutId===n.id&&!_.isDeleted).reduce((_,E)=>_+(E.duration||0),0);return Math.max(d,m)}async ensureActiveWorkout(){const n=this.getActiveWorkout();if(n)return n.id;const i=new Date().toISOString().split("T")[0],d=this.getWorkouts().filter(_=>_.startTime.startsWith(i)).sort((_,E)=>new Date(E.startTime).getTime()-new Date(_.startTime).getTime())[0];if(d&&!d.isManual&&d.status==="finished")return d.endTime=new Date().toISOString(),d.updatedAt=new Date().toISOString(),await G.workouts.put(d),await this.reloadCache(),this.sync().catch(()=>{}),d.id;const p=`implicit_${i}_${Date.now()}`,m={id:p,startTime:new Date().toISOString(),endTime:new Date().toISOString(),status:"finished",isManual:!1,pauseIntervals:[],updatedAt:new Date().toISOString()};return await G.workouts.put(m),await this.reloadCache(),this.sync().catch(()=>{}),p}async updateImplicitWorkoutBounds(n){const i=await G.workouts.get(n);if(!i||i.isManual)return;const c=(await G.logs.where("workoutId").equals(n).toArray()).filter(p=>!p.isDeleted);if(c.length===0)return;const d=c.sort((p,m)=>new Date(p.date).getTime()-new Date(m.date).getTime());i.startTime=d[0].date,i.endTime=d[d.length-1].date,i.status="finished",i.updatedAt=new Date().toISOString(),await G.workouts.put(i)}async addLog(n){const i=await this.ensureActiveWorkout(),s={...n,id:Date.now().toString(),date:new Date().toISOString(),workoutId:i,updatedAt:new Date().toISOString()};return await G.logs.put(s),await this.updateImplicitWorkoutBounds(i),await this.reloadCache(),this.sync().catch(()=>{}),s}async deleteLog(n){const i=await G.logs.get(n);if(i){const s=i.workoutId;i.isDeleted=!0,i.updatedAt=new Date().toISOString(),await G.logs.put(i),s&&await this.updateImplicitWorkoutBounds(s),await this.reloadCache(),this.sync().catch(()=>{})}}async updateLog(n){const i={...n,updatedAt:new Date().toISOString()};await G.logs.put(i),await this.reloadCache(),this.sync().catch(()=>{})}getProfileIdentifier(){var s,c;const n=this.cache.profile;if(n!=null&&n.telegramUsername)return n.telegramUsername;if(n!=null&&n.telegramUserId)return`id_${n.telegramUserId}`;const i=(c=(s=sn==null?void 0:sn.initDataUnsafe)==null?void 0:s.user)==null?void 0:c.id;return i?`id_${i}`:""}async updateProfileSettings(n){var p;const i=(p=sn==null?void 0:sn.initDataUnsafe)==null?void 0:p.user,s=i==null?void 0:i.id;let c=this.cache.profile;c?i!=null&&i.photo_url&&(c.photoUrl=i.photo_url):c={id:"me",isPublic:!1,showFullHistory:!1,telegramUserId:s||0,telegramUsername:i==null?void 0:i.username,photoUrl:i==null?void 0:i.photo_url,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),friends:[]};const d={...c,...n,updatedAt:new Date().toISOString()};await G.profile.put(d),await this.reloadCache(),this.sync().catch(()=>{})}async addFriend(n){const i=this.cache.profile;if(!i)return;const s=i.friends||[];if(s.some(d=>d.identifier===n.identifier))return;const c={...n,addedAt:new Date().toISOString()};await this.updateProfileSettings({friends:[...s,c]})}async removeFriend(n){const i=this.cache.profile;if(!i||!i.friends)return;const s=i.friends.filter(c=>c.identifier!==n);await this.updateProfileSettings({friends:s})}isFriend(n){var s;const i=this.cache.profile;return((s=i==null?void 0:i.friends)==null?void 0:s.some(c=>c.identifier===n))??!1}async updateWorkoutTypeOrder(n){const i=n.map((s,c)=>{const d=this.cache.workoutTypes.find(p=>p.id===s);return d?{...d,order:c,updatedAt:new Date().toISOString()}:null}).filter(Boolean);i.length>0&&(await G.workoutTypes.bulkPut(i),await this.reloadCache(),this.sync().catch(()=>{}))}async getPublicProfile(n){try{const i=await fetch(`${this.SERVER_URL}?profile=${encodeURIComponent(n)}`);return i.ok?await i.json():null}catch{return null}}async getAIRecommendation(n,i){const s=Ai();if(!s)throw new Error("Unauthorized");const c=await fetch(`${this.SERVER_URL}?action=ai`,{method:"POST",headers:{"X-Telegram-Init-Data":s,"Content-Type":"application/json"},body:JSON.stringify({type:n,options:i})});if(!c.ok)throw new Error("AI Generation Failed");return(await c.json()).recommendation}async exportData(){return await vi.readAll()}async importData(n){if(!n.logs||!n.workoutTypes)throw new Error("Invalid data format");await G.transaction("rw",G.workouts,G.logs,G.workoutTypes,G.profile,async()=>{var i,s,c;await G.workouts.clear(),await G.logs.clear(),await G.workoutTypes.clear(),await G.profile.clear(),(i=n.workouts)!=null&&i.length&&await G.workouts.bulkAdd(n.workouts),(s=n.logs)!=null&&s.length&&await G.logs.bulkAdd(n.logs),(c=n.workoutTypes)!=null&&c.length&&await G.workoutTypes.bulkAdd(n.workoutTypes),n.profile&&await G.profile.put({...n.profile,id:"me"})}),await this.reloadCache(),this.sync().catch(()=>{})}}const z=new is;z.reloadCache().then(()=>{});function os(o=0,n=0){return n===1?o:Math.round(o*(1+n/30))}function as(o,n){const i=new Map;return o.filter(c=>c.workoutTypeId===n).forEach(c=>{const d=c.date.split("T")[0],p=os(c.weight||0,c.reps||0),m=i.get(d)||0;p>m&&i.set(d,p)}),i}function ss(o,n){const i=new Set;return o.forEach(s=>i.add(s.startTime.split("T")[0])),n.forEach(s=>i.add(s.date.split("T")[0])),i}function us(o){const n=o.filter(d=>d.endTime&&d.status==="finished");if(n.length===0)return{averageMinutes:0,totalMinutes:0,count:0};let i=0;n.forEach(d=>{const p=new Date(d.startTime).getTime(),m=new Date(d.endTime).getTime();let _=m-p;d.pauseIntervals&&d.pauseIntervals.forEach(E=>{const O=new Date(E.start).getTime(),A=E.end?new Date(E.end).getTime():m;_-=A-O}),i+=_});const s=Math.round(i/1e3/60);return{averageMinutes:Math.round(s/n.length),totalMinutes:s,count:n.length}}function Qo(o,n=6){const i=new Date,s=new Date(i);s.setMonth(i.getMonth()-n),s.setDate(s.getDate()-s.getDay());let c='<div class="heatmap-container"><div class="heatmap-grid">';const d=new Date(s),p=new Date(i);for(;d<=p;){const m=d.toISOString().split("T")[0],_=o.has(m),O=`heatmap-cell level-${_?4:0}`,A=`${m}: ${_?"Workout":"No workout"}`;c+=`<div class="${O}" title="${A}"></div>`,d.setDate(d.getDate()+1)}return c+="</div>",c+=`
        <div class="heatmap-legend">
            Less <div class="heatmap-cell level-0"></div>
            <div class="heatmap-cell level-4"></div> More
        </div>
    `,c+="</div>",c}function $o(o){const n=new Map;o.forEach(c=>{const d=c.date.split("T")[0],p=(c.weight||0)*(c.reps||0);n.set(d,(n.get(d)||0)+p)});const i=Array.from(n.keys()).sort().slice(-10);if(i.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¾Ð±ÑÐµÐ¼Ð°</p>';const s=i.map(c=>({label:new Date(c).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:n.get(c)}));return ds(s,"ÐºÐ³")}function ls(o){const n=Array.from(o.keys()).sort();if(n.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° 1RM</p>';const i=n.map(s=>({label:new Date(s).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:o.get(s)}));return Jo(i,"ÐºÐ³")}function cs(o){const n=o.filter(s=>s.status==="finished"&&s.endTime).sort((s,c)=>new Date(s.startTime).getTime()-new Date(c.startTime).getTime()).slice(-10);if(n.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÐ¸</p>';const i=n.map(s=>{const c=new Date(s.startTime).getTime(),d=new Date(s.endTime).getTime();let p=(d-c)/1e3/60;return s.pauseIntervals&&s.pauseIntervals.forEach(m=>{const _=new Date(m.start).getTime(),E=m.end?new Date(m.end).getTime():d;p-=(E-_)/1e3/60}),{label:new Date(s.startTime).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:Math.round(p)}});return Jo(i,"Ð¼Ð¸Ð½")}function ds(o,n){const c=Math.max(...o.map(p=>p.value))*1.1;return`
        <svg width="100%" height="150" preserveAspectRatio="none">
            ${o.map((p,m)=>{const _=p.value/c*100,E=m/o.length*100,O=1/o.length*80;return`
            <rect x="${E+5}%" y="${100-_}%" width="${O}%" height="${_}%" fill="var(--color-button)" rx="2" opacity="0.8">
               <title>${p.label}: ${p.value}${n}</title>
            </rect>
            <text x="${E+5+O/2}%" y="95%" font-size="10" text-anchor="middle" fill="var(--color-text)" style="pointer-events: none;">
                ${p.label}
            </text>
        `}).join("")}
        </svg>
    `}function Jo(o,n){const d=o.map(K=>K.value),p=Math.min(...d),m=Math.max(...d),_=m-p||1,E=K=>20+K/(o.length-1)*(400-2*20),O=K=>130-(K-p)/_*(150-2*20),A=o.map((K,F)=>`${E(F)},${O(K.value)}`).join(" "),j=o.map((K,F)=>`
        <circle cx="${E(F)}" cy="${O(K.value)}" r="4" fill="var(--color-bg)" stroke="var(--color-button)" stroke-width="2">
            <title>${K.label}: ${K.value}${n}</title>
        </circle>
    `).join("");return`
        <svg viewBox="0 0 400 150" class="chart">
             <polyline
                fill="none"
                stroke="var(--color-button)"
                stroke-width="3"
                stroke-linejoin="round"
                stroke-linecap="round"
                points="${A}"
            />
            ${j}
        </svg>
        <div style="display: flex; justify-content: space-between; margin-top: 4px; font-size: 12px; color: var(--color-hint);">
            <span>${Math.round(p)}${n}</span>
            <span>${Math.round(m)}${n}</span>
        </div>
    `}function fs(o,n){o.innerHTML=`
        <div class="page-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 24px;">ðï¸</div>
            <h1 class="title" style="margin-bottom: 12px;">ÐÐ¸Ð¼-Ð¶Ð¸Ð¼ 21</h1>
            <p class="subtitle" style="margin-bottom: 32px; opacity: 0.7;">ÐÐ¾Ð¹Ð´Ð¸ÑÐµ ÑÐµÑÐµÐ· Telegram, ÑÑÐ¾Ð±Ñ ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</p>
            <div id="telegram-login-container"></div>
        </div>
    `,window.onTelegramAuth=c=>{console.log("Telegram auth callback received:",c),Go(c),localStorage.removeItem("skip_tma_auth"),n()};const i=document.createElement("script");i.src="https://telegram.org/js/telegram-widget.js?22",i.async=!0,i.setAttribute("data-telegram-login","gymgym21bot"),i.setAttribute("data-size","large"),i.setAttribute("data-radius","12"),i.setAttribute("data-onauth","onTelegramAuth(user)"),i.setAttribute("data-request-access","write");const s=document.getElementById("telegram-login-container");s&&s.appendChild(i)}const ps="modulepreload",hs=function(o,n){return new URL(o,n).href},Mo={},ms=function(n,i,s){let c=Promise.resolve();if(i&&i.length>0){const p=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),_=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));c=Promise.allSettled(i.map(E=>{if(E=hs(E,s),E in Mo)return;Mo[E]=!0;const O=E.endsWith(".css"),A=O?'[rel="stylesheet"]':"";if(!!s)for(let F=p.length-1;F>=0;F--){const Y=p[F];if(Y.href===E&&(!O||Y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${E}"]${A}`))return;const K=document.createElement("link");if(K.rel=O?"stylesheet":ps,O||(K.as="script"),K.crossOrigin="",K.href=E,_&&K.setAttribute("nonce",_),document.head.appendChild(K),O)return new Promise((F,Y)=>{K.addEventListener("load",F),K.addEventListener("error",()=>Y(new Error(`Unable to preload CSS for ${E}`)))})}))}function d(p){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=p,window.dispatchEvent(m),!m.defaultPrevented)throw p}return c.then(p=>{for(const m of p||[])m.status==="rejected"&&d(m.reason);return n().catch(d)})};function gs(o={}){const{immediate:n=!1,onNeedRefresh:i,onOfflineReady:s,onRegistered:c,onRegisteredSW:d,onRegisterError:p}=o;let m,_;const E=async(A=!0)=>{await _};async function O(){if("serviceWorker"in navigator){if(m=await ms(async()=>{const{Workbox:A}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:A}},[],import.meta.url).then(({Workbox:A})=>new A("./sw.js",{scope:"./",type:"classic"})).catch(A=>{p==null||p(A)}),!m)return;m.addEventListener("activated",A=>{(A.isUpdate||A.isExternal)&&window.location.reload()}),m.addEventListener("installed",A=>{A.isUpdate||s==null||s()}),m.register({immediate:n}).then(A=>{d?d("./sw.js",A):c==null||c(A)}).catch(A=>{p==null||p(A)})}}return _=O(),E}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function jo(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function pe(o){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?jo(Object(i),!0).forEach(function(s){vs(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):jo(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function yr(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?yr=function(n){return typeof n}:yr=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},yr(o)}function vs(o,n,i){return n in o?Object.defineProperty(o,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[n]=i,o}function ve(){return ve=Object.assign||function(o){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(o[s]=i[s])}return o},ve.apply(this,arguments)}function ys(o,n){if(o==null)return{};var i={},s=Object.keys(o),c,d;for(d=0;d<s.length;d++)c=s[d],!(n.indexOf(c)>=0)&&(i[c]=o[c]);return i}function bs(o,n){if(o==null)return{};var i=ys(o,n),s,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(o);for(c=0;c<d.length;c++)s=d[c],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(o,s)&&(i[s]=o[s])}return i}var ws="1.15.6";function ge(o){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(o)}var ye=ge(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Nn=ge(/Edge/i),Lo=ge(/firefox/i),$n=ge(/safari/i)&&!ge(/chrome/i)&&!ge(/android/i),Bi=ge(/iP(ad|od|hone)/i),Zo=ge(/chrome/i)&&ge(/android/i),ta={capture:!1,passive:!1};function dt(o,n,i){o.addEventListener(n,i,!ye&&ta)}function ut(o,n,i){o.removeEventListener(n,i,!ye&&ta)}function xr(o,n){if(n){if(n[0]===">"&&(n=n.substring(1)),o)try{if(o.matches)return o.matches(n);if(o.msMatchesSelector)return o.msMatchesSelector(n);if(o.webkitMatchesSelector)return o.webkitMatchesSelector(n)}catch{return!1}return!1}}function ea(o){return o.host&&o!==document&&o.host.nodeType?o.host:o.parentNode}function ae(o,n,i,s){if(o){i=i||document;do{if(n!=null&&(n[0]===">"?o.parentNode===i&&xr(o,n):xr(o,n))||s&&o===i)return o;if(o===i)break}while(o=ea(o))}return null}var Ro=/\s+/g;function Qt(o,n,i){if(o&&n)if(o.classList)o.classList[i?"add":"remove"](n);else{var s=(" "+o.className+" ").replace(Ro," ").replace(" "+n+" "," ");o.className=(s+(i?" "+n:"")).replace(Ro," ")}}function et(o,n,i){var s=o&&o.style;if(s){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(o,""):o.currentStyle&&(i=o.currentStyle),n===void 0?i:i[n];!(n in s)&&n.indexOf("webkit")===-1&&(n="-webkit-"+n),s[n]=i+(typeof i=="string"?"":"px")}}function pn(o,n){var i="";if(typeof o=="string")i=o;else do{var s=et(o,"transform");s&&s!=="none"&&(i=s+" "+i)}while(!n&&(o=o.parentNode));var c=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return c&&new c(i)}function na(o,n,i){if(o){var s=o.getElementsByTagName(n),c=0,d=s.length;if(i)for(;c<d;c++)i(s[c],c);return s}return[]}function fe(){var o=document.scrollingElement;return o||document.documentElement}function Ct(o,n,i,s,c){if(!(!o.getBoundingClientRect&&o!==window)){var d,p,m,_,E,O,A;if(o!==window&&o.parentNode&&o!==fe()?(d=o.getBoundingClientRect(),p=d.top,m=d.left,_=d.bottom,E=d.right,O=d.height,A=d.width):(p=0,m=0,_=window.innerHeight,E=window.innerWidth,O=window.innerHeight,A=window.innerWidth),(n||i)&&o!==window&&(c=c||o.parentNode,!ye))do if(c&&c.getBoundingClientRect&&(et(c,"transform")!=="none"||i&&et(c,"position")!=="static")){var j=c.getBoundingClientRect();p-=j.top+parseInt(et(c,"border-top-width")),m-=j.left+parseInt(et(c,"border-left-width")),_=p+d.height,E=m+d.width;break}while(c=c.parentNode);if(s&&o!==window){var K=pn(c||o),F=K&&K.a,Y=K&&K.d;K&&(p/=Y,m/=F,A/=F,O/=Y,_=p+O,E=m+A)}return{top:p,left:m,bottom:_,right:E,width:A,height:O}}}function No(o,n,i){for(var s=Ae(o,!0),c=Ct(o)[n];s;){var d=Ct(s)[i],p=void 0;if(p=c>=d,!p)return s;if(s===fe())break;s=Ae(s,!1)}return!1}function hn(o,n,i,s){for(var c=0,d=0,p=o.children;d<p.length;){if(p[d].style.display!=="none"&&p[d]!==nt.ghost&&(s||p[d]!==nt.dragged)&&ae(p[d],i.draggable,o,!1)){if(c===n)return p[d];c++}d++}return null}function Ki(o,n){for(var i=o.lastElementChild;i&&(i===nt.ghost||et(i,"display")==="none"||n&&!xr(i,n));)i=i.previousElementSibling;return i||null}function ee(o,n){var i=0;if(!o||!o.parentNode)return-1;for(;o=o.previousElementSibling;)o.nodeName.toUpperCase()!=="TEMPLATE"&&o!==nt.clone&&(!n||xr(o,n))&&i++;return i}function Bo(o){var n=0,i=0,s=fe();if(o)do{var c=pn(o),d=c.a,p=c.d;n+=o.scrollLeft*d,i+=o.scrollTop*p}while(o!==s&&(o=o.parentNode));return[n,i]}function _s(o,n){for(var i in o)if(o.hasOwnProperty(i)){for(var s in n)if(n.hasOwnProperty(s)&&n[s]===o[i][s])return Number(i)}return-1}function Ae(o,n){if(!o||!o.getBoundingClientRect)return fe();var i=o,s=!1;do if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var c=et(i);if(i.clientWidth<i.scrollWidth&&(c.overflowX=="auto"||c.overflowX=="scroll")||i.clientHeight<i.scrollHeight&&(c.overflowY=="auto"||c.overflowY=="scroll")){if(!i.getBoundingClientRect||i===document.body)return fe();if(s||n)return i;s=!0}}while(i=i.parentNode);return fe()}function ks(o,n){if(o&&n)for(var i in n)n.hasOwnProperty(i)&&(o[i]=n[i]);return o}function bi(o,n){return Math.round(o.top)===Math.round(n.top)&&Math.round(o.left)===Math.round(n.left)&&Math.round(o.height)===Math.round(n.height)&&Math.round(o.width)===Math.round(n.width)}var Mn;function ra(o,n){return function(){if(!Mn){var i=arguments,s=this;i.length===1?o.call(s,i[0]):o.apply(s,i),Mn=setTimeout(function(){Mn=void 0},n)}}}function Ss(){clearTimeout(Mn),Mn=void 0}function ia(o,n,i){o.scrollLeft+=n,o.scrollTop+=i}function oa(o){var n=window.Polymer,i=window.jQuery||window.Zepto;return n&&n.dom?n.dom(o).cloneNode(!0):i?i(o).clone(!0)[0]:o.cloneNode(!0)}function aa(o,n,i){var s={};return Array.from(o.children).forEach(function(c){var d,p,m,_;if(!(!ae(c,n.draggable,o,!1)||c.animated||c===i)){var E=Ct(c);s.left=Math.min((d=s.left)!==null&&d!==void 0?d:1/0,E.left),s.top=Math.min((p=s.top)!==null&&p!==void 0?p:1/0,E.top),s.right=Math.max((m=s.right)!==null&&m!==void 0?m:-1/0,E.right),s.bottom=Math.max((_=s.bottom)!==null&&_!==void 0?_:-1/0,E.bottom)}}),s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}var zt="Sortable"+new Date().getTime();function Es(){var o=[],n;return{captureAnimationState:function(){if(o=[],!!this.options.animation){var s=[].slice.call(this.el.children);s.forEach(function(c){if(!(et(c,"display")==="none"||c===nt.ghost)){o.push({target:c,rect:Ct(c)});var d=pe({},o[o.length-1].rect);if(c.thisAnimationDuration){var p=pn(c,!0);p&&(d.top-=p.f,d.left-=p.e)}c.fromRect=d}})}},addAnimationState:function(s){o.push(s)},removeAnimationState:function(s){o.splice(_s(o,{target:s}),1)},animateAll:function(s){var c=this;if(!this.options.animation){clearTimeout(n),typeof s=="function"&&s();return}var d=!1,p=0;o.forEach(function(m){var _=0,E=m.target,O=E.fromRect,A=Ct(E),j=E.prevFromRect,K=E.prevToRect,F=m.rect,Y=pn(E,!0);Y&&(A.top-=Y.f,A.left-=Y.e),E.toRect=A,E.thisAnimationDuration&&bi(j,A)&&!bi(O,A)&&(F.top-A.top)/(F.left-A.left)===(O.top-A.top)/(O.left-A.left)&&(_=xs(F,j,K,c.options)),bi(A,O)||(E.prevFromRect=O,E.prevToRect=A,_||(_=c.options.animation),c.animate(E,F,A,_)),_&&(d=!0,p=Math.max(p,_),clearTimeout(E.animationResetTimer),E.animationResetTimer=setTimeout(function(){E.animationTime=0,E.prevFromRect=null,E.fromRect=null,E.prevToRect=null,E.thisAnimationDuration=null},_),E.thisAnimationDuration=_)}),clearTimeout(n),d?n=setTimeout(function(){typeof s=="function"&&s()},p):typeof s=="function"&&s(),o=[]},animate:function(s,c,d,p){if(p){et(s,"transition",""),et(s,"transform","");var m=pn(this.el),_=m&&m.a,E=m&&m.d,O=(c.left-d.left)/(_||1),A=(c.top-d.top)/(E||1);s.animatingX=!!O,s.animatingY=!!A,et(s,"transform","translate3d("+O+"px,"+A+"px,0)"),this.forRepaintDummy=Ds(s),et(s,"transition","transform "+p+"ms"+(this.options.easing?" "+this.options.easing:"")),et(s,"transform","translate3d(0,0,0)"),typeof s.animated=="number"&&clearTimeout(s.animated),s.animated=setTimeout(function(){et(s,"transition",""),et(s,"transform",""),s.animated=!1,s.animatingX=!1,s.animatingY=!1},p)}}}}function Ds(o){return o.offsetWidth}function xs(o,n,i,s){return Math.sqrt(Math.pow(n.top-o.top,2)+Math.pow(n.left-o.left,2))/Math.sqrt(Math.pow(n.top-i.top,2)+Math.pow(n.left-i.left,2))*s.animation}var un=[],wi={initializeByDefault:!0},Bn={mount:function(n){for(var i in wi)wi.hasOwnProperty(i)&&!(i in n)&&(n[i]=wi[i]);un.forEach(function(s){if(s.pluginName===n.pluginName)throw"Sortable: Cannot mount plugin ".concat(n.pluginName," more than once")}),un.push(n)},pluginEvent:function(n,i,s){var c=this;this.eventCanceled=!1,s.cancel=function(){c.eventCanceled=!0};var d=n+"Global";un.forEach(function(p){i[p.pluginName]&&(i[p.pluginName][d]&&i[p.pluginName][d](pe({sortable:i},s)),i.options[p.pluginName]&&i[p.pluginName][n]&&i[p.pluginName][n](pe({sortable:i},s)))})},initializePlugins:function(n,i,s,c){un.forEach(function(m){var _=m.pluginName;if(!(!n.options[_]&&!m.initializeByDefault)){var E=new m(n,i,n.options);E.sortable=n,E.options=n.options,n[_]=E,ve(s,E.defaults)}});for(var d in n.options)if(n.options.hasOwnProperty(d)){var p=this.modifyOption(n,d,n.options[d]);typeof p<"u"&&(n.options[d]=p)}},getEventProperties:function(n,i){var s={};return un.forEach(function(c){typeof c.eventProperties=="function"&&ve(s,c.eventProperties.call(i[c.pluginName],n))}),s},modifyOption:function(n,i,s){var c;return un.forEach(function(d){n[d.pluginName]&&d.optionListeners&&typeof d.optionListeners[i]=="function"&&(c=d.optionListeners[i].call(n[d.pluginName],s))}),c}};function Ts(o){var n=o.sortable,i=o.rootEl,s=o.name,c=o.targetEl,d=o.cloneEl,p=o.toEl,m=o.fromEl,_=o.oldIndex,E=o.newIndex,O=o.oldDraggableIndex,A=o.newDraggableIndex,j=o.originalEvent,K=o.putSortable,F=o.extraEventProperties;if(n=n||i&&i[zt],!!n){var Y,tt=n.options,Z="on"+s.charAt(0).toUpperCase()+s.substr(1);window.CustomEvent&&!ye&&!Nn?Y=new CustomEvent(s,{bubbles:!0,cancelable:!0}):(Y=document.createEvent("Event"),Y.initEvent(s,!0,!0)),Y.to=p||i,Y.from=m||i,Y.item=c||i,Y.clone=d,Y.oldIndex=_,Y.newIndex=E,Y.oldDraggableIndex=O,Y.newDraggableIndex=A,Y.originalEvent=j,Y.pullMode=K?K.lastPutMode:void 0;var Q=pe(pe({},F),Bn.getEventProperties(s,n));for(var rt in Q)Y[rt]=Q[rt];i&&i.dispatchEvent(Y),tt[Z]&&tt[Z].call(n,Y)}}var Is=["evt"],Ut=function(n,i){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=s.evt,d=bs(s,Is);Bn.pluginEvent.bind(nt)(n,i,pe({dragEl:N,parentEl:Tt,ghostEl:it,rootEl:_t,nextEl:Ue,lastDownEl:br,cloneEl:St,cloneHidden:Ie,dragStarted:On,putSortable:jt,activeSortable:nt.active,originalEvent:c,oldIndex:dn,oldDraggableIndex:jn,newIndex:Jt,newDraggableIndex:Te,hideGhostForTarget:ca,unhideGhostForTarget:da,cloneNowHidden:function(){Ie=!0},cloneNowShown:function(){Ie=!1},dispatchSortableEvent:function(m){Kt({sortable:i,name:m,originalEvent:c})}},d))};function Kt(o){Ts(pe({putSortable:jt,cloneEl:St,targetEl:N,rootEl:_t,oldIndex:dn,oldDraggableIndex:jn,newIndex:Jt,newDraggableIndex:Te},o))}var N,Tt,it,_t,Ue,br,St,Ie,dn,Jt,jn,Te,pr,jt,cn=!1,Tr=!1,Ir=[],Fe,oe,_i,ki,Ko,qo,On,ln,Ln,Rn=!1,hr=!1,wr,Nt,Si=[],Pi=!1,Or=[],Mr=typeof document<"u",mr=Bi,Fo=Nn||ye?"cssFloat":"float",Os=Mr&&!Zo&&!Bi&&"draggable"in document.createElement("div"),sa=function(){if(Mr){if(ye)return!1;var o=document.createElement("x");return o.style.cssText="pointer-events:auto",o.style.pointerEvents==="auto"}}(),ua=function(n,i){var s=et(n),c=parseInt(s.width)-parseInt(s.paddingLeft)-parseInt(s.paddingRight)-parseInt(s.borderLeftWidth)-parseInt(s.borderRightWidth),d=hn(n,0,i),p=hn(n,1,i),m=d&&et(d),_=p&&et(p),E=m&&parseInt(m.marginLeft)+parseInt(m.marginRight)+Ct(d).width,O=_&&parseInt(_.marginLeft)+parseInt(_.marginRight)+Ct(p).width;if(s.display==="flex")return s.flexDirection==="column"||s.flexDirection==="column-reverse"?"vertical":"horizontal";if(s.display==="grid")return s.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(d&&m.float&&m.float!=="none"){var A=m.float==="left"?"left":"right";return p&&(_.clear==="both"||_.clear===A)?"vertical":"horizontal"}return d&&(m.display==="block"||m.display==="flex"||m.display==="table"||m.display==="grid"||E>=c&&s[Fo]==="none"||p&&s[Fo]==="none"&&E+O>c)?"vertical":"horizontal"},As=function(n,i,s){var c=s?n.left:n.top,d=s?n.right:n.bottom,p=s?n.width:n.height,m=s?i.left:i.top,_=s?i.right:i.bottom,E=s?i.width:i.height;return c===m||d===_||c+p/2===m+E/2},Ps=function(n,i){var s;return Ir.some(function(c){var d=c[zt].options.emptyInsertThreshold;if(!(!d||Ki(c))){var p=Ct(c),m=n>=p.left-d&&n<=p.right+d,_=i>=p.top-d&&i<=p.bottom+d;if(m&&_)return s=c}}),s},la=function(n){function i(d,p){return function(m,_,E,O){var A=m.options.group.name&&_.options.group.name&&m.options.group.name===_.options.group.name;if(d==null&&(p||A))return!0;if(d==null||d===!1)return!1;if(p&&d==="clone")return d;if(typeof d=="function")return i(d(m,_,E,O),p)(m,_,E,O);var j=(p?m:_).options.group.name;return d===!0||typeof d=="string"&&d===j||d.join&&d.indexOf(j)>-1}}var s={},c=n.group;(!c||yr(c)!="object")&&(c={name:c}),s.name=c.name,s.checkPull=i(c.pull,!0),s.checkPut=i(c.put),s.revertClone=c.revertClone,n.group=s},ca=function(){!sa&&it&&et(it,"display","none")},da=function(){!sa&&it&&et(it,"display","")};Mr&&!Zo&&document.addEventListener("click",function(o){if(Tr)return o.preventDefault(),o.stopPropagation&&o.stopPropagation(),o.stopImmediatePropagation&&o.stopImmediatePropagation(),Tr=!1,!1},!0);var We=function(n){if(N){n=n.touches?n.touches[0]:n;var i=Ps(n.clientX,n.clientY);if(i){var s={};for(var c in n)n.hasOwnProperty(c)&&(s[c]=n[c]);s.target=s.rootEl=i,s.preventDefault=void 0,s.stopPropagation=void 0,i[zt]._onDragOver(s)}}},Cs=function(n){N&&N.parentNode[zt]._isOutsideThisEl(n.target)};function nt(o,n){if(!(o&&o.nodeType&&o.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(o));this.el=o,this.options=n=ve({},n),o[zt]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(o.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return ua(o,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(p,m){p.setData("Text",m.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:nt.supportPointer!==!1&&"PointerEvent"in window&&(!$n||Bi),emptyInsertThreshold:5};Bn.initializePlugins(this,o,i);for(var s in i)!(s in n)&&(n[s]=i[s]);la(n);for(var c in this)c.charAt(0)==="_"&&typeof this[c]=="function"&&(this[c]=this[c].bind(this));this.nativeDraggable=n.forceFallback?!1:Os,this.nativeDraggable&&(this.options.touchStartThreshold=1),n.supportPointer?dt(o,"pointerdown",this._onTapStart):(dt(o,"mousedown",this._onTapStart),dt(o,"touchstart",this._onTapStart)),this.nativeDraggable&&(dt(o,"dragover",this),dt(o,"dragenter",this)),Ir.push(this.el),n.store&&n.store.get&&this.sort(n.store.get(this)||[]),ve(this,Es())}nt.prototype={constructor:nt,_isOutsideThisEl:function(n){!this.el.contains(n)&&n!==this.el&&(ln=null)},_getDirection:function(n,i){return typeof this.options.direction=="function"?this.options.direction.call(this,n,i,N):this.options.direction},_onTapStart:function(n){if(n.cancelable){var i=this,s=this.el,c=this.options,d=c.preventOnFilter,p=n.type,m=n.touches&&n.touches[0]||n.pointerType&&n.pointerType==="touch"&&n,_=(m||n).target,E=n.target.shadowRoot&&(n.path&&n.path[0]||n.composedPath&&n.composedPath()[0])||_,O=c.filter;if(Ks(s),!N&&!(/mousedown|pointerdown/.test(p)&&n.button!==0||c.disabled)&&!E.isContentEditable&&!(!this.nativeDraggable&&$n&&_&&_.tagName.toUpperCase()==="SELECT")&&(_=ae(_,c.draggable,s,!1),!(_&&_.animated)&&br!==_)){if(dn=ee(_),jn=ee(_,c.draggable),typeof O=="function"){if(O.call(this,n,_,this)){Kt({sortable:i,rootEl:E,name:"filter",targetEl:_,toEl:s,fromEl:s}),Ut("filter",i,{evt:n}),d&&n.preventDefault();return}}else if(O&&(O=O.split(",").some(function(A){if(A=ae(E,A.trim(),s,!1),A)return Kt({sortable:i,rootEl:A,name:"filter",targetEl:_,fromEl:s,toEl:s}),Ut("filter",i,{evt:n}),!0}),O)){d&&n.preventDefault();return}c.handle&&!ae(E,c.handle,s,!1)||this._prepareDragStart(n,m,_)}}},_prepareDragStart:function(n,i,s){var c=this,d=c.el,p=c.options,m=d.ownerDocument,_;if(s&&!N&&s.parentNode===d){var E=Ct(s);if(_t=d,N=s,Tt=N.parentNode,Ue=N.nextSibling,br=s,pr=p.group,nt.dragged=N,Fe={target:N,clientX:(i||n).clientX,clientY:(i||n).clientY},Ko=Fe.clientX-E.left,qo=Fe.clientY-E.top,this._lastX=(i||n).clientX,this._lastY=(i||n).clientY,N.style["will-change"]="all",_=function(){if(Ut("delayEnded",c,{evt:n}),nt.eventCanceled){c._onDrop();return}c._disableDelayedDragEvents(),!Lo&&c.nativeDraggable&&(N.draggable=!0),c._triggerDragStart(n,i),Kt({sortable:c,name:"choose",originalEvent:n}),Qt(N,p.chosenClass,!0)},p.ignore.split(",").forEach(function(O){na(N,O.trim(),Ei)}),dt(m,"dragover",We),dt(m,"mousemove",We),dt(m,"touchmove",We),p.supportPointer?(dt(m,"pointerup",c._onDrop),!this.nativeDraggable&&dt(m,"pointercancel",c._onDrop)):(dt(m,"mouseup",c._onDrop),dt(m,"touchend",c._onDrop),dt(m,"touchcancel",c._onDrop)),Lo&&this.nativeDraggable&&(this.options.touchStartThreshold=4,N.draggable=!0),Ut("delayStart",this,{evt:n}),p.delay&&(!p.delayOnTouchOnly||i)&&(!this.nativeDraggable||!(Nn||ye))){if(nt.eventCanceled){this._onDrop();return}p.supportPointer?(dt(m,"pointerup",c._disableDelayedDrag),dt(m,"pointercancel",c._disableDelayedDrag)):(dt(m,"mouseup",c._disableDelayedDrag),dt(m,"touchend",c._disableDelayedDrag),dt(m,"touchcancel",c._disableDelayedDrag)),dt(m,"mousemove",c._delayedDragTouchMoveHandler),dt(m,"touchmove",c._delayedDragTouchMoveHandler),p.supportPointer&&dt(m,"pointermove",c._delayedDragTouchMoveHandler),c._dragStartTimer=setTimeout(_,p.delay)}else _()}},_delayedDragTouchMoveHandler:function(n){var i=n.touches?n.touches[0]:n;Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){N&&Ei(N),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var n=this.el.ownerDocument;ut(n,"mouseup",this._disableDelayedDrag),ut(n,"touchend",this._disableDelayedDrag),ut(n,"touchcancel",this._disableDelayedDrag),ut(n,"pointerup",this._disableDelayedDrag),ut(n,"pointercancel",this._disableDelayedDrag),ut(n,"mousemove",this._delayedDragTouchMoveHandler),ut(n,"touchmove",this._delayedDragTouchMoveHandler),ut(n,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(n,i){i=i||n.pointerType=="touch"&&n,!this.nativeDraggable||i?this.options.supportPointer?dt(document,"pointermove",this._onTouchMove):i?dt(document,"touchmove",this._onTouchMove):dt(document,"mousemove",this._onTouchMove):(dt(N,"dragend",this),dt(_t,"dragstart",this._onDragStart));try{document.selection?_r(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(n,i){if(cn=!1,_t&&N){Ut("dragStarted",this,{evt:i}),this.nativeDraggable&&dt(document,"dragover",Cs);var s=this.options;!n&&Qt(N,s.dragClass,!1),Qt(N,s.ghostClass,!0),nt.active=this,n&&this._appendGhost(),Kt({sortable:this,name:"start",originalEvent:i})}else this._nulling()},_emulateDragOver:function(){if(oe){this._lastX=oe.clientX,this._lastY=oe.clientY,ca();for(var n=document.elementFromPoint(oe.clientX,oe.clientY),i=n;n&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(oe.clientX,oe.clientY),n!==i);)i=n;if(N.parentNode[zt]._isOutsideThisEl(n),i)do{if(i[zt]){var s=void 0;if(s=i[zt]._onDragOver({clientX:oe.clientX,clientY:oe.clientY,target:n,rootEl:i}),s&&!this.options.dragoverBubble)break}n=i}while(i=ea(i));da()}},_onTouchMove:function(n){if(Fe){var i=this.options,s=i.fallbackTolerance,c=i.fallbackOffset,d=n.touches?n.touches[0]:n,p=it&&pn(it,!0),m=it&&p&&p.a,_=it&&p&&p.d,E=mr&&Nt&&Bo(Nt),O=(d.clientX-Fe.clientX+c.x)/(m||1)+(E?E[0]-Si[0]:0)/(m||1),A=(d.clientY-Fe.clientY+c.y)/(_||1)+(E?E[1]-Si[1]:0)/(_||1);if(!nt.active&&!cn){if(s&&Math.max(Math.abs(d.clientX-this._lastX),Math.abs(d.clientY-this._lastY))<s)return;this._onDragStart(n,!0)}if(it){p?(p.e+=O-(_i||0),p.f+=A-(ki||0)):p={a:1,b:0,c:0,d:1,e:O,f:A};var j="matrix(".concat(p.a,",").concat(p.b,",").concat(p.c,",").concat(p.d,",").concat(p.e,",").concat(p.f,")");et(it,"webkitTransform",j),et(it,"mozTransform",j),et(it,"msTransform",j),et(it,"transform",j),_i=O,ki=A,oe=d}n.cancelable&&n.preventDefault()}},_appendGhost:function(){if(!it){var n=this.options.fallbackOnBody?document.body:_t,i=Ct(N,!0,mr,!0,n),s=this.options;if(mr){for(Nt=n;et(Nt,"position")==="static"&&et(Nt,"transform")==="none"&&Nt!==document;)Nt=Nt.parentNode;Nt!==document.body&&Nt!==document.documentElement?(Nt===document&&(Nt=fe()),i.top+=Nt.scrollTop,i.left+=Nt.scrollLeft):Nt=fe(),Si=Bo(Nt)}it=N.cloneNode(!0),Qt(it,s.ghostClass,!1),Qt(it,s.fallbackClass,!0),Qt(it,s.dragClass,!0),et(it,"transition",""),et(it,"transform",""),et(it,"box-sizing","border-box"),et(it,"margin",0),et(it,"top",i.top),et(it,"left",i.left),et(it,"width",i.width),et(it,"height",i.height),et(it,"opacity","0.8"),et(it,"position",mr?"absolute":"fixed"),et(it,"zIndex","100000"),et(it,"pointerEvents","none"),nt.ghost=it,n.appendChild(it),et(it,"transform-origin",Ko/parseInt(it.style.width)*100+"% "+qo/parseInt(it.style.height)*100+"%")}},_onDragStart:function(n,i){var s=this,c=n.dataTransfer,d=s.options;if(Ut("dragStart",this,{evt:n}),nt.eventCanceled){this._onDrop();return}Ut("setupClone",this),nt.eventCanceled||(St=oa(N),St.removeAttribute("id"),St.draggable=!1,St.style["will-change"]="",this._hideClone(),Qt(St,this.options.chosenClass,!1),nt.clone=St),s.cloneId=_r(function(){Ut("clone",s),!nt.eventCanceled&&(s.options.removeCloneOnHide||_t.insertBefore(St,N),s._hideClone(),Kt({sortable:s,name:"clone"}))}),!i&&Qt(N,d.dragClass,!0),i?(Tr=!0,s._loopId=setInterval(s._emulateDragOver,50)):(ut(document,"mouseup",s._onDrop),ut(document,"touchend",s._onDrop),ut(document,"touchcancel",s._onDrop),c&&(c.effectAllowed="move",d.setData&&d.setData.call(s,c,N)),dt(document,"drop",s),et(N,"transform","translateZ(0)")),cn=!0,s._dragStartId=_r(s._dragStarted.bind(s,i,n)),dt(document,"selectstart",s),On=!0,window.getSelection().removeAllRanges(),$n&&et(document.body,"user-select","none")},_onDragOver:function(n){var i=this.el,s=n.target,c,d,p,m=this.options,_=m.group,E=nt.active,O=pr===_,A=m.sort,j=jt||E,K,F=this,Y=!1;if(Pi)return;function tt(Ht,be){Ut(Ht,F,pe({evt:n,isOwner:O,axis:K?"vertical":"horizontal",revert:p,dragRect:c,targetRect:d,canSort:A,fromSortable:j,target:s,completed:Q,onMove:function(He,ie){return gr(_t,i,N,c,He,Ct(He),n,ie)},changed:rt},be))}function Z(){tt("dragOverAnimationCapture"),F.captureAnimationState(),F!==j&&j.captureAnimationState()}function Q(Ht){return tt("dragOverCompleted",{insertion:Ht}),Ht&&(O?E._hideClone():E._showClone(F),F!==j&&(Qt(N,jt?jt.options.ghostClass:E.options.ghostClass,!1),Qt(N,m.ghostClass,!0)),jt!==F&&F!==nt.active?jt=F:F===nt.active&&jt&&(jt=null),j===F&&(F._ignoreWhileAnimating=s),F.animateAll(function(){tt("dragOverAnimationComplete"),F._ignoreWhileAnimating=null}),F!==j&&(j.animateAll(),j._ignoreWhileAnimating=null)),(s===N&&!N.animated||s===i&&!s.animated)&&(ln=null),!m.dragoverBubble&&!n.rootEl&&s!==document&&(N.parentNode[zt]._isOutsideThisEl(n.target),!Ht&&We(n)),!m.dragoverBubble&&n.stopPropagation&&n.stopPropagation(),Y=!0}function rt(){Jt=ee(N),Te=ee(N,m.draggable),Kt({sortable:F,name:"change",toEl:i,newIndex:Jt,newDraggableIndex:Te,originalEvent:n})}if(n.preventDefault!==void 0&&n.cancelable&&n.preventDefault(),s=ae(s,m.draggable,i,!0),tt("dragOver"),nt.eventCanceled)return Y;if(N.contains(n.target)||s.animated&&s.animatingX&&s.animatingY||F._ignoreWhileAnimating===s)return Q(!1);if(Tr=!1,E&&!m.disabled&&(O?A||(p=Tt!==_t):jt===this||(this.lastPutMode=pr.checkPull(this,E,N,n))&&_.checkPut(this,E,N,n))){if(K=this._getDirection(n,s)==="vertical",c=Ct(N),tt("dragOverValid"),nt.eventCanceled)return Y;if(p)return Tt=_t,Z(),this._hideClone(),tt("revert"),nt.eventCanceled||(Ue?_t.insertBefore(N,Ue):_t.appendChild(N)),Q(!0);var V=Ki(i,m.draggable);if(!V||Ls(n,K,this)&&!V.animated){if(V===N)return Q(!1);if(V&&i===n.target&&(s=V),s&&(d=Ct(s)),gr(_t,i,N,c,s,d,n,!!s)!==!1)return Z(),V&&V.nextSibling?i.insertBefore(N,V.nextSibling):i.appendChild(N),Tt=i,rt(),Q(!0)}else if(V&&js(n,K,this)){var lt=hn(i,0,m,!0);if(lt===N)return Q(!1);if(s=lt,d=Ct(s),gr(_t,i,N,c,s,d,n,!1)!==!1)return Z(),i.insertBefore(N,lt),Tt=i,rt(),Q(!0)}else if(s.parentNode===i){d=Ct(s);var gt=0,st,ot=N.parentNode!==i,vt=!As(N.animated&&N.toRect||c,s.animated&&s.toRect||d,K),Bt=K?"top":"left",Lt=No(s,"top","top")||No(N,"top","top"),Ft=Lt?Lt.scrollTop:void 0;ln!==s&&(st=d[Bt],Rn=!1,hr=!vt&&m.invertSwap||ot),gt=Rs(n,s,d,K,vt?1:m.swapThreshold,m.invertedSwapThreshold==null?m.swapThreshold:m.invertedSwapThreshold,hr,ln===s);var At;if(gt!==0){var ne=ee(N);do ne-=gt,At=Tt.children[ne];while(At&&(et(At,"display")==="none"||At===it))}if(gt===0||At===s)return Q(!1);ln=s,Ln=gt;var re=s.nextElementSibling,Wt=!1;Wt=gt===1;var Ve=gr(_t,i,N,c,s,d,n,Wt);if(Ve!==!1)return(Ve===1||Ve===-1)&&(Wt=Ve===1),Pi=!0,setTimeout(Ms,30),Z(),Wt&&!re?i.appendChild(N):s.parentNode.insertBefore(N,Wt?re:s),Lt&&ia(Lt,0,Ft-Lt.scrollTop),Tt=N.parentNode,st!==void 0&&!hr&&(wr=Math.abs(st-Ct(s)[Bt])),rt(),Q(!0)}if(i.contains(N))return Q(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){ut(document,"mousemove",this._onTouchMove),ut(document,"touchmove",this._onTouchMove),ut(document,"pointermove",this._onTouchMove),ut(document,"dragover",We),ut(document,"mousemove",We),ut(document,"touchmove",We)},_offUpEvents:function(){var n=this.el.ownerDocument;ut(n,"mouseup",this._onDrop),ut(n,"touchend",this._onDrop),ut(n,"pointerup",this._onDrop),ut(n,"pointercancel",this._onDrop),ut(n,"touchcancel",this._onDrop),ut(document,"selectstart",this)},_onDrop:function(n){var i=this.el,s=this.options;if(Jt=ee(N),Te=ee(N,s.draggable),Ut("drop",this,{evt:n}),Tt=N&&N.parentNode,Jt=ee(N),Te=ee(N,s.draggable),nt.eventCanceled){this._nulling();return}cn=!1,hr=!1,Rn=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ci(this.cloneId),Ci(this._dragStartId),this.nativeDraggable&&(ut(document,"drop",this),ut(i,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),$n&&et(document.body,"user-select",""),et(N,"transform",""),n&&(On&&(n.cancelable&&n.preventDefault(),!s.dropBubble&&n.stopPropagation()),it&&it.parentNode&&it.parentNode.removeChild(it),(_t===Tt||jt&&jt.lastPutMode!=="clone")&&St&&St.parentNode&&St.parentNode.removeChild(St),N&&(this.nativeDraggable&&ut(N,"dragend",this),Ei(N),N.style["will-change"]="",On&&!cn&&Qt(N,jt?jt.options.ghostClass:this.options.ghostClass,!1),Qt(N,this.options.chosenClass,!1),Kt({sortable:this,name:"unchoose",toEl:Tt,newIndex:null,newDraggableIndex:null,originalEvent:n}),_t!==Tt?(Jt>=0&&(Kt({rootEl:Tt,name:"add",toEl:Tt,fromEl:_t,originalEvent:n}),Kt({sortable:this,name:"remove",toEl:Tt,originalEvent:n}),Kt({rootEl:Tt,name:"sort",toEl:Tt,fromEl:_t,originalEvent:n}),Kt({sortable:this,name:"sort",toEl:Tt,originalEvent:n})),jt&&jt.save()):Jt!==dn&&Jt>=0&&(Kt({sortable:this,name:"update",toEl:Tt,originalEvent:n}),Kt({sortable:this,name:"sort",toEl:Tt,originalEvent:n})),nt.active&&((Jt==null||Jt===-1)&&(Jt=dn,Te=jn),Kt({sortable:this,name:"end",toEl:Tt,originalEvent:n}),this.save()))),this._nulling()},_nulling:function(){Ut("nulling",this),_t=N=Tt=it=Ue=St=br=Ie=Fe=oe=On=Jt=Te=dn=jn=ln=Ln=jt=pr=nt.dragged=nt.ghost=nt.clone=nt.active=null,Or.forEach(function(n){n.checked=!0}),Or.length=_i=ki=0},handleEvent:function(n){switch(n.type){case"drop":case"dragend":this._onDrop(n);break;case"dragenter":case"dragover":N&&(this._onDragOver(n),$s(n));break;case"selectstart":n.preventDefault();break}},toArray:function(){for(var n=[],i,s=this.el.children,c=0,d=s.length,p=this.options;c<d;c++)i=s[c],ae(i,p.draggable,this.el,!1)&&n.push(i.getAttribute(p.dataIdAttr)||Bs(i));return n},sort:function(n,i){var s={},c=this.el;this.toArray().forEach(function(d,p){var m=c.children[p];ae(m,this.options.draggable,c,!1)&&(s[d]=m)},this),i&&this.captureAnimationState(),n.forEach(function(d){s[d]&&(c.removeChild(s[d]),c.appendChild(s[d]))}),i&&this.animateAll()},save:function(){var n=this.options.store;n&&n.set&&n.set(this)},closest:function(n,i){return ae(n,i||this.options.draggable,this.el,!1)},option:function(n,i){var s=this.options;if(i===void 0)return s[n];var c=Bn.modifyOption(this,n,i);typeof c<"u"?s[n]=c:s[n]=i,n==="group"&&la(s)},destroy:function(){Ut("destroy",this);var n=this.el;n[zt]=null,ut(n,"mousedown",this._onTapStart),ut(n,"touchstart",this._onTapStart),ut(n,"pointerdown",this._onTapStart),this.nativeDraggable&&(ut(n,"dragover",this),ut(n,"dragenter",this)),Array.prototype.forEach.call(n.querySelectorAll("[draggable]"),function(i){i.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Ir.splice(Ir.indexOf(this.el),1),this.el=n=null},_hideClone:function(){if(!Ie){if(Ut("hideClone",this),nt.eventCanceled)return;et(St,"display","none"),this.options.removeCloneOnHide&&St.parentNode&&St.parentNode.removeChild(St),Ie=!0}},_showClone:function(n){if(n.lastPutMode!=="clone"){this._hideClone();return}if(Ie){if(Ut("showClone",this),nt.eventCanceled)return;N.parentNode==_t&&!this.options.group.revertClone?_t.insertBefore(St,N):Ue?_t.insertBefore(St,Ue):_t.appendChild(St),this.options.group.revertClone&&this.animate(N,St),et(St,"display",""),Ie=!1}}};function $s(o){o.dataTransfer&&(o.dataTransfer.dropEffect="move"),o.cancelable&&o.preventDefault()}function gr(o,n,i,s,c,d,p,m){var _,E=o[zt],O=E.options.onMove,A;return window.CustomEvent&&!ye&&!Nn?_=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(_=document.createEvent("Event"),_.initEvent("move",!0,!0)),_.to=n,_.from=o,_.dragged=i,_.draggedRect=s,_.related=c||n,_.relatedRect=d||Ct(n),_.willInsertAfter=m,_.originalEvent=p,o.dispatchEvent(_),O&&(A=O.call(E,_,p)),A}function Ei(o){o.draggable=!1}function Ms(){Pi=!1}function js(o,n,i){var s=Ct(hn(i.el,0,i.options,!0)),c=aa(i.el,i.options,it),d=10;return n?o.clientX<c.left-d||o.clientY<s.top&&o.clientX<s.right:o.clientY<c.top-d||o.clientY<s.bottom&&o.clientX<s.left}function Ls(o,n,i){var s=Ct(Ki(i.el,i.options.draggable)),c=aa(i.el,i.options,it),d=10;return n?o.clientX>c.right+d||o.clientY>s.bottom&&o.clientX>s.left:o.clientY>c.bottom+d||o.clientX>s.right&&o.clientY>s.top}function Rs(o,n,i,s,c,d,p,m){var _=s?o.clientY:o.clientX,E=s?i.height:i.width,O=s?i.top:i.left,A=s?i.bottom:i.right,j=!1;if(!p){if(m&&wr<E*c){if(!Rn&&(Ln===1?_>O+E*d/2:_<A-E*d/2)&&(Rn=!0),Rn)j=!0;else if(Ln===1?_<O+wr:_>A-wr)return-Ln}else if(_>O+E*(1-c)/2&&_<A-E*(1-c)/2)return Ns(n)}return j=j||p,j&&(_<O+E*d/2||_>A-E*d/2)?_>O+E/2?1:-1:0}function Ns(o){return ee(N)<ee(o)?1:-1}function Bs(o){for(var n=o.tagName+o.className+o.src+o.href+o.textContent,i=n.length,s=0;i--;)s+=n.charCodeAt(i);return s.toString(36)}function Ks(o){Or.length=0;for(var n=o.getElementsByTagName("input"),i=n.length;i--;){var s=n[i];s.checked&&Or.push(s)}}function _r(o){return setTimeout(o,0)}function Ci(o){return clearTimeout(o)}Mr&&dt(document,"touchmove",function(o){(nt.active||cn)&&o.cancelable&&o.preventDefault()});nt.utils={on:dt,off:ut,css:et,find:na,is:function(n,i){return!!ae(n,i,n,!1)},extend:ks,throttle:ra,closest:ae,toggleClass:Qt,clone:oa,index:ee,nextTick:_r,cancelNextTick:Ci,detectDirection:ua,getChild:hn,expando:zt};nt.get=function(o){return o[zt]};nt.mount=function(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];n[0].constructor===Array&&(n=n[0]),n.forEach(function(s){if(!s.prototype||!s.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(s));s.utils&&(nt.utils=pe(pe({},nt.utils),s.utils)),Bn.mount(s)})};nt.create=function(o,n){return new nt(o,n)};nt.version=ws;var Pt=[],An,$i,Mi=!1,Di,xi,Ar,Pn;function qs(){function o(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this))}return o.prototype={dragStarted:function(i){var s=i.originalEvent;this.sortable.nativeDraggable?dt(document,"dragover",this._handleAutoScroll):this.options.supportPointer?dt(document,"pointermove",this._handleFallbackAutoScroll):s.touches?dt(document,"touchmove",this._handleFallbackAutoScroll):dt(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(i){var s=i.originalEvent;!this.options.dragOverBubble&&!s.rootEl&&this._handleAutoScroll(s)},drop:function(){this.sortable.nativeDraggable?ut(document,"dragover",this._handleAutoScroll):(ut(document,"pointermove",this._handleFallbackAutoScroll),ut(document,"touchmove",this._handleFallbackAutoScroll),ut(document,"mousemove",this._handleFallbackAutoScroll)),Wo(),kr(),Ss()},nulling:function(){Ar=$i=An=Mi=Pn=Di=xi=null,Pt.length=0},_handleFallbackAutoScroll:function(i){this._handleAutoScroll(i,!0)},_handleAutoScroll:function(i,s){var c=this,d=(i.touches?i.touches[0]:i).clientX,p=(i.touches?i.touches[0]:i).clientY,m=document.elementFromPoint(d,p);if(Ar=i,s||this.options.forceAutoScrollFallback||Nn||ye||$n){Ti(i,this.options,m,s);var _=Ae(m,!0);Mi&&(!Pn||d!==Di||p!==xi)&&(Pn&&Wo(),Pn=setInterval(function(){var E=Ae(document.elementFromPoint(d,p),!0);E!==_&&(_=E,kr()),Ti(i,c.options,E,s)},10),Di=d,xi=p)}else{if(!this.options.bubbleScroll||Ae(m,!0)===fe()){kr();return}Ti(i,this.options,Ae(m,!1),!1)}}},ve(o,{pluginName:"scroll",initializeByDefault:!0})}function kr(){Pt.forEach(function(o){clearInterval(o.pid)}),Pt=[]}function Wo(){clearInterval(Pn)}var Ti=ra(function(o,n,i,s){if(n.scroll){var c=(o.touches?o.touches[0]:o).clientX,d=(o.touches?o.touches[0]:o).clientY,p=n.scrollSensitivity,m=n.scrollSpeed,_=fe(),E=!1,O;$i!==i&&($i=i,kr(),An=n.scroll,O=n.scrollFn,An===!0&&(An=Ae(i,!0)));var A=0,j=An;do{var K=j,F=Ct(K),Y=F.top,tt=F.bottom,Z=F.left,Q=F.right,rt=F.width,V=F.height,lt=void 0,gt=void 0,st=K.scrollWidth,ot=K.scrollHeight,vt=et(K),Bt=K.scrollLeft,Lt=K.scrollTop;K===_?(lt=rt<st&&(vt.overflowX==="auto"||vt.overflowX==="scroll"||vt.overflowX==="visible"),gt=V<ot&&(vt.overflowY==="auto"||vt.overflowY==="scroll"||vt.overflowY==="visible")):(lt=rt<st&&(vt.overflowX==="auto"||vt.overflowX==="scroll"),gt=V<ot&&(vt.overflowY==="auto"||vt.overflowY==="scroll"));var Ft=lt&&(Math.abs(Q-c)<=p&&Bt+rt<st)-(Math.abs(Z-c)<=p&&!!Bt),At=gt&&(Math.abs(tt-d)<=p&&Lt+V<ot)-(Math.abs(Y-d)<=p&&!!Lt);if(!Pt[A])for(var ne=0;ne<=A;ne++)Pt[ne]||(Pt[ne]={});(Pt[A].vx!=Ft||Pt[A].vy!=At||Pt[A].el!==K)&&(Pt[A].el=K,Pt[A].vx=Ft,Pt[A].vy=At,clearInterval(Pt[A].pid),(Ft!=0||At!=0)&&(E=!0,Pt[A].pid=setInterval((function(){s&&this.layer===0&&nt.active._onTouchMove(Ar);var re=Pt[this.layer].vy?Pt[this.layer].vy*m:0,Wt=Pt[this.layer].vx?Pt[this.layer].vx*m:0;typeof O=="function"&&O.call(nt.dragged.parentNode[zt],Wt,re,o,Ar,Pt[this.layer].el)!=="continue"||ia(Pt[this.layer].el,Wt,re)}).bind({layer:A}),24))),A++}while(n.bubbleScroll&&j!==_&&(j=Ae(j,!1)));Mi=E}},30),fa=function(n){var i=n.originalEvent,s=n.putSortable,c=n.dragEl,d=n.activeSortable,p=n.dispatchSortableEvent,m=n.hideGhostForTarget,_=n.unhideGhostForTarget;if(i){var E=s||d;m();var O=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:i,A=document.elementFromPoint(O.clientX,O.clientY);_(),E&&!E.el.contains(A)&&(p("spill"),this.onSpill({dragEl:c,putSortable:s}))}};function qi(){}qi.prototype={startIndex:null,dragStart:function(n){var i=n.oldDraggableIndex;this.startIndex=i},onSpill:function(n){var i=n.dragEl,s=n.putSortable;this.sortable.captureAnimationState(),s&&s.captureAnimationState();var c=hn(this.sortable.el,this.startIndex,this.options);c?this.sortable.el.insertBefore(i,c):this.sortable.el.appendChild(i),this.sortable.animateAll(),s&&s.animateAll()},drop:fa};ve(qi,{pluginName:"revertOnSpill"});function Fi(){}Fi.prototype={onSpill:function(n){var i=n.dragEl,s=n.putSortable,c=s||this.sortable;c.captureAnimationState(),i.parentNode&&i.parentNode.removeChild(i),c.animateAll()},drop:fa};ve(Fi,{pluginName:"removeOnSpill"});nt.mount(new qs);nt.mount(Fi,qi);function Uo(o,n,i){const s=new Blob([o],{type:i}),c=URL.createObjectURL(s),d=document.createElement("a");d.href=c,d.download=n,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c)}function Fs(o){const{profile:n,workoutTypes:i,workouts:s,logs:c}=o,d=[];d.push("# ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº"),n&&(d.push(`
## ÐÑÐ¾ÑÐ¸Ð»Ñ`),d.push(`- **ÐÐ¼Ñ:** ${n.displayName||"ÐÐµ ÑÐºÐ°Ð·Ð°Ð½Ð¾"}`),n.telegramUsername&&d.push(`- **Username:** @${n.telegramUsername}`),d.push(`- **ID:** ${n.id}`),d.push(`- **ÐÐ°ÑÐ° ÑÐµÐ³Ð¸ÑÑÑÐ°ÑÐ¸Ð¸:** ${new Date(n.createdAt).toLocaleDateString()}`)),d.push(`
## Ð¢Ð¸Ð¿Ñ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹`);const p=i.filter(E=>!E.isDeleted);if(p.length>0?p.sort((E,O)=>(E.order??0)-(O.order??0)).forEach(E=>{d.push(`- ${E.name} (${E.category==="time"?"ÐÐ° Ð²ÑÐµÐ¼Ñ":"Ð¡Ð¸Ð»Ð¾Ð²Ð¾Ðµ"})`)}):d.push("_ÐÐµÑ Ð°ÐºÑÐ¸Ð²Ð½ÑÑ ÑÐ¸Ð¿Ð¾Ð² ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹_"),d.push(`
## ÐÑÑÐ¾ÑÐ¸Ñ`),c.length===0)return d.push("_ÐÑÑÐ¾ÑÐ¸Ñ Ð¿ÑÑÑÐ°_"),d.join(`
`);const m=new Map;return[...c].filter(E=>!E.isDeleted).sort((E,O)=>new Date(O.date).getTime()-new Date(E.date).getTime()).forEach(E=>{const O=new Date(E.date).toLocaleDateString();m.has(O)||m.set(O,[]),m.get(O).push(E)}),m.forEach((E,O)=>{d.push(`
### ${O}`),Array.from(new Set(E.map(j=>j.workoutId).filter(Boolean))).forEach(j=>{const K=s.find(tt=>tt.id===j),F=E.filter(tt=>tt.workoutId===j);K&&K.name&&d.push(`
#### ${K.name}`);const Y=new Map;F.forEach(tt=>{Y.has(tt.workoutTypeId)||Y.set(tt.workoutTypeId,[]),Y.get(tt.workoutTypeId).push(tt)}),Y.forEach((tt,Z)=>{const Q=i.find(V=>V.id===Z),rt=(Q==null?void 0:Q.name)||"ÐÐµÐ¸Ð·Ð²ÐµÑÑÐ½Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ";d.push(`- **${rt}**: ${tt.map(V=>Ws(V)).join(", ")}`)})})}),d.join(`
`)}function Ws(o){return o.duration!==void 0?`${o.duration} Ð¼Ð¸Ð½`:`${o.weight}ÐºÐ³ Ã ${o.reps}`}function pa(o,n){const i=o.totalVolume;let s="";return i<1e3?s=`${Math.round(i)}ÐºÐ³`:i<1e4?s=`${(i/1e3).toFixed(1)}Ñ`:s=`${Math.round(i/1e3)}Ñ`,`
      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-value">${o.totalWorkouts}</div>
          <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${s}</div>
          <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
        </div>
        ${o.favoriteExercise?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${o.favoriteExercise}</div>
            <div class="stat-label">ÐÑÐ±Ð¸Ð¼Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</div>
          </div>
        `:""}
        ${o.lastWorkoutDate?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${new Date(o.lastWorkoutDate).toLocaleDateString()}</div>
            <div class="stat-label">ÐÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</div>
          </div>
        `:""}
      </div>

      ${n&&n.size>0?`
        <div class="activity-list">
          <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          ${Qo(n)}
        </div>
      `:""}
    `}const Pr=o=>`https://tadatuta.github.io/21/?startapp=profile_${o}`;gs({immediate:!0});var Ho;const Dt=(Ho=window.Telegram)==null?void 0:Ho.WebApp;Dt&&(Dt.ready(),Dt.expand());let Yt="main",fn="all",Et=null,ha=null,Cr=null,ji=!1,Cn=null,qt=null,Sr="overview",Ye="ai",Wi=!1,$r=null,Pe=!1,Er=!1;function Us(o){Yt=o,pt()}let Ii=null;function te(o){let n=document.querySelector(".toast");n||(n=document.createElement("div"),n.className="toast",document.body.appendChild(n)),n.textContent=o,n.classList.add("visible"),Ii&&clearTimeout(Ii),Ii=setTimeout(()=>{n==null||n.classList.remove("visible")},2e3)}function pt(){const o=document.getElementById("app");if(!o)return;const n=localStorage.getItem("skip_tma_auth")==="true",i=!!(Dt!=null&&Dt.initData)&&!n,c=!!Ni();!i&&!c||(o.innerHTML=`
    <main class="content">
      ${Ys()}
    </main>
    <nav class="navigation">
      <button class="navigation__item ${Yt==="main"?"navigation__item_active":""}" data-page="main">
        <span class="navigation__icon">ðï¸</span>
        <span class="navigation__label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Yt==="stats"?"navigation__item_active":""}" data-page="stats">
        <span class="navigation__icon">ð</span>
        <span class="navigation__label">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Yt==="profile-settings"?"navigation__item_active":""}" data-page="profile-settings">
        <span class="navigation__icon">ð¤</span>
        <span class="navigation__label">ÐÑÐ¾ÑÐ¸Ð»Ñ</span>
      </button>
      <button class="navigation__item ${Yt==="settings"?"navigation__item_active":""}" data-page="settings">
        <span class="navigation__icon">âï¸</span>
        <span class="navigation__label">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</span>
      </button>
    </nav>
    <div id="sync-status" class="sync-status"></div>
  `,o.querySelectorAll(".navigation__item").forEach(d=>{d.addEventListener("click",()=>{const p=d.getAttribute("data-page");Us(p)})}),eu(),Vs())}let ma="idle";z.onSyncStatusChange(o=>{ma=o,Ui()});function Ui(){const o=document.getElementById("sync-status");if(!o)return;o.className="sync-status";let n="",i="";switch(ma){case"saving":n="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...",i="ð",o.classList.add("sync-status_saving");break;case"success":n="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾",i="â",o.classList.add("sync-status_success");break;case"error":n="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸",i="â ï¸",o.classList.add("sync-status_error");break;case"idle":if(!navigator.onLine)n="ÐÑÑÐ»Ð°Ð¹Ð½",i="ð¡",o.classList.add("sync-status_offline");else return;break}o.innerHTML=`${i} ${n}`}window.addEventListener("online",()=>{z.sync(),Ui()});window.addEventListener("offline",()=>Ui());function Ys(){switch(Yt){case"main":return Hs();case"stats":return Zs();case"settings":return Gs();case"profile-settings":return Qs();case"public-profile":return Js();default:return""}}function zs(){const o=z.getActiveWorkout();if(o){const n=o.status==="paused";return`
      <div class="workout-controls card">
        <div class="workout-controls__header">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span class="workout-status ${n?"workout-status_paused":""}">
              ${n?"â¸ï¸ ÐÐ°ÑÐ·Ð°":"ð¥ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° Ð°ÐºÑÐ¸Ð²Ð½Ð°"}
            </span>
            <span class="workout-timer">00:00</span>
          </div>
          ${o.name?`<span class="workout-name">${o.name}</span>`:""}
        </div>
        <div class="workout-controls__actions">
          ${n?'<button class="button" id="resume-workout-btn">ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ</button>':'<button class="button button_secondary" id="pause-workout-btn">ÐÐ°ÑÐ·Ð°</button>'}
          <button class="button button_destructive" id="finish-workout-btn">ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ</button>
        </div>
      </div>
    `}return Er?`
      <div class="workout-controls card">
        <h3 class="subtitle" style="margin-top: 0">ÐÐ°ÑÐ°Ð»Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</h3>
        <form id="start-workout-form" style="display: flex; flex-direction: column; gap: 12px;">
          <input class="input" type="text" name="workoutName" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð¾Ð¿ÑÐ¸Ð¾Ð½Ð°Ð»ÑÐ½Ð¾)">
          <div style="display: flex; gap: 8px;">
            <button class="button" type="submit">ÐÐ°ÑÐ°ÑÑ</button>
            <button class="button button_secondary" type="button" id="cancel-start-workout-btn">ÐÑÐ¼ÐµÐ½Ð°</button>
          </div>
        </form>
      </div>
    `:`
    <button class="button" id="start-workout-btn" style="margin-bottom: 24px;">â¶ï¸ ÐÐ°ÑÐ°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ</button>
  `}let Oe=null;function Yo(){const o=z.getActiveWorkout(),n=document.querySelector(".workout-timer");if(!o||!n){Oe&&(clearInterval(Oe),Oe=null);return}const i=new Date(o.startTime).getTime(),s=Date.now();let c=s-i;o.pauseIntervals.forEach(_=>{const E=new Date(_.start).getTime(),O=_.end?new Date(_.end).getTime():(o.status==="paused",s);O>E&&(c-=O-E)});const d=Math.floor(Math.max(0,c)/1e3),p=Math.floor(d/60),m=d%60;n.textContent=`${p.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`}function Vs(){const o=z.getActiveWorkout();Yo(),o&&o.status==="active"?Oe||(Oe=setInterval(Yo,1e3)):Oe&&(clearInterval(Oe),Oe=null)}let Vt=0,Li="";function Yi(o){const n=new Date;n.setHours(0,0,0,0);const i=new Date(n);i.setDate(n.getDate()-o*7),i.setHours(23,59,59,999);const s=new Date(i);return s.setDate(i.getDate()-6),s.setHours(0,0,0,0),{start:s,end:i,label:`${s.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})} - ${i.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}`}}function Hs(){var p;const o=z.getWorkoutTypes(),n=z.getLogs(),i=n[n.length-1],s=i==null?void 0:i.workoutTypeId,c=Et?n.find(m=>m.id===Et):null,{label:d}=Yi(Vt);return`
    <div class="page-content" id="main-content">
      ${zs()}
      <h1 class="title">${Et?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´ÑÐ¾Ð´Ð°":"ÐÐ¾Ð²ÑÐ¹ Ð¿Ð¾Ð´ÑÐ¾Ð´"}</h1>
      <form class="workout-form" id="log-form">
        <div class="form-group">
          <label class="label">Ð¢Ð¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</label>
          <select class="select" name="typeId" id="workout-type-select" required>
            ${o.map(m=>`<option value="${m.id}" ${(Et?c&&m.id===c.workoutTypeId:m.id===s)?"selected":""}>${m.name}</option>`).join("")}
          </select>
        </div>
        
        <div id="strength-inputs" style="display: none;">
            <div class="form-row">
              <div class="form-group">
                <label class="label">ÐÐµÑ (ÐºÐ³)</label>
                <input class="input" type="number" name="weight" step="0.5" placeholder="0" value="${Et&&c?c.weight??"":""}">

              </div>
              <div class="form-group">
                <label class="label">ÐÐ¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</label>
                <input class="input" type="number" name="reps" placeholder="0" value="${Et&&c?c.reps??"":""}">

              </div>
            </div>
        </div>

        <div id="time-inputs" style="display: none;">
            <div class="form-row">
                <div class="form-group">
                    <label class="label">Ð§Ð°ÑÑ</label>
                    <input class="input" type="number" name="duration_hours" placeholder="0" value="${Et&&c&&c.duration?Math.floor(c.duration/60):""}">
                </div>
                <div class="form-group">
                    <label class="label">ÐÐ¸Ð½ÑÑÑ</label>
                    <input class="input" type="number" name="duration_minutes" placeholder="0" value="${Et&&c&&c.duration?c.duration%60:""}">
                </div>
            </div>
        </div>

        ${Et&&c?`
        <div class="form-group">
          <label class="label">ÐÐ°ÑÐ°</label>
          <input class="input" type="date" name="date" required value="${c.date.split("T")[0]}">
        </div>
        `:""}

        <button class="button" type="submit">${Et?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ":"ÐÐ°ÑÐ¸ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ"}</button>
        ${Et?'<button class="button button_secondary" type="button" id="cancel-edit-btn" style="margin-top: 12px;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        ${!Et&&i?`<button class="button button_secondary" type="button" id="duplicate-last-btn" style="margin-top: 12px;">ÐÐ¾Ð²ÑÐ¾ÑÐ¸ÑÑ: ${(p=o.find(m=>m.id===i.workoutTypeId))==null?void 0:p.name} ${i.weight!==void 0?`${i.weight}ÐºÐ³ Ã ${i.reps}`:`${i.duration} Ð¼Ð¸Ð½`}</button>`:""}

      </form>
      <div class="recent-logs">
        <div class="recent-logs__header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
           <button class="icon-btn" id="prev-week-btn">âï¸</button>
           <div id="week-label-container" style="display: flex; align-items: center; gap: 8px; position: relative;">
             <span style="font-size: 18px; position: relative; display: inline-block;">
               ð
               <input type="date" id="calendar-input" value="${Li}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
             </span>
             <h2 class="subtitle" style="margin: 0;">${Vt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":d}</h2>
             <label class="filter-toggle" title="Ð¤Ð¸Ð»ÑÑÑ Ð¿Ð¾ ÑÐ¸Ð¿Ñ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ">
               <input type="checkbox" id="filter-toggle-input" ${Wi?"checked":""}>
               <span class="filter-toggle__icon">ð</span>
             </label>
           </div>
           <button class="icon-btn" id="next-week-btn" ${Vt===0?"disabled":""} style="${Vt===0?"opacity: 0.3; cursor: default;":""}">â¶ï¸</button>
        </div>
        <div id="logs-list">
          ${ga()}
        </div>
      </div>
    </div>
  `}function ga(){var d;const o=z.getLogs(),n=z.getWorkoutTypes(),{start:i,end:s}=Yi(Vt);let c=o.filter(p=>{const m=new Date(p.date);return m>=i&&m<=s});if(Wi){const p=(d=document.querySelector('select[name="typeId"]'))==null?void 0:d.value;p&&(c=c.filter(m=>m.workoutTypeId===p))}return va(c,n,!0)}function vr(){const o=document.getElementById("logs-list"),n=document.querySelector("#week-label-container .subtitle");if(o&&(o.innerHTML=ga(),Xs()),n){const{label:s}=Yi(Vt);n.textContent=Vt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":s}const i=document.getElementById("next-week-btn");i&&(i.disabled=Vt===0,i.style.opacity=Vt===0?"0.3":"",i.style.cursor=Vt===0?"default":"")}function Xs(){document.querySelectorAll(".log-set__delete").forEach(o=>{o.addEventListener("click",async()=>{const n=o.getAttribute("data-id");n&&(Et===n&&(Et=null),await z.deleteLog(n),pt())})}),document.querySelectorAll(".log-set__edit").forEach(o=>{o.addEventListener("click",()=>{Et=o.getAttribute("data-id"),pt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(o=>{o.addEventListener("click",()=>{const n=o.getAttribute("data-date");n&&ya(n)})})}function va(o,n,i){if(o.length===0)return'<p class="hint">ÐÐµÑ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð·Ð° ÑÑÐ¾Ñ Ð¿ÐµÑÐ¸Ð¾Ð´</p>';const s=new Map;[...o].sort((p,m)=>new Date(m.date).getTime()-new Date(p.date).getTime()).forEach(p=>{const _=new Date(p.date).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"});s.has(_)||s.set(_,[]),s.get(_).push(p)});const c=z.getWorkouts();let d="";return s.forEach((p,m)=>{var Y;const _=((Y=p[0])==null?void 0:Y.date.split("T")[0])||"",E=new Set;p.forEach(tt=>{tt.workoutId&&E.add(tt.workoutId)});const O=Array.from(E).sort((tt,Z)=>{var gt,st;const Q=c.find(ot=>ot.id===tt),rt=c.find(ot=>ot.id===Z),V=(Q==null?void 0:Q.startTime)||((gt=p.find(ot=>ot.workoutId===tt))==null?void 0:gt.date)||"",lt=(rt==null?void 0:rt.startTime)||((st=p.find(ot=>ot.workoutId===Z))==null?void 0:st.date)||"";return new Date(lt).getTime()-new Date(V).getTime()}),A=O.length===1?O[0]:null,j=A?c.find(tt=>tt.id===A):null,K=j&&j.name,F=j?Math.round(z.getWorkoutDuration(j)):0;d+='<div class="log-day">',d+=`<div class="log-day__header">
      <span>${m}${K?` â¢ ${j.name}`:""}${j?` â¢ ${F} Ð¼Ð¸Ð½`:""}</span>
      ${i?`<button class="share-btn" data-date="${_}" title="ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ">ð¤</button>`:""}
    </div>`,O.forEach(tt=>{const Z=c.find(lt=>lt.id===tt),Q=p.filter(lt=>lt.workoutId===tt);if(!(O.length===1&&(K||!(Z!=null&&Z.name)))){const lt=Z?Math.round(z.getWorkoutDuration(Z)):0;d+=`<h3 class="workout-subheader">
                ${(Z==null?void 0:Z.name)||"Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°"} 
                <span class="workout-subheader__time">${lt} Ð¼Ð¸Ð½</span>
            </h3>`}const V=new Map;Q.forEach(lt=>{V.has(lt.workoutTypeId)||V.set(lt.workoutTypeId,[]),V.get(lt.workoutTypeId).push(lt)}),V.forEach((lt,gt)=>{const st=n.find(ot=>ot.id===gt);d+=`
            <div class="log-exercise">
              <div class="log-exercise__name">${(st==null?void 0:st.name)||"Ð£Ð´Ð°Ð»ÐµÐ½Ð¾"}</div>
              <div class="log-exercise__sets">
                ${lt.map(ot=>`
                  <div class="log-set ${ot.id===Et?"log-set_active-edit":""} ${ot.id===Cn?"log-set_new":""}">
                    <div class="log-set__info">
                      ${ot.weight!==void 0&&ot.reps!==void 0?`
                        <span class="log-set__weight">${ot.weight} ÐºÐ³</span>
                        <span class="log-set__times">Ã</span>
                        <span class="log-set__reps">${ot.reps}</span>
                      `:`
                        <span class="log-set__reps">â± ${ot.duration} Ð¼Ð¸Ð½</span>
                      `}
                    </div>
                    ${i?`
                    <div class="log-set__actions">
                      <button class="log-set__edit" data-id="${ot.id}">âï¸</button>
                      <button class="log-set__delete" data-id="${ot.id}">Ã</button>
                    </div>
                    `:""}
                  </div>
                `).join("")}
              </div>
            </div>
          `})}),d+="</div>"}),d}function Gs(){const o=z.getWorkoutTypes(),n=qt?o.find(i=>i.id===qt):null;return`
    <div class="page-content">
      <h1 class="title">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</h1>
      <div class="settings-section">
        <h2 class="subtitle">${qt?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¿Ð°":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸"}</h2>
        <form class="add-type-form" id="add-type-form" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 8px; flex-direction: column;">
            <input class="input" type="text" id="new-type-name" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð½Ð°Ð¿Ñ. ÐÐ¸Ð¼ Ð³Ð°Ð½ÑÐµÐ»ÐµÐ¹)" required value="${n?n.name:""}">
            
            <div class="category-switch" style="display: flex; gap: 12px; margin-bottom: 8px;">
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="strength" ${!n||n.category!=="time"?"checked":""}>
                    Ð¡Ð¸Ð»Ð¾Ð²Ð¾Ðµ
                </label>
                <label style="display: flex; align-items: center; gap: 4px;">
                    <input type="radio" name="new-type-category" value="time" ${n&&n.category==="time"?"checked":""}>
                    ÐÐ° Ð²ÑÐµÐ¼Ñ
                </label>
            </div>

            <button class="button" type="submit">${qt?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ"}</button>
          </div>
          ${qt?'<button class="button button_secondary" type="button" id="cancel-edit-type-btn" style="margin-top: 8px; width: 100%;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        </form>

        <h2 class="subtitle">Ð¢Ð¸Ð¿Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
        <div class="type-list" id="workout-type-list">
          ${o.map(i=>`
            <div class="type-item" data-id="${i.id}">
              <span class="drag-handle" style="cursor: grab; margin-right: 12px; opacity: 0.5;">â®â®</span>
              <span style="flex-grow: 1;">${i.name}</span>
              <div style="display: flex; gap: 8px;">
                <button class="type-item__edit icon-btn" data-id="${i.id}" title="Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ">âï¸</button>
                <button class="type-item__delete icon-btn" data-id="${i.id}" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">Ã</button>
              </div>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `}function Qs(){var d,p;const o=z.getProfile(),n=(o==null?void 0:o.isPublic)??!1,i=(o==null?void 0:o.displayName)||((p=(d=Dt==null?void 0:Dt.initDataUnsafe)==null?void 0:d.user)==null?void 0:p.first_name)||"",s=z.getProfileIdentifier(),c=s?Pr(s):"";return`
    <div class="page-content profile-page">
      <h1 class="title">ÐÑÐ¾ÑÐ¸Ð»Ñ</h1>
      
      <div class="profile-header">
        <div class="profile-avatar">
          ${o!=null&&o.photoUrl?`<img src="${o.photoUrl}" alt="${i}" class="profile-avatar-img">`:i.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${i}</div>
        <div class="profile-subtitle">${n?"ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ":"ÐÑÐ¸Ð²Ð°ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ"}</div>
      </div>

      <div class="stats-tabs">
        <button class="stats-tab profile-tab ${Ye==="ai"?"active":""}" data-tab="ai">AI</button>
        <button class="stats-tab profile-tab ${Ye==="public"?"active":""}" data-tab="public">ÐÑÐ±Ð»Ð¸ÑÐ½Ð¾Ðµ</button>
        <button class="stats-tab profile-tab ${Ye==="data"?"active":""}" data-tab="data">ÐÐ°Ð½Ð½ÑÐµ</button>
      </div>

      <div class="profile-settings">

        ${Ye==="public"?`
          <div class="settings-section">
            <div class="settings-section-title">ÐÐ¸Ð´Ð¸Ð¼Ð¾ÑÑÑ</div>
            <div class="toggle-row">
              <div class="toggle-label">
                <span class="toggle-label-text">ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</span>
                <span class="toggle-label-hint">ÐÑÑÐ³Ð¸Ðµ ÑÐ¼Ð¾Ð³ÑÑ Ð²Ð¸Ð´ÐµÑÑ Ð²Ð°ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÑ</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="profile-public-toggle" ${n?"checked":""}>
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row" style="margin-top: 12px;">
              <div class="toggle-label">
                <span class="toggle-label-text">ÐÐ¾ÐºÐ°Ð·ÑÐ²Ð°ÑÑ Ð²ÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ</span>
                <span class="toggle-label-hint">ÐÐ¾Ð´ÑÐ¾Ð±Ð½ÑÐ¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð² Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ð¼ Ð¿ÑÐ¾ÑÐ¸Ð»Ðµ</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="profile-history-toggle" ${o!=null&&o.showFullHistory?"checked":""}>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title">ÐÐ¼Ñ</div>
            <input class="input" type="text" id="profile-display-name" value="${i}" placeholder="ÐÐ°ÑÐµ Ð¸Ð¼Ñ">
          </div>

          ${n&&s?`
            <div class="settings-section">
              <div class="settings-section-title">Ð¡ÑÑÐ»ÐºÐ° Ð½Ð° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</div>
              <div class="profile-link-section">
                <a href="${c}" target="_blank" class="profile-link-url">${c}</a>
                <div class="profile-link-actions">
                  <button class="button button_secondary" id="copy-profile-link">ÐÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ</button>
                  <button class="button" id="share-profile-link">ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ</button>
                </div>
              </div>
            </div>
          `:""}

          <div class="settings-section">
            <div class="settings-section-title">ÐÑÐµÐ²ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</div>
            ${function(){const m=z.getLogs(),_=z.getWorkoutTypes(),E=m.reduce((Z,Q)=>Z+(Q.weight||0)*(Q.reps||0),0),O=new Set(m.map(Z=>Z.date.split("T")[0])),A=O.size,j=m.length>0?[...m].sort((Z,Q)=>new Date(Q.date).getTime()-new Date(Z.date).getTime())[0].date:void 0,K=new Map;m.forEach(Z=>{K.set(Z.workoutTypeId,(K.get(Z.workoutTypeId)||0)+1)});let F,Y=0;return K.forEach((Z,Q)=>{if(Z>Y){Y=Z;const rt=_.find(V=>V.id===Q);rt&&(F=rt.name)}}),pa({totalWorkouts:A,totalVolume:E,favoriteExercise:F,lastWorkoutDate:j},O)}()}
          </div>
  
          ${o!=null&&o.friends&&o.friends.length>0?`
          <div class="settings-section">
              <div class="settings-section-title">ÐÑÑÐ·ÑÑ (${o.friends.length})</div>
              <div class="friends-list">
                  ${o.friends.map(m=>`
                      <a href="${Pr(m.identifier)}" class="friend-item" style="display: flex; align-items: center; gap: 12px; padding: 8px 0; border-bottom: 1px solid var(--border-color); cursor: pointer; text-decoration: none; color: inherit;">
                          <div class="friend-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--surface-color-alt); display: flex; align-items: center; justify-content: center; overflow: hidden;">
                              ${m.photoUrl?`<img src="${m.photoUrl}" style="width: 100%; height: 100%; object-fit: cover;">`:m.displayName.charAt(0).toUpperCase()}
                          </div>
                          <div class="friend-info" style="flex-grow: 1;">
                              <div class="friend-name" style="font-weight: 500;">${m.displayName}</div>
                          </div>
                          <div class="friend-arrow">âº</div>
                      </a>
                  `).join("")}
              </div>
          </div>
          `:""}

          <button class="button" id="save-profile-btn" style="margin-top: 12px;">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
        `:""}

        ${Ye==="ai"?`
          <div class="settings-section">
            <div class="settings-section">
                <div class="settings-section-title">AI Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°ÑÐ¸Ð¸</div>
                
                <div class="ai-controls" style="display: flex; flex-direction: column; gap: 12px;">
                    <button class="button" id="ai-general-btn" ${Pe?"disabled":""}>
                        ${Pe?"ÐÐ½Ð°Ð»Ð¸Ð·...":"â¨ ÐÐ±ÑÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·"}
                    </button>

                    <div class="ai-plan-section">
                        <h3 class="workout-subheader" style="margin-bottom: 8px;">ÐÐ»Ð°Ð½ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h3>
                        <div class="form-group">
                            <label class="label">ÐÐµÑÐ¸Ð¾Ð´</label>
                            <select class="select" id="ai-plan-period">
                                <option value="day">ÐÐ° ÑÐµÐ³Ð¾Ð´Ð½Ñ</option>
                                <option value="week">ÐÐ° Ð½ÐµÐ´ÐµÐ»Ñ</option>
                            </select>
                        </div>
                          
                        <div class="toggle-row" style="margin-top: 24px;">
                          <div class="toggle-label">
                              <span class="toggle-label-text">Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð¾Ð²Ð°ÑÑ Ð½Ð¾Ð²ÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ</span>
                          </div>
                          <label class="toggle-switch">
                              <input type="checkbox" id="ai-allow-new">
                              <span class="toggle-slider"></span>
                          </label>
                        </div>
                        <button class="button" id="ai-plan-btn" ${Pe?"disabled":""} style="margin-top: 8px;">
                            ${Pe?"ÐÐµÐ½ÐµÑÐ°ÑÐ¸Ñ...":"ð Ð¡Ð¾Ð·Ð´Ð°ÑÑ Ð¿Ð»Ð°Ð½"}
                        </button>
                    </div>
                </div>

                <div id="ai-result-container" class="ai-result" style="margin-top: 24px; background: var(--surface-color-alt); padding: 16px; border-radius: 12px; ${$r?"":"display: none;"}">
                    <div class="markdown-body" style="white-space: pre-wrap; font-family: inherit;">${$r||""}</div>
                </div>
            </div>

            <div class="settings-section-title">ÐÐ¸ÑÐ½ÑÐµ Ð´Ð°Ð½Ð½ÑÐµ (ÐÑÐ¸Ð²Ð°ÑÐ½Ð¾)</div>
            <p class="hint" style="margin-bottom: 12px; font-size: 0.9em;">Ð­ÑÐ¸ Ð´Ð°Ð½Ð½ÑÐµ Ð¸ÑÐ¿Ð¾Ð»ÑÐ·ÑÑÑÑÑ ÑÐ¾Ð»ÑÐºÐ¾ Ð´Ð»Ñ Ð¿ÐµÑÑÐ¾Ð½Ð°Ð»Ð¸Ð·Ð°ÑÐ¸Ð¸ ÑÐ¾Ð²ÐµÑÐ¾Ð² Ð¾Ñ AI Ð¸ Ð½Ðµ Ð²Ð¸Ð´Ð½Ñ Ð´ÑÑÐ³Ð¸Ð¼ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»ÑÐ¼.</p>
            
            <div class="form-row">
              <div class="form-group">
                  <label class="label">ÐÐ¾Ð»</label>
                  <select class="select" id="profile-gender">
                      <option value="" ${o!=null&&o.gender?"":"selected"}>ÐÐµ ÑÐºÐ°Ð·Ð°Ð½Ð¾</option>
                      <option value="male" ${(o==null?void 0:o.gender)==="male"?"selected":""}>ÐÑÐ¶ÑÐºÐ¾Ð¹</option>
                      <option value="female" ${(o==null?void 0:o.gender)==="female"?"selected":""}>ÐÐµÐ½ÑÐºÐ¸Ð¹</option>
                  </select>
              </div>
              <div class="form-group">
                  <label class="label">ÐÐ°ÑÐ° ÑÐ¾Ð¶Ð´ÐµÐ½Ð¸Ñ</label>
                  <input class="input" type="date" id="profile-birthdate" value="${(o==null?void 0:o.birthDate)||""}">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                  <label class="label">Ð Ð¾ÑÑ (ÑÐ¼)</label>
                  <input class="input" type="number" id="profile-height" placeholder="180" value="${(o==null?void 0:o.height)||""}">
              </div>
              <div class="form-group">
                  <label class="label">ÐÐµÑ (ÐºÐ³)</label>
                  <input class="input" type="number" id="profile-weight" placeholder="75" value="${(o==null?void 0:o.weight)||""}">
              </div>
            </div>

            <div class="form-group">
               <label class="label">ÐÐ¾Ð¿Ð¾Ð»Ð½Ð¸ÑÐµÐ»ÑÐ½Ð°Ñ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ</label>
               <textarea class="input" id="profile-additional-info" rows="3" placeholder="Ð£ÐºÐ°Ð¶Ð¸ÑÐµ ÑÑÐ°Ð²Ð¼Ñ, Ð¾Ð³ÑÐ°Ð½Ð¸ÑÐµÐ½Ð¸Ñ, ÑÐµÐ»Ð¸ Ð¸Ð»Ð¸ Ð»ÑÐ±ÑÑ Ð´ÑÑÐ³ÑÑ Ð¸Ð½ÑÐ¾ÑÐ¼Ð°ÑÐ¸Ñ, ÐºÐ¾ÑÐ¾ÑÐ°Ñ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ AI Ð´Ð°Ð²Ð°ÑÑ Ð±Ð¾Ð»ÐµÐµ ÑÐ¾ÑÐ½ÑÐµ ÑÐ¾Ð²ÐµÑÑ...">${(o==null?void 0:o.additionalInfo)||""}</textarea>
            </div>
            <button class="button" id="save-profile-btn" style="margin-top: 12px;">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
          </div>
        `:""}

        ${Ye==="data"?`
          <div class="settings-section">
            <div class="settings-section-title">Ð£Ð¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸</div>
            <div style="display: flex; flex-direction: column; gap: 12px;">
              <button class="button button_secondary" id="export-json-btn">Ð­ÐºÑÐ¿Ð¾ÑÑ JSON (Backup)</button>
              <button class="button button_secondary" id="export-md-btn">Ð­ÐºÑÐ¿Ð¾ÑÑ Markdown</button>
              <button class="button button_secondary" id="import-json-btn">ÐÐ¼Ð¿Ð¾ÑÑ JSON (Restore)</button>
              <input type="file" id="import-file-input" style="display: none" accept=".json">
            </div>
          </div>
        `:""}

      </div>
    </div>
  `}function Js(){if(!ha)return`
      <div class="page-content">
        <div class="profile-not-found">
          <div class="profile-not-found-icon">ð</div>
          <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½</div>
        </div>
      </div>
    `;if(!Cr)return ji?`
        <div class="page-content">
          <div class="profile-not-found">
            <div class="profile-not-found-icon">ð</div>
            <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐºÑÑÑ Ð¸Ð»Ð¸ Ð½Ðµ ÑÑÑÐµÑÑÐ²ÑÐµÑ</div>
          </div>
        </div>
      `:`
      <div class="page-content">
        <div class="profile-loading">ÐÐ°Ð³ÑÑÐ·ÐºÐ° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ...</div>
      </div>
    `;const o=Cr;return o.logs&&(o.logs=o.logs.filter(n=>!n.isDeleted)),o.workoutTypes&&(o.workoutTypes=o.workoutTypes.filter(n=>!n.isDeleted)),`
    <div class="page-content profile-page">
      <div class="profile-header">
        <div class="profile-avatar">
          ${o.photoUrl?`<img src="${o.photoUrl}" alt="${o.displayName}" class="profile-avatar-img">`:o.displayName.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${o.displayName}</div>
        <div class="profile-subtitle">@${o.identifier}</div>
        ${function(){const n=z.getProfile();if(n&&(n.telegramUsername===o.identifier||`id_${n.telegramUserId}`===o.identifier))return"";const s=z.isFriend(o.identifier);return`
                <button class="button ${s?"button_secondary":""}" id="friend-action-btn" data-id="${o.identifier}" data-name="${o.displayName}" data-photo="${o.photoUrl||""}" style="margin-top: 12px; height: 36px; font-size: 14px; display: flex; align-items: center; justify-content: center;">
                    ${s?"Ð£Ð´Ð°Ð»Ð¸ÑÑ Ð¸Ð· Ð´ÑÑÐ·ÐµÐ¹":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ Ð² Ð´ÑÑÐ·ÑÑ"}
                </button>
            `}()}
      </div>

      ${function(){let n=0;o.logs&&(n=o.logs.reduce((d,p)=>d+(p.weight||0)*(p.reps||0),0));const i=Math.max(o.stats.totalVolume,n),s={...o.stats,totalVolume:i},c=o.logs?new Set(o.logs.map(d=>d.date.split("T")[0])):new Set;return pa(s,c)}()}

      ${o.recentActivity.length>0?`
        <div class="activity-list">
          <h2 class="subtitle">ÐÐµÐ´Ð°Ð²Ð½ÑÑ Ð°ÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          ${o.recentActivity.map(n=>`
            <div class="activity-item">
              <span class="activity-date">${new Date(n.date).toLocaleDateString()}</span>
              <span class="activity-count">${n.exerciseCount} ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹</span>
            </div>
          `).join("")}
        </div>
      `:""}

      ${o.logs&&o.logs.length>0&&o.workoutTypes?`
        <div class="recent-logs">
          <h2 class="subtitle">ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
          <div id="logs-list">
            ${va(o.logs,o.workoutTypes,!1)}
          </div>
        </div>
      `:""}
    </div>
  `}function Zs(){const o=z.getLogs(),n=z.getWorkouts(),i=z.getWorkoutTypes();if(o.length===0)return`
      <div class="page-content">
        <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
        <p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</p>
      </div>
    `;const s=o.reduce((m,_)=>m+(_.weight||0)*(_.reps||0),0),c=o.reduce((m,_)=>m+(_.reps||0),0),d=us(n);let p=`
    <div class="page-content">
      <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
      <div class="stats-tabs">
        <button class="stats-tab ${Sr==="overview"?"active":""}" data-tab="overview">ÐÐ±Ð·Ð¾Ñ</button>
        <button class="stats-tab ${Sr==="progress"?"active":""}" data-tab="progress">ÐÑÐ¾Ð³ÑÐµÑÑ</button>
      </div>
  `;if(Sr==="overview"){const m=ss(n,o);p+=`
        <div class="stats-section">
            <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
            ${Qo(m)}
        </div>

        <div class="stats-summary">
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
                <div class="stat-metric__value">${m.size}</div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">Ð¡ÑÐµÐ´. Ð´Ð»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ</div>
                <div class="stat-metric__value">${d.averageMinutes}<span class="stat-metric__unit">Ð¼Ð¸Ð½</span></div>
            </div>
             <div class="stat-metric">
                <div class="stat-metric__label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼</div>
                <div class="stat-metric__value">${Math.round(s/1e3)}<span class="stat-metric__unit">Ñ</span></div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ Ð¿Ð¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</div>
                <div class="stat-metric__value">${c}</div>
            </div>
        </div>

        <div class="charts-section">
            <h2 class="subtitle">ÐÐ»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
            <div class="chart-container">
                ${cs(n)}
            </div>
        </div>
     `}else if(p+=`
        <div class="form-group">
            <label class="label">Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</label>
            <select class="select" id="stat-type-select">
                <option value="all">ÐÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ (ÐÐ±ÑÐµÐ¼)</option>
                ${i.map(m=>`<option value="${m.id}" ${fn===m.id?"selected":""}>${m.name}</option>`).join("")}
            </select>
        </div>
    `,fn==="all")p+=`
            <div class="charts-section">
                <h2 class="subtitle">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼ Ð¿Ð¾ Ð´Ð½ÑÐ¼</h2>
                <div class="chart-container">
                    ${$o(o)}
                </div>
            </div>
        `;else{const m=o.filter(E=>E.workoutTypeId===fn),_=as(m,fn);p+=`
             <div class="charts-section">
                <h2 class="subtitle">ÐÑÐ¾Ð³ÑÐµÑÑ ÑÐ¸Ð»Ð¾Ð²ÑÑ (1RM)</h2>
                <div class="chart-container">
                    ${ls(_)}
                </div>
            </div>
            
            <div class="charts-section" style="margin-top: 24px;">
                <h2 class="subtitle">ÐÐ±ÑÐµÐ¼ Ð½Ð°Ð³ÑÑÐ·ÐºÐ¸</h2>
                 <div class="chart-container">
                    ${$o(m)}
                </div>
            </div>
        `}return p+="</div>",p}function tu(o){const n=z.getLogs(),i=z.getWorkoutTypes(),s=n.filter(E=>E.date.startsWith(o));if(s.length===0)return"";const d=new Date(s[0].date).toLocaleDateString("ru-RU",{day:"numeric",month:"long"}),p=new Map;s.forEach(E=>{p.has(E.workoutTypeId)||p.set(E.workoutTypeId,[]),p.get(E.workoutTypeId).push(E)});let m=`ðï¸ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° ${d}

`;p.forEach((E,O)=>{const A=i.find(j=>j.id===O);m+=`${(A==null?void 0:A.name)||"Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ"}:
`,E.forEach(j=>{j.duration?m+=`  â± ${j.duration} Ð¼Ð¸Ð½
`:m+=`  ${j.weight} ÐºÐ³ Ã ${j.reps}
`}),m+=`
`});const _=s.reduce((E,O)=>E+(O.weight&&O.reps?O.weight*O.reps:0),0);return _&&(m+=`ðª ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼: ${Math.round(_)} ÐºÐ³`),m}function ya(o){const n=tu(o);if(n)if(Dt!=null&&Dt.openTelegramLink){const i=`https://t.me/share/url?url=${encodeURIComponent("https://t.me/gymgym21bot")}&text=${encodeURIComponent(n)}`;Dt.openTelegramLink(i)}else navigator.clipboard.writeText(n).then(()=>{alert("Ð¢ÐµÐºÑÑ ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½ Ð² Ð±ÑÑÐµÑ Ð¾Ð±Ð¼ÐµÐ½Ð°")})}function eu(){var o,n,i,s;if(Yt==="main"){const c=document.getElementById("start-workout-btn");c==null||c.addEventListener("click",()=>{Er=!0,pt()});const d=document.getElementById("cancel-start-workout-btn");d==null||d.addEventListener("click",()=>{Er=!1,pt()});const p=document.getElementById("start-workout-form");p==null||p.addEventListener("submit",async rt=>{rt.preventDefault();const lt=new FormData(p).get("workoutName");await z.startWorkout(lt),Er=!1,pt()});const m=document.getElementById("pause-workout-btn");m==null||m.addEventListener("click",async()=>{await z.pauseWorkout(),pt()});const _=document.getElementById("resume-workout-btn");_==null||_.addEventListener("click",async()=>{await z.resumeWorkout(),pt()});const E=document.getElementById("finish-workout-btn");E==null||E.addEventListener("click",async()=>{confirm("ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ?")&&(await z.finishWorkout(),pt())});const O=document.getElementById("log-form"),A=()=>{const rt=document.getElementById("workout-type-select"),V=z.getWorkoutTypes(),lt=rt==null?void 0:rt.value,gt=V.find(vt=>vt.id===lt),st=document.getElementById("strength-inputs"),ot=document.getElementById("time-inputs");gt&&gt.category==="time"?(st&&(st.style.display="none"),ot&&(ot.style.display="block"),O.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(vt=>vt.removeAttribute("required")),O.querySelectorAll('input[name="duration_hours"], input[name="duration_minutes"]').forEach(vt=>vt.removeAttribute("required"))):(st&&(st.style.display="block"),ot&&(ot.style.display="none"),O.querySelectorAll('input[name="weight"], input[name="reps"]').forEach(vt=>vt.setAttribute("required","true")),O.querySelectorAll('input[name="duration_hours"], input[name="duration_minutes"]').forEach(vt=>vt.removeAttribute("required")))};A();const j=document.getElementById("workout-type-select");j==null||j.addEventListener("change",A),O==null||O.addEventListener("submit",async rt=>{rt.preventDefault();const V=new FormData(O),lt=V.get("typeId"),st=z.getWorkoutTypes().find(vt=>vt.id===lt),ot={workoutTypeId:lt};if((st==null?void 0:st.category)==="time"){const vt=parseInt(V.get("duration_hours"),10)||0,Bt=parseInt(V.get("duration_minutes"),10)||0;ot.duration=vt*60+Bt}else ot.weight=parseFloat(V.get("weight")),ot.reps=parseInt(V.get("reps"),10);if(Et){const Bt=z.getLogs().find(Lt=>Lt.id===Et);if(Bt){const Lt=V.get("date");let Ft=Bt.date;if(Lt){const At=new Date(Bt.date),[ne,re,Wt]=Lt.split("-").map(Number);At.setFullYear(ne,re-1,Wt),Ft=At.toISOString()}await z.updateLog({...Bt,...ot,date:Ft}),Et=null}}else Cn=(await z.addLog(ot)).id;pt(),Cn=null});const K=document.getElementById("duplicate-last-btn");K==null||K.addEventListener("click",async()=>{const rt=z.getLogs(),V=rt[rt.length-1];V&&(Cn=(await z.addLog({workoutTypeId:V.workoutTypeId,weight:V.weight,reps:V.reps,duration:V.duration})).id,pt(),Cn=null)});const F=document.getElementById("cancel-edit-btn");F==null||F.addEventListener("click",()=>{Et=null,pt()}),document.querySelectorAll(".log-set__delete").forEach(rt=>{rt.addEventListener("click",async()=>{const V=rt.getAttribute("data-id");V&&(Et===V&&(Et=null),await z.deleteLog(V),pt())})}),document.querySelectorAll(".log-set__edit").forEach(rt=>{rt.addEventListener("click",()=>{Et=rt.getAttribute("data-id"),pt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(rt=>{rt.addEventListener("click",()=>{const V=rt.getAttribute("data-date");V&&ya(V)})});const Y=document.getElementById("prev-week-btn");Y==null||Y.addEventListener("click",()=>{Vt++,vr()});const tt=document.getElementById("next-week-btn");tt==null||tt.addEventListener("click",()=>{Vt>0&&(Vt--,vr())});const Z=document.getElementById("calendar-input");Z==null||Z.addEventListener("change",()=>{if(!Z.value||Z.value===Li)return;Li=Z.value;const rt=new Date(Z.value),V=new Date;V.setHours(0,0,0,0);const lt=V.getTime()-rt.getTime(),gt=Math.floor(lt/(1e3*60*60*24));Vt=Math.max(0,Math.floor(gt/7)),vr()});const Q=document.getElementById("filter-toggle-input");Q==null||Q.addEventListener("change",()=>{Wi=Q.checked,vr()})}if(Yt==="settings"){const c=document.getElementById("add-type-form");c==null||c.addEventListener("submit",async p=>{var E;p.preventDefault();const m=document.getElementById("new-type-name"),_=(E=document.querySelector('input[name="new-type-category"]:checked'))==null?void 0:E.value;m.value&&(qt?(await z.updateWorkoutType(qt,m.value,_),qt=null):await z.addWorkoutType(m.value,_),pt())});const d=document.getElementById("cancel-edit-type-btn");d==null||d.addEventListener("click",()=>{qt=null,pt()}),document.querySelectorAll(".type-item__edit").forEach(p=>{p.addEventListener("click",()=>{qt=p.getAttribute("data-id"),pt();const m=document.getElementById("new-type-name");m==null||m.focus()})}),document.querySelectorAll(".type-item__delete").forEach(p=>{p.addEventListener("click",async()=>{const m=p.getAttribute("data-id");m&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(qt===m&&(qt=null),await z.deleteWorkoutType(m),pt())})})}if(Yt==="settings"){const c=document.getElementById("workout-type-list");c&&nt.create(c,{animation:150,handle:".drag-handle",onEnd:async()=>{const d=Array.from(c.children).map(p=>p.getAttribute("data-id")||"").filter(Boolean);await z.updateWorkoutTypeOrder(d)}}),document.querySelectorAll(".type-item__edit").forEach(d=>{d.addEventListener("click",()=>{qt=d.getAttribute("data-id"),pt();const p=document.getElementById("new-type-name");p==null||p.focus()})}),document.querySelectorAll(".type-item__delete").forEach(d=>{d.addEventListener("click",async()=>{const p=d.getAttribute("data-id");p&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(qt===p&&(qt=null),await z.deleteWorkoutType(p),pt())})})}if(Yt==="stats"){const c=document.getElementById("stat-type-select");c==null||c.addEventListener("change",()=>{fn=c.value,pt()})}if(Yt==="profile-settings"){document.querySelectorAll(".profile-tab").forEach(O=>{O.addEventListener("click",()=>{const A=O.getAttribute("data-tab");(A==="ai"||A==="public"||A==="data")&&(Ye=A,pt())})});const d=document.getElementById("save-profile-btn");d==null||d.addEventListener("click",async()=>{const O=document.getElementById("profile-public-toggle"),A=document.getElementById("profile-history-toggle"),j=document.getElementById("profile-display-name"),K=document.getElementById("profile-gender"),F=document.getElementById("profile-birthdate"),Y=document.getElementById("profile-height"),tt=document.getElementById("profile-weight"),Z=document.getElementById("profile-additional-info"),Q={};O&&(Q.isPublic=O.checked),A&&(Q.showFullHistory=A.checked),j&&(Q.displayName=j.value),K&&(Q.gender=K.value||void 0),F&&(Q.birthDate=F.value),Y&&(Q.height=Y.value?Number(Y.value):void 0),tt&&(Q.weight=tt.value?Number(tt.value):void 0),Z&&(Q.additionalInfo=Z.value),await z.updateProfileSettings(Q),te("ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐ¾ÑÑÐ°Ð½ÐµÐ½"),pt()});const p=document.getElementById("ai-general-btn");p&&p.addEventListener("click",async()=>{Pe=!0,pt();try{$r=await z.getAIRecommendation("general")}catch(O){te("ÐÑÐ¸Ð±ÐºÐ°: "+(O instanceof Error?O.message:String(O)))}finally{Pe=!1,pt()}});const m=document.getElementById("ai-plan-btn");m&&m.addEventListener("click",async()=>{const O=document.getElementById("ai-plan-period").value,A=document.getElementById("ai-allow-new").checked;Pe=!0,pt();try{$r=await z.getAIRecommendation("plan",{period:O,allowNewExercises:A})}catch(j){te("ÐÑÐ¸Ð±ÐºÐ°: "+(j instanceof Error?j.message:String(j)))}finally{Pe=!1,pt()}});const _=document.getElementById("copy-profile-link");_==null||_.addEventListener("click",()=>{const O=z.getProfileIdentifier();if(O){const A=Pr(O);navigator.clipboard.writeText(A).then(()=>{te("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})}});const E=document.getElementById("share-profile-link");E==null||E.addEventListener("click",()=>{const O=z.getProfileIdentifier();if(O){const A=Pr(O);if(Dt!=null&&Dt.openTelegramLink){const j=`https://t.me/share/url?url=${encodeURIComponent(A)}&text=${encodeURIComponent("ÐÐ¾Ð¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº ðª")}`;Dt.openTelegramLink(j)}else navigator.clipboard.writeText(A).then(()=>{te("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})}}),(o=document.getElementById("export-json-btn"))==null||o.addEventListener("click",async()=>{try{const O=await z.exportData(),A=`gym_backup_${new Date().toISOString().split("T")[0]}.json`;Uo(JSON.stringify(O,null,2),A,"application/json"),te("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(O){console.error(O),te("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(n=document.getElementById("export-md-btn"))==null||n.addEventListener("click",async()=>{try{const O=await z.exportData(),A=Fs(O),j=`gym_history_${new Date().toISOString().split("T")[0]}.md`;Uo(A,j,"text/markdown"),te("Ð­ÐºÑÐ¿Ð¾ÑÑ Ð²ÑÐ¿Ð¾Ð»Ð½ÐµÐ½")}catch(O){console.error(O),te("ÐÑÐ¸Ð±ÐºÐ° ÑÐºÑÐ¿Ð¾ÑÑÐ°")}}),(i=document.getElementById("import-json-btn"))==null||i.addEventListener("click",()=>{var O;(O=document.getElementById("import-file-input"))==null||O.click()}),(s=document.getElementById("import-file-input"))==null||s.addEventListener("change",O=>{var K;const A=(K=O.target.files)==null?void 0:K[0];if(!A)return;const j=new FileReader;j.onload=async F=>{var Y;try{const tt=(Y=F.target)==null?void 0:Y.result,Z=JSON.parse(tt);confirm("ÐÐ½Ð¸Ð¼Ð°Ð½Ð¸Ðµ! ÐÑÐµ ÑÐµÐºÑÑÐ¸Ðµ Ð´Ð°Ð½Ð½ÑÐµ Ð±ÑÐ´ÑÑ Ð·Ð°Ð¼ÐµÐ½ÐµÐ½Ñ Ð´Ð°Ð½Ð½ÑÐ¼Ð¸ Ð¸Ð· ÑÐ°Ð¹Ð»Ð°. ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ?")&&(await z.importData(Z),te("ÐÐ°Ð½Ð½ÑÐµ ÑÑÐ¿ÐµÑÐ½Ð¾ Ð¸Ð¼Ð¿Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°Ð½Ñ"),setTimeout(()=>location.reload(),1e3))}catch(tt){console.error(tt),te("ÐÑÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾ÑÑÐ°: ÐÐµÐ²ÐµÑÐ½ÑÐ¹ ÑÐ¾ÑÐ¼Ð°Ñ ÑÐ°Ð¹Ð»Ð°")}},j.readAsText(A),O.target.value=""})}if(Yt==="stats"){document.querySelectorAll(".stats-tab").forEach(p=>{p.addEventListener("click",()=>{const m=p.getAttribute("data-tab");(m==="overview"||m==="progress")&&(Sr=m,pt())})});const d=document.getElementById("stat-type-select");d==null||d.addEventListener("change",p=>{fn=p.target.value,pt()})}if(Yt==="public-profile"){const c=document.getElementById("friend-action-btn");c==null||c.addEventListener("click",async()=>{const d=c.getAttribute("data-id"),p=c.getAttribute("data-name"),m=c.getAttribute("data-photo");d&&p&&(z.isFriend(d)?confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ Ð¸Ð· Ð´ÑÑÐ·ÐµÐ¹?")&&(await z.removeFriend(d),z.sync().catch(()=>{})):(await z.addFriend({identifier:d,displayName:p,photoUrl:m||void 0}),te("ÐÐ¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² Ð´ÑÑÐ·ÑÑ"),z.sync().catch(()=>{})),pt())})}}const ze=document.createElement("div");ze.className="sync-status";document.body.appendChild(ze);function nu(o){switch(ze.className="sync-status visible "+o,o){case"saving":ze.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...";break;case"success":ze.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð¾";break;case"error":ze.textContent="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸";break;default:ze.className="sync-status"}}z.onUpdate(()=>pt());z.onSyncStatusChange(nu);async function ru(){var m;const o=new URLSearchParams(window.location.search);if(o.has("hash")&&o.has("id")){const _={id:parseInt(o.get("id")||"0",10),first_name:o.get("first_name")||"",last_name:o.get("last_name")||void 0,username:o.get("username")||void 0,photo_url:o.get("photo_url")||void 0,auth_date:parseInt(o.get("auth_date")||"0",10),hash:o.get("hash")||""};Go(_),o.delete("hash"),o.delete("id"),o.delete("first_name"),o.delete("last_name"),o.delete("username"),o.delete("photo_url"),o.delete("auth_date"),o.delete("auth");const E=o.toString(),O=window.location.pathname+(E?"?"+E:"");window.history.replaceState({},document.title,O),location.reload();return}const n=localStorage.getItem("skip_tma_auth")==="true",i=!!(Dt!=null&&Dt.initData)&&!n,c=!!Ni();if(!i&&!c){fs(document.getElementById("app"),()=>{location.reload()});return}const p=new URLSearchParams(window.location.search).get("startapp")||((m=Dt==null?void 0:Dt.initDataUnsafe)==null?void 0:m.start_param);if(p&&p.startsWith("profile_")){const _=p.replace("profile_","");ha=_,Yt="public-profile",ji=!1,pt(),Cr=await z.getPublicProfile(_),Cr||(ji=!0),pt()}else pt();await z.init()}ru();
