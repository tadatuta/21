var Ya=Object.defineProperty;var Ga=(v,u,c)=>u in v?Ya(v,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):v[u]=c;var jt=(v,u,c)=>Ga(v,typeof u!="symbol"?u+"":u,c);(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))g(x);new MutationObserver(x=>{for(const D of x)if(D.type==="childList")for(const S of D.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&g(S)}).observe(document,{childList:!0,subtree:!0});function c(x){const D={};return x.integrity&&(D.integrity=x.integrity),x.referrerPolicy&&(D.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?D.credentials="include":x.crossOrigin==="anonymous"?D.credentials="omit":D.credentials="same-origin",D}function g(x){if(x.ep)return;x.ep=!0;const D=c(x);fetch(x.href,D)}})();const Qa="modulepreload",Xa=function(v,u){return new URL(v,u).href},Hr={},ra=function(u,c,g){let x=Promise.resolve();if(c&&c.length>0){const S=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),K=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));x=Promise.allSettled(c.map(R=>{if(R=Xa(R,g),R in Hr)return;Hr[R]=!0;const z=R.endsWith(".css"),B=z?'[rel="stylesheet"]':"";if(!!g)for(let V=S.length-1;V>=0;V--){const ot=S[V];if(ot.href===R&&(!z||ot.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${R}"]${B}`))return;const U=document.createElement("link");if(U.rel=z?"stylesheet":Qa,z||(U.as="script"),U.crossOrigin="",U.href=R,K&&U.setAttribute("nonce",K),document.head.appendChild(U),z)return new Promise((V,ot)=>{U.addEventListener("load",V),U.addEventListener("error",()=>ot(new Error(`Unable to preload CSS for ${R}`)))})}))}function D(S){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=S,window.dispatchEvent(E),!E.defaultPrevented)throw S}return x.then(S=>{for(const E of S||[])E.status==="rejected"&&D(E.reason);return u().catch(D)})};var Yr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ja(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var aa={exports:{}};(function(v,u){((c,g)=>{v.exports=g()})(Yr,function(){var c=function(t,e){return(c=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(n,r){n.__proto__=r}:function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}))(t,e)},g=function(){return(g=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function x(t,e,n){for(var r,a=0,i=e.length;a<i;a++)!r&&a in e||((r=r||Array.prototype.slice.call(e,0,a))[a]=e[a]);return t.concat(r||Array.prototype.slice.call(e))}var D=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Yr,S=Object.keys,E=Array.isArray;function K(t,e){return typeof e=="object"&&S(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||D.Promise||(D.Promise=Promise);var R=Object.getPrototypeOf,z={}.hasOwnProperty;function B(t,e){return z.call(t,e)}function tt(t,e){typeof e=="function"&&(e=e(R(t))),(typeof Reflect>"u"?S:Reflect.ownKeys)(e).forEach(function(n){V(t,n,e[n])})}var U=Object.defineProperty;function V(t,e,n,r){U(t,e,K(n&&B(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ot(t){return{from:function(e){return t.prototype=Object.create(e.prototype),V(t.prototype,"constructor",t),{extend:tt.bind(null,t.prototype)}}}}var yt=Object.getOwnPropertyDescriptor,vt=[].slice;function xt(t,e,n){return vt.call(t,e,n)}function Ut(t,e){return e(t)}function St(t){if(!t)throw new Error("Assertion Failed")}function mt(t){D.setImmediate?setImmediate(t):setTimeout(t,0)}function bt(t,e){if(typeof e=="string"&&B(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,a=e.length;r<a;++r){var i=bt(t,e[r]);n.push(i)}return n}var o,s=e.indexOf(".");return s===-1||(o=t[e.substr(0,s)])==null?void 0:bt(o,e.substr(s+1))}function ut(t,e,n){if(t&&e!==void 0&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){St(typeof n!="string"&&"length"in n);for(var r=0,a=e.length;r<a;++r)ut(t,e[r],n[r])}else{var i,o,s=e.indexOf(".");s!==-1?(i=e.substr(0,s),(s=e.substr(s+1))===""?n===void 0?E(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=n:ut(o=(o=t[i])&&B(t,i)?o:t[i]={},s,n)):n===void 0?E(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function ft(t){var e,n={};for(e in t)B(t,e)&&(n[e]=t[e]);return n}var ha=[].concat;function ur(t){return ha.apply([],t)}var Ct="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ur([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return D[t]}),cr=new Set(Ct.map(function(t){return D[t]})),ve=null;function Wt(t){return ve=new WeakMap,t=function e(n){if(!n||typeof n!="object")return n;var r=ve.get(n);if(r)return r;if(E(n)){r=[],ve.set(n,r);for(var a=0,i=n.length;a<i;++a)r.push(e(n[a]))}else if(cr.has(n.constructor))r=n;else{var o,s=R(n);for(o in r=s===Object.prototype?{}:Object.create(s),ve.set(n,r),n)B(n,o)&&(r[o]=e(n[o]))}return r}(t),ve=null,t}var pa={}.toString;function hn(t){return pa.call(t).slice(8,-1)}var pn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ma=typeof pn=="symbol"?function(t){var e;return t!=null&&(e=t[pn])&&e.apply(t)}:function(){return null};function Vt(t,e){e=t.indexOf(e),0<=e&&t.splice(e,1)}var re={};function Pt(t){var e,n,r,a;if(arguments.length===1){if(E(t))return t.slice();if(this===re&&typeof t=="string")return[t];if(a=ma(t))for(n=[];!(r=a.next()).done;)n.push(r.value);else{if(t==null)return[t];if(typeof(e=t.length)!="number")return[t];for(n=new Array(e);e--;)n[e]=t[e]}}else for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var mn=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Ct=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],_t=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Ct),ya={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ae(t,e){this.name=t,this.message=e}function lr(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,a){return a.indexOf(n)===r}).join(`
`)}function Ke(t,e,n,r){this.failures=e,this.failedKeys=r,this.successCount=n,this.message=lr(t,e)}function ie(t,e){this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=lr(t,this.failures)}ot(ae).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ot(Ke).from(ae),ot(ie).from(ae);var yn=_t.reduce(function(t,e){return t[e]=e+"Error",t},{}),va=ae,N=_t.reduce(function(t,e){var n=e+"Error";function r(a,i){this.name=n,a?typeof a=="string"?(this.message="".concat(a).concat(i?`
 `+i:""),this.inner=i||null):typeof a=="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a):(this.message=ya[e]||n,this.inner=null)}return ot(r).from(va),t[e]=r,t},{}),dr=(N.Syntax=SyntaxError,N.Type=TypeError,N.Range=RangeError,Ct.reduce(function(t,e){return t[e+"Error"]=N[e],t},{}));Ct=_t.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=N[e]),t},{});function Z(){}function ge(t){return t}function ga(t,e){return t==null||t===ge?e:function(n){return e(t(n))}}function zt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ba(t,e){return t===Z?e:function(){var n=t.apply(this,arguments),r=(n!==void 0&&(arguments[0]=n),this.onsuccess),a=this.onerror,i=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return r&&(this.onsuccess=this.onsuccess?zt(r,this.onsuccess):r),a&&(this.onerror=this.onerror?zt(a,this.onerror):a),i!==void 0?i:n}}function wa(t,e){return t===Z?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?zt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?zt(r,this.onerror):r)}}function _a(t,e){return t===Z?e:function(a){var r=t.apply(this,arguments),a=(K(a,r),this.onsuccess),i=this.onerror,o=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return a&&(this.onsuccess=this.onsuccess?zt(a,this.onsuccess):a),i&&(this.onerror=this.onerror?zt(i,this.onerror):i),r===void 0?o===void 0?void 0:o:K(r,o)}}function ka(t,e){return t===Z?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function vn(t,e){return t===Z?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,a=arguments.length,i=new Array(a);a--;)i[a]=arguments[a];return n.then(function(){return e.apply(r,i)})}return e.apply(this,arguments)}}Ct.ModifyError=Ke,Ct.DexieError=ae,Ct.BulkError=ie;var It=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function fr(t){It=t}var be={},hr=100,we=typeof Promise>"u"?[]:(_t=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[we=crypto.subtle.digest("SHA-512",new Uint8Array([0])),R(we),_t]:[_t,R(_t),_t]),_t=we[0],he=we[1],he=he&&he.then,Ht=_t&&_t.constructor,gn=!!we[2],_e=function(t,e){ke.push([t,e]),$e&&(queueMicrotask(Sa),$e=!1)},bn=!0,$e=!0,Yt=[],je=[],wn=ge,Lt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Z,pgp:!1,env:{},finalize:Z},M=Lt,ke=[],Gt=0,Le=[];function $(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=M;if(typeof t!="function"){if(t!==be)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&kn(this,this._value)}else this._state=null,this._value=null,++e.ref,function n(r,a){try{a(function(i){if(r._state===null){if(i===r)throw new TypeError("A promise cannot be resolved with itself.");var o=r._lib&&oe();i&&typeof i.then=="function"?n(r,function(s,f){i instanceof $?i._then(s,f):i.then(s,f)}):(r._state=!0,r._value=i,mr(r)),o&&se()}},kn.bind(null,r))}catch(i){kn(r,i)}}(this,t)}var _n={get:function(){var t=M,e=Be;function n(r,a){var i=this,o=!t.global&&(t!==M||e!==Be),s=o&&!Rt(),f=new $(function(w,h){xn(i,new pr(vr(r,t,o,s),vr(a,t,o,s),w,h,t))});return this._consoleTask&&(f._consoleTask=this._consoleTask),f}return n.prototype=be,n},set:function(t){V(this,"then",t&&t.prototype===be?_n:{get:function(){return t},set:_n.set})}};function pr(t,e,n,r,a){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=a}function kn(t,e){var n,r;je.push(e),t._state===null&&(n=t._lib&&oe(),e=wn(e),t._state=!1,t._value=e,r=t,Yt.some(function(a){return a._value===r._value})||Yt.push(r),mr(t),n)&&se()}function mr(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)xn(t,e[n]);var a=t._PSD;--a.ref||a.finalize(),Gt===0&&(++Gt,_e(function(){--Gt==0&&Sn()},[]))}function xn(t,e){if(t._state===null)t._listeners.push(e);else{var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Gt,_e(xa,[n,t,e])}}function xa(t,e,n){try{var r,a=e._value;!e._state&&je.length&&(je=[]),r=It&&e._consoleTask?e._consoleTask.run(function(){return t(a)}):t(a),e._state||je.indexOf(a)!==-1||(i=>{for(var o=Yt.length;o;)if(Yt[--o]._value===i._value)return Yt.splice(o,1)})(e),n.resolve(r)}catch(i){n.reject(i)}finally{--Gt==0&&Sn(),--n.psd.ref||n.psd.finalize()}}function Sa(){Qt(Lt,function(){oe()&&se()})}function oe(){var t=bn;return $e=bn=!1,t}function se(){var t,e,n;do for(;0<ke.length;)for(t=ke,ke=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(0<ke.length);$e=bn=!0}function Sn(){for(var t=Yt,e=(Yt=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)}),Le.slice(0)),n=e.length;n;)e[--n]()}function qe(t){return new $(be,!1,t)}function rt(t,e){var n=M;return function(){var r=oe(),a=M;try{return Mt(n,!0),t.apply(this,arguments)}catch(i){e&&e(i)}finally{Mt(a,!1),r&&se()}}}tt($.prototype,{then:_n,_then:function(t,e){xn(this,new pr(null,null,t,e,M))},catch:function(t){var e,n;return arguments.length===1?this.then(null,t):(e=t,n=arguments[1],typeof e=="function"?this.then(null,function(r){return(r instanceof e?n:qe)(r)}):this.then(null,function(r){return(r&&r.name===e?n:qe)(r)}))},finally:function(t){return this.then(function(e){return $.resolve(t()).then(function(){return e})},function(e){return $.resolve(t()).then(function(){return qe(e)})})},timeout:function(t,e){var n=this;return t<1/0?new $(function(r,a){var i=setTimeout(function(){return a(new N.Timeout(e))},t);n.then(r,a).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&V($.prototype,Symbol.toStringTag,"Dexie.Promise"),Lt.env=yr(),tt($,{all:function(){var t=Pt.apply(null,arguments).map(Ne);return new $(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(a,i){return $.resolve(a).then(function(o){t[i]=o,--r||e(t)},n)})})},resolve:function(t){return t instanceof $?t:t&&typeof t.then=="function"?new $(function(e,n){t.then(e,n)}):new $(be,!0,t)},reject:qe,race:function(){var t=Pt.apply(null,arguments).map(Ne);return new $(function(e,n){t.map(function(r){return $.resolve(r).then(e,n)})})},PSD:{get:function(){return M},set:function(t){return M=t}},totalEchoes:{get:function(){return Be}},newPSD:qt,usePSD:Qt,scheduler:{get:function(){return _e},set:function(t){_e=t}},rejectionMapper:{get:function(){return wn},set:function(t){wn=t}},follow:function(t,e){return new $(function(n,r){return qt(function(a,i){var o=M;o.unhandleds=[],o.onunhandled=i,o.finalize=zt(function(){var s,f=this;s=function(){f.unhandleds.length===0?a():i(f.unhandleds[0])},Le.push(function w(){s(),Le.splice(Le.indexOf(w),1)}),++Gt,_e(function(){--Gt==0&&Sn()},[])},o.finalize),t()},e,n,r)})}}),Ht&&(Ht.allSettled&&V($,"allSettled",function(){var t=Pt.apply(null,arguments).map(Ne);return new $(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(a,i){return $.resolve(a).then(function(o){return r[i]={status:"fulfilled",value:o}},function(o){return r[i]={status:"rejected",reason:o}}).then(function(){return--n||e(r)})})})}),Ht.any&&typeof AggregateError<"u"&&V($,"any",function(){var t=Pt.apply(null,arguments).map(Ne);return new $(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,a=new Array(r);t.forEach(function(i,o){return $.resolve(i).then(function(s){return e(s)},function(s){a[o]=s,--r||n(new AggregateError(a))})})})}),Ht.withResolvers)&&($.withResolvers=Ht.withResolvers);var ht={awaits:0,echoes:0,id:0},Ta=0,Re=[],Me=0,Be=0,Da=0;function qt(t,o,n,r){var a=M,i=Object.create(a),o=(i.parent=a,i.ref=0,i.global=!1,i.id=++Da,Lt.env,i.env=gn?{Promise:$,PromiseProp:{value:$,configurable:!0,writable:!0},all:$.all,race:$.race,allSettled:$.allSettled,any:$.any,resolve:$.resolve,reject:$.reject}:{},o&&K(i,o),++a.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()},Qt(i,t,n,r));return i.ref===0&&i.finalize(),o}function ue(){return ht.id||(ht.id=++Ta),++ht.awaits,ht.echoes+=hr,ht.id}function Rt(){return!!ht.awaits&&(--ht.awaits==0&&(ht.id=0),ht.echoes=ht.awaits*hr,!0)}function Ne(t){return ht.echoes&&t&&t.constructor===Ht?(ue(),t.then(function(e){return Rt(),e},function(e){return Rt(),ct(e)})):t}function Ea(){var t=Re[Re.length-1];Re.pop(),Mt(t,!1)}function Mt(t,e){var n,r,a=M;(e?!ht.echoes||Me++&&t===M:!Me||--Me&&t===M)||queueMicrotask(e?(function(i){++Be,ht.echoes&&--ht.echoes!=0||(ht.echoes=ht.awaits=ht.id=0),Re.push(M),Mt(i,!0)}).bind(null,t):Ea),t!==M&&(M=t,a===Lt&&(Lt.env=yr()),gn)&&(n=Lt.env.Promise,r=t.env,a.global||t.global)&&(Object.defineProperty(D,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any)&&(n.any=r.any)}function yr(){var t=D.Promise;return gn?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(D,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function Qt(t,e,n,r,a){var i=M;try{return Mt(t,!0),e(n,r,a)}finally{Mt(i,!1)}}function vr(t,e,n,r){return typeof t!="function"?t:function(){var a=M;n&&ue(),Mt(e,!0);try{return t.apply(this,arguments)}finally{Mt(a,!1),r&&queueMicrotask(Rt)}}}function Tn(t){Promise===Ht&&ht.echoes===0?Me===0?t():enqueueNativeMicroTask(t):setTimeout(t,0)}(""+he).indexOf("[native code]")===-1&&(ue=Rt=Z);var ct=$.reject,Xt="ï¿¿",Kt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",gr="String expected.",ce=[],Fe="__dbnames",Dn="readonly",En="readwrite";function Jt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var br={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ue(t){return typeof t!="string"||/\./.test(t)?function(e){return e}:function(e){return e[t]===void 0&&t in e&&delete(e=Wt(e))[t],e}}function wr(){throw N.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function G(t,e){try{var n=_r(t),r=_r(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e<t?1:t<e?-1:0;case"binary":for(var a=kr(t),i=kr(e),o=a.length,s=i.length,f=o<s?o:s,w=0;w<f;++w)if(a[w]!==i[w])return a[w]<i[w]?-1:1;return o===s?0:o<s?-1:1;case"Array":for(var h=t,l=e,m=h.length,y=l.length,p=m<y?m:y,d=0;d<p;++d){var _=G(h[d],l[d]);if(_!==0)return _}return m===y?0:m<y?-1:1}}catch{}return NaN}function _r(t){var e=typeof t;return e=="object"&&(ArrayBuffer.isView(t)||(e=hn(t))==="ArrayBuffer")?"binary":e}function kr(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}function We(t,e,n){var r=t.schema.yProps;return r?(e&&0<n.numFailures&&(e=e.filter(function(a,i){return!n.failures[i]})),Promise.all(r.map(function(a){return a=a.updatesTable,e?t.db.table(a).where("k").anyOf(e).delete():t.db.table(a).clear()})).then(function(){return n})):n}xr.prototype.execute=function(t){var e=this["@@propmod"];if(e.add!==void 0){var n=e.add;if(E(n))return x(x([],E(t)?t:[],!0),n).sort();if(typeof n=="number")return(Number(t)||0)+n;if(typeof n=="bigint")try{return BigInt(t)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(e.remove!==void 0){var r=e.remove;if(E(r))return E(t)?t.filter(function(a){return!r.includes(a)}).sort():[];if(typeof r=="number")return Number(t)-r;if(typeof r=="bigint")try{return BigInt(t)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return n=(n=e.replacePrefix)==null?void 0:n[0],n&&typeof t=="string"&&t.startsWith(n)?e.replacePrefix[1]+t.substring(n.length):t};var xe=xr;function xr(t){this["@@propmod"]=t}function Sr(t,e){for(var n=S(e),r=n.length,a=!1,i=0;i<r;++i){var o=n[i],s=e[o],f=bt(t,o);s instanceof xe?(ut(t,o,s.execute(f)),a=!0):f!==s&&(ut(t,o,s),a=!0)}return a}et.prototype._trans=function(t,e,n){var r=this._tx||M.trans,a=this.name,i=It&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function o(w,h,l){if(l.schema[a])return e(l.idbtrans,l);throw new N.NotFound("Table "+a+" not part of transaction")}var s=oe();try{var f=r&&r.db._novip===this.db._novip?r===M.trans?r._promise(t,o,n):qt(function(){return r._promise(t,o,n)},{trans:r,transless:M.transless||M}):function w(h,l,m,y){if(h.idbdb&&(h._state.openComplete||M.letThrough||h._vip)){var p=h._createTransaction(l,m,h._dbSchema);try{p.create(),h._state.PR1398_maxLoop=3}catch(d){return d.name===yn.InvalidState&&h.isOpen()&&0<--h._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),h.close({disableAutoOpen:!1}),h.open().then(function(){return w(h,l,m,y)})):ct(d)}return p._promise(l,function(d,_){return qt(function(){return M.trans=p,y(d,_,p)})}).then(function(d){if(l==="readwrite")try{p.idbtrans.commit()}catch{}return l==="readonly"?d:p._completion.then(function(){return d})})}if(h._state.openComplete)return ct(new N.DatabaseClosed(h._state.dbOpenError));if(!h._state.isBeingOpened){if(!h._state.autoOpen)return ct(new N.DatabaseClosed);h.open().catch(Z)}return h._state.dbReadyPromise.then(function(){return w(h,l,m,y)})}(this.db,t,[this.name],o);return i&&(f._consoleTask=i,f=f.catch(function(w){return console.trace(w),ct(w)})),f}finally{s&&se()}},et.prototype.get=function(t,e){var n=this;return t&&t.constructor===Object?this.where(t).first(e):t==null?ct(new N.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:t}).then(function(a){return n.hook.reading.fire(a)})}).then(e)},et.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(E(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var e=S(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(s){if(s.compound&&e.every(function(w){return 0<=s.keyPath.indexOf(w)})){for(var f=0;f<e.length;++f)if(e.indexOf(s.keyPath[f])===-1)return!1;return!0}return!1}).sort(function(s,f){return s.keyPath.length-f.keyPath.length})[0];if(n&&this.db._maxKey!==Xt)return o=n.keyPath.slice(0,e.length),this.where(o).equals(o.map(function(s){return t[s]}));!n&&It&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(e.join("+"),"]"));var r=this.schema.idxByName;function a(s,f){return G(s,f)===0}var o=e.reduce(function(h,f){var w=h[0],h=h[1],l=r[f],m=t[f];return[w||l,w||!l?Jt(h,l&&l.multi?function(y){return y=bt(y,f),E(y)&&y.some(function(p){return a(m,p)})}:function(y){return a(m,bt(y,f))}):h]},[null,null]),i=o[0],o=o[1];return i?this.where(i.name).equals(t[i.keyPath]).filter(o):n?this.filter(o):this.where(e).equals("")},et.prototype.filter=function(t){return this.toCollection().and(t)},et.prototype.count=function(t){return this.toCollection().count(t)},et.prototype.offset=function(t){return this.toCollection().offset(t)},et.prototype.limit=function(t){return this.toCollection().limit(t)},et.prototype.each=function(t){return this.toCollection().each(t)},et.prototype.toArray=function(t){return this.toCollection().toArray(t)},et.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},et.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,E(t)?"[".concat(t.join("+"),"]"):t))},et.prototype.reverse=function(){return this.toCollection().reverse()},et.prototype.mapToClass=function(t){for(var e=this.db,n=this.name,r=((this.schema.mappedClass=t).prototype instanceof wr&&(t=(o=>{var s=h,f=o;if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function w(){this.constructor=s}function h(){return o!==null&&o.apply(this,arguments)||this}return c(s,f),s.prototype=f===null?Object.create(f):(w.prototype=f.prototype,new w),Object.defineProperty(h.prototype,"db",{get:function(){return e},enumerable:!1,configurable:!0}),h.prototype.table=function(){return n},h})(t)),new Set),a=t.prototype;a;a=R(a))Object.getOwnPropertyNames(a).forEach(function(o){return r.add(o)});function i(o){if(!o)return o;var s,f=Object.create(t.prototype);for(s in o)if(!r.has(s))try{f[s]=o[s]}catch{}return f}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=i,this.hook("reading",i),t},et.prototype.defineClass=function(){return this.mapToClass(function(t){K(this,t)})},et.prototype.add=function(t,e){var n=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=t;return i&&a&&(o=Ue(i)(t)),this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"add",keys:e!=null?[e]:null,values:[o]})}).then(function(s){return s.numFailures?$.reject(s.failures[0]):s.lastResult}).then(function(s){if(i)try{ut(t,i,s)}catch{}return s})},et.prototype.upsert=function(t,e){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(a){return n.core.get({trans:a,key:t}).then(function(i){var o=i??{};return Sr(o,e),r&&ut(o,r,t),n.core.mutate({trans:a,type:"put",values:[o],keys:[t],upsert:!0,updates:{keys:[t],changeSpecs:[e]}}).then(function(s){return s.numFailures?$.reject(s.failures[0]):!!i})})})},et.prototype.update=function(t,e){return typeof t!="object"||E(t)?this.where(":id").equals(t).modify(e):(t=bt(t,this.schema.primKey.keyPath))===void 0?ct(new N.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(e)},et.prototype.put=function(t,e){var n=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=t;return i&&a&&(o=Ue(i)(t)),this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"put",values:[o],keys:e!=null?[e]:null})}).then(function(s){return s.numFailures?$.reject(s.failures[0]):s.lastResult}).then(function(s){if(i)try{ut(t,i,s)}catch{}return s})},et.prototype.delete=function(t){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"delete",keys:[t]}).then(function(r){return We(e,[t],r)}).then(function(r){return r.numFailures?$.reject(r.failures[0]):void 0})})},et.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:br}).then(function(n){return We(t,null,n)})}).then(function(e){return e.numFailures?$.reject(e.failures[0]):void 0})},et.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",function(n){return e.core.getMany({keys:t,trans:n}).then(function(r){return r.map(function(a){return e.hook.reading.fire(a)})})})},et.prototype.bulkAdd=function(t,e,n){var r=this,a=Array.isArray(e)?e:void 0,i=(n=n||(a?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(o){var s=r.schema.primKey,w=s.auto,s=s.keyPath;if(s&&a)throw new N.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");var f=t.length,w=s&&w?t.map(Ue(s)):t;return r.core.mutate({trans:o,type:"add",keys:a,values:w,wantResults:i}).then(function(h){var l=h.numFailures,m=h.failures;if(l===0)return i?h.results:h.lastResult;throw new ie("".concat(r.name,".bulkAdd(): ").concat(l," of ").concat(f," operations failed"),m)})})},et.prototype.bulkPut=function(t,e,n){var r=this,a=Array.isArray(e)?e:void 0,i=(n=n||(a?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(o){var s=r.schema.primKey,w=s.auto,s=s.keyPath;if(s&&a)throw new N.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");var f=t.length,w=s&&w?t.map(Ue(s)):t;return r.core.mutate({trans:o,type:"put",keys:a,values:w,wantResults:i}).then(function(h){var l=h.numFailures,m=h.failures;if(l===0)return i?h.results:h.lastResult;throw new ie("".concat(r.name,".bulkPut(): ").concat(l," of ").concat(f," operations failed"),m)})})},et.prototype.bulkUpdate=function(t){var e=this,n=this.core,r=t.map(function(o){return o.key}),a=t.map(function(o){return o.changes}),i=[];return this._trans("readwrite",function(o){return n.getMany({trans:o,keys:r,cache:"clone"}).then(function(s){var f=[],w=[],h=(t.forEach(function(l,m){var y=l.key,p=l.changes,d=s[m];if(d){for(var _=0,k=Object.keys(p);_<k.length;_++){var b=k[_],T=p[b];if(b===e.schema.primKey.keyPath){if(G(T,y)!==0)throw new N.Constraint("Cannot update primary key in bulkUpdate()")}else ut(d,b,T)}i.push(m),f.push(y),w.push(d)}}),f.length);return n.mutate({trans:o,type:"put",keys:f,values:w,updates:{keys:r,changeSpecs:a}}).then(function(l){var m=l.numFailures,y=l.failures;if(m===0)return h;for(var p=0,d=Object.keys(y);p<d.length;p++){var _,k=d[p],b=i[Number(k)];b!=null&&(_=y[k],delete y[k],y[b]=_)}throw new ie("".concat(e.name,".bulkUpdate(): ").concat(m," of ").concat(h," operations failed"),y)})})})},et.prototype.bulkDelete=function(t){var e=this,n=t.length;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"delete",keys:t}).then(function(a){return We(e,t,a)})}).then(function(r){var a=r.numFailures,i=r.failures;if(a===0)return r.lastResult;throw new ie("".concat(e.name,".bulkDelete(): ").concat(a," of ").concat(n," operations failed"),i)})};var Tr=et;function et(){}function Se(t){function e(o,s){if(s){for(var f=arguments.length,w=new Array(f-1);--f;)w[f-1]=arguments[f];return n[o].subscribe.apply(null,w),t}if(typeof o=="string")return n[o]}var n={};e.addEventType=i;for(var r=1,a=arguments.length;r<a;++r)i(arguments[r]);return e;function i(o,s,f){var w,h;if(typeof o!="object")return s=s||ka,h={subscribers:[],fire:f=f||Z,subscribe:function(l){h.subscribers.indexOf(l)===-1&&(h.subscribers.push(l),h.fire=s(h.fire,l))},unsubscribe:function(l){h.subscribers=h.subscribers.filter(function(m){return m!==l}),h.fire=h.subscribers.reduce(s,f)}},n[o]=e[o]=h;S(w=o).forEach(function(l){var m=w[l];if(E(m))i(l,w[l][0],w[l][1]);else{if(m!=="asap")throw new N.InvalidArgument("Invalid event config");var y=i(l,ge,function(){for(var p=arguments.length,d=new Array(p);p--;)d[p]=arguments[p];y.subscribers.forEach(function(_){mt(function(){_.apply(null,d)})})})}})}}function Te(t,e){return ot(e).from({prototype:t}),e}function le(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function In(t,e){t.filter=Jt(t.filter,e)}function On(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Jt(r(),e())}:e,t.justLimit=n&&!r}function Ve(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(n)return n;throw new N.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed")}function Dr(t,e,n){var r=Ve(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function ze(t,e,n,r){var a,i,o=t.replayFilter?Jt(t.filter,t.replayFilter()):t.filter;return t.or?(a={},i=function(s,f,w){var h,l;o&&!o(f,w,function(m){return f.stop(m)},function(m){return f.fail(m)})||((l=""+(h=f.primaryKey))=="[object ArrayBuffer]"&&(l=""+new Uint8Array(h)),B(a,l))||(a[l]=!0,e(s,f,w))},Promise.all([t.or._iterate(i,n),Er(Dr(t,r,n),t.algorithm,i,!t.keysOnly&&t.valueMapper)])):Er(Dr(t,r,n),Jt(t.algorithm,o),e,!t.keysOnly&&t.valueMapper)}function Er(t,e,n,r){var a=rt(r?function(i,o,s){return n(r(i),o,s)}:n);return t.then(function(i){if(i)return i.start(function(){var o=function(){return i.continue()};e&&!e(i,function(s){return o=s},function(s){i.stop(s),o=Z},function(s){i.fail(s),o=Z})||a(i.value,i,function(s){return o=s}),o()})})}X.prototype._read=function(t,e){var n=this._ctx;return n.error?n.table._trans(null,ct.bind(null,n.error)):n.table._trans("readonly",t).then(e)},X.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,ct.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},X.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Jt(e.algorithm,t)},X.prototype._iterate=function(t,e){return ze(this._ctx,t,e,this._ctx.table.core)},X.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&K(n,t),e._ctx=n,e},X.prototype.raw=function(){return this._ctx.valueMapper=null,this},X.prototype.each=function(t){var e=this._ctx;return this._read(function(n){return ze(e,t,n,e.table.core)})},X.prototype.count=function(t){var e=this;return this._read(function(n){var r,a=e._ctx,i=a.table.core;return le(a,!0)?i.count({trans:n,query:{index:Ve(a,i.schema),range:a.range}}).then(function(o){return Math.min(o,a.limit)}):(r=0,ze(a,function(){return++r,!1},n,i).then(function(){return r}))}).then(t)},X.prototype.sortBy=function(t,e){var n=t.split(".").reverse(),r=n[0],a=n.length-1;function i(f,w){return w?i(f[n[w]],w-1):f[r]}var o=this._ctx.dir==="next"?1:-1;function s(f,w){return G(i(f,a),i(w,a))*o}return this.toArray(function(f){return f.sort(s)}).then(e)},X.prototype.toArray=function(t){var e=this;return this._read(function(n){var r,a,i,o=e._ctx;return o.dir==="next"&&le(o,!0)&&0<o.limit?(r=o.valueMapper,a=Ve(o,o.table.core.schema),o.table.core.query({trans:n,limit:o.limit,values:!0,query:{index:a,range:o.range}}).then(function(s){return s=s.result,r?s.map(r):s})):(i=[],ze(o,function(s){return i.push(s)},n,o.table.core).then(function(){return i}))},t)},X.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,le(e)?On(e,function(){var n=t;return function(r,a){return n===0||(n===1?--n:a(function(){r.advance(n),n=0}),!1)}}):On(e,function(){var n=t;return function(){return--n<0}})),this},X.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),On(this._ctx,function(){var e=t;return function(n,r,a){return--e<=0&&r(a),0<=e}},!0),this},X.prototype.until=function(t,e){return In(this._ctx,function(n,r,a){return!t(n.value)||(r(a),e)}),this},X.prototype.first=function(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)},X.prototype.last=function(t){return this.reverse().first(t)},X.prototype.filter=function(t){var e;return In(this._ctx,function(n){return t(n.value)}),(e=this._ctx).isMatch=Jt(e.isMatch,t),this},X.prototype.and=function(t){return this.filter(t)},X.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},X.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},X.prototype.desc=function(){return this.reverse()},X.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(n,r){t(r.key,r)})},X.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},X.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(n,r){t(r.primaryKey,r)})},X.prototype.keys=function(t){var e=this._ctx,n=(e.keysOnly=!e.isMatch,[]);return this.each(function(r,a){n.push(a.key)}).then(function(){return n}).then(t)},X.prototype.primaryKeys=function(t){var e=this._ctx;if(e.dir==="next"&&le(e,!0)&&0<e.limit)return this._read(function(r){var a=Ve(e,e.table.core.schema);return e.table.core.query({trans:r,values:!1,limit:e.limit,query:{index:a,range:e.range}})}).then(function(r){return r.result}).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each(function(r,a){n.push(a.primaryKey)}).then(function(){return n}).then(t)},X.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},X.prototype.firstKey=function(t){return this.limit(1).keys(function(e){return e[0]}).then(t)},X.prototype.lastKey=function(t){return this.reverse().firstKey(t)},X.prototype.distinct=function(){var t,e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];return e&&e.multi&&(t={},In(this._ctx,function(r){var r=r.primaryKey.toString(),a=B(t,r);return t[r]=!0,!a})),this},X.prototype.modify=function(t){var e=this,n=this._ctx;return this._write(function(r){function a(d,_){var k=_.failures;m+=d-_.numFailures;for(var b=0,T=S(k);b<T.length;b++){var I=T[b];l.push(k[I])}}var i=typeof t=="function"?t:function(d){return Sr(d,t)},o=n.table.core,h=o.schema.primaryKey,s=h.outbound,f=h.extractKey,w=200,h=e.db._options.modifyChunkSize,l=(h&&(w=typeof h=="object"?h[o.name]||h["*"]||200:h),[]),m=0,y=[],p=t===Ir;return e.clone().primaryKeys().then(function(d){function _(b){var T=Math.min(w,d.length-b),I=d.slice(b,b+T);return(p?Promise.resolve([]):o.getMany({trans:r,keys:I,cache:"immutable"})).then(function(P){var C=[],O=[],L=s?[]:null,j=p?I:[];if(!p)for(var A=0;A<T;++A){var q=P[A],Q={value:Wt(q),primKey:d[b+A]};i.call(Q,Q.value,Q)!==!1&&(Q.value==null?j.push(d[b+A]):s||G(f(q),f(Q.value))===0?(O.push(Q.value),s&&L.push(d[b+A])):(j.push(d[b+A]),C.push(Q.value)))}return Promise.resolve(0<C.length&&o.mutate({trans:r,type:"add",values:C}).then(function(J){for(var F in J.failures)j.splice(parseInt(F),1);a(C.length,J)})).then(function(){return(0<O.length||k&&typeof t=="object")&&o.mutate({trans:r,type:"put",keys:L,values:O,criteria:k,changeSpec:typeof t!="function"&&t,isAdditionalChunk:0<b}).then(function(J){return a(O.length,J)})}).then(function(){return(0<j.length||k&&p)&&o.mutate({trans:r,type:"delete",keys:j,criteria:k,isAdditionalChunk:0<b}).then(function(J){return We(n.table,j,J)}).then(function(J){return a(j.length,J)})}).then(function(){return d.length>b+T&&_(b+w)})})}var k=le(n)&&n.limit===1/0&&(typeof t!="function"||p)&&{index:n.index,range:n.range};return _(0).then(function(){if(0<l.length)throw new Ke("Error modifying one or more objects",l,m,y);return d.length})})})},X.prototype.delete=function(){var t=this._ctx,e=t.range;return!le(t)||t.table.schema.yProps||!t.isPrimKey&&e.type!==3?this.modify(Ir):this._write(function(n){var r=t.table.core.schema.primaryKey,a=e;return t.table.core.count({trans:n,query:{index:r,range:a}}).then(function(i){return t.table.core.mutate({trans:n,type:"deleteRange",range:a}).then(function(f){var s=f.failures,f=f.numFailures;if(f)throw new Ke("Could not delete some values",Object.keys(s).map(function(w){return s[w]}),i-f);return i-f})})})};var Ia=X;function X(){}var Ir=function(t,e){return e.value=null};function Oa(t,e){return t<e?-1:t===e?0:1}function Aa(t,e){return e<t?-1:t===e?0:1}function kt(t,e,n){return t=t instanceof Ar?new t.Collection(t):t,t._ctx.error=new(n||TypeError)(e),t}function de(t){return new t.Collection(t,function(){return Or("")}).limit(0)}function He(y,e,n,r){var a,i,o,s,f,w,h,l=n.length;if(!n.every(function(d){return typeof d=="string"}))return kt(y,gr);function m(d){a=d==="next"?function(k){return k.toUpperCase()}:function(k){return k.toLowerCase()},i=d==="next"?function(k){return k.toLowerCase()}:function(k){return k.toUpperCase()},o=d==="next"?Oa:Aa;var _=n.map(function(k){return{lower:i(k),upper:a(k)}}).sort(function(k,b){return o(k.lower,b.lower)});s=_.map(function(k){return k.upper}),f=_.map(function(k){return k.lower}),h=(w=d)==="next"?"":r}m("next");var y=new y.Collection(y,function(){return Bt(s[0],f[l-1]+r)}),p=(y._ondirectionchange=function(d){m(d)},0);return y._addAlgorithm(function(d,_,k){var b=d.key;if(typeof b=="string"){var T=i(b);if(e(T,f,p))return!0;for(var I=null,P=p;P<l;++P){var C=((O,L,j,A,q,Q)=>{for(var J=Math.min(O.length,A.length),F=-1,H=0;H<J;++H){var at=L[H];if(at!==A[H])return q(O[H],j[H])<0?O.substr(0,H)+j[H]+j.substr(H+1):q(O[H],A[H])<0?O.substr(0,H)+A[H]+j.substr(H+1):0<=F?O.substr(0,F)+L[F]+j.substr(F+1):null;q(O[H],at)<0&&(F=H)}return J<A.length&&Q==="next"?O+j.substr(O.length):J<O.length&&Q==="prev"?O.substr(0,j.length):F<0?null:O.substr(0,F)+A[F]+j.substr(F+1)})(b,T,s[P],f[P],o,w);C===null&&I===null?p=P+1:(I===null||0<o(I,C))&&(I=C)}_(I!==null?function(){d.continue(I+h)}:k)}return!1}),y}function Bt(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Or(t){return{type:1,lower:t,upper:t}}Object.defineProperty(pt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),pt.prototype.between=function(t,e,n,r){n=n!==!1,r=r===!0;try{return 0<this._cmp(t,e)||this._cmp(t,e)===0&&(n||r)&&(!n||!r)?de(this):new this.Collection(this,function(){return Bt(t,e,!n,!r)})}catch{return kt(this,Kt)}},pt.prototype.equals=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Or(t)})},pt.prototype.above=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(t,void 0,!0)})},pt.prototype.aboveOrEqual=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(t,void 0,!1)})},pt.prototype.below=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(void 0,t,!1,!0)})},pt.prototype.belowOrEqual=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(void 0,t)})},pt.prototype.startsWith=function(t){return typeof t!="string"?kt(this,gr):this.between(t,t+Xt,!0,!0)},pt.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):He(this,function(e,n){return e.indexOf(n[0])===0},[t],Xt)},pt.prototype.equalsIgnoreCase=function(t){return He(this,function(e,n){return e===n[0]},[t],"")},pt.prototype.anyOfIgnoreCase=function(){var t=Pt.apply(re,arguments);return t.length===0?de(this):He(this,function(e,n){return n.indexOf(e)!==-1},t,"")},pt.prototype.startsWithAnyOfIgnoreCase=function(){var t=Pt.apply(re,arguments);return t.length===0?de(this):He(this,function(e,n){return n.some(function(r){return e.indexOf(r)===0})},t,Xt)},pt.prototype.anyOf=function(){var t,e,n=this,r=Pt.apply(re,arguments),a=this._cmp;try{r.sort(a)}catch{return kt(this,Kt)}return r.length===0?de(this):((t=new this.Collection(this,function(){return Bt(r[0],r[r.length-1])}))._ondirectionchange=function(i){a=i==="next"?n._ascending:n._descending,r.sort(a)},e=0,t._addAlgorithm(function(i,o,s){for(var f=i.key;0<a(f,r[e]);)if(++e===r.length)return o(s),!1;return a(f,r[e])===0||(o(function(){i.continue(r[e])}),!1)}),t)},pt.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},pt.prototype.noneOf=function(){var t=Pt.apply(re,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return kt(this,Kt)}var e=t.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},pt.prototype.inAnyRange=function(t,k){var n=this,r=this._cmp,a=this._ascending,i=this._descending,o=this._min,s=this._max;if(t.length===0)return de(this);if(!t.every(function(b){return b[0]!==void 0&&b[1]!==void 0&&a(b[0],b[1])<=0}))return kt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",N.InvalidArgument);var f=!k||k.includeLowers!==!1,w=k&&k.includeUppers===!0,h,l=a;function m(b,T){return l(b[0],T[0])}try{(h=t.reduce(function(b,T){for(var I=0,P=b.length;I<P;++I){var C=b[I];if(r(T[0],C[1])<0&&0<r(T[1],C[0])){C[0]=o(C[0],T[0]),C[1]=s(C[1],T[1]);break}}return I===P&&b.push(T),b},[])).sort(m)}catch{return kt(this,Kt)}var y=0,p=w?function(b){return 0<a(b,h[y][1])}:function(b){return 0<=a(b,h[y][1])},d=f?function(b){return 0<i(b,h[y][0])}:function(b){return 0<=i(b,h[y][0])},_=p,k=new this.Collection(this,function(){return Bt(h[0][0],h[h.length-1][1],!f,!w)});return k._ondirectionchange=function(b){l=b==="next"?(_=p,a):(_=d,i),h.sort(m)},k._addAlgorithm(function(b,T,I){for(var P,C=b.key;_(C);)if(++y===h.length)return T(I),!1;return!p(P=C)&&!d(P)||(n._cmp(C,h[y][1])===0||n._cmp(C,h[y][0])===0||T(function(){l===a?b.continue(h[y][0]):b.continue(h[y][1])}),!1)}),k},pt.prototype.startsWithAnyOf=function(){var t=Pt.apply(re,arguments);return t.every(function(e){return typeof e=="string"})?t.length===0?de(this):this.inAnyRange(t.map(function(e){return[e,e+Xt]})):kt(this,"startsWithAnyOf() only works with strings")};var Ar=pt;function pt(){}function Ot(t){return rt(function(e){return De(e),t(e.target.error),!1})}function De(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Ee="storagemutated",An="x-storagemutated-1",Nt=Se(null,Ee),Pa=(At.prototype._lock=function(){return St(!M.global),++this._reculock,this._reculock!==1||M.global||(M.lockOwnerFor=this),this},At.prototype._unlock=function(){if(St(!M.global),--this._reculock==0)for(M.global||(M.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{Qt(t[1],t[0])}catch{}}return this},At.prototype._locked=function(){return this._reculock&&M.lockOwnerFor!==this},At.prototype.create=function(t){var e=this;if(this.mode){var n=this.db.idbdb,r=this.db._state.dbOpenError;if(St(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new N.DatabaseClosed(r);case"MissingAPIError":throw new N.MissingAPI(r.message,r);default:throw new N.OpenFailed(r)}if(!this.active)throw new N.TransactionInactive;St(this._completion._state===null),(t=this.idbtrans=t||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=rt(function(a){De(a),e._reject(t.error)}),t.onabort=rt(function(a){De(a),e.active&&e._reject(new N.Abort(t.error)),e.active=!1,e.on("abort").fire(a)}),t.oncomplete=rt(function(){e.active=!1,e._resolve(),"mutatedParts"in t&&Nt.storagemutated.fire(t.mutatedParts)})}return this},At.prototype._promise=function(t,e,n){var r,a=this;return t==="readwrite"&&this.mode!=="readwrite"?ct(new N.ReadOnly("Transaction is readonly")):this.active?this._locked()?new $(function(i,o){a._blockedFuncs.push([function(){a._promise(t,e,n).then(i,o)},M])}):n?qt(function(){var i=new $(function(o,s){a._lock();var f=e(o,s,a);f&&f.then&&f.then(o,s)});return i.finally(function(){return a._unlock()}),i._lib=!0,i}):((r=new $(function(i,o){var s=e(i,o,a);s&&s.then&&s.then(i,o)}))._lib=!0,r):ct(new N.TransactionInactive)},At.prototype._root=function(){return this.parent?this.parent._root():this},At.prototype.waitFor=function(t){var e,n=this._root(),r=$.resolve(t),a=(n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],e=n.idbtrans.objectStore(n.storeNames[0]),function i(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(e.get(-1/0).onsuccess=i)}()),n._waitingFor);return new $(function(i,o){r.then(function(s){return n._waitingQueue.push(rt(i.bind(null,s)))},function(s){return n._waitingQueue.push(rt(o.bind(null,s)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},At.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new N.Abort))},At.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(B(e,t))return e[t];var n=this.schema[t];if(n)return(n=new this.db.Table(t,n,this)).core=this.db.core.table(t),e[t]=n;throw new N.NotFound("Table "+t+" not part of transaction")},At);function At(){}function Pn(t,e,n,r,a,i,o,s){return{name:t,keyPath:e,unique:n,multi:r,auto:a,compound:i,src:(n&&!o?"&":"")+(r?"*":"")+(a?"++":"")+Pr(e),type:s}}function Pr(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Cn(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:(r=function(a){return[a.name,a]},n.reduce(function(a,i,o){return i=r(i,o),i&&(a[i[0]]=i[1]),a},{}))};var r}var Ie=function(t){try{return t.only([[]]),Ie=function(){return[[]]},[[]]}catch{return Ie=function(){return Xt},Xt}};function Kn(t){return t==null?function(){}:typeof t=="string"?(e=t).split(".").length===1?function(n){return n[e]}:function(n){return bt(n,e)}:function(n){return bt(n,t)};var e}function Cr(t){return[].slice.call(t)}var Ca=0;function Oe(t){return t==null?":id":typeof t=="string"?t:"[".concat(t.join("+"),"]")}function Ka(t,e,f){function r(p){if(p.type===3)return null;if(p.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var l=p.lower,m=p.upper,y=p.lowerOpen,p=p.upperOpen;return l===void 0?m===void 0?null:e.upperBound(m,!!p):m===void 0?e.lowerBound(l,!!y):e.bound(l,m,!!y,!!p)}function a(h){var l,m=h.name;return{name:m,schema:h,mutate:function(y){var p=y.trans,d=y.type,_=y.keys,k=y.values,b=y.range;return new Promise(function(T,I){T=rt(T);var P=p.objectStore(m),C=P.keyPath==null,O=d==="put"||d==="add";if(!O&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);var L,j=(_||k||{length:1}).length;if(_&&k&&_.length!==k.length)throw new Error("Given keys array must have same length as given values array.");if(j===0)return T({numFailures:0,failures:{},results:[],lastResult:void 0});function A(st){++J,De(st)}var q=[],Q=[],J=0;if(d==="deleteRange"){if(b.type===4)return T({numFailures:J,failures:Q,results:[],lastResult:void 0});b.type===3?q.push(L=P.clear()):q.push(L=P.delete(r(b)))}else{var C=O?C?[k,_]:[k,null]:[_,null],F=C[0],H=C[1];if(O)for(var at=0;at<j;++at)q.push(L=H&&H[at]!==void 0?P[d](F[at],H[at]):P[d](F[at])),L.onerror=A;else for(at=0;at<j;++at)q.push(L=P[d](F[at])),L.onerror=A}function Tt(st){st=st.target.result,q.forEach(function(ee,Xn){return ee.error!=null&&(Q[Xn]=ee.error)}),T({numFailures:J,failures:Q,results:d==="delete"?_:q.map(function(ee){return ee.result}),lastResult:st})}L.onerror=function(st){A(st),Tt(st)},L.onsuccess=Tt})},getMany:function(y){var p=y.trans,d=y.keys;return new Promise(function(_,k){_=rt(_);for(var b,T=p.objectStore(m),I=d.length,P=new Array(I),C=0,O=0,L=function(q){q=q.target,P[q._pos]=q.result,++O===C&&_(P)},j=Ot(k),A=0;A<I;++A)d[A]!=null&&((b=T.get(d[A]))._pos=A,b.onsuccess=L,b.onerror=j,++C);C===0&&_(P)})},get:function(y){var p=y.trans,d=y.key;return new Promise(function(_,k){_=rt(_);var b=p.objectStore(m).get(d);b.onsuccess=function(T){return _(T.target.result)},b.onerror=Ot(k)})},query:(l=s,function(y){return new Promise(function(p,d){p=rt(p);var _,k,b,O=y.trans,T=y.values,I=y.limit,C=y.query,P=I===1/0?void 0:I,L=C.index,C=C.range,O=O.objectStore(m),O=L.isPrimaryKey?O:O.index(L.name),L=r(C);if(I===0)return p({result:[]});l?((C=T?O.getAll(L,P):O.getAllKeys(L,P)).onsuccess=function(j){return p({result:j.target.result})},C.onerror=Ot(d)):(_=0,k=!T&&"openKeyCursor"in O?O.openKeyCursor(L):O.openCursor(L),b=[],k.onsuccess=function(j){var A=k.result;return!A||(b.push(T?A.value:A.primaryKey),++_===I)?p({result:b}):void A.continue()},k.onerror=Ot(d))})}),openCursor:function(y){var p=y.trans,d=y.values,_=y.query,k=y.reverse,b=y.unique;return new Promise(function(T,I){T=rt(T);var O=_.index,P=_.range,C=p.objectStore(m),C=O.isPrimaryKey?C:C.index(O.name),O=k?b?"prevunique":"prev":b?"nextunique":"next",L=!d&&"openKeyCursor"in C?C.openKeyCursor(r(P),O):C.openCursor(r(P),O);L.onerror=Ot(I),L.onsuccess=rt(function(j){var A,q,Q,J,F=L.result;F?(F.___id=++Ca,F.done=!1,A=F.continue.bind(F),q=(q=F.continuePrimaryKey)&&q.bind(F),Q=F.advance.bind(F),J=function(){throw new Error("Cursor not stopped")},F.trans=p,F.stop=F.continue=F.continuePrimaryKey=F.advance=function(){throw new Error("Cursor not started")},F.fail=rt(I),F.next=function(){var H=this,at=1;return this.start(function(){return at--?H.continue():H.stop()}).then(function(){return H})},F.start=function(H){function at(){if(L.result)try{H()}catch(st){F.fail(st)}else F.done=!0,F.start=function(){throw new Error("Cursor behind last entry")},F.stop()}var Tt=new Promise(function(st,ee){st=rt(st),L.onerror=Ot(ee),F.fail=ee,F.stop=function(Xn){F.stop=F.continue=F.continuePrimaryKey=F.advance=J,st(Xn)}});return L.onsuccess=rt(function(st){L.onsuccess=at,at()}),F.continue=A,F.continuePrimaryKey=q,F.advance=Q,at(),Tt},T(F)):T(null)},I)})},count:function(y){var p=y.query,d=y.trans,_=p.index,k=p.range;return new Promise(function(b,T){var I=d.objectStore(m),I=_.isPrimaryKey?I:I.index(_.name),P=r(k),P=P?I.count(P):I.count();P.onsuccess=rt(function(C){return b(C.target.result)}),P.onerror=Ot(T)})}}}i=f,o=Cr((f=t).objectStoreNames);var i,f={schema:{name:f.name,tables:o.map(function(h){return i.objectStore(h)}).map(function(h){var l=h.keyPath,m=h.autoIncrement,p=E(l),y={},p={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:l==null,compound:p,keyPath:l,autoIncrement:m,unique:!0,extractKey:Kn(l)},indexes:Cr(h.indexNames).map(function(d){return h.index(d)}).map(function(b){var T=b.name,_=b.unique,k=b.multiEntry,b=b.keyPath,T={name:T,compound:E(b),keyPath:b,unique:_,multiEntry:k,extractKey:Kn(b)};return y[Oe(b)]=T}),getIndexByKeyPath:function(d){return y[Oe(d)]}};return y[":id"]=p.primaryKey,l!=null&&(y[Oe(l)]=p.primaryKey),p})},hasGetAll:0<o.length&&"getAll"in i.objectStore(o[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},o=f.schema,s=f.hasGetAll,f=o.tables.map(a),w={};return f.forEach(function(h){return w[h.name]=h}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(h){if(w[h])return w[h];throw new Error("Table '".concat(h,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Ie(e),schema:o}}function $a(t,e,n,r){return n=n.IDBKeyRange,e=Ka(e,n,r),{dbcore:t.dbcore.reduce(function(a,i){return i=i.create,g(g({},a),i(a))},e)}}function Ye(t,e){var n=e.db,n=$a(t._middlewares,n,t._deps,e);t.core=n.dbcore,t.tables.forEach(function(r){var a=r.name;t.core.schema.tables.some(function(i){return i.name===a})&&(r.core=t.core.table(a),t[a]instanceof t.Table)&&(t[a].core=r.core)})}function Ge(t,e,n,r){n.forEach(function(a){var i=r[a];e.forEach(function(o){var s=function f(w,h){return yt(w,h)||(w=R(w))&&f(w,h)}(o,a);(!s||"value"in s&&s.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?V(o,a,{get:function(){return this.table(a)},set:function(f){U(this,a,{value:f,writable:!0,configurable:!0,enumerable:!0})}}):o[a]=new t.Table(a,i))})})}function $n(t,e){e.forEach(function(n){for(var r in n)n[r]instanceof t.Table&&delete n[r]})}function ja(t,e){return t._cfg.version-e._cfg.version}function La(t,e,n,r){var a=t._dbSchema,i=(n.objectStoreNames.contains("$meta")&&!a.$meta&&(a.$meta=Cn("$meta",$r("")[0],[]),t._storeNames.push("$meta")),t._createTransaction("readwrite",t._storeNames,a)),o=(i.create(n),i._completion.catch(r),i._reject.bind(i)),s=M.transless||M;qt(function(){if(M.trans=i,M.transless=s,e!==0)return Ye(t,n),w=e,((f=i).storeNames.includes("$meta")?f.table("$meta").get("version").then(function(h){return h??w}):$.resolve(w)).then(function(_){var l=t,m=_,y=i,p=n,d=[],_=l._versions,k=l._dbSchema=Xe(0,l.idbdb,p);return(_=_.filter(function(b){return b._cfg.version>=m})).length===0?$.resolve():(_.forEach(function(b){d.push(function(){var T,I,P,C=k,O=b._cfg.dbschema,L=(Je(l,C,p),Je(l,O,p),k=l._dbSchema=O,jn(C,O)),j=(L.add.forEach(function(A){Ln(p,A[0],A[1].primKey,A[1].indexes)}),L.change.forEach(function(A){if(A.recreate)throw new N.Upgrade("Not yet support for changing primary key");var q=p.objectStore(A.name);A.add.forEach(function(Q){return Qe(q,Q)}),A.change.forEach(function(Q){q.deleteIndex(Q.name),Qe(q,Q)}),A.del.forEach(function(Q){return q.deleteIndex(Q)})}),b._cfg.contentUpgrade);if(j&&b._cfg.version>m)return Ye(l,p),y._memoizedTables={},T=ft(O),L.del.forEach(function(A){T[A]=C[A]}),$n(l,[l.Transaction.prototype]),Ge(l,[l.Transaction.prototype],S(T),T),y.schema=T,(I=mn(j))&&ue(),O=$.follow(function(){var A;(P=j(y))&&I&&(A=Rt.bind(null,null),P.then(A,A))}),P&&typeof P.then=="function"?$.resolve(P):O.then(function(){return P})}),d.push(function(T){var I,P,C=b._cfg.dbschema;I=C,P=T,[].slice.call(P.db.objectStoreNames).forEach(function(O){return I[O]==null&&P.db.deleteObjectStore(O)}),$n(l,[l.Transaction.prototype]),Ge(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),y.schema=l._dbSchema}),d.push(function(T){l.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(l.idbdb.version/10)===b._cfg.version?(l.idbdb.deleteObjectStore("$meta"),delete l._dbSchema.$meta,l._storeNames=l._storeNames.filter(function(I){return I!=="$meta"})):T.objectStore("$meta").put(b._cfg.version,"version"))})}),function b(){return d.length?$.resolve(d.shift()(y.idbtrans)).then(b):$.resolve()}().then(function(){Kr(k,p)}))}).catch(o);var f,w;S(a).forEach(function(h){Ln(n,h,a[h].primKey,a[h].indexes)}),Ye(t,n),$.follow(function(){return t.on.populate.fire(i)}).catch(o)})}function qa(t,e){Kr(t._dbSchema,e),e.db.version%10!=0||e.objectStoreNames.contains("$meta")||e.db.createObjectStore("$meta").add(Math.ceil(e.db.version/10-1),"version");var n=Xe(0,t.idbdb,e);Je(t,t._dbSchema,e);for(var r=0,a=jn(n,t._dbSchema).change;r<a.length;r++){var i=(o=>{if(o.change.length||o.recreate)return console.warn("Unable to patch indexes of table ".concat(o.name," because it has changes on the type of index or primary key.")),{value:void 0};var s=e.objectStore(o.name);o.add.forEach(function(f){It&&console.debug("Dexie upgrade patch: Creating missing index ".concat(o.name,".").concat(f.src)),Qe(s,f)})})(a[r]);if(typeof i=="object")return i.value}}function jn(t,e){var n,r={del:[],add:[],change:[]};for(n in t)e[n]||r.del.push(n);for(n in e){var a=t[n],i=e[n];if(a){var o={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||a.primKey.auto!==i.primKey.auto)o.recreate=!0,r.change.push(o);else{var s=a.idxByName,f=i.idxByName,w=void 0;for(w in s)f[w]||o.del.push(w);for(w in f){var h=s[w],l=f[w];h?h.src!==l.src&&o.change.push(l):o.add.push(l)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([n,i])}return r}function Ln(t,e,n,r){var a=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});r.forEach(function(i){return Qe(a,i)})}function Kr(t,e){S(t).forEach(function(n){e.db.objectStoreNames.contains(n)||(It&&console.debug("Dexie: Creating missing table",n),Ln(e,n,t[n].primKey,t[n].indexes))})}function Qe(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Xe(t,e,n){var r={};return xt(e.objectStoreNames,0).forEach(function(a){for(var i=n.objectStore(a),o=Pn(Pr(w=i.keyPath),w||"",!0,!1,!!i.autoIncrement,w&&typeof w!="string",!0),s=[],f=0;f<i.indexNames.length;++f){var h=i.index(i.indexNames[f]),w=h.keyPath,h=Pn(h.name,w,!!h.unique,!!h.multiEntry,!1,w&&typeof w!="string",!1);s.push(h)}r[a]=Cn(a,o,s)}),r}function Je(t,e,n){for(var r=n.db.objectStoreNames,a=0;a<r.length;++a){var i=r[a],o=n.objectStore(i);t._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var f,w=o.indexNames[s],h=o.index(w).keyPath,h=typeof h=="string"?h:"["+xt(h).join("+")+"]";e[i]&&(f=e[i].idxByName[h])&&(f.name=w,delete e[i].idxByName[h],e[i].idxByName[w]=f)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&D.WorkerGlobalScope&&D instanceof D.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function $r(t){return t.split(",").map(function(e,n){var a=e.split(":"),r=(r=a[1])==null?void 0:r.trim(),a=(e=a[0].trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return Pn(a,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),E(i),n===0,r)})}fe.prototype._createTableSchema=Cn,fe.prototype._parseIndexSyntax=$r,fe.prototype._parseStoresSpec=function(t,e){var n=this;S(t).forEach(function(r){if(t[r]!==null){var a=n._parseIndexSyntax(t[r]),i=a.shift();if(!i)throw new N.Schema("Invalid schema for table "+r+": "+t[r]);if(i.unique=!0,i.multi)throw new N.Schema("Primary key cannot be multiEntry*");a.forEach(function(o){if(o.auto)throw new N.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new N.Schema("Index must have a name and cannot be an empty string")}),i=n._createTableSchema(r,i,a),e[r]=i}})},fe.prototype.stores=function(n){var e=this.db,n=(this._cfg.storesSource=this._cfg.storesSource?K(this._cfg.storesSource,n):n,e._versions),r={},a={};return n.forEach(function(i){K(r,i._cfg.storesSource),a=i._cfg.dbschema={},i._parseStoresSpec(r,a)}),e._dbSchema=a,$n(e,[e._allTables,e,e.Transaction.prototype]),Ge(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],S(a),a),e._storeNames=S(a),this},fe.prototype.upgrade=function(t){return this._cfg.contentUpgrade=vn(this._cfg.contentUpgrade||Z,t),this};var Ra=fe;function fe(){}function qn(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new $t(Fe,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Rn(t){return t&&typeof t.databases=="function"}function Mn(t){return qt(function(){return M.letThrough=!0,t()})}function Bn(t){return!("from"in t)}var gt=function(t,e){var n;if(!this)return n=new gt,t&&"d"in t&&K(n,t),n;K(this,arguments.length?{d:1,from:t,to:1<arguments.length?e:t}:{d:0})};function Ae(t,e,n){var r=G(e,n);if(!isNaN(r)){if(0<r)throw RangeError();if(Bn(t))return K(t,{from:e,to:n,d:1});var r=t.l,a=t.r;if(G(n,t.from)<0)return r?Ae(r,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Lr(t);if(0<G(e,t.to))return a?Ae(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Lr(t);G(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),0<G(n,t.to)&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1),e=!t.r,r&&!t.l&&Pe(t,r),a&&e&&Pe(t,a)}}function Pe(t,e){Bn(e)||function n(r,a){var i=a.from,o=a.l,s=a.r;Ae(r,i,a.to),o&&n(r,o),s&&n(r,s)}(t,e)}function jr(t,e){var n=Ze(e),r=n.next();if(!r.done)for(var a=r.value,i=Ze(t),o=i.next(a.from),s=o.value;!r.done&&!o.done;){if(G(s.from,a.to)<=0&&0<=G(s.to,a.from))return!0;G(a.from,s.from)<0?a=(r=n.next(s.from)).value:s=(o=i.next(a.from)).value}return!1}function Ze(t){var e=Bn(t)?null:{s:0,n:t};return{next:function(n){for(var r=0<arguments.length;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&G(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||G(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Lr(t){var e,n,r,a=(((a=t.r)==null?void 0:a.d)||0)-(((a=t.l)==null?void 0:a.d)||0),a=1<a?"r":a<-1?"l":"";a&&(e=a=="r"?"l":"r",n=g({},t),r=t[a],t.from=r.from,t.to=r.to,t[a]=r[a],n[a]=r[e],(t[e]=n).d=qr(n)),t.d=qr(t)}function qr(n){var e=n.r,n=n.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}function tn(t,e){return S(e).forEach(function(n){t[n]?Pe(t[n],e[n]):t[n]=function r(a){var i,o,s={};for(i in a)B(a,i)&&(o=a[i],s[i]=!o||typeof o!="object"||cr.has(o.constructor)?o:r(o));return s}(e[n])}),t}function Nn(t,e){return t.all||e.all||Object.keys(t).some(function(n){return e[n]&&jr(e[n],t[n])})}tt(gt.prototype,((_t={add:function(t){return Pe(this,t),this},addKey:function(t){return Ae(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return Ae(e,n,n)}),this},hasKey:function(t){var e=Ze(this).next(t).value;return e&&G(e.from,t)<=0&&0<=G(e.to,t)}})[pn]=function(){return Ze(this)},_t));var Zt={},Fn={},Un=!1;function en(t){tn(Fn,t),Un||(Un=!0,setTimeout(function(){Un=!1,Wn(Fn,!(Fn={}))},0))}function Wn(t,e){e===void 0&&(e=!1);var n=new Set;if(t.all)for(var r=0,a=Object.values(Zt);r<a.length;r++)Rr(s=a[r],t,n,e);else for(var i in t){var o,s,i=/^idb\:\/\/(.*)\/(.*)\//.exec(i);i&&(o=i[1],i=i[2],s=Zt["idb://".concat(o,"/").concat(i)])&&Rr(s,t,n,e)}n.forEach(function(f){return f()})}function Rr(t,e,n,r){for(var a=[],i=0,o=Object.entries(t.queries.query);i<o.length;i++){for(var s=o[i],f=s[0],w=[],h=0,l=s[1];h<l.length;h++){var m=l[h];Nn(e,m.obsSet)?m.subscribers.forEach(function(_){return n.add(_)}):r&&w.push(m)}r&&a.push([f,w])}if(r)for(var y=0,p=a;y<p.length;y++){var d=p[y],f=d[0],w=d[1];t.queries.query[f]=w}}function Ma(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?ct(e.dbOpenError):t});e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller,a=Math.round(10*t.verno),i=!1;function o(){if(e.openCanceller!==r)throw new N.DatabaseClosed("db.open() was cancelled")}function s(){return new $(function(m,y){if(o(),!n)throw new N.MissingAPI;var p=t.name,d=e.autoSchema||!a?n.open(p):n.open(p,a);if(!d)throw new N.MissingAPI;d.onerror=Ot(y),d.onblocked=rt(t._fireOnBlocked),d.onupgradeneeded=rt(function(_){var k;h=d.transaction,e.autoSchema&&!t._options.allowEmptyDB?(d.onerror=De,h.abort(),d.result.close(),(k=n.deleteDatabase(p)).onsuccess=k.onerror=rt(function(){y(new N.NoSuchDatabase("Database ".concat(p," doesnt exist")))})):(h.onerror=Ot(y),k=_.oldVersion>Math.pow(2,62)?0:_.oldVersion,l=k<1,t.idbdb=d.result,i&&qa(t,h),La(t,k/10,h,y))},y),d.onsuccess=rt(function(){h=null;var _,k,b,T,I,P,C=t.idbdb=d.result,O=xt(C.objectStoreNames);if(0<O.length)try{var L=C.transaction((I=O).length===1?I[0]:I,"readonly");if(e.autoSchema)P=C,T=L,(b=t).verno=P.version/10,T=b._dbSchema=Xe(0,P,T),b._storeNames=xt(P.objectStoreNames,0),Ge(b,[b._allTables],S(T),T);else if(Je(t,t._dbSchema,L),k=L,((k=jn(Xe(0,(_=t).idbdb,k),_._dbSchema)).add.length||k.change.some(function(j){return j.add.length||j.change.length}))&&!i)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),C.close(),a=C.version+1,i=!0,m(s());Ye(t,L)}catch{}ce.push(t),C.onversionchange=rt(function(j){e.vcFired=!0,t.on("versionchange").fire(j)}),C.onclose=rt(function(){t.close({disableAutoOpen:!1})}),l&&(O=t._deps,I=p,Rn(P=O.indexedDB)||I===Fe||qn(P,O.IDBKeyRange).put({name:I}).catch(Z)),m()},y)}).catch(function(m){switch(m==null?void 0:m.name){case"UnknownError":if(0<e.PR1398_maxLoop)return e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),s();break;case"VersionError":if(0<a)return a=0,s()}return $.reject(m)})}var f,w=e.dbReadyResolve,h=null,l=!1;return $.race([r,(typeof navigator>"u"?$.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(m){function y(){return indexedDB.databases().finally(m)}f=setInterval(y,100),y()}).finally(function(){return clearInterval(f)}):Promise.resolve()).then(s)]).then(function(){return o(),e.onReadyBeingFired=[],$.resolve(Mn(function(){return t.on.ready.fire(t.vip)})).then(function m(){var y;if(0<e.onReadyBeingFired.length)return y=e.onReadyBeingFired.reduce(vn,Z),e.onReadyBeingFired=[],$.resolve(Mn(function(){return y(t.vip)})).then(m)})}).finally(function(){e.openCanceller===r&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)}).catch(function(m){e.dbOpenError=m;try{h&&h.abort()}catch{}return r===e.openCanceller&&t._close(),ct(m)}).finally(function(){e.openComplete=!0,w()}).then(function(){var m;return l&&(m={},t.tables.forEach(function(y){y.schema.indexes.forEach(function(p){p.name&&(m["idb://".concat(t.name,"/").concat(y.name,"/").concat(p.name)]=new gt(-1/0,[[[]]]))}),m["idb://".concat(t.name,"/").concat(y.name,"/")]=m["idb://".concat(t.name,"/").concat(y.name,"/:dels")]=new gt(-1/0,[[[]]])}),Nt(Ee).fire(m),Wn(m,!0)),t})}function Vn(t){function e(i){return t.next(i)}var n=a(e),r=a(function(i){return t.throw(i)});function a(i){return function(s){var s=i(s),f=s.value;return s.done?f:f&&typeof f.then=="function"?f.then(n,r):E(f)?Promise.all(f).then(n,r):n(f)}}return a(e)()}function nn(t,e,n){for(var r=E(t)?t.slice():[t],a=0;a<n;++a)r.push(e);return r}var Ba={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return g(g({},t),{table:function(r){var n=t.table(r),r=n.schema,a={},i=[];function o(m,y,p){var b=Oe(m),d=a[b]=a[b]||[],_=m==null?0:typeof m=="string"?1:m.length,k=0<y,b=g(g({},p),{name:k?"".concat(b,"(virtual-from:").concat(p.name,")"):p.name,lowLevelIndex:p,isVirtual:k,keyTail:y,keyLength:_,extractKey:Kn(m),unique:!k&&p.unique});return d.push(b),b.isPrimaryKey||i.push(b),1<_&&o(_===2?m[0]:m.slice(0,_-1),y+1,p),d.sort(function(T,I){return T.keyTail-I.keyTail}),b}var s=o(r.primaryKey.keyPath,0,r.primaryKey);a[":id"]=[s];for(var f=0,w=r.indexes;f<w.length;f++){var h=w[f];o(h.keyPath,0,h)}function l(m){var y,p=m.query.index;return p.isVirtual?g(g({},m),{query:{index:p.lowLevelIndex,range:(y=m.query.range,p=p.keyTail,{type:y.type===1?2:y.type,lower:nn(y.lower,y.lowerOpen?t.MAX_KEY:t.MIN_KEY,p),lowerOpen:!0,upper:nn(y.upper,y.upperOpen?t.MIN_KEY:t.MAX_KEY,p),upperOpen:!0})}}):m}return g(g({},n),{schema:g(g({},r),{primaryKey:s,indexes:i,getIndexByKeyPath:function(m){return(m=a[Oe(m)])&&m[0]}}),count:function(m){return n.count(l(m))},query:function(m){return n.query(l(m))},openCursor:function(m){var y=m.query.index,p=y.keyTail,d=y.keyLength;return y.isVirtual?n.openCursor(l(m)).then(function(k){return k&&_(k)}):n.openCursor(m);function _(k){return Object.create(k,{continue:{value:function(b){b!=null?k.continue(nn(b,m.reverse?t.MAX_KEY:t.MIN_KEY,p)):m.unique?k.continue(k.key.slice(0,d).concat(m.reverse?t.MIN_KEY:t.MAX_KEY,p)):k.continue()}},continuePrimaryKey:{value:function(b,T){k.continuePrimaryKey(nn(b,t.MAX_KEY,p),T)}},primaryKey:{get:function(){return k.primaryKey}},key:{get:function(){var b=k.key;return d===1?b[0]:b.slice(0,d)}},value:{get:function(){return k.value}}})}}})}})}};function zn(t,e,n,r){return n=n||{},r=r||"",S(t).forEach(function(a){var i,o,s;B(e,a)?(i=t[a],o=e[a],typeof i=="object"&&typeof o=="object"&&i&&o?(s=hn(i))!==hn(o)?n[r+a]=e[a]:s==="Object"?zn(i,o,n,r+a+"."):i!==o&&(n[r+a]=e[a]):i!==o&&(n[r+a]=e[a])):n[r+a]=void 0}),S(e).forEach(function(a){B(t,a)||(n[r+a]=e[a])}),n}function Hn(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Na={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return g(g({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey;return g(g({},n),{mutate:function(a){var i=M.trans,o=i.table(e).hook,s=o.deleting,f=o.creating,w=o.updating;switch(a.type){case"add":if(f.fire===Z)break;return i._promise("readwrite",function(){return h(a)},!0);case"put":if(f.fire===Z&&w.fire===Z)break;return i._promise("readwrite",function(){return h(a)},!0);case"delete":if(s.fire===Z)break;return i._promise("readwrite",function(){return h(a)},!0);case"deleteRange":if(s.fire===Z)break;return i._promise("readwrite",function(){return function l(m,y,p){return n.query({trans:m,values:!1,query:{index:r,range:y},limit:p}).then(function(d){var _=d.result;return h({type:"delete",keys:_,trans:m}).then(function(k){return 0<k.numFailures?Promise.reject(k.failures[0]):_.length<p?{failures:[],numFailures:0,lastResult:void 0}:l(m,g(g({},y),{lower:_[_.length-1],lowerOpen:!0}),p)})})}(a.trans,a.range,1e4)},!0)}return n.mutate(a);function h(l){var m,y,p,d=M.trans,_=l.keys||Hn(r,l);if(_)return(l=l.type==="add"||l.type==="put"?g(g({},l),{keys:_}):g({},l)).type!=="delete"&&(l.values=x([],l.values)),l.keys&&(l.keys=x([],l.keys)),m=n,p=_,((y=l).type==="add"?Promise.resolve([]):m.getMany({trans:y.trans,keys:p,cache:"immutable"})).then(function(k){var b=_.map(function(T,I){var P,C,O,L=k[I],j={onerror:null,onsuccess:null};return l.type==="delete"?s.fire.call(j,T,L,d):l.type==="add"||L===void 0?(P=f.fire.call(j,T,l.values[I],d),T==null&&P!=null&&(l.keys[I]=T=P,r.outbound||ut(l.values[I],r.keyPath,T))):(P=zn(L,l.values[I]),(C=w.fire.call(j,P,T,L,d))&&(O=l.values[I],Object.keys(C).forEach(function(A){B(O,A)?O[A]=C[A]:ut(O,A,C[A])}))),j});return n.mutate(l).then(function(T){for(var I=T.failures,P=T.results,C=T.numFailures,T=T.lastResult,O=0;O<_.length;++O){var L=(P||_)[O],j=b[O];L==null?j.onerror&&j.onerror(I[O]):j.onsuccess&&j.onsuccess(l.type==="put"&&k[O]?l.values[O]:L)}return{failures:I,results:P,numFailures:C,lastResult:T}}).catch(function(T){return b.forEach(function(I){return I.onerror&&I.onerror(T)}),Promise.reject(T)})});throw new Error("Keys missing")}}})}})}};function Mr(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],a=0,i=0;a<e.keys.length&&i<t.length;++a)G(e.keys[a],t[i])===0&&(r.push(n?Wt(e.values[a]):e.values[a]),++i);return r.length===t.length?r:null}catch{return null}}var Fa={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return g(g({},n),{getMany:function(r){var a;return r.cache?(a=Mr(r.keys,r.trans._cache,r.cache==="clone"))?$.resolve(a):n.getMany(r).then(function(i){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Wt(i):i},i}):n.getMany(r)},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function Br(t,e){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!e.schema.primaryKey.outbound}function Nr(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ua={stack:"dbcore",level:0,name:"Observability",create:function(t){var e=t.schema.name,n=new gt(t.MIN_KEY,t.MAX_KEY);return g(g({},t),{transaction:function(r,a,i){if(M.subscr&&a!=="readonly")throw new N.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(M.querier));return t.transaction(r,a,i)},table:function(r){function a(_){var d,_=_.query;return[d=_.index,new gt((d=(_=_.range).lower)!=null?d:t.MIN_KEY,(d=_.upper)!=null?d:t.MAX_KEY)]}var i=t.table(r),o=i.schema,s=o.primaryKey,f=o.indexes,w=s.extractKey,h=s.outbound,l=s.autoIncrement&&f.filter(function(p){return p.compound&&p.keyPath.includes(s.keyPath)}),m=g(g({},i),{mutate:function(p){function d(q){return q="idb://".concat(e,"/").concat(r,"/").concat(q),I[q]||(I[q]=new gt)}var _,k,b,T=p.trans,I=p.mutatedParts||(p.mutatedParts={}),P=d(""),C=d(":dels"),O=p.type,j=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[Hn(s,p).filter(function(q){return q}),p.values]:[],L=j[0],j=j[1],A=p.trans._cache;return E(L)?(P.addKeys(L),(O=O==="delete"||L.length===j.length?Mr(L,A):null)||C.addKeys(L),(O||j)&&(_=d,k=O,b=j,o.indexes.forEach(function(q){var Q=_(q.name||"");function J(H){return H!=null?q.extractKey(H):null}function F(H){q.multiEntry&&E(H)?H.forEach(function(at){return Q.addKey(at)}):Q.addKey(H)}(k||b).forEach(function(H,st){var Tt=k&&J(k[st]),st=b&&J(b[st]);G(Tt,st)!==0&&(Tt!=null&&F(Tt),st!=null)&&F(st)})}))):L?(j={from:(A=L.lower)!=null?A:t.MIN_KEY,to:(O=L.upper)!=null?O:t.MAX_KEY},C.add(j),P.add(j)):(P.add(n),C.add(n),o.indexes.forEach(function(q){return d(q.name).add(n)})),i.mutate(p).then(function(q){return!L||p.type!=="add"&&p.type!=="put"||(P.addKeys(q.results),l&&l.forEach(function(Q){for(var J=p.values.map(function(Tt){return Q.extractKey(Tt)}),F=Q.keyPath.findIndex(function(Tt){return Tt===s.keyPath}),H=0,at=q.results.length;H<at;++H)J[H][F]=q.results[H];d(Q.name).addKeys(J)})),T.mutatedParts=tn(T.mutatedParts||{},I),q})}}),y={get:function(p){return[s,new gt(p.key)]},getMany:function(p){return[s,new gt().addKeys(p.keys)]},count:a,query:a,openCursor:a};return S(y).forEach(function(p){m[p]=function(d){var _=M.subscr,k=!!_,b=Br(M,i)&&Nr(p,d)?d.obsSet={}:_;if(k){var T,_=function(j){return j="idb://".concat(e,"/").concat(r,"/").concat(j),b[j]||(b[j]=new gt)},I=_(""),P=_(":dels"),k=y[p](d),C=k[0],k=k[1];if((p==="query"&&C.isPrimaryKey&&!d.values?P:_(C.name||"")).add(k),!C.isPrimaryKey){if(p!=="count")return T=p==="query"&&h&&d.values&&i.query(g(g({},d),{values:!1})),i[p].apply(this,arguments).then(function(j){if(p==="query"){if(h&&d.values)return T.then(function(J){return J=J.result,I.addKeys(J),j});var A=d.values?j.result.map(w):j.result;(d.values?I:P).addKeys(A)}else{var q,Q;if(p==="openCursor")return Q=d.values,(q=j)&&Object.create(q,{key:{get:function(){return P.addKey(q.primaryKey),q.key}},primaryKey:{get:function(){var J=q.primaryKey;return P.addKey(J),J}},value:{get:function(){return Q&&I.addKey(q.primaryKey),q.value}}})}return j});P.add(n)}}return i[p].apply(this,arguments)}}),m}})}};function Fr(t,e,n){var r;return n.numFailures===0?e:e.type==="deleteRange"||(r=e.keys?e.keys.length:"values"in e&&e.values?e.values.length:1,n.numFailures===r)?null:(r=g({},e),E(r.keys)&&(r.keys=r.keys.filter(function(a,i){return!(i in n.failures)})),"values"in r&&E(r.values)&&(r.values=r.values.filter(function(a,i){return!(i in n.failures)})),r)}function Yn(t,e){return n=t,((r=e).lower===void 0||(r.lowerOpen?0<G(n,r.lower):0<=G(n,r.lower)))&&(n=t,(r=e).upper===void 0||(r.upperOpen?G(n,r.upper)<0:G(n,r.upper)<=0));var n,r}function Ur(t,e,n,r,a,i){var o,s,f,w,h,l;return!n||n.length===0||(o=e.query.index,s=o.multiEntry,f=e.query.range,w=r.schema.primaryKey.extractKey,h=o.extractKey,l=(o.lowLevelIndex||o).extractKey,(r=n.reduce(function(m,y){var p=m,d=[];if(y.type==="add"||y.type==="put")for(var _=new gt,k=y.values.length-1;0<=k;--k){var b,T=y.values[k],I=w(T);!_.hasKey(I)&&(b=h(T),s&&E(b)?b.some(function(j){return Yn(j,f)}):Yn(b,f))&&(_.addKey(I),d.push(T))}switch(y.type){case"add":var P=new gt().addKeys(e.values?m.map(function(A){return w(A)}):m),p=m.concat(e.values?d.filter(function(A){return A=w(A),!P.hasKey(A)&&(P.addKey(A),!0)}):d.map(function(A){return w(A)}).filter(function(A){return!P.hasKey(A)&&(P.addKey(A),!0)}));break;case"put":var C=new gt().addKeys(y.values.map(function(A){return w(A)}));p=m.filter(function(A){return!C.hasKey(e.values?w(A):A)}).concat(e.values?d:d.map(function(A){return w(A)}));break;case"delete":var O=new gt().addKeys(y.keys);p=m.filter(function(A){return!O.hasKey(e.values?w(A):A)});break;case"deleteRange":var L=y.range;p=m.filter(function(A){return!Yn(w(A),L)})}return p},t))===t)?t:(r.sort(function(m,y){return G(l(m),l(y))||G(w(m),w(y))}),e.limit&&e.limit<1/0&&(r.length>e.limit?r.length=e.limit:t.length===e.limit&&r.length<e.limit&&(a.dirty=!0)),i?Object.freeze(r):r)}function Wr(t,e){return G(t.lower,e.lower)===0&&G(t.upper,e.upper)===0&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function Wa(t,e){return((n,r,a,i)=>{if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((n=G(n,r))===0){if(a&&i)return 0;if(a)return 1;if(i)return-1}return n})(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&0<=((n,r,a,i)=>{if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((n=G(n,r))===0){if(a&&i)return 0;if(a)return-1;if(i)return 1}return n})(t.upper,e.upper,t.upperOpen,e.upperOpen)}function Va(t,e,n,r){t.subscribers.add(n),r.addEventListener("abort",function(){var a,i;t.subscribers.delete(n),t.subscribers.size===0&&(a=t,i=e,setTimeout(function(){a.subscribers.size===0&&Vt(i,a)},3e3))})}var za={stack:"dbcore",level:0,name:"Cache",create:function(t){var e=t.schema.name;return g(g({},t),{transaction:function(n,r,a){var i,o,s=t.transaction(n,r,a);return r==="readwrite"&&(a=(i=new AbortController).signal,s.addEventListener("abort",(o=function(f){return function(){if(i.abort(),r==="readwrite"){for(var w=new Set,h=0,l=n;h<l.length;h++){var m=l[h],y=Zt["idb://".concat(e,"/").concat(m)];if(y){var p=t.table(m),d=y.optimisticOps.filter(function(q){return q.trans===s});if(s._explicit&&f&&s.mutatedParts)for(var _=0,k=Object.values(y.queries.query);_<k.length;_++)for(var b=0,T=(C=k[_]).slice();b<T.length;b++)Nn((O=T[b]).obsSet,s.mutatedParts)&&(Vt(C,O),O.subscribers.forEach(function(q){return w.add(q)}));else if(0<d.length){y.optimisticOps=y.optimisticOps.filter(function(q){return q.trans!==s});for(var I=0,P=Object.values(y.queries.query);I<P.length;I++)for(var C,O,L,j=0,A=(C=P[I]).slice();j<A.length;j++)(O=A[j]).res!=null&&s.mutatedParts&&(f&&!O.dirty?(L=Object.isFrozen(O.res),L=Ur(O.res,O.req,d,p,O,L),O.dirty?(Vt(C,O),O.subscribers.forEach(function(q){return w.add(q)})):L!==O.res&&(O.res=L,O.promise=$.resolve({result:L}))):(O.dirty&&Vt(C,O),O.subscribers.forEach(function(q){return w.add(q)})))}}}w.forEach(function(q){return q()})}}})(!1),{signal:a}),s.addEventListener("error",o(!1),{signal:a}),s.addEventListener("complete",o(!0),{signal:a})),s},table:function(n){var r=t.table(n),a=r.schema.primaryKey;return g(g({},r),{mutate:function(i){var o,s=M.trans;return!a.outbound&&s.db._options.cache!=="disabled"&&!s.explicit&&s.idbtrans.mode==="readwrite"&&(o=Zt["idb://".concat(e,"/").concat(n)])?(s=r.mutate(i),i.type!=="add"&&i.type!=="put"||!(50<=i.values.length||Hn(a,i).some(function(f){return f==null}))?(o.optimisticOps.push(i),i.mutatedParts&&en(i.mutatedParts),s.then(function(f){0<f.numFailures&&(Vt(o.optimisticOps,i),(f=Fr(0,i,f))&&o.optimisticOps.push(f),i.mutatedParts)&&en(i.mutatedParts)}),s.catch(function(){Vt(o.optimisticOps,i),i.mutatedParts&&en(i.mutatedParts)})):s.then(function(f){var w=Fr(0,g(g({},i),{values:i.values.map(function(h,l){var m;return f.failures[l]?h:(ut(m=(m=a.keyPath)!=null&&m.includes(".")?Wt(h):g({},h),a.keyPath,f.results[l]),m)})}),f);o.optimisticOps.push(w),queueMicrotask(function(){return i.mutatedParts&&en(i.mutatedParts)})}),s):r.mutate(i)},query:function(i){var o,s,f,w,h,l,m;return Br(M,r)&&Nr("query",i)?(o=((f=M.trans)==null?void 0:f.db._options.cache)==="immutable",s=(f=M).requery,f=f.signal,l=((y,p,d,_)=>{var k=Zt["idb://".concat(y,"/").concat(p)];if(!k)return[];if(!(y=k.queries[d]))return[null,!1,k,null];var b=y[(_.query?_.query.index.name:null)||""];if(!b)return[null,!1,k,null];switch(d){case"query":var T=b.find(function(I){return I.req.limit===_.limit&&I.req.values===_.values&&Wr(I.req.query.range,_.query.range)});return T?[T,!0,k,b]:[b.find(function(I){return("limit"in I.req?I.req.limit:1/0)>=_.limit&&(!_.values||I.req.values)&&Wa(I.req.query.range,_.query.range)}),!1,k,b];case"count":return T=b.find(function(I){return Wr(I.req.query.range,_.query.range)}),[T,!!T,k,b]}})(e,n,"query",i),m=l[0],w=l[2],h=l[3],m&&l[1]?m.obsSet=i.obsSet:(l=r.query(i).then(function(y){var p=y.result;if(m&&(m.res=p),o){for(var d=0,_=p.length;d<_;++d)Object.freeze(p[d]);Object.freeze(p)}else y.result=Wt(p);return y}).catch(function(y){return h&&m&&Vt(h,m),Promise.reject(y)}),m={obsSet:i.obsSet,promise:l,subscribers:new Set,type:"query",req:i,dirty:!1},h?h.push(m):(h=[m],(w=w||(Zt["idb://".concat(e,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[i.query.index.name||""]=h)),Va(m,h,s,f),m.promise.then(function(y){return{result:Ur(y.result,i,w==null?void 0:w.optimisticOps,r,m,o)}})):r.query(i)}})}})}};function rn(t,e){return new Proxy(t,{get:function(n,r,a){return r==="db"?e:Reflect.get(n,r,a)}})}lt.prototype.version=function(t){if(isNaN(t)||t<.1)throw new N.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new N.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,n=e.filter(function(r){return r._cfg.version===t})[0];return n||(n=new this.Version(t),e.push(n),e.sort(ja),n.stores({}),this._state.autoSchema=!1),n},lt.prototype._whenReady=function(t){var e=this;return this.idbdb&&(this._state.openComplete||M.letThrough||this._vip)?t():new $(function(n,r){if(e._state.openComplete)return r(new N.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return void r(new N.DatabaseClosed);e.open().catch(Z)}e._state.dbReadyPromise.then(n,r)}).then(t)},lt.prototype.use=function(a){var e=a.stack,n=a.create,r=a.level,a=a.name,i=(a&&this.unuse({stack:e,name:a}),this._middlewares[e]||(this._middlewares[e]=[]));return i.push({stack:e,create:n,level:r??10,name:a}),i.sort(function(o,s){return o.level-s.level}),this},lt.prototype.unuse=function(t){var e=t.stack,n=t.name,r=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(a){return r?a.create!==r:!!n&&a.name!==n})),this},lt.prototype.open=function(){var t=this;return Qt(Lt,function(){return Ma(t)})},lt.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var t=this._state,e=ce.indexOf(this);if(0<=e&&ce.splice(e,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new $(function(n){t.dbReadyResolve=n}),t.openCanceller=new $(function(n,r){t.cancelOpen=r}))},lt.prototype.close=function(e){var e=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;e?(n.isBeingOpened&&n.cancelOpen(new N.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new N.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},lt.prototype.delete=function(t){var e=this,n=(t===void 0&&(t={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),r=this._state;return new $(function(a,i){function o(){e.close(t);var s=e._deps.indexedDB.deleteDatabase(e.name);s.onsuccess=rt(function(){var f,w,h;f=e._deps,w=e.name,Rn(h=f.indexedDB)||w===Fe||qn(h,f.IDBKeyRange).delete(w).catch(Z),a()}),s.onerror=Ot(i),s.onblocked=e._fireOnBlocked}if(n)throw new N.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},lt.prototype.backendDB=function(){return this.idbdb},lt.prototype.isOpen=function(){return this.idbdb!==null},lt.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},lt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},lt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(lt.prototype,"tables",{get:function(){var t=this;return S(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!1,configurable:!0}),lt.prototype.transaction=function(){var t=(function(e,n,r){var a=arguments.length;if(a<2)throw new N.InvalidArgument("Too few arguments");for(var i=new Array(a-1);--a;)i[a-1]=arguments[a];return r=i.pop(),[e,ur(i),r]}).apply(this,arguments);return this._transaction.apply(this,t)},lt.prototype._transaction=function(t,e,n){var r,a,i=this,o=M.trans,s=(o&&o.db===this&&t.indexOf("!")===-1||(o=null),t.indexOf("?")!==-1);t=t.replace("!","").replace("?","");try{if(a=e.map(function(w){if(w=w instanceof i.Table?w.name:w,typeof w!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return w}),t=="r"||t===Dn)r=Dn;else{if(t!="rw"&&t!=En)throw new N.InvalidArgument("Invalid transaction mode: "+t);r=En}if(o){if(o.mode===Dn&&r===En){if(!s)throw new N.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&a.forEach(function(w){if(o&&o.storeNames.indexOf(w)===-1){if(!s)throw new N.SubTransaction("Table "+w+" not included in parent transaction.");o=null}}),s&&o&&!o.active&&(o=null)}}catch(w){return o?o._promise(null,function(h,l){l(w)}):ct(w)}var f=(function w(h,l,m,y,p){return $.resolve().then(function(){var b=M.transless||M,d=h._createTransaction(l,m,h._dbSchema,y),b=(d.explicit=!0,{trans:d,transless:b});if(y)d.idbtrans=y.idbtrans;else try{d.create(),d.idbtrans._explicit=!0,h._state.PR1398_maxLoop=3}catch(T){return T.name===yn.InvalidState&&h.isOpen()&&0<--h._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),h.close({disableAutoOpen:!1}),h.open().then(function(){return w(h,l,m,null,p)})):ct(T)}var _,k=mn(p),b=(k&&ue(),$.follow(function(){var T;(_=p.call(d,d))&&(k?(T=Rt.bind(null,null),_.then(T,T)):typeof _.next=="function"&&typeof _.throw=="function"&&(_=Vn(_)))},b));return(_&&typeof _.then=="function"?$.resolve(_).then(function(T){return d.active?T:ct(new N.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):b.then(function(){return _})).then(function(T){return y&&d._resolve(),d._completion.then(function(){return T})}).catch(function(T){return d._reject(T),ct(T)})})}).bind(null,this,r,a,o,n);return o?o._promise(r,f,"lock"):M.trans?Qt(M.transless,function(){return i._whenReady(f)}):this._whenReady(f)},lt.prototype.table=function(t){if(B(this._allTables,t))return this._allTables[t];throw new N.InvalidTable("Table ".concat(t," does not exist"))};var $t=lt;function lt(t,e){var n,r,a,i,o,s=this,f=(this._middlewares={},this.verno=0,lt.dependencies),f=(this._options=e=g({addons:lt.addons,autoOpen:!0,indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange,cache:"cloned"},e),this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange},e.addons),w=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Z,dbReadyPromise:null,cancelOpen:Z,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:e.autoOpen}),h=(w.dbReadyPromise=new $(function(l){w.dbReadyResolve=l}),w.openCanceller=new $(function(l,m){w.cancelOpen=m}),this._state=w,this.name=t,this.on=Se(this,"populate","blocked","versionchange","close",{ready:[vn,Z]}),this.once=function(l,m){var y=function(){for(var p=[],d=0;d<arguments.length;d++)p[d]=arguments[d];s.on(l).unsubscribe(y),m.apply(s,p)};return s.on(l,y)},this.on.ready.subscribe=Ut(this.on.ready.subscribe,function(l){return function(m,y){lt.vip(function(){var p,d=s._state;d.openComplete?(d.dbOpenError||$.resolve().then(m),y&&l(m)):d.onReadyBeingFired?(d.onReadyBeingFired.push(m),y&&l(m)):(l(m),p=s,y||l(function _(){p.on.ready.unsubscribe(m),p.on.ready.unsubscribe(_)}))})}}),this.Collection=(n=this,Te(Ia.prototype,function(_,d){this.db=n;var y=br,p=null;if(d)try{y=d()}catch(b){p=b}var d=_._ctx,_=d.table,k=_.hook.reading.fire;this._ctx={table:_,index:d.index,isPrimKey:!d.index||_.schema.primKey.keyPath&&d.index===_.schema.primKey.name,range:y,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:p,or:d.or,valueMapper:k!==ge?k:null}})),this.Table=(r=this,Te(Tr.prototype,function(l,m,y){this.db=r,this._tx=y,this.name=l,this.schema=m,this.hook=r._allTables[l]?r._allTables[l].hook:Se(null,{creating:[ba,Z],reading:[ga,ge],updating:[_a,Z],deleting:[wa,Z]})})),this.Transaction=(a=this,Te(Pa.prototype,function(l,m,y,p,d){var _=this;l!=="readonly"&&m.forEach(function(k){k=(k=y[k])==null?void 0:k.yProps,k&&(m=m.concat(k.map(function(b){return b.updatesTable})))}),this.db=a,this.mode=l,this.storeNames=m,this.schema=y,this.chromeTransactionDurability=p,this.idbtrans=null,this.on=Se(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $(function(k,b){_._resolve=k,_._reject=b}),this._completion.then(function(){_.active=!1,_.on.complete.fire()},function(k){var b=_.active;return _.active=!1,_.on.error.fire(k),_.parent?_.parent._reject(k):b&&_.idbtrans&&_.idbtrans.abort(),ct(k)})})),this.Version=(i=this,Te(Ra.prototype,function(l){this.db=i,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(o=this,Te(Ar.prototype,function(l,m,y){if(this.db=o,this._ctx={table:l,index:m===":id"?null:m,or:y},this._cmp=this._ascending=G,this._descending=function(p,d){return G(d,p)},this._max=function(p,d){return 0<G(p,d)?p:d},this._min=function(p,d){return G(p,d)<0?p:d},this._IDBKeyRange=o._deps.IDBKeyRange,!this._IDBKeyRange)throw new N.MissingAPI})),this.on("versionchange",function(l){0<l.newVersion?console.warn("Another connection wants to upgrade database '".concat(s.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(s.name,"'. Closing db now to resume the delete request.")),s.close({disableAutoOpen:!1})}),this.on("blocked",function(l){!l.newVersion||l.newVersion<l.oldVersion?console.warn("Dexie.delete('".concat(s.name,"') was blocked")):console.warn("Upgrade '".concat(s.name,"' blocked by other connection holding version ").concat(l.oldVersion/10))}),this._maxKey=Ie(e.IDBKeyRange),this._createTransaction=function(l,m,y,p){return new s.Transaction(l,m,y,s._options.chromeTransactionDurability,p)},this._fireOnBlocked=function(l){s.on("blocked").fire(l),ce.filter(function(m){return m.name===s.name&&m!==s&&!m._state.vcFired}).map(function(m){return m.on("versionchange").fire(l)})},this.use(Fa),this.use(za),this.use(Ua),this.use(Ba),this.use(Na),new Proxy(this,{get:function(l,m,y){var p;return m==="_vip"||(m==="table"?function(d){return rn(s.table(d),h)}:(p=Reflect.get(l,m,y))instanceof Tr?rn(p,h):m==="tables"?p.map(function(d){return rn(d,h)}):m==="_createTransaction"?function(){return rn(p.apply(this,arguments),h)}:p)}}));this.vip=h,f.forEach(function(l){return l(s)})}var an,he=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ha=(Gn.prototype.subscribe=function(t,e,n){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:e,complete:n})},Gn.prototype[he]=function(){return this},Gn);function Gn(t){this._subscribe=t}try{an={indexedDB:D.indexedDB||D.mozIndexedDB||D.webkitIndexedDB||D.msIndexedDB,IDBKeyRange:D.IDBKeyRange||D.webkitIDBKeyRange}}catch{an={indexedDB:null,IDBKeyRange:null}}function Vr(t){var e,n=!1,r=new Ha(function(a){var i=mn(t),o,s=!1,f={},w={},h={get closed(){return s},unsubscribe:function(){s||(s=!0,o&&o.abort(),l&&Nt.storagemutated.unsubscribe(y))}},l=(a.start&&a.start(h),!1),m=function(){return Tn(p)},y=function(d){tn(f,d),Nn(w,f)&&m()},p=function(){var d,_,k;!s&&an.indexedDB&&(f={},d={},o&&o.abort(),o=new AbortController,k=(b=>{var T=oe();try{i&&ue();var I=qt(t,b);return I=i?I.finally(Rt):I}finally{T&&se()}})(_={subscr:d,signal:o.signal,requery:m,querier:t,trans:null}),Promise.resolve(k).then(function(b){n=!0,e=b,s||_.signal.aborted||(f={},(T=>{for(var I in T)if(B(T,I))return;return 1})(w=d)||l||(Nt(Ee,y),l=!0),Tn(function(){return!s&&a.next&&a.next(b)}))},function(b){n=!1,["DatabaseClosedError","AbortError"].includes(b==null?void 0:b.name)||s||Tn(function(){s||a.error&&a.error(b)})}))};return setTimeout(m,0),h});return r.hasValue=function(){return n},r.getValue=function(){return e},r}var te=$t;function Qn(t){var e=Ft;try{Ft=!0,Nt.storagemutated.fire(t),Wn(t,!0)}finally{Ft=e}}tt(te,g(g({},Ct),{delete:function(t){return new te(t,{addons:[]}).delete()},exists:function(t){return new te(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return e=te.dependencies,n=e.indexedDB,e=e.IDBKeyRange,(Rn(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(a){return a.name}).filter(function(a){return a!==Fe})}):qn(n,e).toCollection().primaryKeys()).then(t)}catch{return ct(new N.MissingAPI)}var e,n},defineClass:function(){return function(t){K(this,t)}},ignoreTransaction:function(t){return M.trans?Qt(M.transless,t):t()},vip:Mn,async:function(t){return function(){try{var e=Vn(t.apply(this,arguments));return e&&typeof e.then=="function"?e:$.resolve(e)}catch(n){return ct(n)}}},spawn:function(t,e,n){try{var r=Vn(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:$.resolve(r)}catch(a){return ct(a)}},currentTransaction:{get:function(){return M.trans||null}},waitFor:function(t,e){return t=$.resolve(typeof t=="function"?te.ignoreTransaction(t):t).timeout(e||6e4),M.trans?M.trans.waitFor(t):t},Promise:$,debug:{get:function(){return It},set:function(t){fr(t)}},derive:ot,extend:K,props:tt,override:Ut,Events:Se,on:Nt,liveQuery:Vr,extendObservabilitySet:tn,getByKeyPath:bt,setByKeyPath:ut,delByKeyPath:function(t,e){typeof e=="string"?ut(t,e,void 0):"length"in e&&[].map.call(e,function(n){ut(t,n,void 0)})},shallowClone:ft,deepClone:Wt,getObjectDiff:zn,cmp:G,asap:mt,minKey:-1/0,addons:[],connections:ce,errnames:yn,dependencies:an,cache:Zt,semVer:"4.3.0",version:"4.3.0".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,2*n)})})),te.maxKey=Ie(te.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Nt(Ee,function(t){Ft||(t=new CustomEvent(An,{detail:t}),Ft=!0,dispatchEvent(t),Ft=!1)}),addEventListener(An,function(t){t=t.detail,Ft||Qn(t)}));var pe,Ft=!1,zr=function(){};return typeof BroadcastChannel<"u"&&((zr=function(){(pe=new BroadcastChannel(An)).onmessage=function(t){return t.data&&Qn(t.data)}})(),typeof pe.unref=="function"&&pe.unref(),Nt(Ee,function(t){Ft||pe.postMessage(t)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(t){if(!$t.disableBfCache&&t.persisted){It&&console.debug("Dexie: handling persisted pagehide"),pe!=null&&pe.close();for(var e=0,n=ce;e<n.length;e++)n[e].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(t){!$t.disableBfCache&&t.persisted&&(It&&console.debug("Dexie: handling persisted pageshow"),zr(),Qn({all:new gt(-1/0,[[]])}))})),$.rejectionMapper=function(t,e){return!t||t instanceof ae||t instanceof TypeError||t instanceof SyntaxError||!t.name||!dr[t.name]?t:(e=new dr[t.name](e||t.message,t),"stack"in t&&V(e,"stack",{get:function(){return this.inner.stack}}),e)},fr(It),g($t,Object.freeze({__proto__:null,Dexie:$t,Entity:wr,PropModification:xe,RangeSet:gt,add:function(t){return new xe({add:t})},cmp:G,default:$t,liveQuery:Vr,mergeRanges:Pe,rangesOverlap:jr,remove:function(t){return new xe({remove:t})},replacePrefix:function(t,e){return new xe({replacePrefix:[t,e]})}}),{default:$t}),$t})})(aa);var Za=aa.exports;const tr=Ja(Za),Gr=Symbol.for("Dexie"),ln=globalThis[Gr]||(globalThis[Gr]=tr);if(tr.semVer!==ln.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${tr.semVer} and ${ln.semVer}`);const{liveQuery:Ii,mergeRanges:Oi,rangesOverlap:Ai,RangeSet:Pi,cmp:Ci,Entity:Ki,PropModification:$i,replacePrefix:ji,add:Li,remove:qi,DexieYProvider:Ri}=ln;class ti extends ln{constructor(){super("GymDatabase");jt(this,"workouts");jt(this,"logs");jt(this,"workoutTypes");jt(this,"profile");this.version(1).stores({workouts:"id, status, startTime, updatedAt, isDeleted",logs:"id, workoutId, workoutTypeId, date, updatedAt, isDeleted",workoutTypes:"id, updatedAt, isDeleted",profile:"id, updatedAt, isDeleted"})}}const Y=new ti,rr="gym_web_auth";function fn(){const v=localStorage.getItem(rr);try{return v?JSON.parse(v):null}catch{return null}}function ar(v){localStorage.setItem(rr,JSON.stringify(v))}function ia(){localStorage.removeItem(rr)}function oa(){const v=fn();if(!v)return null;const u=new URLSearchParams;return Object.entries(v).forEach(([c,g])=>{g!=null&&u.append(c,String(g))}),u.toString()}const ei=Object.freeze(Object.defineProperty({__proto__:null,clearAuthData:ia,getAuthData:fn,getAuthString:oa,saveAuthData:ar},Symbol.toStringTag,{value:"Module"}));var ta;const on=(ta=window.Telegram)==null?void 0:ta.WebApp,Qr="https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4";class Xr{static getHeaders(){const u={"Content-Type":"application/json"};if(on!=null&&on.initData)localStorage.getItem("skip_tma_auth")==="true"||(u["X-Telegram-Init-Data"]=on.initData);else{const c=oa();c&&(u["X-Telegram-Init-Data"]=c)}return u}static async sync(){if(!navigator.onLine)throw new Error("Offline");const u=this.getHeaders(),c=await fetch(Qr,{headers:u});if(!c.ok)throw c.status===401?new Error("Unauthorized"):new Error("Sync failed");const g=await c.json();await this.mergeData(g);const x=await this.readAll();await fetch(Qr,{method:"POST",headers:u,body:JSON.stringify(x)})}static async mergeData(u){await Y.transaction("rw",Y.workouts,Y.logs,Y.workoutTypes,Y.profile,async()=>{if(await this.mergeTable(Y.workouts,u.workouts),await this.mergeTable(Y.logs,u.logs),await this.mergeTable(Y.workoutTypes,u.workoutTypes),u.profile){const c={...u.profile,id:"me"};await this.mergeTable(Y.profile,[c])}})}static async mergeTable(u,c=[]){const g=await u.toArray(),x=new Map(g.map(D=>[D.id,D]));for(const D of c){const S=x.get(D.id);if(!S)await u.put(D);else{const E=new Date(D.updatedAt).getTime(),K=new Date(S.updatedAt).getTime();E>K&&await u.put(D)}}}static async readAll(){return{workouts:await Y.workouts.toArray(),logs:await Y.logs.toArray(),workoutTypes:await Y.workoutTypes.toArray(),profile:(await Y.profile.toArray())[0]}}}const ni="gym_twa_data";var ea;const me=(ea=window.Telegram)==null?void 0:ea.WebApp,Jn={workoutTypes:[{id:"1",name:"ÐÐ¸Ð¼ Ð»ÐµÐ¶Ð°",updatedAt:new Date().toISOString()},{id:"2",name:"ÐÑÐ¸ÑÐµÐ´Ð°Ð½Ð¸Ñ",updatedAt:new Date().toISOString()},{id:"3",name:"Ð¡ÑÐ°Ð½Ð¾Ð²Ð°Ñ ÑÑÐ³Ð°",updatedAt:new Date().toISOString()}],logs:[],workouts:[]};class ri{constructor(){jt(this,"onUpdateCallback");jt(this,"onSyncStatusChangeCallback");jt(this,"status","idle");jt(this,"cache",{...Jn});this.init()}async init(){await this.migrateFromLocalStorage(),this.sync().catch(console.error)}async migrateFromLocalStorage(){const u=localStorage.getItem(ni);if(u)try{const c=JSON.parse(u);if(await Y.workoutTypes.count()===0){console.log("Migrating from localStorage to IDB...");const x=new Date().toISOString(),D=(c.workoutTypes||Jn.workoutTypes).map(K=>({...K,updatedAt:x}));await Y.workoutTypes.bulkPut(D);const S=(c.logs||[]).map(K=>({...K,updatedAt:x,workoutId:K.workoutId||"legacy"}));await Y.logs.bulkPut(S);const E=(c.workouts||[]).map(K=>({...K,updatedAt:x}));if(await Y.workouts.bulkPut(E),c.profile){const K={...c.profile,id:"me",updatedAt:x};await Y.profile.put(K)}}}catch(c){console.error("Migration failed",c)}else await Y.workoutTypes.count()===0&&await Y.workoutTypes.bulkPut(Jn.workoutTypes)}onUpdate(u){this.onUpdateCallback=u}onSyncStatusChange(u){this.onSyncStatusChangeCallback=u}setStatus(u){var c;this.status=u,(c=this.onSyncStatusChangeCallback)==null||c.call(this,u),u==="success"&&setTimeout(()=>{this.status==="success"&&this.setStatus("idle")},2e3)}async sync(){var c;const u=localStorage.getItem("skip_tma_auth")==="true";if(u&&!(await ra(async()=>{const{getAuthString:x}=await Promise.resolve().then(()=>ei);return{getAuthString:x}},void 0,import.meta.url)).getAuthString()){this.setStatus("idle");return}try{this.setStatus("saving"),await Xr.sync(),this.setStatus("success"),(c=this.onUpdateCallback)==null||c.call(this)}catch(g){if(console.error("Sync failed",g),(g instanceof Error?g.message:String(g)).toLowerCase().includes("unauthorized")){if(u){this.setStatus("error");return}localStorage.setItem("skip_tma_auth","true"),ia(),location.reload();return}g instanceof Error&&g.message==="Offline"?this.setStatus("idle"):this.setStatus("error")}}async reloadCache(){var u;this.cache=await Xr.readAll(),(u=this.onUpdateCallback)==null||u.call(this)}getWorkoutTypes(){return this.cache.workoutTypes.filter(u=>!u.isDeleted)}getLogs(){return this.cache.logs.filter(u=>!u.isDeleted)}getWorkouts(){return this.cache.workouts.filter(u=>!u.isDeleted)}getActiveWorkout(){return this.cache.workouts.find(u=>!u.isDeleted&&(u.status==="active"||u.status==="paused"))}getProfile(){return this.cache.profile}async addWorkoutType(u){const c={id:Date.now().toString(),name:u,updatedAt:new Date().toISOString()};return await Y.workoutTypes.put(c),await this.reloadCache(),this.sync().catch(()=>{}),c}async deleteWorkoutType(u){const c=await Y.workoutTypes.get(u);c&&(c.isDeleted=!0,c.updatedAt=new Date().toISOString(),await Y.workoutTypes.put(c),await this.reloadCache(),this.sync().catch(()=>{}))}async updateWorkoutType(u,c){const g=await Y.workoutTypes.get(u);g&&(g.name=c,g.updatedAt=new Date().toISOString(),await Y.workoutTypes.put(g),await this.reloadCache(),this.sync().catch(()=>{}))}async startWorkout(u){this.getActiveWorkout()&&await this.finishWorkout();const g={id:Date.now().toString(),startTime:new Date().toISOString(),status:"active",name:u,isManual:!0,pauseIntervals:[],updatedAt:new Date().toISOString()};return await Y.workouts.put(g),await this.reloadCache(),this.sync().catch(()=>{}),g}async pauseWorkout(){const u=this.getActiveWorkout();u&&u.status==="active"&&(u.status="paused",u.pauseIntervals.push({start:new Date().toISOString()}),u.updatedAt=new Date().toISOString(),await Y.workouts.put(u),await this.reloadCache(),this.sync().catch(()=>{}))}async resumeWorkout(){const u=this.getActiveWorkout();if(u&&u.status==="paused"){u.status="active";const c=u.pauseIntervals[u.pauseIntervals.length-1];c&&!c.end&&(c.end=new Date().toISOString()),u.updatedAt=new Date().toISOString(),await Y.workouts.put(u),await this.reloadCache(),this.sync().catch(()=>{})}}async finishWorkout(){const u=this.getActiveWorkout();if(u){u.status="finished",u.endTime=new Date().toISOString();const c=u.pauseIntervals[u.pauseIntervals.length-1];c&&!c.end&&(c.end=u.endTime),u.updatedAt=new Date().toISOString(),await Y.workouts.put(u),await this.reloadCache(),this.sync().catch(()=>{})}}getWorkoutDuration(u){const c=new Date(u.startTime).getTime(),g=u.endTime?new Date(u.endTime).getTime():Date.now();let x=g-c;return u.pauseIntervals.forEach(S=>{const E=new Date(S.start).getTime(),K=S.end?new Date(S.end).getTime():u.status==="paused"?Date.now():g;K>E&&(x-=K-E)}),Math.floor(Math.max(0,x)/6e4)}async ensureActiveWorkout(){const u=this.getActiveWorkout();if(u)return u.id;const c=new Date().toISOString().split("T")[0],D=this.getWorkouts().filter(K=>K.startTime.startsWith(c)).sort((K,R)=>new Date(R.startTime).getTime()-new Date(K.startTime).getTime())[0];if(D&&!D.isManual&&D.status==="finished")return D.endTime=new Date().toISOString(),D.updatedAt=new Date().toISOString(),await Y.workouts.put(D),await this.reloadCache(),this.sync().catch(()=>{}),D.id;const S=`implicit_${c}_${Date.now()}`,E={id:S,startTime:new Date().toISOString(),endTime:new Date().toISOString(),status:"finished",isManual:!1,pauseIntervals:[],updatedAt:new Date().toISOString()};return await Y.workouts.put(E),await this.reloadCache(),this.sync().catch(()=>{}),S}async updateImplicitWorkoutBounds(u){const c=await Y.workouts.get(u);if(!c||c.isManual)return;const x=(await Y.logs.where("workoutId").equals(u).toArray()).filter(S=>!S.isDeleted);if(x.length===0)return;const D=x.sort((S,E)=>new Date(S.date).getTime()-new Date(E.date).getTime());c.startTime=D[0].date,c.endTime=D[D.length-1].date,c.status="finished",c.updatedAt=new Date().toISOString(),await Y.workouts.put(c)}async addLog(u){const c=await this.ensureActiveWorkout(),g={...u,id:Date.now().toString(),date:new Date().toISOString(),workoutId:c,updatedAt:new Date().toISOString()};return await Y.logs.put(g),await this.updateImplicitWorkoutBounds(c),await this.reloadCache(),this.sync().catch(()=>{}),g}async deleteLog(u){const c=await Y.logs.get(u);if(c){const g=c.workoutId;c.isDeleted=!0,c.updatedAt=new Date().toISOString(),await Y.logs.put(c),g&&await this.updateImplicitWorkoutBounds(g),await this.reloadCache(),this.sync().catch(()=>{})}}async updateLog(u){const c={...u,updatedAt:new Date().toISOString()};await Y.logs.put(c),await this.reloadCache(),this.sync().catch(()=>{})}getProfileIdentifier(){var g,x;const u=this.cache.profile;if(u!=null&&u.telegramUsername)return u.telegramUsername;if(u!=null&&u.telegramUserId)return`id_${u.telegramUserId}`;const c=(x=(g=me==null?void 0:me.initDataUnsafe)==null?void 0:g.user)==null?void 0:x.id;return c?`id_${c}`:""}async updateProfileSettings(u){var S;const c=(S=me==null?void 0:me.initDataUnsafe)==null?void 0:S.user,g=c==null?void 0:c.id;let x=this.cache.profile;x?c!=null&&c.photo_url&&(x.photoUrl=c.photo_url):x={id:"me",isPublic:!1,showFullHistory:!1,telegramUserId:g||0,telegramUsername:c==null?void 0:c.username,photoUrl:c==null?void 0:c.photo_url,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};const D={...x,...u,updatedAt:new Date().toISOString()};await Y.profile.put(D),await this.reloadCache(),this.sync().catch(()=>{})}async getPublicProfile(u){try{const g=await fetch(`https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4?profile=${encodeURIComponent(u)}`);return g.ok?await g.json():null}catch{return null}}}const W=new ri;W.reloadCache().then(()=>{});function ai(v,u){return u===1?v:Math.round(v*(1+u/30))}function ii(v,u){const c=new Map;return v.filter(x=>x.workoutTypeId===u).forEach(x=>{const D=x.date.split("T")[0],S=ai(x.weight,x.reps),E=c.get(D)||0;S>E&&c.set(D,S)}),c}function oi(v,u){const c=new Set;return v.forEach(g=>c.add(g.startTime.split("T")[0])),u.forEach(g=>c.add(g.date.split("T")[0])),c}function si(v){const u=v.filter(D=>D.endTime&&D.status==="finished");if(u.length===0)return{averageMinutes:0,totalMinutes:0,count:0};let c=0;u.forEach(D=>{const S=new Date(D.startTime).getTime(),E=new Date(D.endTime).getTime();let K=E-S;D.pauseIntervals&&D.pauseIntervals.forEach(R=>{const z=new Date(R.start).getTime(),B=R.end?new Date(R.end).getTime():E;K-=B-z}),c+=K});const g=Math.round(c/1e3/60);return{averageMinutes:Math.round(g/u.length),totalMinutes:g,count:u.length}}function ui(v,u=6){const c=new Date,g=new Date(c);g.setMonth(c.getMonth()-u),g.setDate(g.getDate()-g.getDay());let x='<div class="heatmap-container"><div class="heatmap-grid">';const D=new Date(g),S=new Date(c);for(;D<=S;){const E=D.toISOString().split("T")[0],K=v.has(E),z=`heatmap-cell level-${K?4:0}`,B=`${E}: ${K?"Workout":"No workout"}`;x+=`<div class="${z}" title="${B}"></div>`,D.setDate(D.getDate()+1)}return x+="</div>",x+=`
        <div class="heatmap-legend">
            Less <div class="heatmap-cell level-0"></div>
            <div class="heatmap-cell level-4"></div> More
        </div>
    `,x+="</div>",x}function Jr(v){const u=new Map;v.forEach(x=>{const D=x.date.split("T")[0],S=x.weight*x.reps;u.set(D,(u.get(D)||0)+S)});const c=Array.from(u.keys()).sort().slice(-10);if(c.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¾Ð±ÑÐµÐ¼Ð°</p>';const g=c.map(x=>({label:new Date(x).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:u.get(x)}));return di(g,"ÐºÐ³")}function ci(v){const u=Array.from(v.keys()).sort();if(u.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° 1RM</p>';const c=u.map(g=>({label:new Date(g).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:v.get(g)}));return sa(c,"ÐºÐ³")}function li(v){const u=v.filter(g=>g.status==="finished"&&g.endTime).sort((g,x)=>new Date(g.startTime).getTime()-new Date(x.startTime).getTime()).slice(-10);if(u.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÐ¸</p>';const c=u.map(g=>{const x=new Date(g.startTime).getTime(),D=new Date(g.endTime).getTime();let S=(D-x)/1e3/60;return g.pauseIntervals&&g.pauseIntervals.forEach(E=>{const K=new Date(E.start).getTime(),R=E.end?new Date(E.end).getTime():D;S-=(R-K)/1e3/60}),{label:new Date(g.startTime).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:Math.round(S)}});return sa(c,"Ð¼Ð¸Ð½")}function di(v,u){const x=Math.max(...v.map(S=>S.value))*1.1;return`
        <svg width="100%" height="150" preserveAspectRatio="none">
            ${v.map((S,E)=>{const K=S.value/x*100,R=E/v.length*100,z=1/v.length*80;return`
            <rect x="${R+5}%" y="${100-K}%" width="${z}%" height="${K}%" fill="var(--color-button)" rx="2" opacity="0.8">
               <title>${S.label}: ${S.value}${u}</title>
            </rect>
            <text x="${R+5+z/2}%" y="95%" font-size="10" text-anchor="middle" fill="var(--color-text)" style="pointer-events: none;">
                ${S.label}
            </text>
        `}).join("")}
        </svg>
    `}function sa(v,u){const D=v.map(U=>U.value),S=Math.min(...D),E=Math.max(...D),K=E-S||1,R=U=>20+U/(v.length-1)*(400-2*20),z=U=>130-(U-S)/K*(150-2*20),B=v.map((U,V)=>`${R(V)},${z(U.value)}`).join(" "),tt=v.map((U,V)=>`
        <circle cx="${R(V)}" cy="${z(U.value)}" r="4" fill="var(--color-bg)" stroke="var(--color-button)" stroke-width="2">
            <title>${U.label}: ${U.value}${u}</title>
        </circle>
    `).join("");return`
        <svg viewBox="0 0 400 150" class="chart">
             <polyline
                fill="none"
                stroke="var(--color-button)"
                stroke-width="3"
                stroke-linejoin="round"
                stroke-linecap="round"
                points="${B}"
            />
            ${tt}
        </svg>
        <div style="display: flex; justify-content: space-between; margin-top: 4px; font-size: 12px; color: var(--color-hint);">
            <span>${Math.round(S)}${u}</span>
            <span>${Math.round(E)}${u}</span>
        </div>
    `}function fi(v,u){v.innerHTML=`
        <div class="page-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 24px;">ðï¸</div>
            <h1 class="title" style="margin-bottom: 12px;">ÐÐ¸Ð¼-Ð¶Ð¸Ð¼ 21</h1>
            <p class="subtitle" style="margin-bottom: 32px; opacity: 0.7;">ÐÐ¾Ð¹Ð´Ð¸ÑÐµ ÑÐµÑÐµÐ· Telegram, ÑÑÐ¾Ð±Ñ ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</p>
            <div id="telegram-login-container"></div>
        </div>
    `,window.onTelegramAuth=x=>{console.log("Telegram auth callback received:",x),ar(x),localStorage.removeItem("skip_tma_auth"),u()};const c=document.createElement("script");c.src="https://telegram.org/js/telegram-widget.js?22",c.async=!0,c.setAttribute("data-telegram-login","gymgym21bot"),c.setAttribute("data-size","large"),c.setAttribute("data-radius","12"),c.setAttribute("data-onauth","onTelegramAuth(user)"),c.setAttribute("data-request-access","write");const g=document.getElementById("telegram-login-container");g&&g.appendChild(c)}function hi(v={}){const{immediate:u=!1,onNeedRefresh:c,onOfflineReady:g,onRegistered:x,onRegisteredSW:D,onRegisterError:S}=v;let E,K;const R=async(B=!0)=>{await K};async function z(){if("serviceWorker"in navigator){if(E=await ra(async()=>{const{Workbox:B}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:B}},[],import.meta.url).then(({Workbox:B})=>new B("./sw.js",{scope:"./",type:"classic"})).catch(B=>{S==null||S(B)}),!E)return;E.addEventListener("activated",B=>{(B.isUpdate||B.isExternal)&&window.location.reload()}),E.addEventListener("installed",B=>{B.isUpdate||g==null||g()}),E.register({immediate:u}).then(B=>{D?D("./sw.js",B):x==null||x(B)}).catch(B=>{S==null||S(B)})}}return K=z(),R}hi({immediate:!0});var na;const it=(na=window.Telegram)==null?void 0:na.WebApp;it&&(it.ready(),it.expand());let Et="main",ye="all",dt=null,ua=null,dn=null,er=!1,Ce=null,Dt=null,un="overview",ir=!1,cn=!1;function pi(v){Et=v,nt()}let Zn=null;function Zr(v){let u=document.querySelector(".toast");u||(u=document.createElement("div"),u.className="toast",document.body.appendChild(u)),u.textContent=v,u.classList.add("visible"),Zn&&clearTimeout(Zn),Zn=setTimeout(()=>{u==null||u.classList.remove("visible")},2e3)}function nt(){const v=document.getElementById("app");if(!v)return;const u=localStorage.getItem("skip_tma_auth")==="true",c=!!(it!=null&&it.initData)&&!u,x=!!fn();!c&&!x||(v.innerHTML=`
    <main class="content">
      ${mi()}
    </main>
    <nav class="navigation">
      <button class="navigation__item ${Et==="main"?"navigation__item_active":""}" data-page="main">
        <span class="navigation__icon">ðï¸</span>
        <span class="navigation__label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Et==="stats"?"navigation__item_active":""}" data-page="stats">
        <span class="navigation__icon">ð</span>
        <span class="navigation__label">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Et==="profile-settings"?"navigation__item_active":""}" data-page="profile-settings">
        <span class="navigation__icon">ð¤</span>
        <span class="navigation__label">ÐÑÐ¾ÑÐ¸Ð»Ñ</span>
      </button>
      <button class="navigation__item ${Et==="settings"?"navigation__item_active":""}" data-page="settings">
        <span class="navigation__icon">âï¸</span>
        <span class="navigation__label">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</span>
      </button>
    </nav>
    <div id="sync-status" class="sync-status"></div>
  `,v.querySelectorAll(".navigation__item").forEach(D=>{D.addEventListener("click",()=>{const S=D.getAttribute("data-page");pi(S)})}),Si())}let ca="idle";W.onSyncStatusChange(v=>{ca=v,or()});function or(){const v=document.getElementById("sync-status");if(!v)return;v.className="sync-status";let u="",c="";switch(ca){case"saving":u="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...",c="ð",v.classList.add("sync-status_saving");break;case"success":u="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾",c="â",v.classList.add("sync-status_success");break;case"error":u="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸",c="â ï¸",v.classList.add("sync-status_error");break;case"idle":if(!navigator.onLine)u="ÐÑÑÐ»Ð°Ð¹Ð½",c="ð¡",v.classList.add("sync-status_offline");else return;break}v.innerHTML=`${c} ${u}`}window.addEventListener("online",()=>{W.sync(),or()});window.addEventListener("offline",()=>or());function mi(){switch(Et){case"main":return vi();case"stats":return ki();case"settings":return bi();case"profile-settings":return wi();case"public-profile":return _i();default:return""}}function yi(){const v=W.getActiveWorkout();if(v){const u=v.status==="paused";return`
      <div class="workout-controls card">
        <div class="workout-controls__header">
          <span class="workout-status ${u?"workout-status_paused":""}">
            ${u?"â¸ï¸ ÐÐ°ÑÐ·Ð°":"ð¥ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° Ð°ÐºÑÐ¸Ð²Ð½Ð°"}
          </span>
          ${v.name?`<span class="workout-name">${v.name}</span>`:""}
        </div>
        <div class="workout-controls__actions">
          ${u?'<button class="button" id="resume-workout-btn">ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ</button>':'<button class="button button_secondary" id="pause-workout-btn">ÐÐ°ÑÐ·Ð°</button>'}
          <button class="button button_destructive" id="finish-workout-btn">ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ</button>
        </div>
      </div>
    `}return cn?`
      <div class="workout-controls card">
        <h3 class="subtitle" style="margin-top: 0">ÐÐ°ÑÐ°Ð»Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</h3>
        <form id="start-workout-form" style="display: flex; flex-direction: column; gap: 12px;">
          <input class="input" type="text" name="workoutName" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð¾Ð¿ÑÐ¸Ð¾Ð½Ð°Ð»ÑÐ½Ð¾)">
          <div style="display: flex; gap: 8px;">
            <button class="button" type="submit">ÐÐ°ÑÐ°ÑÑ</button>
            <button class="button button_secondary" type="button" id="cancel-start-workout-btn">ÐÑÐ¼ÐµÐ½Ð°</button>
          </div>
        </form>
      </div>
    `:`
    <button class="button" id="start-workout-btn" style="margin-bottom: 24px;">â¶ï¸ ÐÐ°ÑÐ°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ</button>
  `}let wt=0,nr="";function sr(v){const u=new Date;u.setHours(0,0,0,0);const c=new Date(u);c.setDate(u.getDate()-v*7),c.setHours(23,59,59,999);const g=new Date(c);return g.setDate(c.getDate()-6),g.setHours(0,0,0,0),{start:g,end:c,label:`${g.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})} - ${c.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}`}}function vi(){var S;const v=W.getWorkoutTypes(),u=W.getLogs(),c=u[u.length-1],g=c==null?void 0:c.workoutTypeId,x=dt?u.find(E=>E.id===dt):null,{label:D}=sr(wt);return`
    <div class="page-content" id="main-content">
      ${yi()}
      <h1 class="title">${dt?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´ÑÐ¾Ð´Ð°":"ÐÐ¾Ð²ÑÐ¹ Ð¿Ð¾Ð´ÑÐ¾Ð´"}</h1>
      <form class="workout-form" id="log-form">
        <div class="form-group">
          <label class="label">Ð¢Ð¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</label>
          <select class="select" name="typeId" required>
            ${v.map(E=>`<option value="${E.id}" ${(dt?x&&E.id===x.workoutTypeId:E.id===g)?"selected":""}>${E.name}</option>`).join("")}
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="label">ÐÐµÑ (ÐºÐ³)</label>
            <input class="input" type="number" name="weight" step="0.5" required placeholder="0" value="${dt&&x?x.weight:""}">
          </div>
          <div class="form-group">
            <label class="label">ÐÐ¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</label>
            <input class="input" type="number" name="reps" required placeholder="0" value="${dt&&x?x.reps:""}">
          </div>
        </div>
        <button class="button" type="submit">${dt?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ":"ÐÐ°ÑÐ¸ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ"}</button>
        ${dt?'<button class="button button_secondary" type="button" id="cancel-edit-btn" style="margin-top: 12px;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        ${!dt&&c?`<button class="button button_secondary" type="button" id="duplicate-last-btn" style="margin-top: 12px;">ÐÐ¾Ð²ÑÐ¾ÑÐ¸ÑÑ: ${(S=v.find(E=>E.id===c.workoutTypeId))==null?void 0:S.name} ${c.weight}ÐºÐ³ Ã ${c.reps}</button>`:""}
      </form>
      <div class="recent-logs">
        <div class="recent-logs__header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
           <button class="icon-btn" id="prev-week-btn">âï¸</button>
           <div id="week-label-container" style="display: flex; align-items: center; gap: 8px; position: relative;">
             <span style="font-size: 18px; position: relative; display: inline-block;">
               ð
               <input type="date" id="calendar-input" value="${nr}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
             </span>
             <h2 class="subtitle" style="margin: 0;">${wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":D}</h2>
             <label class="filter-toggle" title="Ð¤Ð¸Ð»ÑÑÑ Ð¿Ð¾ ÑÐ¸Ð¿Ñ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ">
               <input type="checkbox" id="filter-toggle-input" ${ir?"checked":""}>
               <span class="filter-toggle__icon">ð</span>
             </label>
           </div>
           <button class="icon-btn" id="next-week-btn" ${wt===0?"disabled":""} style="${wt===0?"opacity: 0.3; cursor: default;":""}">â¶ï¸</button>
        </div>
        <div id="logs-list">
          ${la()}
        </div>
      </div>
    </div>
  `}function la(){var D;const v=W.getLogs(),u=W.getWorkoutTypes(),{start:c,end:g}=sr(wt);let x=v.filter(S=>{const E=new Date(S.date);return E>=c&&E<=g});if(ir){const S=(D=document.querySelector('select[name="typeId"]'))==null?void 0:D.value;S&&(x=x.filter(E=>E.workoutTypeId===S))}return da(x,u,!0)}function sn(){const v=document.getElementById("logs-list"),u=document.querySelector("#week-label-container .subtitle");if(v&&(v.innerHTML=la(),gi()),u){const{label:g}=sr(wt);u.textContent=wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":g}const c=document.getElementById("next-week-btn");c&&(c.disabled=wt===0,c.style.opacity=wt===0?"0.3":"",c.style.cursor=wt===0?"default":"")}function gi(){document.querySelectorAll(".log-set__delete").forEach(v=>{v.addEventListener("click",async()=>{const u=v.getAttribute("data-id");u&&(dt===u&&(dt=null),await W.deleteLog(u),nt())})}),document.querySelectorAll(".log-set__edit").forEach(v=>{v.addEventListener("click",()=>{dt=v.getAttribute("data-id"),nt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(v=>{v.addEventListener("click",()=>{const u=v.getAttribute("data-date");u&&fa(u)})})}function da(v,u,c){if(v.length===0)return'<p class="hint">ÐÐµÑ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð·Ð° ÑÑÐ¾Ñ Ð¿ÐµÑÐ¸Ð¾Ð´</p>';const g=new Map;[...v].sort((S,E)=>new Date(E.date).getTime()-new Date(S.date).getTime()).forEach(S=>{const K=new Date(S.date).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"});g.has(K)||g.set(K,[]),g.get(K).push(S)});const x=W.getWorkouts();let D="";return g.forEach((S,E)=>{var ot;const K=((ot=S[0])==null?void 0:ot.date.split("T")[0])||"",R=new Set;S.forEach(yt=>{yt.workoutId&&R.add(yt.workoutId)});const z=Array.from(R).sort((yt,vt)=>{var bt,ut;const xt=x.find(ft=>ft.id===yt),Ut=x.find(ft=>ft.id===vt),St=(xt==null?void 0:xt.startTime)||((bt=S.find(ft=>ft.workoutId===yt))==null?void 0:bt.date)||"",mt=(Ut==null?void 0:Ut.startTime)||((ut=S.find(ft=>ft.workoutId===vt))==null?void 0:ut.date)||"";return new Date(mt).getTime()-new Date(St).getTime()}),B=z.length===1?z[0]:null,tt=B?x.find(yt=>yt.id===B):null,U=tt&&tt.name,V=tt?Math.round(W.getWorkoutDuration(tt)):0;D+='<div class="log-day">',D+=`<div class="log-day__header">
      <span>${E}${U?` â¢ ${tt.name}`:""}${tt?` â¢ ${V} Ð¼Ð¸Ð½`:""}</span>
      ${c?`<button class="share-btn" data-date="${K}" title="ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ">ð¤</button>`:""}
    </div>`,z.forEach(yt=>{const vt=x.find(mt=>mt.id===yt),xt=S.filter(mt=>mt.workoutId===yt);if(!(z.length===1&&(U||!(vt!=null&&vt.name)))){const mt=vt?Math.round(W.getWorkoutDuration(vt)):0;D+=`<h3 class="workout-subheader">
                ${(vt==null?void 0:vt.name)||"Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°"} 
                <span class="workout-subheader__time">${mt} Ð¼Ð¸Ð½</span>
            </h3>`}const St=new Map;xt.forEach(mt=>{St.has(mt.workoutTypeId)||St.set(mt.workoutTypeId,[]),St.get(mt.workoutTypeId).push(mt)}),St.forEach((mt,bt)=>{const ut=u.find(ft=>ft.id===bt);D+=`
            <div class="log-exercise">
              <div class="log-exercise__name">${(ut==null?void 0:ut.name)||"Ð£Ð´Ð°Ð»ÐµÐ½Ð¾"}</div>
              <div class="log-exercise__sets">
                ${mt.map(ft=>`
                  <div class="log-set ${ft.id===dt?"log-set_active-edit":""} ${ft.id===Ce?"log-set_new":""}">
                    <div class="log-set__info">
                      <span class="log-set__weight">${ft.weight} ÐºÐ³</span>
                      <span class="log-set__times">Ã</span>
                      <span class="log-set__reps">${ft.reps}</span>
                    </div>
                    ${c?`
                    <div class="log-set__actions">
                      <button class="log-set__edit" data-id="${ft.id}">âï¸</button>
                      <button class="log-set__delete" data-id="${ft.id}">Ã</button>
                    </div>
                    `:""}
                  </div>
                `).join("")}
              </div>
            </div>
          `})}),D+="</div>"}),D}function bi(){const v=W.getWorkoutTypes(),u=Dt?v.find(c=>c.id===Dt):null;return`
    <div class="page-content">
      <h1 class="title">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</h1>
      <div class="settings-section">
        <h2 class="subtitle">${Dt?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¿Ð°":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸"}</h2>
        <form class="add-type-form" id="add-type-form" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 8px;">
            <input class="input" type="text" id="new-type-name" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð½Ð°Ð¿Ñ. ÐÐ¸Ð¼ Ð³Ð°Ð½ÑÐµÐ»ÐµÐ¹)" required value="${u?u.name:""}">
            <button class="button" type="submit">${Dt?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ"}</button>
          </div>
          ${Dt?'<button class="button button_secondary" type="button" id="cancel-edit-type-btn" style="margin-top: 8px; width: 100%;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        </form>

        <h2 class="subtitle">Ð¢Ð¸Ð¿Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
        <div class="type-list">
          ${v.map(c=>`
            <div class="type-item">
              <span>${c.name}</span>
              <div style="display: flex; gap: 8px;">
                <button class="type-item__edit icon-btn" data-id="${c.id}" title="Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ">âï¸</button>
                <button class="type-item__delete icon-btn" data-id="${c.id}" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">Ã</button>
              </div>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `}function wi(){var K,R;const v=W.getProfile(),u=(v==null?void 0:v.isPublic)??!1,c=(v==null?void 0:v.displayName)||((R=(K=it==null?void 0:it.initDataUnsafe)==null?void 0:K.user)==null?void 0:R.first_name)||"",g=W.getProfileIdentifier(),x=g?`https://t.me/gymgym21bot/app?startapp=profile_${g}`:"",D=W.getLogs(),S=D.reduce((z,B)=>z+B.weight*B.reps,0),E=new Set(D.map(z=>z.date.split("T")[0])).size;return`
    <div class="page-content profile-page">
      <h1 class="title">ÐÑÐ¾ÑÐ¸Ð»Ñ</h1>
      
      <div class="profile-header">
        <div class="profile-avatar">
          ${v!=null&&v.photoUrl?`<img src="${v.photoUrl}" alt="${c}" class="profile-avatar-img">`:c.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${c}</div>
        <div class="profile-subtitle">${u?"ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ":"ÐÑÐ¸Ð²Ð°ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ"}</div>
      </div>

      <div class="profile-settings">
        <div class="settings-section">
          <div class="settings-section-title">ÐÐ¸Ð´Ð¸Ð¼Ð¾ÑÑÑ</div>
          <div class="toggle-row">
            <div class="toggle-label">
              <span class="toggle-label-text">ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</span>
              <span class="toggle-label-hint">ÐÑÑÐ³Ð¸Ðµ ÑÐ¼Ð¾Ð³ÑÑ Ð²Ð¸Ð´ÐµÑÑ Ð²Ð°ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÑ</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="profile-public-toggle" ${u?"checked":""}>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="toggle-row" style="margin-top: 12px;">
            <div class="toggle-label">
              <span class="toggle-label-text">ÐÐ¾ÐºÐ°Ð·ÑÐ²Ð°ÑÑ Ð²ÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ</span>
              <span class="toggle-label-hint">ÐÐ¾Ð´ÑÐ¾Ð±Ð½ÑÐ¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð² Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ð¼ Ð¿ÑÐ¾ÑÐ¸Ð»Ðµ</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="profile-history-toggle" ${v!=null&&v.showFullHistory?"checked":""}>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-section">
          <div class="settings-section-title">ÐÐ¼Ñ</div>
          <input class="input" type="text" id="profile-display-name" value="${c}" placeholder="ÐÐ°ÑÐµ Ð¸Ð¼Ñ">
        </div>

        ${u&&g?`
          <div class="settings-section">
            <div class="settings-section-title">Ð¡ÑÑÐ»ÐºÐ° Ð½Ð° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</div>
            <div class="profile-link-section">
              <a href="${x}" target="_blank" class="profile-link-url">${x}</a>
              <div class="profile-link-actions">
                <button class="button button_secondary" id="copy-profile-link">ÐÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ</button>
                <button class="button" id="share-profile-link">ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ</button>
              </div>
            </div>
          </div>
        `:""}

        <div class="settings-section">
          <div class="settings-section-title">ÐÑÐµÐ²ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</div>
          <div class="profile-stats">
            <div class="stat-card">
              <div class="stat-value">${E}</div>
              <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">${Math.round(S/1e3)}Ñ</div>
              <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
            </div>
          </div>
        </div>

        <button class="button" id="save-profile-btn">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
      </div>
    </div>
  `}function _i(){if(!ua)return`
      <div class="page-content">
        <div class="profile-not-found">
          <div class="profile-not-found-icon">ð</div>
          <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½</div>
        </div>
      </div>
    `;if(!dn)return er?`
        <div class="page-content">
          <div class="profile-not-found">
            <div class="profile-not-found-icon">ð</div>
            <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐºÑÑÑ Ð¸Ð»Ð¸ Ð½Ðµ ÑÑÑÐµÑÑÐ²ÑÐµÑ</div>
          </div>
        </div>
      `:`
      <div class="page-content">
        <div class="profile-loading">ÐÐ°Ð³ÑÑÐ·ÐºÐ° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ...</div>
      </div>
    `;const v=dn;return`
    <div class="page-content profile-page">
      <div class="profile-header">
        <div class="profile-avatar">
          ${v.photoUrl?`<img src="${v.photoUrl}" alt="${v.displayName}" class="profile-avatar-img">`:v.displayName.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${v.displayName}</div>
        <div class="profile-subtitle">@${v.identifier}</div>
      </div>

      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-value">${v.stats.totalWorkouts}</div>
          <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${Math.round(v.stats.totalVolume/1e3)}Ñ</div>
          <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
        </div>
        ${v.stats.favoriteExercise?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${v.stats.favoriteExercise}</div>
            <div class="stat-label">ÐÑÐ±Ð¸Ð¼Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</div>
          </div>
        `:""}
        ${v.stats.lastWorkoutDate?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${new Date(v.stats.lastWorkoutDate).toLocaleDateString()}</div>
            <div class="stat-label">ÐÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</div>
          </div>
        `:""}
      </div>

      ${v.recentActivity.length>0?`
        <div class="activity-list">
          <h2 class="subtitle">ÐÐµÐ´Ð°Ð²Ð½ÑÑ Ð°ÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          ${v.recentActivity.map(u=>`
            <div class="activity-item">
              <span class="activity-date">${new Date(u.date).toLocaleDateString()}</span>
              <span class="activity-count">${u.exerciseCount} ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹</span>
            </div>
          `).join("")}
        </div>
      `:""}

      ${v.logs&&v.logs.length>0&&v.workoutTypes?`
        <div class="recent-logs">
          <h2 class="subtitle">ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
          <div id="logs-list">
            ${da(v.logs,v.workoutTypes,!1)}
          </div>
        </div>
      `:""}
    </div>
  `}function ki(){const v=W.getLogs(),u=W.getWorkouts(),c=W.getWorkoutTypes();if(v.length===0)return`
      <div class="page-content">
        <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
        <p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</p>
      </div>
    `;const g=v.reduce((E,K)=>E+K.weight*K.reps,0),x=v.reduce((E,K)=>E+K.reps,0),D=si(u);let S=`
    <div class="page-content">
      <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
      <div class="stats-tabs">
        <button class="stats-tab ${un==="overview"?"active":""}" data-tab="overview">ÐÐ±Ð·Ð¾Ñ</button>
        <button class="stats-tab ${un==="progress"?"active":""}" data-tab="progress">ÐÑÐ¾Ð³ÑÐµÑÑ</button>
      </div>
  `;if(un==="overview"){const E=oi(u,v);S+=`
        <div class="stats-section">
            <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
            ${ui(E)}
        </div>

        <div class="stats-summary">
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
                <div class="stat-metric__value">${E.size}</div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">Ð¡ÑÐµÐ´. Ð´Ð»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ</div>
                <div class="stat-metric__value">${D.averageMinutes}<span class="stat-metric__unit">Ð¼Ð¸Ð½</span></div>
            </div>
             <div class="stat-metric">
                <div class="stat-metric__label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼</div>
                <div class="stat-metric__value">${Math.round(g/1e3)}<span class="stat-metric__unit">Ñ</span></div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ Ð¿Ð¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</div>
                <div class="stat-metric__value">${x}</div>
            </div>
        </div>

        <div class="charts-section">
            <h2 class="subtitle">ÐÐ»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
            <div class="chart-container">
                ${li(u)}
            </div>
        </div>
     `}else if(S+=`
        <div class="form-group">
            <label class="label">Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</label>
            <select class="select" id="stat-type-select">
                <option value="all">ÐÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ (ÐÐ±ÑÐµÐ¼)</option>
                ${c.map(E=>`<option value="${E.id}" ${ye===E.id?"selected":""}>${E.name}</option>`).join("")}
            </select>
        </div>
    `,ye==="all")S+=`
            <div class="charts-section">
                <h2 class="subtitle">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼ Ð¿Ð¾ Ð´Ð½ÑÐ¼</h2>
                <div class="chart-container">
                    ${Jr(v)}
                </div>
            </div>
        `;else{const E=v.filter(R=>R.workoutTypeId===ye),K=ii(E,ye);S+=`
             <div class="charts-section">
                <h2 class="subtitle">ÐÑÐ¾Ð³ÑÐµÑÑ ÑÐ¸Ð»Ð¾Ð²ÑÑ (1RM)</h2>
                <div class="chart-container">
                    ${ci(K)}
                </div>
            </div>
            
            <div class="charts-section" style="margin-top: 24px;">
                <h2 class="subtitle">ÐÐ±ÑÐµÐ¼ Ð½Ð°Ð³ÑÑÐ·ÐºÐ¸</h2>
                 <div class="chart-container">
                    ${Jr(E)}
                </div>
            </div>
        `}return S+="</div>",S}function xi(v){const u=W.getLogs(),c=W.getWorkoutTypes(),g=u.filter(R=>R.date.startsWith(v));if(g.length===0)return"";const D=new Date(g[0].date).toLocaleDateString("ru-RU",{day:"numeric",month:"long"}),S=new Map;g.forEach(R=>{S.has(R.workoutTypeId)||S.set(R.workoutTypeId,[]),S.get(R.workoutTypeId).push(R)});let E=`ðï¸ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° ${D}

`;S.forEach((R,z)=>{const B=c.find(tt=>tt.id===z);E+=`${(B==null?void 0:B.name)||"Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ"}:
`,R.forEach(tt=>{E+=`  ${tt.weight} ÐºÐ³ Ã ${tt.reps}
`}),E+=`
`});const K=g.reduce((R,z)=>R+z.weight*z.reps,0);return E+=`ðª ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼: ${Math.round(K)} ÐºÐ³`,E}function fa(v){const u=xi(v);if(u)if(it!=null&&it.openTelegramLink){const c=`https://t.me/share/url?url=${encodeURIComponent("https://t.me/gymgym21bot")}&text=${encodeURIComponent(u)}`;it.openTelegramLink(c)}else navigator.clipboard.writeText(u).then(()=>{alert("Ð¢ÐµÐºÑÑ ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½ Ð² Ð±ÑÑÐµÑ Ð¾Ð±Ð¼ÐµÐ½Ð°")})}function Si(){if(Et==="main"){const v=document.getElementById("start-workout-btn");v==null||v.addEventListener("click",()=>{cn=!0,nt()});const u=document.getElementById("cancel-start-workout-btn");u==null||u.addEventListener("click",()=>{cn=!1,nt()});const c=document.getElementById("start-workout-form");c==null||c.addEventListener("submit",async U=>{U.preventDefault();const ot=new FormData(c).get("workoutName");await W.startWorkout(ot),cn=!1,nt()});const g=document.getElementById("pause-workout-btn");g==null||g.addEventListener("click",async()=>{await W.pauseWorkout(),nt()});const x=document.getElementById("resume-workout-btn");x==null||x.addEventListener("click",async()=>{await W.resumeWorkout(),nt()});const D=document.getElementById("finish-workout-btn");D==null||D.addEventListener("click",async()=>{confirm("ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ?")&&(await W.finishWorkout(),nt())});const S=document.getElementById("log-form");S==null||S.addEventListener("submit",async U=>{U.preventDefault();const V=new FormData(S),ot={workoutTypeId:V.get("typeId"),weight:parseFloat(V.get("weight")),reps:parseInt(V.get("reps"),10)};if(dt){const vt=W.getLogs().find(xt=>xt.id===dt);vt&&(await W.updateLog({...vt,...ot}),dt=null)}else Ce=(await W.addLog(ot)).id;nt(),Ce=null});const E=document.getElementById("duplicate-last-btn");E==null||E.addEventListener("click",async()=>{const U=W.getLogs(),V=U[U.length-1];V&&(Ce=(await W.addLog({workoutTypeId:V.workoutTypeId,weight:V.weight,reps:V.reps})).id,nt(),Ce=null)});const K=document.getElementById("cancel-edit-btn");K==null||K.addEventListener("click",()=>{dt=null,nt()}),document.querySelectorAll(".log-set__delete").forEach(U=>{U.addEventListener("click",async()=>{const V=U.getAttribute("data-id");V&&(dt===V&&(dt=null),await W.deleteLog(V),nt())})}),document.querySelectorAll(".log-set__edit").forEach(U=>{U.addEventListener("click",()=>{dt=U.getAttribute("data-id"),nt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(U=>{U.addEventListener("click",()=>{const V=U.getAttribute("data-date");V&&fa(V)})});const R=document.getElementById("prev-week-btn");R==null||R.addEventListener("click",()=>{wt++,sn()});const z=document.getElementById("next-week-btn");z==null||z.addEventListener("click",()=>{wt>0&&(wt--,sn())});const B=document.getElementById("calendar-input");B==null||B.addEventListener("change",()=>{if(!B.value||B.value===nr)return;nr=B.value;const U=new Date(B.value),V=new Date;V.setHours(0,0,0,0);const ot=V.getTime()-U.getTime(),yt=Math.floor(ot/(1e3*60*60*24));wt=Math.max(0,Math.floor(yt/7)),sn()});const tt=document.getElementById("filter-toggle-input");tt==null||tt.addEventListener("change",()=>{ir=tt.checked,sn()})}if(Et==="settings"){const v=document.getElementById("add-type-form");v==null||v.addEventListener("submit",async c=>{c.preventDefault();const g=document.getElementById("new-type-name");g.value&&(Dt?(await W.updateWorkoutType(Dt,g.value),Dt=null):await W.addWorkoutType(g.value),nt())});const u=document.getElementById("cancel-edit-type-btn");u==null||u.addEventListener("click",()=>{Dt=null,nt()}),document.querySelectorAll(".type-item__edit").forEach(c=>{c.addEventListener("click",()=>{Dt=c.getAttribute("data-id"),nt();const g=document.getElementById("new-type-name");g==null||g.focus()})}),document.querySelectorAll(".type-item__delete").forEach(c=>{c.addEventListener("click",async()=>{const g=c.getAttribute("data-id");g&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(Dt===g&&(Dt=null),await W.deleteWorkoutType(g),nt())})})}if(Et==="stats"){const v=document.getElementById("stat-type-select");v==null||v.addEventListener("change",()=>{ye=v.value,nt()})}if(Et==="profile-settings"){const v=document.getElementById("save-profile-btn");v==null||v.addEventListener("click",async()=>{const g=document.getElementById("profile-public-toggle"),x=document.getElementById("profile-history-toggle"),D=document.getElementById("profile-display-name");await W.updateProfileSettings({isPublic:(g==null?void 0:g.checked)??!1,showFullHistory:(x==null?void 0:x.checked)??!1,displayName:(D==null?void 0:D.value)||void 0}),nt()});const u=document.getElementById("copy-profile-link");u==null||u.addEventListener("click",()=>{const x=`https://t.me/gymgym21bot/app?startapp=profile_${W.getProfileIdentifier()}`;navigator.clipboard.writeText(x).then(()=>{Zr("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})});const c=document.getElementById("share-profile-link");c==null||c.addEventListener("click",()=>{const x=`https://t.me/gymgym21bot/app?startapp=profile_${W.getProfileIdentifier()}`;if(it!=null&&it.openTelegramLink){const D=`https://t.me/share/url?url=${encodeURIComponent(x)}&text=${encodeURIComponent("ÐÐ¾Ð¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº ðª")}`;it.openTelegramLink(D)}else navigator.clipboard.writeText(x).then(()=>{Zr("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})})}if(Et==="stats"){document.querySelectorAll(".stats-tab").forEach(c=>{c.addEventListener("click",()=>{const g=c.getAttribute("data-tab");(g==="overview"||g==="progress")&&(un=g,nt())})});const u=document.getElementById("stat-type-select");u==null||u.addEventListener("change",c=>{ye=c.target.value,nt()})}}const ne=document.createElement("div");ne.className="sync-status";document.body.appendChild(ne);function Ti(v){switch(ne.className="sync-status visible "+v,v){case"saving":ne.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...";break;case"success":ne.textContent="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð¾";break;case"error":ne.textContent="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸";break;default:ne.className="sync-status"}}W.onUpdate(()=>nt());W.onSyncStatusChange(Ti);async function Di(){var E;const v=new URLSearchParams(window.location.search);if(v.has("hash")&&v.has("id")){const K={id:parseInt(v.get("id")||"0",10),first_name:v.get("first_name")||"",last_name:v.get("last_name")||void 0,username:v.get("username")||void 0,photo_url:v.get("photo_url")||void 0,auth_date:parseInt(v.get("auth_date")||"0",10),hash:v.get("hash")||""};ar(K),v.delete("hash"),v.delete("id"),v.delete("first_name"),v.delete("last_name"),v.delete("username"),v.delete("photo_url"),v.delete("auth_date"),v.delete("auth");const R=v.toString(),z=window.location.pathname+(R?"?"+R:"");window.history.replaceState({},document.title,z),location.reload();return}const u=localStorage.getItem("skip_tma_auth")==="true",c=!!(it!=null&&it.initData)&&!u,x=!!fn();if(!c&&!x){fi(document.getElementById("app"),()=>{location.reload()});return}const S=new URLSearchParams(window.location.search).get("startapp")||((E=it==null?void 0:it.initDataUnsafe)==null?void 0:E.start_param);if(S&&S.startsWith("profile_")){const K=S.replace("profile_","");ua=K,Et="public-profile",er=!1,nt(),dn=await W.getPublicProfile(K),dn||(er=!0),nt()}else nt();await W.init()}Di();
