var Ua=Object.defineProperty;var Wa=(v,u,c)=>u in v?Ua(v,u,{enumerable:!0,configurable:!0,writable:!0,value:c}):v[u]=c;var jt=(v,u,c)=>Wa(v,typeof u!="symbol"?u+"":u,c);(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const T of document.querySelectorAll('link[rel="modulepreload"]'))g(T);new MutationObserver(T=>{for(const S of T)if(S.type==="childList")for(const D of S.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&g(D)}).observe(document,{childList:!0,subtree:!0});function c(T){const S={};return T.integrity&&(S.integrity=T.integrity),T.referrerPolicy&&(S.referrerPolicy=T.referrerPolicy),T.crossOrigin==="use-credentials"?S.credentials="include":T.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function g(T){if(T.ep)return;T.ep=!0;const S=c(T);fetch(T.href,S)}})();var Wr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Va(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var ta={exports:{}};(function(v,u){((c,g)=>{v.exports=g()})(Wr,function(){var c=function(t,e){return(c=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(n,r){n.__proto__=r}:function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}))(t,e)},g=function(){return(g=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function T(t,e,n){for(var r,a=0,i=e.length;a<i;a++)!r&&a in e||((r=r||Array.prototype.slice.call(e,0,a))[a]=e[a]);return t.concat(r||Array.prototype.slice.call(e))}var S=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Wr,D=Object.keys,E=Array.isArray;function K(t,e){return typeof e=="object"&&D(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||S.Promise||(S.Promise=Promise);var R=Object.getPrototypeOf,Y={}.hasOwnProperty;function B(t,e){return Y.call(t,e)}function V(t,e){typeof e=="function"&&(e=e(R(t))),(typeof Reflect>"u"?D:Reflect.ownKeys)(e).forEach(function(n){Z(t,n,e[n])})}var U=Object.defineProperty;function Z(t,e,n,r){U(t,e,K(n&&B(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ft(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Z(t.prototype,"constructor",t),{extend:V.bind(null,t.prototype)}}}}var vt=Object.getOwnPropertyDescriptor,gt=[].slice;function Tt(t,e,n){return gt.call(t,e,n)}function Ut(t,e){return e(t)}function xt(t){if(!t)throw new Error("Assertion Failed")}function yt(t){S.setImmediate?setImmediate(t):setTimeout(t,0)}function bt(t,e){if(typeof e=="string"&&B(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,a=e.length;r<a;++r){var i=bt(t,e[r]);n.push(i)}return n}var o,s=e.indexOf(".");return s===-1||(o=t[e.substr(0,s)])==null?void 0:bt(o,e.substr(s+1))}function ot(t,e,n){if(t&&e!==void 0&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){xt(typeof n!="string"&&"length"in n);for(var r=0,a=e.length;r<a;++r)ot(t,e[r],n[r])}else{var i,o,s=e.indexOf(".");s!==-1?(i=e.substr(0,s),(s=e.substr(s+1))===""?n===void 0?E(t)&&!isNaN(parseInt(i))?t.splice(i,1):delete t[i]:t[i]=n:ot(o=(o=t[i])&&B(t,i)?o:t[i]={},s,n)):n===void 0?E(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function dt(t){var e,n={};for(e in t)B(t,e)&&(n[e]=t[e]);return n}var ua=[].concat;function ir(t){return ua.apply([],t)}var Ct="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ir([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return S[t]}),or=new Set(Ct.map(function(t){return S[t]})),ve=null;function Wt(t){return ve=new WeakMap,t=function e(n){if(!n||typeof n!="object")return n;var r=ve.get(n);if(r)return r;if(E(n)){r=[],ve.set(n,r);for(var a=0,i=n.length;a<i;++a)r.push(e(n[a]))}else if(or.has(n.constructor))r=n;else{var o,s=R(n);for(o in r=s===Object.prototype?{}:Object.create(s),ve.set(n,r),n)B(n,o)&&(r[o]=e(n[o]))}return r}(t),ve=null,t}var ca={}.toString;function dn(t){return ca.call(t).slice(8,-1)}var fn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",la=typeof fn=="symbol"?function(t){var e;return t!=null&&(e=t[fn])&&e.apply(t)}:function(){return null};function Vt(t,e){e=t.indexOf(e),0<=e&&t.splice(e,1)}var re={};function At(t){var e,n,r,a;if(arguments.length===1){if(E(t))return t.slice();if(this===re&&typeof t=="string")return[t];if(a=la(t))for(n=[];!(r=a.next()).done;)n.push(r.value);else{if(t==null)return[t];if(typeof(e=t.length)!="number")return[t];for(n=new Array(e);e--;)n[e]=t[e]}}else for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var hn=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Ct=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],_t=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Ct),da={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ae(t,e){this.name=t,this.message=e}function sr(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,a){return a.indexOf(n)===r}).join(`
`)}function Ke(t,e,n,r){this.failures=e,this.failedKeys=r,this.successCount=n,this.message=sr(t,e)}function ie(t,e){this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=sr(t,this.failures)}ft(ae).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ft(Ke).from(ae),ft(ie).from(ae);var pn=_t.reduce(function(t,e){return t[e]=e+"Error",t},{}),fa=ae,N=_t.reduce(function(t,e){var n=e+"Error";function r(a,i){this.name=n,a?typeof a=="string"?(this.message="".concat(a).concat(i?`
 `+i:""),this.inner=i||null):typeof a=="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a):(this.message=da[e]||n,this.inner=null)}return ft(r).from(fa),t[e]=r,t},{}),ur=(N.Syntax=SyntaxError,N.Type=TypeError,N.Range=RangeError,Ct.reduce(function(t,e){return t[e+"Error"]=N[e],t},{}));Ct=_t.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=N[e]),t},{});function tt(){}function ge(t){return t}function ha(t,e){return t==null||t===ge?e:function(n){return e(t(n))}}function zt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function pa(t,e){return t===tt?e:function(){var n=t.apply(this,arguments),r=(n!==void 0&&(arguments[0]=n),this.onsuccess),a=this.onerror,i=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return r&&(this.onsuccess=this.onsuccess?zt(r,this.onsuccess):r),a&&(this.onerror=this.onerror?zt(a,this.onerror):a),i!==void 0?i:n}}function ya(t,e){return t===tt?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?zt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?zt(r,this.onerror):r)}}function ma(t,e){return t===tt?e:function(a){var r=t.apply(this,arguments),a=(K(a,r),this.onsuccess),i=this.onerror,o=(this.onsuccess=null,this.onerror=null,e.apply(this,arguments));return a&&(this.onsuccess=this.onsuccess?zt(a,this.onsuccess):a),i&&(this.onerror=this.onerror?zt(i,this.onerror):i),r===void 0?o===void 0?void 0:o:K(r,o)}}function va(t,e){return t===tt?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function yn(t,e){return t===tt?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,a=arguments.length,i=new Array(a);a--;)i[a]=arguments[a];return n.then(function(){return e.apply(r,i)})}return e.apply(this,arguments)}}Ct.ModifyError=Ke,Ct.DexieError=ae,Ct.BulkError=ie;var It=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function cr(t){It=t}var be={},lr=100,we=typeof Promise>"u"?[]:(_t=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[we=crypto.subtle.digest("SHA-512",new Uint8Array([0])),R(we),_t]:[_t,R(_t),_t]),_t=we[0],he=we[1],he=he&&he.then,Ht=_t&&_t.constructor,mn=!!we[2],_e=function(t,e){ke.push([t,e]),$e&&(queueMicrotask(ba),$e=!1)},vn=!0,$e=!0,Yt=[],je=[],gn=ge,Lt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:tt,pgp:!1,env:{},finalize:tt},M=Lt,ke=[],Gt=0,Le=[];function $(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var e=this._PSD=M;if(typeof t!="function"){if(t!==be)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&wn(this,this._value)}else this._state=null,this._value=null,++e.ref,function n(r,a){try{a(function(i){if(r._state===null){if(i===r)throw new TypeError("A promise cannot be resolved with itself.");var o=r._lib&&oe();i&&typeof i.then=="function"?n(r,function(s,f){i instanceof $?i._then(s,f):i.then(s,f)}):(r._state=!0,r._value=i,fr(r)),o&&se()}},wn.bind(null,r))}catch(i){wn(r,i)}}(this,t)}var bn={get:function(){var t=M,e=Be;function n(r,a){var i=this,o=!t.global&&(t!==M||e!==Be),s=o&&!Rt(),f=new $(function(w,h){_n(i,new dr(pr(r,t,o,s),pr(a,t,o,s),w,h,t))});return this._consoleTask&&(f._consoleTask=this._consoleTask),f}return n.prototype=be,n},set:function(t){Z(this,"then",t&&t.prototype===be?bn:{get:function(){return t},set:bn.set})}};function dr(t,e,n,r,a){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=a}function wn(t,e){var n,r;je.push(e),t._state===null&&(n=t._lib&&oe(),e=gn(e),t._state=!1,t._value=e,r=t,Yt.some(function(a){return a._value===r._value})||Yt.push(r),fr(t),n)&&se()}function fr(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)_n(t,e[n]);var a=t._PSD;--a.ref||a.finalize(),Gt===0&&(++Gt,_e(function(){--Gt==0&&kn()},[]))}function _n(t,e){if(t._state===null)t._listeners.push(e);else{var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Gt,_e(ga,[n,t,e])}}function ga(t,e,n){try{var r,a=e._value;!e._state&&je.length&&(je=[]),r=It&&e._consoleTask?e._consoleTask.run(function(){return t(a)}):t(a),e._state||je.indexOf(a)!==-1||(i=>{for(var o=Yt.length;o;)if(Yt[--o]._value===i._value)return Yt.splice(o,1)})(e),n.resolve(r)}catch(i){n.reject(i)}finally{--Gt==0&&kn(),--n.psd.ref||n.psd.finalize()}}function ba(){Qt(Lt,function(){oe()&&se()})}function oe(){var t=vn;return $e=vn=!1,t}function se(){var t,e,n;do for(;0<ke.length;)for(t=ke,ke=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(0<ke.length);$e=vn=!0}function kn(){for(var t=Yt,e=(Yt=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)}),Le.slice(0)),n=e.length;n;)e[--n]()}function qe(t){return new $(be,!1,t)}function rt(t,e){var n=M;return function(){var r=oe(),a=M;try{return Mt(n,!0),t.apply(this,arguments)}catch(i){e&&e(i)}finally{Mt(a,!1),r&&se()}}}V($.prototype,{then:bn,_then:function(t,e){_n(this,new dr(null,null,t,e,M))},catch:function(t){var e,n;return arguments.length===1?this.then(null,t):(e=t,n=arguments[1],typeof e=="function"?this.then(null,function(r){return(r instanceof e?n:qe)(r)}):this.then(null,function(r){return(r&&r.name===e?n:qe)(r)}))},finally:function(t){return this.then(function(e){return $.resolve(t()).then(function(){return e})},function(e){return $.resolve(t()).then(function(){return qe(e)})})},timeout:function(t,e){var n=this;return t<1/0?new $(function(r,a){var i=setTimeout(function(){return a(new N.Timeout(e))},t);n.then(r,a).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Z($.prototype,Symbol.toStringTag,"Dexie.Promise"),Lt.env=hr(),V($,{all:function(){var t=At.apply(null,arguments).map(Ne);return new $(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(a,i){return $.resolve(a).then(function(o){t[i]=o,--r||e(t)},n)})})},resolve:function(t){return t instanceof $?t:t&&typeof t.then=="function"?new $(function(e,n){t.then(e,n)}):new $(be,!0,t)},reject:qe,race:function(){var t=At.apply(null,arguments).map(Ne);return new $(function(e,n){t.map(function(r){return $.resolve(r).then(e,n)})})},PSD:{get:function(){return M},set:function(t){return M=t}},totalEchoes:{get:function(){return Be}},newPSD:qt,usePSD:Qt,scheduler:{get:function(){return _e},set:function(t){_e=t}},rejectionMapper:{get:function(){return gn},set:function(t){gn=t}},follow:function(t,e){return new $(function(n,r){return qt(function(a,i){var o=M;o.unhandleds=[],o.onunhandled=i,o.finalize=zt(function(){var s,f=this;s=function(){f.unhandleds.length===0?a():i(f.unhandleds[0])},Le.push(function w(){s(),Le.splice(Le.indexOf(w),1)}),++Gt,_e(function(){--Gt==0&&kn()},[])},o.finalize),t()},e,n,r)})}}),Ht&&(Ht.allSettled&&Z($,"allSettled",function(){var t=At.apply(null,arguments).map(Ne);return new $(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(a,i){return $.resolve(a).then(function(o){return r[i]={status:"fulfilled",value:o}},function(o){return r[i]={status:"rejected",reason:o}}).then(function(){return--n||e(r)})})})}),Ht.any&&typeof AggregateError<"u"&&Z($,"any",function(){var t=At.apply(null,arguments).map(Ne);return new $(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,a=new Array(r);t.forEach(function(i,o){return $.resolve(i).then(function(s){return e(s)},function(s){a[o]=s,--r||n(new AggregateError(a))})})})}),Ht.withResolvers)&&($.withResolvers=Ht.withResolvers);var ht={awaits:0,echoes:0,id:0},wa=0,Re=[],Me=0,Be=0,_a=0;function qt(t,o,n,r){var a=M,i=Object.create(a),o=(i.parent=a,i.ref=0,i.global=!1,i.id=++_a,Lt.env,i.env=mn?{Promise:$,PromiseProp:{value:$,configurable:!0,writable:!0},all:$.all,race:$.race,allSettled:$.allSettled,any:$.any,resolve:$.resolve,reject:$.reject}:{},o&&K(i,o),++a.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()},Qt(i,t,n,r));return i.ref===0&&i.finalize(),o}function ue(){return ht.id||(ht.id=++wa),++ht.awaits,ht.echoes+=lr,ht.id}function Rt(){return!!ht.awaits&&(--ht.awaits==0&&(ht.id=0),ht.echoes=ht.awaits*lr,!0)}function Ne(t){return ht.echoes&&t&&t.constructor===Ht?(ue(),t.then(function(e){return Rt(),e},function(e){return Rt(),st(e)})):t}function ka(){var t=Re[Re.length-1];Re.pop(),Mt(t,!1)}function Mt(t,e){var n,r,a=M;(e?!ht.echoes||Me++&&t===M:!Me||--Me&&t===M)||queueMicrotask(e?(function(i){++Be,ht.echoes&&--ht.echoes!=0||(ht.echoes=ht.awaits=ht.id=0),Re.push(M),Mt(i,!0)}).bind(null,t):ka),t!==M&&(M=t,a===Lt&&(Lt.env=hr()),mn)&&(n=Lt.env.Promise,r=t.env,a.global||t.global)&&(Object.defineProperty(S,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any)&&(n.any=r.any)}function hr(){var t=S.Promise;return mn?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(S,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject}:{}}function Qt(t,e,n,r,a){var i=M;try{return Mt(t,!0),e(n,r,a)}finally{Mt(i,!1)}}function pr(t,e,n,r){return typeof t!="function"?t:function(){var a=M;n&&ue(),Mt(e,!0);try{return t.apply(this,arguments)}finally{Mt(a,!1),r&&queueMicrotask(Rt)}}}function xn(t){Promise===Ht&&ht.echoes===0?Me===0?t():enqueueNativeMicroTask(t):setTimeout(t,0)}(""+he).indexOf("[native code]")===-1&&(ue=Rt=tt);var st=$.reject,Xt="ï¿¿",Kt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",yr="String expected.",ce=[],Fe="__dbnames",Sn="readonly",Dn="readwrite";function Jt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var mr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ue(t){return typeof t!="string"||/\./.test(t)?function(e){return e}:function(e){return e[t]===void 0&&t in e&&delete(e=Wt(e))[t],e}}function vr(){throw N.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function G(t,e){try{var n=gr(t),r=gr(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e<t?1:t<e?-1:0;case"binary":for(var a=br(t),i=br(e),o=a.length,s=i.length,f=o<s?o:s,w=0;w<f;++w)if(a[w]!==i[w])return a[w]<i[w]?-1:1;return o===s?0:o<s?-1:1;case"Array":for(var h=t,l=e,y=h.length,m=l.length,p=y<m?y:m,d=0;d<p;++d){var _=G(h[d],l[d]);if(_!==0)return _}return y===m?0:y<m?-1:1}}catch{}return NaN}function gr(t){var e=typeof t;return e=="object"&&(ArrayBuffer.isView(t)||(e=dn(t))==="ArrayBuffer")?"binary":e}function br(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}function We(t,e,n){var r=t.schema.yProps;return r?(e&&0<n.numFailures&&(e=e.filter(function(a,i){return!n.failures[i]})),Promise.all(r.map(function(a){return a=a.updatesTable,e?t.db.table(a).where("k").anyOf(e).delete():t.db.table(a).clear()})).then(function(){return n})):n}wr.prototype.execute=function(t){var e=this["@@propmod"];if(e.add!==void 0){var n=e.add;if(E(n))return T(T([],E(t)?t:[],!0),n).sort();if(typeof n=="number")return(Number(t)||0)+n;if(typeof n=="bigint")try{return BigInt(t)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(e.remove!==void 0){var r=e.remove;if(E(r))return E(t)?t.filter(function(a){return!r.includes(a)}).sort():[];if(typeof r=="number")return Number(t)-r;if(typeof r=="bigint")try{return BigInt(t)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return n=(n=e.replacePrefix)==null?void 0:n[0],n&&typeof t=="string"&&t.startsWith(n)?e.replacePrefix[1]+t.substring(n.length):t};var xe=wr;function wr(t){this["@@propmod"]=t}function _r(t,e){for(var n=D(e),r=n.length,a=!1,i=0;i<r;++i){var o=n[i],s=e[o],f=bt(t,o);s instanceof xe?(ot(t,o,s.execute(f)),a=!0):f!==s&&(ot(t,o,s),a=!0)}return a}et.prototype._trans=function(t,e,n){var r=this._tx||M.trans,a=this.name,i=It&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function o(w,h,l){if(l.schema[a])return e(l.idbtrans,l);throw new N.NotFound("Table "+a+" not part of transaction")}var s=oe();try{var f=r&&r.db._novip===this.db._novip?r===M.trans?r._promise(t,o,n):qt(function(){return r._promise(t,o,n)},{trans:r,transless:M.transless||M}):function w(h,l,y,m){if(h.idbdb&&(h._state.openComplete||M.letThrough||h._vip)){var p=h._createTransaction(l,y,h._dbSchema);try{p.create(),h._state.PR1398_maxLoop=3}catch(d){return d.name===pn.InvalidState&&h.isOpen()&&0<--h._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),h.close({disableAutoOpen:!1}),h.open().then(function(){return w(h,l,y,m)})):st(d)}return p._promise(l,function(d,_){return qt(function(){return M.trans=p,m(d,_,p)})}).then(function(d){if(l==="readwrite")try{p.idbtrans.commit()}catch{}return l==="readonly"?d:p._completion.then(function(){return d})})}if(h._state.openComplete)return st(new N.DatabaseClosed(h._state.dbOpenError));if(!h._state.isBeingOpened){if(!h._state.autoOpen)return st(new N.DatabaseClosed);h.open().catch(tt)}return h._state.dbReadyPromise.then(function(){return w(h,l,y,m)})}(this.db,t,[this.name],o);return i&&(f._consoleTask=i,f=f.catch(function(w){return console.trace(w),st(w)})),f}finally{s&&se()}},et.prototype.get=function(t,e){var n=this;return t&&t.constructor===Object?this.where(t).first(e):t==null?st(new N.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:t}).then(function(a){return n.hook.reading.fire(a)})}).then(e)},et.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(E(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var e=D(t);if(e.length===1)return this.where(e[0]).equals(t[e[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(s){if(s.compound&&e.every(function(w){return 0<=s.keyPath.indexOf(w)})){for(var f=0;f<e.length;++f)if(e.indexOf(s.keyPath[f])===-1)return!1;return!0}return!1}).sort(function(s,f){return s.keyPath.length-f.keyPath.length})[0];if(n&&this.db._maxKey!==Xt)return o=n.keyPath.slice(0,e.length),this.where(o).equals(o.map(function(s){return t[s]}));!n&&It&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(e.join("+"),"]"));var r=this.schema.idxByName;function a(s,f){return G(s,f)===0}var o=e.reduce(function(h,f){var w=h[0],h=h[1],l=r[f],y=t[f];return[w||l,w||!l?Jt(h,l&&l.multi?function(m){return m=bt(m,f),E(m)&&m.some(function(p){return a(y,p)})}:function(m){return a(y,bt(m,f))}):h]},[null,null]),i=o[0],o=o[1];return i?this.where(i.name).equals(t[i.keyPath]).filter(o):n?this.filter(o):this.where(e).equals("")},et.prototype.filter=function(t){return this.toCollection().and(t)},et.prototype.count=function(t){return this.toCollection().count(t)},et.prototype.offset=function(t){return this.toCollection().offset(t)},et.prototype.limit=function(t){return this.toCollection().limit(t)},et.prototype.each=function(t){return this.toCollection().each(t)},et.prototype.toArray=function(t){return this.toCollection().toArray(t)},et.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},et.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,E(t)?"[".concat(t.join("+"),"]"):t))},et.prototype.reverse=function(){return this.toCollection().reverse()},et.prototype.mapToClass=function(t){for(var e=this.db,n=this.name,r=((this.schema.mappedClass=t).prototype instanceof vr&&(t=(o=>{var s=h,f=o;if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function w(){this.constructor=s}function h(){return o!==null&&o.apply(this,arguments)||this}return c(s,f),s.prototype=f===null?Object.create(f):(w.prototype=f.prototype,new w),Object.defineProperty(h.prototype,"db",{get:function(){return e},enumerable:!1,configurable:!0}),h.prototype.table=function(){return n},h})(t)),new Set),a=t.prototype;a;a=R(a))Object.getOwnPropertyNames(a).forEach(function(o){return r.add(o)});function i(o){if(!o)return o;var s,f=Object.create(t.prototype);for(s in o)if(!r.has(s))try{f[s]=o[s]}catch{}return f}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=i,this.hook("reading",i),t},et.prototype.defineClass=function(){return this.mapToClass(function(t){K(this,t)})},et.prototype.add=function(t,e){var n=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=t;return i&&a&&(o=Ue(i)(t)),this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"add",keys:e!=null?[e]:null,values:[o]})}).then(function(s){return s.numFailures?$.reject(s.failures[0]):s.lastResult}).then(function(s){if(i)try{ot(t,i,s)}catch{}return s})},et.prototype.upsert=function(t,e){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(a){return n.core.get({trans:a,key:t}).then(function(i){var o=i??{};return _r(o,e),r&&ot(o,r,t),n.core.mutate({trans:a,type:"put",values:[o],keys:[t],upsert:!0,updates:{keys:[t],changeSpecs:[e]}}).then(function(s){return s.numFailures?$.reject(s.failures[0]):!!i})})})},et.prototype.update=function(t,e){return typeof t!="object"||E(t)?this.where(":id").equals(t).modify(e):(t=bt(t,this.schema.primKey.keyPath))===void 0?st(new N.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(t).modify(e)},et.prototype.put=function(t,e){var n=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=t;return i&&a&&(o=Ue(i)(t)),this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"put",values:[o],keys:e!=null?[e]:null})}).then(function(s){return s.numFailures?$.reject(s.failures[0]):s.lastResult}).then(function(s){if(i)try{ot(t,i,s)}catch{}return s})},et.prototype.delete=function(t){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"delete",keys:[t]}).then(function(r){return We(e,[t],r)}).then(function(r){return r.numFailures?$.reject(r.failures[0]):void 0})})},et.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:mr}).then(function(n){return We(t,null,n)})}).then(function(e){return e.numFailures?$.reject(e.failures[0]):void 0})},et.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",function(n){return e.core.getMany({keys:t,trans:n}).then(function(r){return r.map(function(a){return e.hook.reading.fire(a)})})})},et.prototype.bulkAdd=function(t,e,n){var r=this,a=Array.isArray(e)?e:void 0,i=(n=n||(a?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(o){var s=r.schema.primKey,w=s.auto,s=s.keyPath;if(s&&a)throw new N.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");var f=t.length,w=s&&w?t.map(Ue(s)):t;return r.core.mutate({trans:o,type:"add",keys:a,values:w,wantResults:i}).then(function(h){var l=h.numFailures,y=h.failures;if(l===0)return i?h.results:h.lastResult;throw new ie("".concat(r.name,".bulkAdd(): ").concat(l," of ").concat(f," operations failed"),y)})})},et.prototype.bulkPut=function(t,e,n){var r=this,a=Array.isArray(e)?e:void 0,i=(n=n||(a?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(o){var s=r.schema.primKey,w=s.auto,s=s.keyPath;if(s&&a)throw new N.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");var f=t.length,w=s&&w?t.map(Ue(s)):t;return r.core.mutate({trans:o,type:"put",keys:a,values:w,wantResults:i}).then(function(h){var l=h.numFailures,y=h.failures;if(l===0)return i?h.results:h.lastResult;throw new ie("".concat(r.name,".bulkPut(): ").concat(l," of ").concat(f," operations failed"),y)})})},et.prototype.bulkUpdate=function(t){var e=this,n=this.core,r=t.map(function(o){return o.key}),a=t.map(function(o){return o.changes}),i=[];return this._trans("readwrite",function(o){return n.getMany({trans:o,keys:r,cache:"clone"}).then(function(s){var f=[],w=[],h=(t.forEach(function(l,y){var m=l.key,p=l.changes,d=s[y];if(d){for(var _=0,k=Object.keys(p);_<k.length;_++){var b=k[_],x=p[b];if(b===e.schema.primKey.keyPath){if(G(x,m)!==0)throw new N.Constraint("Cannot update primary key in bulkUpdate()")}else ot(d,b,x)}i.push(y),f.push(m),w.push(d)}}),f.length);return n.mutate({trans:o,type:"put",keys:f,values:w,updates:{keys:r,changeSpecs:a}}).then(function(l){var y=l.numFailures,m=l.failures;if(y===0)return h;for(var p=0,d=Object.keys(m);p<d.length;p++){var _,k=d[p],b=i[Number(k)];b!=null&&(_=m[k],delete m[k],m[b]=_)}throw new ie("".concat(e.name,".bulkUpdate(): ").concat(y," of ").concat(h," operations failed"),m)})})})},et.prototype.bulkDelete=function(t){var e=this,n=t.length;return this._trans("readwrite",function(r){return e.core.mutate({trans:r,type:"delete",keys:t}).then(function(a){return We(e,t,a)})}).then(function(r){var a=r.numFailures,i=r.failures;if(a===0)return r.lastResult;throw new ie("".concat(e.name,".bulkDelete(): ").concat(a," of ").concat(n," operations failed"),i)})};var kr=et;function et(){}function Se(t){function e(o,s){if(s){for(var f=arguments.length,w=new Array(f-1);--f;)w[f-1]=arguments[f];return n[o].subscribe.apply(null,w),t}if(typeof o=="string")return n[o]}var n={};e.addEventType=i;for(var r=1,a=arguments.length;r<a;++r)i(arguments[r]);return e;function i(o,s,f){var w,h;if(typeof o!="object")return s=s||va,h={subscribers:[],fire:f=f||tt,subscribe:function(l){h.subscribers.indexOf(l)===-1&&(h.subscribers.push(l),h.fire=s(h.fire,l))},unsubscribe:function(l){h.subscribers=h.subscribers.filter(function(y){return y!==l}),h.fire=h.subscribers.reduce(s,f)}},n[o]=e[o]=h;D(w=o).forEach(function(l){var y=w[l];if(E(y))i(l,w[l][0],w[l][1]);else{if(y!=="asap")throw new N.InvalidArgument("Invalid event config");var m=i(l,ge,function(){for(var p=arguments.length,d=new Array(p);p--;)d[p]=arguments[p];m.subscribers.forEach(function(_){yt(function(){_.apply(null,d)})})})}})}}function De(t,e){return ft(e).from({prototype:t}),e}function le(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function En(t,e){t.filter=Jt(t.filter,e)}function Tn(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Jt(r(),e())}:e,t.justLimit=n&&!r}function Ve(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(n)return n;throw new N.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed")}function xr(t,e,n){var r=Ve(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function ze(t,e,n,r){var a,i,o=t.replayFilter?Jt(t.filter,t.replayFilter()):t.filter;return t.or?(a={},i=function(s,f,w){var h,l;o&&!o(f,w,function(y){return f.stop(y)},function(y){return f.fail(y)})||((l=""+(h=f.primaryKey))=="[object ArrayBuffer]"&&(l=""+new Uint8Array(h)),B(a,l))||(a[l]=!0,e(s,f,w))},Promise.all([t.or._iterate(i,n),Sr(xr(t,r,n),t.algorithm,i,!t.keysOnly&&t.valueMapper)])):Sr(xr(t,r,n),Jt(t.algorithm,o),e,!t.keysOnly&&t.valueMapper)}function Sr(t,e,n,r){var a=rt(r?function(i,o,s){return n(r(i),o,s)}:n);return t.then(function(i){if(i)return i.start(function(){var o=function(){return i.continue()};e&&!e(i,function(s){return o=s},function(s){i.stop(s),o=tt},function(s){i.fail(s),o=tt})||a(i.value,i,function(s){return o=s}),o()})})}X.prototype._read=function(t,e){var n=this._ctx;return n.error?n.table._trans(null,st.bind(null,n.error)):n.table._trans("readonly",t).then(e)},X.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,st.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},X.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Jt(e.algorithm,t)},X.prototype._iterate=function(t,e){return ze(this._ctx,t,e,this._ctx.table.core)},X.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&K(n,t),e._ctx=n,e},X.prototype.raw=function(){return this._ctx.valueMapper=null,this},X.prototype.each=function(t){var e=this._ctx;return this._read(function(n){return ze(e,t,n,e.table.core)})},X.prototype.count=function(t){var e=this;return this._read(function(n){var r,a=e._ctx,i=a.table.core;return le(a,!0)?i.count({trans:n,query:{index:Ve(a,i.schema),range:a.range}}).then(function(o){return Math.min(o,a.limit)}):(r=0,ze(a,function(){return++r,!1},n,i).then(function(){return r}))}).then(t)},X.prototype.sortBy=function(t,e){var n=t.split(".").reverse(),r=n[0],a=n.length-1;function i(f,w){return w?i(f[n[w]],w-1):f[r]}var o=this._ctx.dir==="next"?1:-1;function s(f,w){return G(i(f,a),i(w,a))*o}return this.toArray(function(f){return f.sort(s)}).then(e)},X.prototype.toArray=function(t){var e=this;return this._read(function(n){var r,a,i,o=e._ctx;return o.dir==="next"&&le(o,!0)&&0<o.limit?(r=o.valueMapper,a=Ve(o,o.table.core.schema),o.table.core.query({trans:n,limit:o.limit,values:!0,query:{index:a,range:o.range}}).then(function(s){return s=s.result,r?s.map(r):s})):(i=[],ze(o,function(s){return i.push(s)},n,o.table.core).then(function(){return i}))},t)},X.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,le(e)?Tn(e,function(){var n=t;return function(r,a){return n===0||(n===1?--n:a(function(){r.advance(n),n=0}),!1)}}):Tn(e,function(){var n=t;return function(){return--n<0}})),this},X.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Tn(this._ctx,function(){var e=t;return function(n,r,a){return--e<=0&&r(a),0<=e}},!0),this},X.prototype.until=function(t,e){return En(this._ctx,function(n,r,a){return!t(n.value)||(r(a),e)}),this},X.prototype.first=function(t){return this.limit(1).toArray(function(e){return e[0]}).then(t)},X.prototype.last=function(t){return this.reverse().first(t)},X.prototype.filter=function(t){var e;return En(this._ctx,function(n){return t(n.value)}),(e=this._ctx).isMatch=Jt(e.isMatch,t),this},X.prototype.and=function(t){return this.filter(t)},X.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},X.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},X.prototype.desc=function(){return this.reverse()},X.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(n,r){t(r.key,r)})},X.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},X.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(n,r){t(r.primaryKey,r)})},X.prototype.keys=function(t){var e=this._ctx,n=(e.keysOnly=!e.isMatch,[]);return this.each(function(r,a){n.push(a.key)}).then(function(){return n}).then(t)},X.prototype.primaryKeys=function(t){var e=this._ctx;if(e.dir==="next"&&le(e,!0)&&0<e.limit)return this._read(function(r){var a=Ve(e,e.table.core.schema);return e.table.core.query({trans:r,values:!1,limit:e.limit,query:{index:a,range:e.range}})}).then(function(r){return r.result}).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each(function(r,a){n.push(a.primaryKey)}).then(function(){return n}).then(t)},X.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},X.prototype.firstKey=function(t){return this.limit(1).keys(function(e){return e[0]}).then(t)},X.prototype.lastKey=function(t){return this.reverse().firstKey(t)},X.prototype.distinct=function(){var t,e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];return e&&e.multi&&(t={},En(this._ctx,function(r){var r=r.primaryKey.toString(),a=B(t,r);return t[r]=!0,!a})),this},X.prototype.modify=function(t){var e=this,n=this._ctx;return this._write(function(r){function a(d,_){var k=_.failures;y+=d-_.numFailures;for(var b=0,x=D(k);b<x.length;b++){var I=x[b];l.push(k[I])}}var i=typeof t=="function"?t:function(d){return _r(d,t)},o=n.table.core,h=o.schema.primaryKey,s=h.outbound,f=h.extractKey,w=200,h=e.db._options.modifyChunkSize,l=(h&&(w=typeof h=="object"?h[o.name]||h["*"]||200:h),[]),y=0,m=[],p=t===Dr;return e.clone().primaryKeys().then(function(d){function _(b){var x=Math.min(w,d.length-b),I=d.slice(b,b+x);return(p?Promise.resolve([]):o.getMany({trans:r,keys:I,cache:"immutable"})).then(function(A){var C=[],O=[],L=s?[]:null,j=p?I:[];if(!p)for(var P=0;P<x;++P){var q=A[P],Q={value:Wt(q),primKey:d[b+P]};i.call(Q,Q.value,Q)!==!1&&(Q.value==null?j.push(d[b+P]):s||G(f(q),f(Q.value))===0?(O.push(Q.value),s&&L.push(d[b+P])):(j.push(d[b+P]),C.push(Q.value)))}return Promise.resolve(0<C.length&&o.mutate({trans:r,type:"add",values:C}).then(function(J){for(var F in J.failures)j.splice(parseInt(F),1);a(C.length,J)})).then(function(){return(0<O.length||k&&typeof t=="object")&&o.mutate({trans:r,type:"put",keys:L,values:O,criteria:k,changeSpec:typeof t!="function"&&t,isAdditionalChunk:0<b}).then(function(J){return a(O.length,J)})}).then(function(){return(0<j.length||k&&p)&&o.mutate({trans:r,type:"delete",keys:j,criteria:k,isAdditionalChunk:0<b}).then(function(J){return We(n.table,j,J)}).then(function(J){return a(j.length,J)})}).then(function(){return d.length>b+x&&_(b+w)})})}var k=le(n)&&n.limit===1/0&&(typeof t!="function"||p)&&{index:n.index,range:n.range};return _(0).then(function(){if(0<l.length)throw new Ke("Error modifying one or more objects",l,y,m);return d.length})})})},X.prototype.delete=function(){var t=this._ctx,e=t.range;return!le(t)||t.table.schema.yProps||!t.isPrimKey&&e.type!==3?this.modify(Dr):this._write(function(n){var r=t.table.core.schema.primaryKey,a=e;return t.table.core.count({trans:n,query:{index:r,range:a}}).then(function(i){return t.table.core.mutate({trans:n,type:"deleteRange",range:a}).then(function(f){var s=f.failures,f=f.numFailures;if(f)throw new Ke("Could not delete some values",Object.keys(s).map(function(w){return s[w]}),i-f);return i-f})})})};var xa=X;function X(){}var Dr=function(t,e){return e.value=null};function Sa(t,e){return t<e?-1:t===e?0:1}function Da(t,e){return e<t?-1:t===e?0:1}function kt(t,e,n){return t=t instanceof Tr?new t.Collection(t):t,t._ctx.error=new(n||TypeError)(e),t}function de(t){return new t.Collection(t,function(){return Er("")}).limit(0)}function He(m,e,n,r){var a,i,o,s,f,w,h,l=n.length;if(!n.every(function(d){return typeof d=="string"}))return kt(m,yr);function y(d){a=d==="next"?function(k){return k.toUpperCase()}:function(k){return k.toLowerCase()},i=d==="next"?function(k){return k.toLowerCase()}:function(k){return k.toUpperCase()},o=d==="next"?Sa:Da;var _=n.map(function(k){return{lower:i(k),upper:a(k)}}).sort(function(k,b){return o(k.lower,b.lower)});s=_.map(function(k){return k.upper}),f=_.map(function(k){return k.lower}),h=(w=d)==="next"?"":r}y("next");var m=new m.Collection(m,function(){return Bt(s[0],f[l-1]+r)}),p=(m._ondirectionchange=function(d){y(d)},0);return m._addAlgorithm(function(d,_,k){var b=d.key;if(typeof b=="string"){var x=i(b);if(e(x,f,p))return!0;for(var I=null,A=p;A<l;++A){var C=((O,L,j,P,q,Q)=>{for(var J=Math.min(O.length,P.length),F=-1,z=0;z<J;++z){var at=L[z];if(at!==P[z])return q(O[z],j[z])<0?O.substr(0,z)+j[z]+j.substr(z+1):q(O[z],P[z])<0?O.substr(0,z)+P[z]+j.substr(z+1):0<=F?O.substr(0,F)+L[F]+j.substr(F+1):null;q(O[z],at)<0&&(F=z)}return J<P.length&&Q==="next"?O+j.substr(O.length):J<O.length&&Q==="prev"?O.substr(0,j.length):F<0?null:O.substr(0,F)+P[F]+j.substr(F+1)})(b,x,s[A],f[A],o,w);C===null&&I===null?p=A+1:(I===null||0<o(I,C))&&(I=C)}_(I!==null?function(){d.continue(I+h)}:k)}return!1}),m}function Bt(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Er(t){return{type:1,lower:t,upper:t}}Object.defineProperty(pt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),pt.prototype.between=function(t,e,n,r){n=n!==!1,r=r===!0;try{return 0<this._cmp(t,e)||this._cmp(t,e)===0&&(n||r)&&(!n||!r)?de(this):new this.Collection(this,function(){return Bt(t,e,!n,!r)})}catch{return kt(this,Kt)}},pt.prototype.equals=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Er(t)})},pt.prototype.above=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(t,void 0,!0)})},pt.prototype.aboveOrEqual=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(t,void 0,!1)})},pt.prototype.below=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(void 0,t,!1,!0)})},pt.prototype.belowOrEqual=function(t){return t==null?kt(this,Kt):new this.Collection(this,function(){return Bt(void 0,t)})},pt.prototype.startsWith=function(t){return typeof t!="string"?kt(this,yr):this.between(t,t+Xt,!0,!0)},pt.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):He(this,function(e,n){return e.indexOf(n[0])===0},[t],Xt)},pt.prototype.equalsIgnoreCase=function(t){return He(this,function(e,n){return e===n[0]},[t],"")},pt.prototype.anyOfIgnoreCase=function(){var t=At.apply(re,arguments);return t.length===0?de(this):He(this,function(e,n){return n.indexOf(e)!==-1},t,"")},pt.prototype.startsWithAnyOfIgnoreCase=function(){var t=At.apply(re,arguments);return t.length===0?de(this):He(this,function(e,n){return n.some(function(r){return e.indexOf(r)===0})},t,Xt)},pt.prototype.anyOf=function(){var t,e,n=this,r=At.apply(re,arguments),a=this._cmp;try{r.sort(a)}catch{return kt(this,Kt)}return r.length===0?de(this):((t=new this.Collection(this,function(){return Bt(r[0],r[r.length-1])}))._ondirectionchange=function(i){a=i==="next"?n._ascending:n._descending,r.sort(a)},e=0,t._addAlgorithm(function(i,o,s){for(var f=i.key;0<a(f,r[e]);)if(++e===r.length)return o(s),!1;return a(f,r[e])===0||(o(function(){i.continue(r[e])}),!1)}),t)},pt.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},pt.prototype.noneOf=function(){var t=At.apply(re,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return kt(this,Kt)}var e=t.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},pt.prototype.inAnyRange=function(t,k){var n=this,r=this._cmp,a=this._ascending,i=this._descending,o=this._min,s=this._max;if(t.length===0)return de(this);if(!t.every(function(b){return b[0]!==void 0&&b[1]!==void 0&&a(b[0],b[1])<=0}))return kt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",N.InvalidArgument);var f=!k||k.includeLowers!==!1,w=k&&k.includeUppers===!0,h,l=a;function y(b,x){return l(b[0],x[0])}try{(h=t.reduce(function(b,x){for(var I=0,A=b.length;I<A;++I){var C=b[I];if(r(x[0],C[1])<0&&0<r(x[1],C[0])){C[0]=o(C[0],x[0]),C[1]=s(C[1],x[1]);break}}return I===A&&b.push(x),b},[])).sort(y)}catch{return kt(this,Kt)}var m=0,p=w?function(b){return 0<a(b,h[m][1])}:function(b){return 0<=a(b,h[m][1])},d=f?function(b){return 0<i(b,h[m][0])}:function(b){return 0<=i(b,h[m][0])},_=p,k=new this.Collection(this,function(){return Bt(h[0][0],h[h.length-1][1],!f,!w)});return k._ondirectionchange=function(b){l=b==="next"?(_=p,a):(_=d,i),h.sort(y)},k._addAlgorithm(function(b,x,I){for(var A,C=b.key;_(C);)if(++m===h.length)return x(I),!1;return!p(A=C)&&!d(A)||(n._cmp(C,h[m][1])===0||n._cmp(C,h[m][0])===0||x(function(){l===a?b.continue(h[m][0]):b.continue(h[m][1])}),!1)}),k},pt.prototype.startsWithAnyOf=function(){var t=At.apply(re,arguments);return t.every(function(e){return typeof e=="string"})?t.length===0?de(this):this.inAnyRange(t.map(function(e){return[e,e+Xt]})):kt(this,"startsWithAnyOf() only works with strings")};var Tr=pt;function pt(){}function Ot(t){return rt(function(e){return Ee(e),t(e.target.error),!1})}function Ee(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Te="storagemutated",In="x-storagemutated-1",Nt=Se(null,Te),Ea=(Pt.prototype._lock=function(){return xt(!M.global),++this._reculock,this._reculock!==1||M.global||(M.lockOwnerFor=this),this},Pt.prototype._unlock=function(){if(xt(!M.global),--this._reculock==0)for(M.global||(M.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var t=this._blockedFuncs.shift();try{Qt(t[1],t[0])}catch{}}return this},Pt.prototype._locked=function(){return this._reculock&&M.lockOwnerFor!==this},Pt.prototype.create=function(t){var e=this;if(this.mode){var n=this.db.idbdb,r=this.db._state.dbOpenError;if(xt(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new N.DatabaseClosed(r);case"MissingAPIError":throw new N.MissingAPI(r.message,r);default:throw new N.OpenFailed(r)}if(!this.active)throw new N.TransactionInactive;xt(this._completion._state===null),(t=this.idbtrans=t||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=rt(function(a){Ee(a),e._reject(t.error)}),t.onabort=rt(function(a){Ee(a),e.active&&e._reject(new N.Abort(t.error)),e.active=!1,e.on("abort").fire(a)}),t.oncomplete=rt(function(){e.active=!1,e._resolve(),"mutatedParts"in t&&Nt.storagemutated.fire(t.mutatedParts)})}return this},Pt.prototype._promise=function(t,e,n){var r,a=this;return t==="readwrite"&&this.mode!=="readwrite"?st(new N.ReadOnly("Transaction is readonly")):this.active?this._locked()?new $(function(i,o){a._blockedFuncs.push([function(){a._promise(t,e,n).then(i,o)},M])}):n?qt(function(){var i=new $(function(o,s){a._lock();var f=e(o,s,a);f&&f.then&&f.then(o,s)});return i.finally(function(){return a._unlock()}),i._lib=!0,i}):((r=new $(function(i,o){var s=e(i,o,a);s&&s.then&&s.then(i,o)}))._lib=!0,r):st(new N.TransactionInactive)},Pt.prototype._root=function(){return this.parent?this.parent._root():this},Pt.prototype.waitFor=function(t){var e,n=this._root(),r=$.resolve(t),a=(n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],e=n.idbtrans.objectStore(n.storeNames[0]),function i(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(e.get(-1/0).onsuccess=i)}()),n._waitingFor);return new $(function(i,o){r.then(function(s){return n._waitingQueue.push(rt(i.bind(null,s)))},function(s){return n._waitingQueue.push(rt(o.bind(null,s)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},Pt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new N.Abort))},Pt.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(B(e,t))return e[t];var n=this.schema[t];if(n)return(n=new this.db.Table(t,n,this)).core=this.db.core.table(t),e[t]=n;throw new N.NotFound("Table "+t+" not part of transaction")},Pt);function Pt(){}function On(t,e,n,r,a,i,o,s){return{name:t,keyPath:e,unique:n,multi:r,auto:a,compound:i,src:(n&&!o?"&":"")+(r?"*":"")+(a?"++":"")+Ir(e),type:s}}function Ir(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Pn(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:(r=function(a){return[a.name,a]},n.reduce(function(a,i,o){return i=r(i,o),i&&(a[i[0]]=i[1]),a},{}))};var r}var Ie=function(t){try{return t.only([[]]),Ie=function(){return[[]]},[[]]}catch{return Ie=function(){return Xt},Xt}};function An(t){return t==null?function(){}:typeof t=="string"?(e=t).split(".").length===1?function(n){return n[e]}:function(n){return bt(n,e)}:function(n){return bt(n,t)};var e}function Or(t){return[].slice.call(t)}var Ta=0;function Oe(t){return t==null?":id":typeof t=="string"?t:"[".concat(t.join("+"),"]")}function Ia(t,e,f){function r(p){if(p.type===3)return null;if(p.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var l=p.lower,y=p.upper,m=p.lowerOpen,p=p.upperOpen;return l===void 0?y===void 0?null:e.upperBound(y,!!p):y===void 0?e.lowerBound(l,!!m):e.bound(l,y,!!m,!!p)}function a(h){var l,y=h.name;return{name:y,schema:h,mutate:function(m){var p=m.trans,d=m.type,_=m.keys,k=m.values,b=m.range;return new Promise(function(x,I){x=rt(x);var A=p.objectStore(y),C=A.keyPath==null,O=d==="put"||d==="add";if(!O&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);var L,j=(_||k||{length:1}).length;if(_&&k&&_.length!==k.length)throw new Error("Given keys array must have same length as given values array.");if(j===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});function P(it){++J,Ee(it)}var q=[],Q=[],J=0;if(d==="deleteRange"){if(b.type===4)return x({numFailures:J,failures:Q,results:[],lastResult:void 0});b.type===3?q.push(L=A.clear()):q.push(L=A.delete(r(b)))}else{var C=O?C?[k,_]:[k,null]:[_,null],F=C[0],z=C[1];if(O)for(var at=0;at<j;++at)q.push(L=z&&z[at]!==void 0?A[d](F[at],z[at]):A[d](F[at])),L.onerror=P;else for(at=0;at<j;++at)q.push(L=A[d](F[at])),L.onerror=P}function St(it){it=it.target.result,q.forEach(function(ee,Gn){return ee.error!=null&&(Q[Gn]=ee.error)}),x({numFailures:J,failures:Q,results:d==="delete"?_:q.map(function(ee){return ee.result}),lastResult:it})}L.onerror=function(it){P(it),St(it)},L.onsuccess=St})},getMany:function(m){var p=m.trans,d=m.keys;return new Promise(function(_,k){_=rt(_);for(var b,x=p.objectStore(y),I=d.length,A=new Array(I),C=0,O=0,L=function(q){q=q.target,A[q._pos]=q.result,++O===C&&_(A)},j=Ot(k),P=0;P<I;++P)d[P]!=null&&((b=x.get(d[P]))._pos=P,b.onsuccess=L,b.onerror=j,++C);C===0&&_(A)})},get:function(m){var p=m.trans,d=m.key;return new Promise(function(_,k){_=rt(_);var b=p.objectStore(y).get(d);b.onsuccess=function(x){return _(x.target.result)},b.onerror=Ot(k)})},query:(l=s,function(m){return new Promise(function(p,d){p=rt(p);var _,k,b,O=m.trans,x=m.values,I=m.limit,C=m.query,A=I===1/0?void 0:I,L=C.index,C=C.range,O=O.objectStore(y),O=L.isPrimaryKey?O:O.index(L.name),L=r(C);if(I===0)return p({result:[]});l?((C=x?O.getAll(L,A):O.getAllKeys(L,A)).onsuccess=function(j){return p({result:j.target.result})},C.onerror=Ot(d)):(_=0,k=!x&&"openKeyCursor"in O?O.openKeyCursor(L):O.openCursor(L),b=[],k.onsuccess=function(j){var P=k.result;return!P||(b.push(x?P.value:P.primaryKey),++_===I)?p({result:b}):void P.continue()},k.onerror=Ot(d))})}),openCursor:function(m){var p=m.trans,d=m.values,_=m.query,k=m.reverse,b=m.unique;return new Promise(function(x,I){x=rt(x);var O=_.index,A=_.range,C=p.objectStore(y),C=O.isPrimaryKey?C:C.index(O.name),O=k?b?"prevunique":"prev":b?"nextunique":"next",L=!d&&"openKeyCursor"in C?C.openKeyCursor(r(A),O):C.openCursor(r(A),O);L.onerror=Ot(I),L.onsuccess=rt(function(j){var P,q,Q,J,F=L.result;F?(F.___id=++Ta,F.done=!1,P=F.continue.bind(F),q=(q=F.continuePrimaryKey)&&q.bind(F),Q=F.advance.bind(F),J=function(){throw new Error("Cursor not stopped")},F.trans=p,F.stop=F.continue=F.continuePrimaryKey=F.advance=function(){throw new Error("Cursor not started")},F.fail=rt(I),F.next=function(){var z=this,at=1;return this.start(function(){return at--?z.continue():z.stop()}).then(function(){return z})},F.start=function(z){function at(){if(L.result)try{z()}catch(it){F.fail(it)}else F.done=!0,F.start=function(){throw new Error("Cursor behind last entry")},F.stop()}var St=new Promise(function(it,ee){it=rt(it),L.onerror=Ot(ee),F.fail=ee,F.stop=function(Gn){F.stop=F.continue=F.continuePrimaryKey=F.advance=J,it(Gn)}});return L.onsuccess=rt(function(it){L.onsuccess=at,at()}),F.continue=P,F.continuePrimaryKey=q,F.advance=Q,at(),St},x(F)):x(null)},I)})},count:function(m){var p=m.query,d=m.trans,_=p.index,k=p.range;return new Promise(function(b,x){var I=d.objectStore(y),I=_.isPrimaryKey?I:I.index(_.name),A=r(k),A=A?I.count(A):I.count();A.onsuccess=rt(function(C){return b(C.target.result)}),A.onerror=Ot(x)})}}}i=f,o=Or((f=t).objectStoreNames);var i,f={schema:{name:f.name,tables:o.map(function(h){return i.objectStore(h)}).map(function(h){var l=h.keyPath,y=h.autoIncrement,p=E(l),m={},p={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:l==null,compound:p,keyPath:l,autoIncrement:y,unique:!0,extractKey:An(l)},indexes:Or(h.indexNames).map(function(d){return h.index(d)}).map(function(b){var x=b.name,_=b.unique,k=b.multiEntry,b=b.keyPath,x={name:x,compound:E(b),keyPath:b,unique:_,multiEntry:k,extractKey:An(b)};return m[Oe(b)]=x}),getIndexByKeyPath:function(d){return m[Oe(d)]}};return m[":id"]=p.primaryKey,l!=null&&(m[Oe(l)]=p.primaryKey),p})},hasGetAll:0<o.length&&"getAll"in i.objectStore(o[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},o=f.schema,s=f.hasGetAll,f=o.tables.map(a),w={};return f.forEach(function(h){return w[h.name]=h}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(h){if(w[h])return w[h];throw new Error("Table '".concat(h,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Ie(e),schema:o}}function Oa(t,e,n,r){return n=n.IDBKeyRange,e=Ia(e,n,r),{dbcore:t.dbcore.reduce(function(a,i){return i=i.create,g(g({},a),i(a))},e)}}function Ye(t,e){var n=e.db,n=Oa(t._middlewares,n,t._deps,e);t.core=n.dbcore,t.tables.forEach(function(r){var a=r.name;t.core.schema.tables.some(function(i){return i.name===a})&&(r.core=t.core.table(a),t[a]instanceof t.Table)&&(t[a].core=r.core)})}function Ge(t,e,n,r){n.forEach(function(a){var i=r[a];e.forEach(function(o){var s=function f(w,h){return vt(w,h)||(w=R(w))&&f(w,h)}(o,a);(!s||"value"in s&&s.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?Z(o,a,{get:function(){return this.table(a)},set:function(f){U(this,a,{value:f,writable:!0,configurable:!0,enumerable:!0})}}):o[a]=new t.Table(a,i))})})}function Cn(t,e){e.forEach(function(n){for(var r in n)n[r]instanceof t.Table&&delete n[r]})}function Pa(t,e){return t._cfg.version-e._cfg.version}function Aa(t,e,n,r){var a=t._dbSchema,i=(n.objectStoreNames.contains("$meta")&&!a.$meta&&(a.$meta=Pn("$meta",Ar("")[0],[]),t._storeNames.push("$meta")),t._createTransaction("readwrite",t._storeNames,a)),o=(i.create(n),i._completion.catch(r),i._reject.bind(i)),s=M.transless||M;qt(function(){if(M.trans=i,M.transless=s,e!==0)return Ye(t,n),w=e,((f=i).storeNames.includes("$meta")?f.table("$meta").get("version").then(function(h){return h??w}):$.resolve(w)).then(function(_){var l=t,y=_,m=i,p=n,d=[],_=l._versions,k=l._dbSchema=Xe(0,l.idbdb,p);return(_=_.filter(function(b){return b._cfg.version>=y})).length===0?$.resolve():(_.forEach(function(b){d.push(function(){var x,I,A,C=k,O=b._cfg.dbschema,L=(Je(l,C,p),Je(l,O,p),k=l._dbSchema=O,Kn(C,O)),j=(L.add.forEach(function(P){$n(p,P[0],P[1].primKey,P[1].indexes)}),L.change.forEach(function(P){if(P.recreate)throw new N.Upgrade("Not yet support for changing primary key");var q=p.objectStore(P.name);P.add.forEach(function(Q){return Qe(q,Q)}),P.change.forEach(function(Q){q.deleteIndex(Q.name),Qe(q,Q)}),P.del.forEach(function(Q){return q.deleteIndex(Q)})}),b._cfg.contentUpgrade);if(j&&b._cfg.version>y)return Ye(l,p),m._memoizedTables={},x=dt(O),L.del.forEach(function(P){x[P]=C[P]}),Cn(l,[l.Transaction.prototype]),Ge(l,[l.Transaction.prototype],D(x),x),m.schema=x,(I=hn(j))&&ue(),O=$.follow(function(){var P;(A=j(m))&&I&&(P=Rt.bind(null,null),A.then(P,P))}),A&&typeof A.then=="function"?$.resolve(A):O.then(function(){return A})}),d.push(function(x){var I,A,C=b._cfg.dbschema;I=C,A=x,[].slice.call(A.db.objectStoreNames).forEach(function(O){return I[O]==null&&A.db.deleteObjectStore(O)}),Cn(l,[l.Transaction.prototype]),Ge(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),m.schema=l._dbSchema}),d.push(function(x){l.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(l.idbdb.version/10)===b._cfg.version?(l.idbdb.deleteObjectStore("$meta"),delete l._dbSchema.$meta,l._storeNames=l._storeNames.filter(function(I){return I!=="$meta"})):x.objectStore("$meta").put(b._cfg.version,"version"))})}),function b(){return d.length?$.resolve(d.shift()(m.idbtrans)).then(b):$.resolve()}().then(function(){Pr(k,p)}))}).catch(o);var f,w;D(a).forEach(function(h){$n(n,h,a[h].primKey,a[h].indexes)}),Ye(t,n),$.follow(function(){return t.on.populate.fire(i)}).catch(o)})}function Ca(t,e){Pr(t._dbSchema,e),e.db.version%10!=0||e.objectStoreNames.contains("$meta")||e.db.createObjectStore("$meta").add(Math.ceil(e.db.version/10-1),"version");var n=Xe(0,t.idbdb,e);Je(t,t._dbSchema,e);for(var r=0,a=Kn(n,t._dbSchema).change;r<a.length;r++){var i=(o=>{if(o.change.length||o.recreate)return console.warn("Unable to patch indexes of table ".concat(o.name," because it has changes on the type of index or primary key.")),{value:void 0};var s=e.objectStore(o.name);o.add.forEach(function(f){It&&console.debug("Dexie upgrade patch: Creating missing index ".concat(o.name,".").concat(f.src)),Qe(s,f)})})(a[r]);if(typeof i=="object")return i.value}}function Kn(t,e){var n,r={del:[],add:[],change:[]};for(n in t)e[n]||r.del.push(n);for(n in e){var a=t[n],i=e[n];if(a){var o={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||a.primKey.auto!==i.primKey.auto)o.recreate=!0,r.change.push(o);else{var s=a.idxByName,f=i.idxByName,w=void 0;for(w in s)f[w]||o.del.push(w);for(w in f){var h=s[w],l=f[w];h?h.src!==l.src&&o.change.push(l):o.add.push(l)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([n,i])}return r}function $n(t,e,n,r){var a=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});r.forEach(function(i){return Qe(a,i)})}function Pr(t,e){D(t).forEach(function(n){e.db.objectStoreNames.contains(n)||(It&&console.debug("Dexie: Creating missing table",n),$n(e,n,t[n].primKey,t[n].indexes))})}function Qe(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Xe(t,e,n){var r={};return Tt(e.objectStoreNames,0).forEach(function(a){for(var i=n.objectStore(a),o=On(Ir(w=i.keyPath),w||"",!0,!1,!!i.autoIncrement,w&&typeof w!="string",!0),s=[],f=0;f<i.indexNames.length;++f){var h=i.index(i.indexNames[f]),w=h.keyPath,h=On(h.name,w,!!h.unique,!!h.multiEntry,!1,w&&typeof w!="string",!1);s.push(h)}r[a]=Pn(a,o,s)}),r}function Je(t,e,n){for(var r=n.db.objectStoreNames,a=0;a<r.length;++a){var i=r[a],o=n.objectStore(i);t._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var f,w=o.indexNames[s],h=o.index(w).keyPath,h=typeof h=="string"?h:"["+Tt(h).join("+")+"]";e[i]&&(f=e[i].idxByName[h])&&(f.name=w,delete e[i].idxByName[h],e[i].idxByName[w]=f)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&S.WorkerGlobalScope&&S instanceof S.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function Ar(t){return t.split(",").map(function(e,n){var a=e.split(":"),r=(r=a[1])==null?void 0:r.trim(),a=(e=a[0].trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return On(a,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),E(i),n===0,r)})}fe.prototype._createTableSchema=Pn,fe.prototype._parseIndexSyntax=Ar,fe.prototype._parseStoresSpec=function(t,e){var n=this;D(t).forEach(function(r){if(t[r]!==null){var a=n._parseIndexSyntax(t[r]),i=a.shift();if(!i)throw new N.Schema("Invalid schema for table "+r+": "+t[r]);if(i.unique=!0,i.multi)throw new N.Schema("Primary key cannot be multiEntry*");a.forEach(function(o){if(o.auto)throw new N.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new N.Schema("Index must have a name and cannot be an empty string")}),i=n._createTableSchema(r,i,a),e[r]=i}})},fe.prototype.stores=function(n){var e=this.db,n=(this._cfg.storesSource=this._cfg.storesSource?K(this._cfg.storesSource,n):n,e._versions),r={},a={};return n.forEach(function(i){K(r,i._cfg.storesSource),a=i._cfg.dbschema={},i._parseStoresSpec(r,a)}),e._dbSchema=a,Cn(e,[e._allTables,e,e.Transaction.prototype]),Ge(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],D(a),a),e._storeNames=D(a),this},fe.prototype.upgrade=function(t){return this._cfg.contentUpgrade=yn(this._cfg.contentUpgrade||tt,t),this};var Ka=fe;function fe(){}function jn(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new $t(Fe,{addons:[],indexedDB:t,IDBKeyRange:e})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Ln(t){return t&&typeof t.databases=="function"}function qn(t){return qt(function(){return M.letThrough=!0,t()})}function Rn(t){return!("from"in t)}var mt=function(t,e){var n;if(!this)return n=new mt,t&&"d"in t&&K(n,t),n;K(this,arguments.length?{d:1,from:t,to:1<arguments.length?e:t}:{d:0})};function Pe(t,e,n){var r=G(e,n);if(!isNaN(r)){if(0<r)throw RangeError();if(Rn(t))return K(t,{from:e,to:n,d:1});var r=t.l,a=t.r;if(G(n,t.from)<0)return r?Pe(r,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Kr(t);if(0<G(e,t.to))return a?Pe(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Kr(t);G(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),0<G(n,t.to)&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1),e=!t.r,r&&!t.l&&Ae(t,r),a&&e&&Ae(t,a)}}function Ae(t,e){Rn(e)||function n(r,a){var i=a.from,o=a.l,s=a.r;Pe(r,i,a.to),o&&n(r,o),s&&n(r,s)}(t,e)}function Cr(t,e){var n=Ze(e),r=n.next();if(!r.done)for(var a=r.value,i=Ze(t),o=i.next(a.from),s=o.value;!r.done&&!o.done;){if(G(s.from,a.to)<=0&&0<=G(s.to,a.from))return!0;G(a.from,s.from)<0?a=(r=n.next(s.from)).value:s=(o=i.next(a.from)).value}return!1}function Ze(t){var e=Rn(t)?null:{s:0,n:t};return{next:function(n){for(var r=0<arguments.length;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&G(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||G(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Kr(t){var e,n,r,a=(((a=t.r)==null?void 0:a.d)||0)-(((a=t.l)==null?void 0:a.d)||0),a=1<a?"r":a<-1?"l":"";a&&(e=a=="r"?"l":"r",n=g({},t),r=t[a],t.from=r.from,t.to=r.to,t[a]=r[a],n[a]=r[e],(t[e]=n).d=$r(n)),t.d=$r(t)}function $r(n){var e=n.r,n=n.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}function tn(t,e){return D(e).forEach(function(n){t[n]?Ae(t[n],e[n]):t[n]=function r(a){var i,o,s={};for(i in a)B(a,i)&&(o=a[i],s[i]=!o||typeof o!="object"||or.has(o.constructor)?o:r(o));return s}(e[n])}),t}function Mn(t,e){return t.all||e.all||Object.keys(t).some(function(n){return e[n]&&Cr(e[n],t[n])})}V(mt.prototype,((_t={add:function(t){return Ae(this,t),this},addKey:function(t){return Pe(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return Pe(e,n,n)}),this},hasKey:function(t){var e=Ze(this).next(t).value;return e&&G(e.from,t)<=0&&0<=G(e.to,t)}})[fn]=function(){return Ze(this)},_t));var Zt={},Bn={},Nn=!1;function en(t){tn(Bn,t),Nn||(Nn=!0,setTimeout(function(){Nn=!1,Fn(Bn,!(Bn={}))},0))}function Fn(t,e){e===void 0&&(e=!1);var n=new Set;if(t.all)for(var r=0,a=Object.values(Zt);r<a.length;r++)jr(s=a[r],t,n,e);else for(var i in t){var o,s,i=/^idb\:\/\/(.*)\/(.*)\//.exec(i);i&&(o=i[1],i=i[2],s=Zt["idb://".concat(o,"/").concat(i)])&&jr(s,t,n,e)}n.forEach(function(f){return f()})}function jr(t,e,n,r){for(var a=[],i=0,o=Object.entries(t.queries.query);i<o.length;i++){for(var s=o[i],f=s[0],w=[],h=0,l=s[1];h<l.length;h++){var y=l[h];Mn(e,y.obsSet)?y.subscribers.forEach(function(_){return n.add(_)}):r&&w.push(y)}r&&a.push([f,w])}if(r)for(var m=0,p=a;m<p.length;m++){var d=p[m],f=d[0],w=d[1];t.queries.query[f]=w}}function $a(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?st(e.dbOpenError):t});e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller,a=Math.round(10*t.verno),i=!1;function o(){if(e.openCanceller!==r)throw new N.DatabaseClosed("db.open() was cancelled")}function s(){return new $(function(y,m){if(o(),!n)throw new N.MissingAPI;var p=t.name,d=e.autoSchema||!a?n.open(p):n.open(p,a);if(!d)throw new N.MissingAPI;d.onerror=Ot(m),d.onblocked=rt(t._fireOnBlocked),d.onupgradeneeded=rt(function(_){var k;h=d.transaction,e.autoSchema&&!t._options.allowEmptyDB?(d.onerror=Ee,h.abort(),d.result.close(),(k=n.deleteDatabase(p)).onsuccess=k.onerror=rt(function(){m(new N.NoSuchDatabase("Database ".concat(p," doesnt exist")))})):(h.onerror=Ot(m),k=_.oldVersion>Math.pow(2,62)?0:_.oldVersion,l=k<1,t.idbdb=d.result,i&&Ca(t,h),Aa(t,k/10,h,m))},m),d.onsuccess=rt(function(){h=null;var _,k,b,x,I,A,C=t.idbdb=d.result,O=Tt(C.objectStoreNames);if(0<O.length)try{var L=C.transaction((I=O).length===1?I[0]:I,"readonly");if(e.autoSchema)A=C,x=L,(b=t).verno=A.version/10,x=b._dbSchema=Xe(0,A,x),b._storeNames=Tt(A.objectStoreNames,0),Ge(b,[b._allTables],D(x),x);else if(Je(t,t._dbSchema,L),k=L,((k=Kn(Xe(0,(_=t).idbdb,k),_._dbSchema)).add.length||k.change.some(function(j){return j.add.length||j.change.length}))&&!i)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),C.close(),a=C.version+1,i=!0,y(s());Ye(t,L)}catch{}ce.push(t),C.onversionchange=rt(function(j){e.vcFired=!0,t.on("versionchange").fire(j)}),C.onclose=rt(function(){t.close({disableAutoOpen:!1})}),l&&(O=t._deps,I=p,Ln(A=O.indexedDB)||I===Fe||jn(A,O.IDBKeyRange).put({name:I}).catch(tt)),y()},m)}).catch(function(y){switch(y==null?void 0:y.name){case"UnknownError":if(0<e.PR1398_maxLoop)return e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),s();break;case"VersionError":if(0<a)return a=0,s()}return $.reject(y)})}var f,w=e.dbReadyResolve,h=null,l=!1;return $.race([r,(typeof navigator>"u"?$.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(y){function m(){return indexedDB.databases().finally(y)}f=setInterval(m,100),m()}).finally(function(){return clearInterval(f)}):Promise.resolve()).then(s)]).then(function(){return o(),e.onReadyBeingFired=[],$.resolve(qn(function(){return t.on.ready.fire(t.vip)})).then(function y(){var m;if(0<e.onReadyBeingFired.length)return m=e.onReadyBeingFired.reduce(yn,tt),e.onReadyBeingFired=[],$.resolve(qn(function(){return m(t.vip)})).then(y)})}).finally(function(){e.openCanceller===r&&(e.onReadyBeingFired=null,e.isBeingOpened=!1)}).catch(function(y){e.dbOpenError=y;try{h&&h.abort()}catch{}return r===e.openCanceller&&t._close(),st(y)}).finally(function(){e.openComplete=!0,w()}).then(function(){var y;return l&&(y={},t.tables.forEach(function(m){m.schema.indexes.forEach(function(p){p.name&&(y["idb://".concat(t.name,"/").concat(m.name,"/").concat(p.name)]=new mt(-1/0,[[[]]]))}),y["idb://".concat(t.name,"/").concat(m.name,"/")]=y["idb://".concat(t.name,"/").concat(m.name,"/:dels")]=new mt(-1/0,[[[]]])}),Nt(Te).fire(y),Fn(y,!0)),t})}function Un(t){function e(i){return t.next(i)}var n=a(e),r=a(function(i){return t.throw(i)});function a(i){return function(s){var s=i(s),f=s.value;return s.done?f:f&&typeof f.then=="function"?f.then(n,r):E(f)?Promise.all(f).then(n,r):n(f)}}return a(e)()}function nn(t,e,n){for(var r=E(t)?t.slice():[t],a=0;a<n;++a)r.push(e);return r}var ja={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return g(g({},t),{table:function(r){var n=t.table(r),r=n.schema,a={},i=[];function o(y,m,p){var b=Oe(y),d=a[b]=a[b]||[],_=y==null?0:typeof y=="string"?1:y.length,k=0<m,b=g(g({},p),{name:k?"".concat(b,"(virtual-from:").concat(p.name,")"):p.name,lowLevelIndex:p,isVirtual:k,keyTail:m,keyLength:_,extractKey:An(y),unique:!k&&p.unique});return d.push(b),b.isPrimaryKey||i.push(b),1<_&&o(_===2?y[0]:y.slice(0,_-1),m+1,p),d.sort(function(x,I){return x.keyTail-I.keyTail}),b}var s=o(r.primaryKey.keyPath,0,r.primaryKey);a[":id"]=[s];for(var f=0,w=r.indexes;f<w.length;f++){var h=w[f];o(h.keyPath,0,h)}function l(y){var m,p=y.query.index;return p.isVirtual?g(g({},y),{query:{index:p.lowLevelIndex,range:(m=y.query.range,p=p.keyTail,{type:m.type===1?2:m.type,lower:nn(m.lower,m.lowerOpen?t.MAX_KEY:t.MIN_KEY,p),lowerOpen:!0,upper:nn(m.upper,m.upperOpen?t.MIN_KEY:t.MAX_KEY,p),upperOpen:!0})}}):y}return g(g({},n),{schema:g(g({},r),{primaryKey:s,indexes:i,getIndexByKeyPath:function(y){return(y=a[Oe(y)])&&y[0]}}),count:function(y){return n.count(l(y))},query:function(y){return n.query(l(y))},openCursor:function(y){var m=y.query.index,p=m.keyTail,d=m.keyLength;return m.isVirtual?n.openCursor(l(y)).then(function(k){return k&&_(k)}):n.openCursor(y);function _(k){return Object.create(k,{continue:{value:function(b){b!=null?k.continue(nn(b,y.reverse?t.MAX_KEY:t.MIN_KEY,p)):y.unique?k.continue(k.key.slice(0,d).concat(y.reverse?t.MIN_KEY:t.MAX_KEY,p)):k.continue()}},continuePrimaryKey:{value:function(b,x){k.continuePrimaryKey(nn(b,t.MAX_KEY,p),x)}},primaryKey:{get:function(){return k.primaryKey}},key:{get:function(){var b=k.key;return d===1?b[0]:b.slice(0,d)}},value:{get:function(){return k.value}}})}}})}})}};function Wn(t,e,n,r){return n=n||{},r=r||"",D(t).forEach(function(a){var i,o,s;B(e,a)?(i=t[a],o=e[a],typeof i=="object"&&typeof o=="object"&&i&&o?(s=dn(i))!==dn(o)?n[r+a]=e[a]:s==="Object"?Wn(i,o,n,r+a+"."):i!==o&&(n[r+a]=e[a]):i!==o&&(n[r+a]=e[a])):n[r+a]=void 0}),D(e).forEach(function(a){B(t,a)||(n[r+a]=e[a])}),n}function Vn(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var La={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return g(g({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey;return g(g({},n),{mutate:function(a){var i=M.trans,o=i.table(e).hook,s=o.deleting,f=o.creating,w=o.updating;switch(a.type){case"add":if(f.fire===tt)break;return i._promise("readwrite",function(){return h(a)},!0);case"put":if(f.fire===tt&&w.fire===tt)break;return i._promise("readwrite",function(){return h(a)},!0);case"delete":if(s.fire===tt)break;return i._promise("readwrite",function(){return h(a)},!0);case"deleteRange":if(s.fire===tt)break;return i._promise("readwrite",function(){return function l(y,m,p){return n.query({trans:y,values:!1,query:{index:r,range:m},limit:p}).then(function(d){var _=d.result;return h({type:"delete",keys:_,trans:y}).then(function(k){return 0<k.numFailures?Promise.reject(k.failures[0]):_.length<p?{failures:[],numFailures:0,lastResult:void 0}:l(y,g(g({},m),{lower:_[_.length-1],lowerOpen:!0}),p)})})}(a.trans,a.range,1e4)},!0)}return n.mutate(a);function h(l){var y,m,p,d=M.trans,_=l.keys||Vn(r,l);if(_)return(l=l.type==="add"||l.type==="put"?g(g({},l),{keys:_}):g({},l)).type!=="delete"&&(l.values=T([],l.values)),l.keys&&(l.keys=T([],l.keys)),y=n,p=_,((m=l).type==="add"?Promise.resolve([]):y.getMany({trans:m.trans,keys:p,cache:"immutable"})).then(function(k){var b=_.map(function(x,I){var A,C,O,L=k[I],j={onerror:null,onsuccess:null};return l.type==="delete"?s.fire.call(j,x,L,d):l.type==="add"||L===void 0?(A=f.fire.call(j,x,l.values[I],d),x==null&&A!=null&&(l.keys[I]=x=A,r.outbound||ot(l.values[I],r.keyPath,x))):(A=Wn(L,l.values[I]),(C=w.fire.call(j,A,x,L,d))&&(O=l.values[I],Object.keys(C).forEach(function(P){B(O,P)?O[P]=C[P]:ot(O,P,C[P])}))),j});return n.mutate(l).then(function(x){for(var I=x.failures,A=x.results,C=x.numFailures,x=x.lastResult,O=0;O<_.length;++O){var L=(A||_)[O],j=b[O];L==null?j.onerror&&j.onerror(I[O]):j.onsuccess&&j.onsuccess(l.type==="put"&&k[O]?l.values[O]:L)}return{failures:I,results:A,numFailures:C,lastResult:x}}).catch(function(x){return b.forEach(function(I){return I.onerror&&I.onerror(x)}),Promise.reject(x)})});throw new Error("Keys missing")}}})}})}};function Lr(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],a=0,i=0;a<e.keys.length&&i<t.length;++a)G(e.keys[a],t[i])===0&&(r.push(n?Wt(e.values[a]):e.values[a]),++i);return r.length===t.length?r:null}catch{return null}}var qa={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return g(g({},n),{getMany:function(r){var a;return r.cache?(a=Lr(r.keys,r.trans._cache,r.cache==="clone"))?$.resolve(a):n.getMany(r).then(function(i){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Wt(i):i},i}):n.getMany(r)},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function qr(t,e){return t.trans.mode==="readonly"&&!!t.subscr&&!t.trans.explicit&&t.trans.db._options.cache!=="disabled"&&!e.schema.primaryKey.outbound}function Rr(t,e){switch(t){case"query":return e.values&&!e.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ra={stack:"dbcore",level:0,name:"Observability",create:function(t){var e=t.schema.name,n=new mt(t.MIN_KEY,t.MAX_KEY);return g(g({},t),{transaction:function(r,a,i){if(M.subscr&&a!=="readonly")throw new N.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(M.querier));return t.transaction(r,a,i)},table:function(r){function a(_){var d,_=_.query;return[d=_.index,new mt((d=(_=_.range).lower)!=null?d:t.MIN_KEY,(d=_.upper)!=null?d:t.MAX_KEY)]}var i=t.table(r),o=i.schema,s=o.primaryKey,f=o.indexes,w=s.extractKey,h=s.outbound,l=s.autoIncrement&&f.filter(function(p){return p.compound&&p.keyPath.includes(s.keyPath)}),y=g(g({},i),{mutate:function(p){function d(q){return q="idb://".concat(e,"/").concat(r,"/").concat(q),I[q]||(I[q]=new mt)}var _,k,b,x=p.trans,I=p.mutatedParts||(p.mutatedParts={}),A=d(""),C=d(":dels"),O=p.type,j=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[Vn(s,p).filter(function(q){return q}),p.values]:[],L=j[0],j=j[1],P=p.trans._cache;return E(L)?(A.addKeys(L),(O=O==="delete"||L.length===j.length?Lr(L,P):null)||C.addKeys(L),(O||j)&&(_=d,k=O,b=j,o.indexes.forEach(function(q){var Q=_(q.name||"");function J(z){return z!=null?q.extractKey(z):null}function F(z){q.multiEntry&&E(z)?z.forEach(function(at){return Q.addKey(at)}):Q.addKey(z)}(k||b).forEach(function(z,it){var St=k&&J(k[it]),it=b&&J(b[it]);G(St,it)!==0&&(St!=null&&F(St),it!=null)&&F(it)})}))):L?(j={from:(P=L.lower)!=null?P:t.MIN_KEY,to:(O=L.upper)!=null?O:t.MAX_KEY},C.add(j),A.add(j)):(A.add(n),C.add(n),o.indexes.forEach(function(q){return d(q.name).add(n)})),i.mutate(p).then(function(q){return!L||p.type!=="add"&&p.type!=="put"||(A.addKeys(q.results),l&&l.forEach(function(Q){for(var J=p.values.map(function(St){return Q.extractKey(St)}),F=Q.keyPath.findIndex(function(St){return St===s.keyPath}),z=0,at=q.results.length;z<at;++z)J[z][F]=q.results[z];d(Q.name).addKeys(J)})),x.mutatedParts=tn(x.mutatedParts||{},I),q})}}),m={get:function(p){return[s,new mt(p.key)]},getMany:function(p){return[s,new mt().addKeys(p.keys)]},count:a,query:a,openCursor:a};return D(m).forEach(function(p){y[p]=function(d){var _=M.subscr,k=!!_,b=qr(M,i)&&Rr(p,d)?d.obsSet={}:_;if(k){var x,_=function(j){return j="idb://".concat(e,"/").concat(r,"/").concat(j),b[j]||(b[j]=new mt)},I=_(""),A=_(":dels"),k=m[p](d),C=k[0],k=k[1];if((p==="query"&&C.isPrimaryKey&&!d.values?A:_(C.name||"")).add(k),!C.isPrimaryKey){if(p!=="count")return x=p==="query"&&h&&d.values&&i.query(g(g({},d),{values:!1})),i[p].apply(this,arguments).then(function(j){if(p==="query"){if(h&&d.values)return x.then(function(J){return J=J.result,I.addKeys(J),j});var P=d.values?j.result.map(w):j.result;(d.values?I:A).addKeys(P)}else{var q,Q;if(p==="openCursor")return Q=d.values,(q=j)&&Object.create(q,{key:{get:function(){return A.addKey(q.primaryKey),q.key}},primaryKey:{get:function(){var J=q.primaryKey;return A.addKey(J),J}},value:{get:function(){return Q&&I.addKey(q.primaryKey),q.value}}})}return j});A.add(n)}}return i[p].apply(this,arguments)}}),y}})}};function Mr(t,e,n){var r;return n.numFailures===0?e:e.type==="deleteRange"||(r=e.keys?e.keys.length:"values"in e&&e.values?e.values.length:1,n.numFailures===r)?null:(r=g({},e),E(r.keys)&&(r.keys=r.keys.filter(function(a,i){return!(i in n.failures)})),"values"in r&&E(r.values)&&(r.values=r.values.filter(function(a,i){return!(i in n.failures)})),r)}function zn(t,e){return n=t,((r=e).lower===void 0||(r.lowerOpen?0<G(n,r.lower):0<=G(n,r.lower)))&&(n=t,(r=e).upper===void 0||(r.upperOpen?G(n,r.upper)<0:G(n,r.upper)<=0));var n,r}function Br(t,e,n,r,a,i){var o,s,f,w,h,l;return!n||n.length===0||(o=e.query.index,s=o.multiEntry,f=e.query.range,w=r.schema.primaryKey.extractKey,h=o.extractKey,l=(o.lowLevelIndex||o).extractKey,(r=n.reduce(function(y,m){var p=y,d=[];if(m.type==="add"||m.type==="put")for(var _=new mt,k=m.values.length-1;0<=k;--k){var b,x=m.values[k],I=w(x);!_.hasKey(I)&&(b=h(x),s&&E(b)?b.some(function(j){return zn(j,f)}):zn(b,f))&&(_.addKey(I),d.push(x))}switch(m.type){case"add":var A=new mt().addKeys(e.values?y.map(function(P){return w(P)}):y),p=y.concat(e.values?d.filter(function(P){return P=w(P),!A.hasKey(P)&&(A.addKey(P),!0)}):d.map(function(P){return w(P)}).filter(function(P){return!A.hasKey(P)&&(A.addKey(P),!0)}));break;case"put":var C=new mt().addKeys(m.values.map(function(P){return w(P)}));p=y.filter(function(P){return!C.hasKey(e.values?w(P):P)}).concat(e.values?d:d.map(function(P){return w(P)}));break;case"delete":var O=new mt().addKeys(m.keys);p=y.filter(function(P){return!O.hasKey(e.values?w(P):P)});break;case"deleteRange":var L=m.range;p=y.filter(function(P){return!zn(w(P),L)})}return p},t))===t)?t:(r.sort(function(y,m){return G(l(y),l(m))||G(w(y),w(m))}),e.limit&&e.limit<1/0&&(r.length>e.limit?r.length=e.limit:t.length===e.limit&&r.length<e.limit&&(a.dirty=!0)),i?Object.freeze(r):r)}function Nr(t,e){return G(t.lower,e.lower)===0&&G(t.upper,e.upper)===0&&!!t.lowerOpen==!!e.lowerOpen&&!!t.upperOpen==!!e.upperOpen}function Ma(t,e){return((n,r,a,i)=>{if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((n=G(n,r))===0){if(a&&i)return 0;if(a)return 1;if(i)return-1}return n})(t.lower,e.lower,t.lowerOpen,e.lowerOpen)<=0&&0<=((n,r,a,i)=>{if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((n=G(n,r))===0){if(a&&i)return 0;if(a)return-1;if(i)return 1}return n})(t.upper,e.upper,t.upperOpen,e.upperOpen)}function Ba(t,e,n,r){t.subscribers.add(n),r.addEventListener("abort",function(){var a,i;t.subscribers.delete(n),t.subscribers.size===0&&(a=t,i=e,setTimeout(function(){a.subscribers.size===0&&Vt(i,a)},3e3))})}var Na={stack:"dbcore",level:0,name:"Cache",create:function(t){var e=t.schema.name;return g(g({},t),{transaction:function(n,r,a){var i,o,s=t.transaction(n,r,a);return r==="readwrite"&&(a=(i=new AbortController).signal,s.addEventListener("abort",(o=function(f){return function(){if(i.abort(),r==="readwrite"){for(var w=new Set,h=0,l=n;h<l.length;h++){var y=l[h],m=Zt["idb://".concat(e,"/").concat(y)];if(m){var p=t.table(y),d=m.optimisticOps.filter(function(q){return q.trans===s});if(s._explicit&&f&&s.mutatedParts)for(var _=0,k=Object.values(m.queries.query);_<k.length;_++)for(var b=0,x=(C=k[_]).slice();b<x.length;b++)Mn((O=x[b]).obsSet,s.mutatedParts)&&(Vt(C,O),O.subscribers.forEach(function(q){return w.add(q)}));else if(0<d.length){m.optimisticOps=m.optimisticOps.filter(function(q){return q.trans!==s});for(var I=0,A=Object.values(m.queries.query);I<A.length;I++)for(var C,O,L,j=0,P=(C=A[I]).slice();j<P.length;j++)(O=P[j]).res!=null&&s.mutatedParts&&(f&&!O.dirty?(L=Object.isFrozen(O.res),L=Br(O.res,O.req,d,p,O,L),O.dirty?(Vt(C,O),O.subscribers.forEach(function(q){return w.add(q)})):L!==O.res&&(O.res=L,O.promise=$.resolve({result:L}))):(O.dirty&&Vt(C,O),O.subscribers.forEach(function(q){return w.add(q)})))}}}w.forEach(function(q){return q()})}}})(!1),{signal:a}),s.addEventListener("error",o(!1),{signal:a}),s.addEventListener("complete",o(!0),{signal:a})),s},table:function(n){var r=t.table(n),a=r.schema.primaryKey;return g(g({},r),{mutate:function(i){var o,s=M.trans;return!a.outbound&&s.db._options.cache!=="disabled"&&!s.explicit&&s.idbtrans.mode==="readwrite"&&(o=Zt["idb://".concat(e,"/").concat(n)])?(s=r.mutate(i),i.type!=="add"&&i.type!=="put"||!(50<=i.values.length||Vn(a,i).some(function(f){return f==null}))?(o.optimisticOps.push(i),i.mutatedParts&&en(i.mutatedParts),s.then(function(f){0<f.numFailures&&(Vt(o.optimisticOps,i),(f=Mr(0,i,f))&&o.optimisticOps.push(f),i.mutatedParts)&&en(i.mutatedParts)}),s.catch(function(){Vt(o.optimisticOps,i),i.mutatedParts&&en(i.mutatedParts)})):s.then(function(f){var w=Mr(0,g(g({},i),{values:i.values.map(function(h,l){var y;return f.failures[l]?h:(ot(y=(y=a.keyPath)!=null&&y.includes(".")?Wt(h):g({},h),a.keyPath,f.results[l]),y)})}),f);o.optimisticOps.push(w),queueMicrotask(function(){return i.mutatedParts&&en(i.mutatedParts)})}),s):r.mutate(i)},query:function(i){var o,s,f,w,h,l,y;return qr(M,r)&&Rr("query",i)?(o=((f=M.trans)==null?void 0:f.db._options.cache)==="immutable",s=(f=M).requery,f=f.signal,l=((m,p,d,_)=>{var k=Zt["idb://".concat(m,"/").concat(p)];if(!k)return[];if(!(m=k.queries[d]))return[null,!1,k,null];var b=m[(_.query?_.query.index.name:null)||""];if(!b)return[null,!1,k,null];switch(d){case"query":var x=b.find(function(I){return I.req.limit===_.limit&&I.req.values===_.values&&Nr(I.req.query.range,_.query.range)});return x?[x,!0,k,b]:[b.find(function(I){return("limit"in I.req?I.req.limit:1/0)>=_.limit&&(!_.values||I.req.values)&&Ma(I.req.query.range,_.query.range)}),!1,k,b];case"count":return x=b.find(function(I){return Nr(I.req.query.range,_.query.range)}),[x,!!x,k,b]}})(e,n,"query",i),y=l[0],w=l[2],h=l[3],y&&l[1]?y.obsSet=i.obsSet:(l=r.query(i).then(function(m){var p=m.result;if(y&&(y.res=p),o){for(var d=0,_=p.length;d<_;++d)Object.freeze(p[d]);Object.freeze(p)}else m.result=Wt(p);return m}).catch(function(m){return h&&y&&Vt(h,y),Promise.reject(m)}),y={obsSet:i.obsSet,promise:l,subscribers:new Set,type:"query",req:i,dirty:!1},h?h.push(y):(h=[y],(w=w||(Zt["idb://".concat(e,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[i.query.index.name||""]=h)),Ba(y,h,s,f),y.promise.then(function(m){return{result:Br(m.result,i,w==null?void 0:w.optimisticOps,r,y,o)}})):r.query(i)}})}})}};function rn(t,e){return new Proxy(t,{get:function(n,r,a){return r==="db"?e:Reflect.get(n,r,a)}})}ut.prototype.version=function(t){if(isNaN(t)||t<.1)throw new N.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new N.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,n=e.filter(function(r){return r._cfg.version===t})[0];return n||(n=new this.Version(t),e.push(n),e.sort(Pa),n.stores({}),this._state.autoSchema=!1),n},ut.prototype._whenReady=function(t){var e=this;return this.idbdb&&(this._state.openComplete||M.letThrough||this._vip)?t():new $(function(n,r){if(e._state.openComplete)return r(new N.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return void r(new N.DatabaseClosed);e.open().catch(tt)}e._state.dbReadyPromise.then(n,r)}).then(t)},ut.prototype.use=function(a){var e=a.stack,n=a.create,r=a.level,a=a.name,i=(a&&this.unuse({stack:e,name:a}),this._middlewares[e]||(this._middlewares[e]=[]));return i.push({stack:e,create:n,level:r??10,name:a}),i.sort(function(o,s){return o.level-s.level}),this},ut.prototype.unuse=function(t){var e=t.stack,n=t.name,r=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(a){return r?a.create!==r:!!n&&a.name!==n})),this},ut.prototype.open=function(){var t=this;return Qt(Lt,function(){return $a(t)})},ut.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var t=this._state,e=ce.indexOf(this);if(0<=e&&ce.splice(e,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new $(function(n){t.dbReadyResolve=n}),t.openCanceller=new $(function(n,r){t.cancelOpen=r}))},ut.prototype.close=function(e){var e=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;e?(n.isBeingOpened&&n.cancelOpen(new N.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new N.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},ut.prototype.delete=function(t){var e=this,n=(t===void 0&&(t={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),r=this._state;return new $(function(a,i){function o(){e.close(t);var s=e._deps.indexedDB.deleteDatabase(e.name);s.onsuccess=rt(function(){var f,w,h;f=e._deps,w=e.name,Ln(h=f.indexedDB)||w===Fe||jn(h,f.IDBKeyRange).delete(w).catch(tt),a()}),s.onerror=Ot(i),s.onblocked=e._fireOnBlocked}if(n)throw new N.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},ut.prototype.backendDB=function(){return this.idbdb},ut.prototype.isOpen=function(){return this.idbdb!==null},ut.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},ut.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ut.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ut.prototype,"tables",{get:function(){var t=this;return D(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!1,configurable:!0}),ut.prototype.transaction=function(){var t=(function(e,n,r){var a=arguments.length;if(a<2)throw new N.InvalidArgument("Too few arguments");for(var i=new Array(a-1);--a;)i[a-1]=arguments[a];return r=i.pop(),[e,ir(i),r]}).apply(this,arguments);return this._transaction.apply(this,t)},ut.prototype._transaction=function(t,e,n){var r,a,i=this,o=M.trans,s=(o&&o.db===this&&t.indexOf("!")===-1||(o=null),t.indexOf("?")!==-1);t=t.replace("!","").replace("?","");try{if(a=e.map(function(w){if(w=w instanceof i.Table?w.name:w,typeof w!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return w}),t=="r"||t===Sn)r=Sn;else{if(t!="rw"&&t!=Dn)throw new N.InvalidArgument("Invalid transaction mode: "+t);r=Dn}if(o){if(o.mode===Sn&&r===Dn){if(!s)throw new N.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&a.forEach(function(w){if(o&&o.storeNames.indexOf(w)===-1){if(!s)throw new N.SubTransaction("Table "+w+" not included in parent transaction.");o=null}}),s&&o&&!o.active&&(o=null)}}catch(w){return o?o._promise(null,function(h,l){l(w)}):st(w)}var f=(function w(h,l,y,m,p){return $.resolve().then(function(){var b=M.transless||M,d=h._createTransaction(l,y,h._dbSchema,m),b=(d.explicit=!0,{trans:d,transless:b});if(m)d.idbtrans=m.idbtrans;else try{d.create(),d.idbtrans._explicit=!0,h._state.PR1398_maxLoop=3}catch(x){return x.name===pn.InvalidState&&h.isOpen()&&0<--h._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),h.close({disableAutoOpen:!1}),h.open().then(function(){return w(h,l,y,null,p)})):st(x)}var _,k=hn(p),b=(k&&ue(),$.follow(function(){var x;(_=p.call(d,d))&&(k?(x=Rt.bind(null,null),_.then(x,x)):typeof _.next=="function"&&typeof _.throw=="function"&&(_=Un(_)))},b));return(_&&typeof _.then=="function"?$.resolve(_).then(function(x){return d.active?x:st(new N.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):b.then(function(){return _})).then(function(x){return m&&d._resolve(),d._completion.then(function(){return x})}).catch(function(x){return d._reject(x),st(x)})})}).bind(null,this,r,a,o,n);return o?o._promise(r,f,"lock"):M.trans?Qt(M.transless,function(){return i._whenReady(f)}):this._whenReady(f)},ut.prototype.table=function(t){if(B(this._allTables,t))return this._allTables[t];throw new N.InvalidTable("Table ".concat(t," does not exist"))};var $t=ut;function ut(t,e){var n,r,a,i,o,s=this,f=(this._middlewares={},this.verno=0,ut.dependencies),f=(this._options=e=g({addons:ut.addons,autoOpen:!0,indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange,cache:"cloned"},e),this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange},e.addons),w=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:tt,dbReadyPromise:null,cancelOpen:tt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:e.autoOpen}),h=(w.dbReadyPromise=new $(function(l){w.dbReadyResolve=l}),w.openCanceller=new $(function(l,y){w.cancelOpen=y}),this._state=w,this.name=t,this.on=Se(this,"populate","blocked","versionchange","close",{ready:[yn,tt]}),this.once=function(l,y){var m=function(){for(var p=[],d=0;d<arguments.length;d++)p[d]=arguments[d];s.on(l).unsubscribe(m),y.apply(s,p)};return s.on(l,m)},this.on.ready.subscribe=Ut(this.on.ready.subscribe,function(l){return function(y,m){ut.vip(function(){var p,d=s._state;d.openComplete?(d.dbOpenError||$.resolve().then(y),m&&l(y)):d.onReadyBeingFired?(d.onReadyBeingFired.push(y),m&&l(y)):(l(y),p=s,m||l(function _(){p.on.ready.unsubscribe(y),p.on.ready.unsubscribe(_)}))})}}),this.Collection=(n=this,De(xa.prototype,function(_,d){this.db=n;var m=mr,p=null;if(d)try{m=d()}catch(b){p=b}var d=_._ctx,_=d.table,k=_.hook.reading.fire;this._ctx={table:_,index:d.index,isPrimKey:!d.index||_.schema.primKey.keyPath&&d.index===_.schema.primKey.name,range:m,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:p,or:d.or,valueMapper:k!==ge?k:null}})),this.Table=(r=this,De(kr.prototype,function(l,y,m){this.db=r,this._tx=m,this.name=l,this.schema=y,this.hook=r._allTables[l]?r._allTables[l].hook:Se(null,{creating:[pa,tt],reading:[ha,ge],updating:[ma,tt],deleting:[ya,tt]})})),this.Transaction=(a=this,De(Ea.prototype,function(l,y,m,p,d){var _=this;l!=="readonly"&&y.forEach(function(k){k=(k=m[k])==null?void 0:k.yProps,k&&(y=y.concat(k.map(function(b){return b.updatesTable})))}),this.db=a,this.mode=l,this.storeNames=y,this.schema=m,this.chromeTransactionDurability=p,this.idbtrans=null,this.on=Se(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $(function(k,b){_._resolve=k,_._reject=b}),this._completion.then(function(){_.active=!1,_.on.complete.fire()},function(k){var b=_.active;return _.active=!1,_.on.error.fire(k),_.parent?_.parent._reject(k):b&&_.idbtrans&&_.idbtrans.abort(),st(k)})})),this.Version=(i=this,De(Ka.prototype,function(l){this.db=i,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(o=this,De(Tr.prototype,function(l,y,m){if(this.db=o,this._ctx={table:l,index:y===":id"?null:y,or:m},this._cmp=this._ascending=G,this._descending=function(p,d){return G(d,p)},this._max=function(p,d){return 0<G(p,d)?p:d},this._min=function(p,d){return G(p,d)<0?p:d},this._IDBKeyRange=o._deps.IDBKeyRange,!this._IDBKeyRange)throw new N.MissingAPI})),this.on("versionchange",function(l){0<l.newVersion?console.warn("Another connection wants to upgrade database '".concat(s.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(s.name,"'. Closing db now to resume the delete request.")),s.close({disableAutoOpen:!1})}),this.on("blocked",function(l){!l.newVersion||l.newVersion<l.oldVersion?console.warn("Dexie.delete('".concat(s.name,"') was blocked")):console.warn("Upgrade '".concat(s.name,"' blocked by other connection holding version ").concat(l.oldVersion/10))}),this._maxKey=Ie(e.IDBKeyRange),this._createTransaction=function(l,y,m,p){return new s.Transaction(l,y,m,s._options.chromeTransactionDurability,p)},this._fireOnBlocked=function(l){s.on("blocked").fire(l),ce.filter(function(y){return y.name===s.name&&y!==s&&!y._state.vcFired}).map(function(y){return y.on("versionchange").fire(l)})},this.use(qa),this.use(Na),this.use(Ra),this.use(ja),this.use(La),new Proxy(this,{get:function(l,y,m){var p;return y==="_vip"||(y==="table"?function(d){return rn(s.table(d),h)}:(p=Reflect.get(l,y,m))instanceof kr?rn(p,h):y==="tables"?p.map(function(d){return rn(d,h)}):y==="_createTransaction"?function(){return rn(p.apply(this,arguments),h)}:p)}}));this.vip=h,f.forEach(function(l){return l(s)})}var an,he=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Fa=(Hn.prototype.subscribe=function(t,e,n){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:e,complete:n})},Hn.prototype[he]=function(){return this},Hn);function Hn(t){this._subscribe=t}try{an={indexedDB:S.indexedDB||S.mozIndexedDB||S.webkitIndexedDB||S.msIndexedDB,IDBKeyRange:S.IDBKeyRange||S.webkitIDBKeyRange}}catch{an={indexedDB:null,IDBKeyRange:null}}function Fr(t){var e,n=!1,r=new Fa(function(a){var i=hn(t),o,s=!1,f={},w={},h={get closed(){return s},unsubscribe:function(){s||(s=!0,o&&o.abort(),l&&Nt.storagemutated.unsubscribe(m))}},l=(a.start&&a.start(h),!1),y=function(){return xn(p)},m=function(d){tn(f,d),Mn(w,f)&&y()},p=function(){var d,_,k;!s&&an.indexedDB&&(f={},d={},o&&o.abort(),o=new AbortController,k=(b=>{var x=oe();try{i&&ue();var I=qt(t,b);return I=i?I.finally(Rt):I}finally{x&&se()}})(_={subscr:d,signal:o.signal,requery:y,querier:t,trans:null}),Promise.resolve(k).then(function(b){n=!0,e=b,s||_.signal.aborted||(f={},(x=>{for(var I in x)if(B(x,I))return;return 1})(w=d)||l||(Nt(Te,m),l=!0),xn(function(){return!s&&a.next&&a.next(b)}))},function(b){n=!1,["DatabaseClosedError","AbortError"].includes(b==null?void 0:b.name)||s||xn(function(){s||a.error&&a.error(b)})}))};return setTimeout(y,0),h});return r.hasValue=function(){return n},r.getValue=function(){return e},r}var te=$t;function Yn(t){var e=Ft;try{Ft=!0,Nt.storagemutated.fire(t),Fn(t,!0)}finally{Ft=e}}V(te,g(g({},Ct),{delete:function(t){return new te(t,{addons:[]}).delete()},exists:function(t){return new te(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return e=te.dependencies,n=e.indexedDB,e=e.IDBKeyRange,(Ln(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(a){return a.name}).filter(function(a){return a!==Fe})}):jn(n,e).toCollection().primaryKeys()).then(t)}catch{return st(new N.MissingAPI)}var e,n},defineClass:function(){return function(t){K(this,t)}},ignoreTransaction:function(t){return M.trans?Qt(M.transless,t):t()},vip:qn,async:function(t){return function(){try{var e=Un(t.apply(this,arguments));return e&&typeof e.then=="function"?e:$.resolve(e)}catch(n){return st(n)}}},spawn:function(t,e,n){try{var r=Un(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:$.resolve(r)}catch(a){return st(a)}},currentTransaction:{get:function(){return M.trans||null}},waitFor:function(t,e){return t=$.resolve(typeof t=="function"?te.ignoreTransaction(t):t).timeout(e||6e4),M.trans?M.trans.waitFor(t):t},Promise:$,debug:{get:function(){return It},set:function(t){cr(t)}},derive:ft,extend:K,props:V,override:Ut,Events:Se,on:Nt,liveQuery:Fr,extendObservabilitySet:tn,getByKeyPath:bt,setByKeyPath:ot,delByKeyPath:function(t,e){typeof e=="string"?ot(t,e,void 0):"length"in e&&[].map.call(e,function(n){ot(t,n,void 0)})},shallowClone:dt,deepClone:Wt,getObjectDiff:Wn,cmp:G,asap:yt,minKey:-1/0,addons:[],connections:ce,errnames:pn,dependencies:an,cache:Zt,semVer:"4.3.0",version:"4.3.0".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,2*n)})})),te.maxKey=Ie(te.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Nt(Te,function(t){Ft||(t=new CustomEvent(In,{detail:t}),Ft=!0,dispatchEvent(t),Ft=!1)}),addEventListener(In,function(t){t=t.detail,Ft||Yn(t)}));var pe,Ft=!1,Ur=function(){};return typeof BroadcastChannel<"u"&&((Ur=function(){(pe=new BroadcastChannel(In)).onmessage=function(t){return t.data&&Yn(t.data)}})(),typeof pe.unref=="function"&&pe.unref(),Nt(Te,function(t){Ft||pe.postMessage(t)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(t){if(!$t.disableBfCache&&t.persisted){It&&console.debug("Dexie: handling persisted pagehide"),pe!=null&&pe.close();for(var e=0,n=ce;e<n.length;e++)n[e].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(t){!$t.disableBfCache&&t.persisted&&(It&&console.debug("Dexie: handling persisted pageshow"),Ur(),Yn({all:new mt(-1/0,[[]])}))})),$.rejectionMapper=function(t,e){return!t||t instanceof ae||t instanceof TypeError||t instanceof SyntaxError||!t.name||!ur[t.name]?t:(e=new ur[t.name](e||t.message,t),"stack"in t&&Z(e,"stack",{get:function(){return this.inner.stack}}),e)},cr(It),g($t,Object.freeze({__proto__:null,Dexie:$t,Entity:vr,PropModification:xe,RangeSet:mt,add:function(t){return new xe({add:t})},cmp:G,default:$t,liveQuery:Fr,mergeRanges:Ae,rangesOverlap:Cr,remove:function(t){return new xe({remove:t})},replacePrefix:function(t,e){return new xe({replacePrefix:[t,e]})}}),{default:$t}),$t})})(ta);var za=ta.exports;const Zn=Va(za),Vr=Symbol.for("Dexie"),cn=globalThis[Vr]||(globalThis[Vr]=Zn);if(Zn.semVer!==cn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Zn.semVer} and ${cn.semVer}`);const{liveQuery:Ei,mergeRanges:Ti,rangesOverlap:Ii,RangeSet:Oi,cmp:Pi,Entity:Ai,PropModification:Ci,replacePrefix:Ki,add:$i,remove:ji,DexieYProvider:Li}=cn;class Ha extends cn{constructor(){super("GymDatabase");jt(this,"workouts");jt(this,"logs");jt(this,"workoutTypes");jt(this,"profile");this.version(1).stores({workouts:"id, status, startTime, updatedAt, isDeleted",logs:"id, workoutId, workoutTypeId, date, updatedAt, isDeleted",workoutTypes:"id, updatedAt, isDeleted",profile:"id, updatedAt, isDeleted"})}}const H=new Ha,nr="gym_web_auth";function ea(){const v=localStorage.getItem(nr);try{return v?JSON.parse(v):null}catch{return null}}function Ya(v){localStorage.setItem(nr,JSON.stringify(v))}function Ga(){localStorage.removeItem(nr)}function Qa(){const v=ea();if(!v)return null;const u=new URLSearchParams;return Object.entries(v).forEach(([c,g])=>{g!=null&&u.append(c,String(g))}),u.toString()}var Xr;const on=(Xr=window.Telegram)==null?void 0:Xr.WebApp,zr="https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4";class Hr{static getHeaders(){const u={"Content-Type":"application/json"};if(on!=null&&on.initData)u["X-Telegram-Init-Data"]=on.initData;else{const c=Qa();c&&(u["X-Telegram-Init-Data"]=c)}return u}static async sync(){if(!navigator.onLine)throw new Error("Offline");const u=this.getHeaders(),c=await fetch(zr,{headers:u});if(!c.ok)throw c.status===401?new Error("Unauthorized"):new Error("Sync failed");const g=await c.json();await this.mergeData(g);const T=await this.readAll();await fetch(zr,{method:"POST",headers:u,body:JSON.stringify(T)})}static async mergeData(u){await H.transaction("rw",H.workouts,H.logs,H.workoutTypes,H.profile,async()=>{if(await this.mergeTable(H.workouts,u.workouts),await this.mergeTable(H.logs,u.logs),await this.mergeTable(H.workoutTypes,u.workoutTypes),u.profile){const c={...u.profile,id:"me"};await this.mergeTable(H.profile,[c])}})}static async mergeTable(u,c=[]){const g=await u.toArray(),T=new Map(g.map(S=>[S.id,S]));for(const S of c){const D=T.get(S.id);if(!D)await u.put(S);else{const E=new Date(S.updatedAt).getTime(),K=new Date(D.updatedAt).getTime();E>K&&await u.put(S)}}}static async readAll(){return{workouts:await H.workouts.toArray(),logs:await H.logs.toArray(),workoutTypes:await H.workoutTypes.toArray(),profile:(await H.profile.toArray())[0]}}}const Xa="gym_twa_data";var Jr;const ye=(Jr=window.Telegram)==null?void 0:Jr.WebApp,Qn={workoutTypes:[{id:"1",name:"ÐÐ¸Ð¼ Ð»ÐµÐ¶Ð°",updatedAt:new Date().toISOString()},{id:"2",name:"ÐÑÐ¸ÑÐµÐ´Ð°Ð½Ð¸Ñ",updatedAt:new Date().toISOString()},{id:"3",name:"Ð¡ÑÐ°Ð½Ð¾Ð²Ð°Ñ ÑÑÐ³Ð°",updatedAt:new Date().toISOString()}],logs:[],workouts:[]};class Ja{constructor(){jt(this,"onUpdateCallback");jt(this,"onSyncStatusChangeCallback");jt(this,"status","idle");jt(this,"cache",{...Qn});this.init()}async init(){await this.migrateFromLocalStorage(),this.sync().catch(console.error)}async migrateFromLocalStorage(){const u=localStorage.getItem(Xa);if(u)try{const c=JSON.parse(u);if(await H.workoutTypes.count()===0){console.log("Migrating from localStorage to IDB...");const T=new Date().toISOString(),S=(c.workoutTypes||Qn.workoutTypes).map(K=>({...K,updatedAt:T}));await H.workoutTypes.bulkPut(S);const D=(c.logs||[]).map(K=>({...K,updatedAt:T,workoutId:K.workoutId||"legacy"}));await H.logs.bulkPut(D);const E=(c.workouts||[]).map(K=>({...K,updatedAt:T}));if(await H.workouts.bulkPut(E),c.profile){const K={...c.profile,id:"me",updatedAt:T};await H.profile.put(K)}}}catch(c){console.error("Migration failed",c)}else await H.workoutTypes.count()===0&&await H.workoutTypes.bulkPut(Qn.workoutTypes)}onUpdate(u){this.onUpdateCallback=u}onSyncStatusChange(u){this.onSyncStatusChangeCallback=u}setStatus(u){var c;this.status=u,(c=this.onSyncStatusChangeCallback)==null||c.call(this,u),u==="success"&&setTimeout(()=>{this.status==="success"&&this.setStatus("idle")},2e3)}async sync(){var u;try{this.setStatus("saving"),await Hr.sync(),this.setStatus("success"),(u=this.onUpdateCallback)==null||u.call(this)}catch(c){if(console.error("Sync failed",c),c.message==="Unauthorized"){Ga(),location.reload();return}c.message!=="Offline"?this.setStatus("error"):this.setStatus("idle")}}async reloadCache(){var u;this.cache=await Hr.readAll(),(u=this.onUpdateCallback)==null||u.call(this)}getWorkoutTypes(){return this.cache.workoutTypes.filter(u=>!u.isDeleted)}getLogs(){return this.cache.logs.filter(u=>!u.isDeleted)}getWorkouts(){return this.cache.workouts.filter(u=>!u.isDeleted)}getActiveWorkout(){return this.cache.workouts.find(u=>!u.isDeleted&&(u.status==="active"||u.status==="paused"))}getProfile(){return this.cache.profile}async addWorkoutType(u){const c={id:Date.now().toString(),name:u,updatedAt:new Date().toISOString()};return await H.workoutTypes.put(c),await this.reloadCache(),this.sync().catch(()=>{}),c}async deleteWorkoutType(u){const c=await H.workoutTypes.get(u);c&&(c.isDeleted=!0,c.updatedAt=new Date().toISOString(),await H.workoutTypes.put(c),await this.reloadCache(),this.sync().catch(()=>{}))}async updateWorkoutType(u,c){const g=await H.workoutTypes.get(u);g&&(g.name=c,g.updatedAt=new Date().toISOString(),await H.workoutTypes.put(g),await this.reloadCache(),this.sync().catch(()=>{}))}async startWorkout(u){this.getActiveWorkout()&&await this.finishWorkout();const g={id:Date.now().toString(),startTime:new Date().toISOString(),status:"active",name:u,isManual:!0,pauseIntervals:[],updatedAt:new Date().toISOString()};return await H.workouts.put(g),await this.reloadCache(),this.sync().catch(()=>{}),g}async pauseWorkout(){const u=this.getActiveWorkout();u&&u.status==="active"&&(u.status="paused",u.pauseIntervals.push({start:new Date().toISOString()}),u.updatedAt=new Date().toISOString(),await H.workouts.put(u),await this.reloadCache(),this.sync().catch(()=>{}))}async resumeWorkout(){const u=this.getActiveWorkout();if(u&&u.status==="paused"){u.status="active";const c=u.pauseIntervals[u.pauseIntervals.length-1];c&&!c.end&&(c.end=new Date().toISOString()),u.updatedAt=new Date().toISOString(),await H.workouts.put(u),await this.reloadCache(),this.sync().catch(()=>{})}}async finishWorkout(){const u=this.getActiveWorkout();if(u){u.status="finished",u.endTime=new Date().toISOString();const c=u.pauseIntervals[u.pauseIntervals.length-1];c&&!c.end&&(c.end=u.endTime),u.updatedAt=new Date().toISOString(),await H.workouts.put(u),await this.reloadCache(),this.sync().catch(()=>{})}}getWorkoutDuration(u){const c=new Date(u.startTime).getTime(),g=u.endTime?new Date(u.endTime).getTime():Date.now();let T=g-c;return u.pauseIntervals.forEach(D=>{const E=new Date(D.start).getTime(),K=D.end?new Date(D.end).getTime():u.status==="paused"?Date.now():g;K>E&&(T-=K-E)}),Math.floor(Math.max(0,T)/6e4)}async ensureActiveWorkout(){const u=this.getActiveWorkout();if(u)return u.id;const c=new Date().toISOString().split("T")[0],S=this.getWorkouts().filter(K=>K.startTime.startsWith(c)).sort((K,R)=>new Date(R.startTime).getTime()-new Date(K.startTime).getTime())[0];if(S&&!S.isManual&&S.status==="finished")return S.endTime=new Date().toISOString(),S.updatedAt=new Date().toISOString(),await H.workouts.put(S),await this.reloadCache(),this.sync().catch(()=>{}),S.id;const D=`implicit_${c}_${Date.now()}`,E={id:D,startTime:new Date().toISOString(),endTime:new Date().toISOString(),status:"finished",isManual:!1,pauseIntervals:[],updatedAt:new Date().toISOString()};return await H.workouts.put(E),await this.reloadCache(),this.sync().catch(()=>{}),D}async updateImplicitWorkoutBounds(u){const c=await H.workouts.get(u);if(!c||c.isManual)return;const T=(await H.logs.where("workoutId").equals(u).toArray()).filter(D=>!D.isDeleted);if(T.length===0)return;const S=T.sort((D,E)=>new Date(D.date).getTime()-new Date(E.date).getTime());c.startTime=S[0].date,c.endTime=S[S.length-1].date,c.status="finished",c.updatedAt=new Date().toISOString(),await H.workouts.put(c)}async addLog(u){const c=await this.ensureActiveWorkout(),g={...u,id:Date.now().toString(),date:new Date().toISOString(),workoutId:c,updatedAt:new Date().toISOString()};return await H.logs.put(g),await this.updateImplicitWorkoutBounds(c),await this.reloadCache(),this.sync().catch(()=>{}),g}async deleteLog(u){const c=await H.logs.get(u);if(c){const g=c.workoutId;c.isDeleted=!0,c.updatedAt=new Date().toISOString(),await H.logs.put(c),g&&await this.updateImplicitWorkoutBounds(g),await this.reloadCache(),this.sync().catch(()=>{})}}async updateLog(u){const c={...u,updatedAt:new Date().toISOString()};await H.logs.put(c),await this.reloadCache(),this.sync().catch(()=>{})}getProfileIdentifier(){var g,T;const u=this.cache.profile;if(u!=null&&u.telegramUsername)return u.telegramUsername;if(u!=null&&u.telegramUserId)return`id_${u.telegramUserId}`;const c=(T=(g=ye==null?void 0:ye.initDataUnsafe)==null?void 0:g.user)==null?void 0:T.id;return c?`id_${c}`:""}async updateProfileSettings(u){var D;const c=(D=ye==null?void 0:ye.initDataUnsafe)==null?void 0:D.user,g=c==null?void 0:c.id;let T=this.cache.profile;T?c!=null&&c.photo_url&&(T.photoUrl=c.photo_url):T={id:"me",isPublic:!1,showFullHistory:!1,telegramUserId:g||0,telegramUsername:c==null?void 0:c.username,photoUrl:c==null?void 0:c.photo_url,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};const S={...T,...u,updatedAt:new Date().toISOString()};await H.profile.put(S),await this.reloadCache(),this.sync().catch(()=>{})}async getPublicProfile(u){try{const g=await fetch(`https://functions.yandexcloud.net/d4ehnqvq3a8fo55t7tj4?profile=${encodeURIComponent(u)}`);return g.ok?await g.json():null}catch{return null}}}const W=new Ja;W.reloadCache().then(()=>{});function Za(v,u){return u===1?v:Math.round(v*(1+u/30))}function ti(v,u){const c=new Map;return v.filter(T=>T.workoutTypeId===u).forEach(T=>{const S=T.date.split("T")[0],D=Za(T.weight,T.reps),E=c.get(S)||0;D>E&&c.set(S,D)}),c}function ei(v,u){const c=new Set;return v.forEach(g=>c.add(g.startTime.split("T")[0])),u.forEach(g=>c.add(g.date.split("T")[0])),c}function ni(v){const u=v.filter(S=>S.endTime&&S.status==="finished");if(u.length===0)return{averageMinutes:0,totalMinutes:0,count:0};let c=0;u.forEach(S=>{const D=new Date(S.startTime).getTime(),E=new Date(S.endTime).getTime();let K=E-D;S.pauseIntervals&&S.pauseIntervals.forEach(R=>{const Y=new Date(R.start).getTime(),B=R.end?new Date(R.end).getTime():E;K-=B-Y}),c+=K});const g=Math.round(c/1e3/60);return{averageMinutes:Math.round(g/u.length),totalMinutes:g,count:u.length}}function ri(v,u=6){const c=new Date,g=new Date(c);g.setMonth(c.getMonth()-u),g.setDate(g.getDate()-g.getDay());let T='<div class="heatmap-container"><div class="heatmap-grid">';const S=new Date(g),D=new Date(c);for(;S<=D;){const E=S.toISOString().split("T")[0],K=v.has(E),Y=`heatmap-cell level-${K?4:0}`,B=`${E}: ${K?"Workout":"No workout"}`;T+=`<div class="${Y}" title="${B}"></div>`,S.setDate(S.getDate()+1)}return T+="</div>",T+=`
        <div class="heatmap-legend">
            Less <div class="heatmap-cell level-0"></div>
            <div class="heatmap-cell level-4"></div> More
        </div>
    `,T+="</div>",T}function Yr(v){const u=new Map;v.forEach(T=>{const S=T.date.split("T")[0],D=T.weight*T.reps;u.set(S,(u.get(S)||0)+D)});const c=Array.from(u.keys()).sort().slice(-10);if(c.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¾Ð±ÑÐµÐ¼Ð°</p>';const g=c.map(T=>({label:new Date(T).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:u.get(T)}));return oi(g,"ÐºÐ³")}function ai(v){const u=Array.from(v.keys()).sort();if(u.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° 1RM</p>';const c=u.map(g=>({label:new Date(g).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:v.get(g)}));return na(c,"ÐºÐ³")}function ii(v){const u=v.filter(g=>g.status==="finished"&&g.endTime).sort((g,T)=>new Date(g.startTime).getTime()-new Date(T.startTime).getTime()).slice(-10);if(u.length<2)return'<p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ° Ð¿ÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÐ¸</p>';const c=u.map(g=>{const T=new Date(g.startTime).getTime(),S=new Date(g.endTime).getTime();let D=(S-T)/1e3/60;return g.pauseIntervals&&g.pauseIntervals.forEach(E=>{const K=new Date(E.start).getTime(),R=E.end?new Date(E.end).getTime():S;D-=(R-K)/1e3/60}),{label:new Date(g.startTime).toLocaleDateString(void 0,{day:"numeric",month:"short"}),value:Math.round(D)}});return na(c,"Ð¼Ð¸Ð½")}function oi(v,u){const T=Math.max(...v.map(D=>D.value))*1.1;return`
        <svg width="100%" height="150" preserveAspectRatio="none">
            ${v.map((D,E)=>{const K=D.value/T*100,R=E/v.length*100,Y=1/v.length*80;return`
            <rect x="${R+5}%" y="${100-K}%" width="${Y}%" height="${K}%" fill="var(--color-button)" rx="2" opacity="0.8">
               <title>${D.label}: ${D.value}${u}</title>
            </rect>
            <text x="${R+5+Y/2}%" y="95%" font-size="10" text-anchor="middle" fill="var(--color-text)" style="pointer-events: none;">
                ${D.label}
            </text>
        `}).join("")}
        </svg>
    `}function na(v,u){const S=v.map(U=>U.value),D=Math.min(...S),E=Math.max(...S),K=E-D||1,R=U=>20+U/(v.length-1)*(400-2*20),Y=U=>130-(U-D)/K*(150-2*20),B=v.map((U,Z)=>`${R(Z)},${Y(U.value)}`).join(" "),V=v.map((U,Z)=>`
        <circle cx="${R(Z)}" cy="${Y(U.value)}" r="4" fill="var(--color-bg)" stroke="var(--color-button)" stroke-width="2">
            <title>${U.label}: ${U.value}${u}</title>
        </circle>
    `).join("");return`
        <svg viewBox="0 0 400 150" class="chart">
             <polyline
                fill="none"
                stroke="var(--color-button)"
                stroke-width="3"
                stroke-linejoin="round"
                stroke-linecap="round"
                points="${B}"
            />
            ${V}
        </svg>
        <div style="display: flex; justify-content: space-between; margin-top: 4px; font-size: 12px; color: var(--color-hint);">
            <span>${Math.round(D)}${u}</span>
            <span>${Math.round(E)}${u}</span>
        </div>
    `}function si(v,u){v.innerHTML=`
        <div class="page-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 24px;">ðï¸</div>
            <h1 class="title" style="margin-bottom: 12px;">ÐÐ¸Ð¼-Ð¶Ð¸Ð¼ 21</h1>
            <p class="subtitle" style="margin-bottom: 32px; opacity: 0.7;">ÐÐ¾Ð¹Ð´Ð¸ÑÐµ ÑÐµÑÐµÐ· Telegram, ÑÑÐ¾Ð±Ñ ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</p>
            <div id="telegram-login-container"></div>
        </div>
    `;const c=document.createElement("script");c.src="https://telegram.org/js/telegram-widget.js?22",c.async=!0,c.setAttribute("data-telegram-login","gymgym21bot"),c.setAttribute("data-size","large"),c.setAttribute("data-radius","12"),c.setAttribute("data-auth-url",window.location.href),c.setAttribute("data-request-access","write");const g=document.getElementById("telegram-login-container");g&&g.appendChild(c)}const ui="modulepreload",ci=function(v,u){return new URL(v,u).href},Gr={},li=function(u,c,g){let T=Promise.resolve();if(c&&c.length>0){const D=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),K=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));T=Promise.allSettled(c.map(R=>{if(R=ci(R,g),R in Gr)return;Gr[R]=!0;const Y=R.endsWith(".css"),B=Y?'[rel="stylesheet"]':"";if(!!g)for(let Z=D.length-1;Z>=0;Z--){const ft=D[Z];if(ft.href===R&&(!Y||ft.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${R}"]${B}`))return;const U=document.createElement("link");if(U.rel=Y?"stylesheet":ui,Y||(U.as="script"),U.crossOrigin="",U.href=R,K&&U.setAttribute("nonce",K),document.head.appendChild(U),Y)return new Promise((Z,ft)=>{U.addEventListener("load",Z),U.addEventListener("error",()=>ft(new Error(`Unable to preload CSS for ${R}`)))})}))}function S(D){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=D,window.dispatchEvent(E),!E.defaultPrevented)throw D}return T.then(D=>{for(const E of D||[])E.status==="rejected"&&S(E.reason);return u().catch(S)})};function di(v={}){const{immediate:u=!1,onNeedRefresh:c,onOfflineReady:g,onRegistered:T,onRegisteredSW:S,onRegisterError:D}=v;let E,K;const R=async(B=!0)=>{await K};async function Y(){if("serviceWorker"in navigator){if(E=await li(async()=>{const{Workbox:B}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:B}},[],import.meta.url).then(({Workbox:B})=>new B("./sw.js",{scope:"./",type:"classic"})).catch(B=>{D==null||D(B)}),!E)return;E.addEventListener("activated",B=>{(B.isUpdate||B.isExternal)&&window.location.reload()}),E.addEventListener("installed",B=>{B.isUpdate||g==null||g()}),E.register({immediate:u}).then(B=>{S?S("./sw.js",B):T==null||T(B)}).catch(B=>{D==null||D(B)})}}return K=Y(),R}di({immediate:!0});var Zr;const lt=(Zr=window.Telegram)==null?void 0:Zr.WebApp;lt&&(lt.ready(),lt.expand());let Et="main",me="all",ct=null,ra=null,ln=null,tr=!1,Ce=null,Dt=null,sn="overview",un=!1;function fi(v){Et=v,nt()}let Xn=null;function Qr(v){let u=document.querySelector(".toast");u||(u=document.createElement("div"),u.className="toast",document.body.appendChild(u)),u.textContent=v,u.classList.add("visible"),Xn&&clearTimeout(Xn),Xn=setTimeout(()=>{u==null||u.classList.remove("visible")},2e3)}function nt(){const v=document.getElementById("app");v&&(v.innerHTML=`
    <main class="content">
      ${hi()}
    </main>
    <nav class="navigation">
      <button class="navigation__item ${Et==="main"?"navigation__item_active":""}" data-page="main">
        <span class="navigation__icon">ðï¸</span>
        <span class="navigation__label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Et==="stats"?"navigation__item_active":""}" data-page="stats">
        <span class="navigation__icon">ð</span>
        <span class="navigation__label">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</span>
      </button>
      <button class="navigation__item ${Et==="profile-settings"?"navigation__item_active":""}" data-page="profile-settings">
        <span class="navigation__icon">ð¤</span>
        <span class="navigation__label">ÐÑÐ¾ÑÐ¸Ð»Ñ</span>
      </button>
      <button class="navigation__item ${Et==="settings"?"navigation__item_active":""}" data-page="settings">
        <span class="navigation__icon">âï¸</span>
        <span class="navigation__label">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</span>
      </button>
    </nav>
    <div id="sync-status" class="sync-status"></div>
  `,v.querySelectorAll(".navigation__item").forEach(u=>{u.addEventListener("click",()=>{const c=u.getAttribute("data-page");fi(c)})}),ki())}let aa="idle";W.onSyncStatusChange(v=>{aa=v,rr()});function rr(){const v=document.getElementById("sync-status");if(!v)return;v.className="sync-status";let u="",c="";switch(aa){case"saving":u="Ð¡Ð¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ñ...",c="ð",v.classList.add("sync-status_saving");break;case"success":u="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾",c="â",v.classList.add("sync-status_success");break;case"error":u="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¸Ð½ÑÑÐ¾Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸",c="â ï¸",v.classList.add("sync-status_error");break;case"idle":if(!navigator.onLine)u="ÐÑÑÐ»Ð°Ð¹Ð½",c="ð¡",v.classList.add("sync-status_offline");else return;break}v.innerHTML=`${c} ${u}`}window.addEventListener("online",()=>{W.sync(),rr()});window.addEventListener("offline",()=>rr());function hi(){switch(Et){case"main":return yi();case"stats":return wi();case"settings":return vi();case"profile-settings":return gi();case"public-profile":return bi();default:return""}}function pi(){const v=W.getActiveWorkout();if(v){const u=v.status==="paused";return`
      <div class="workout-controls card">
        <div class="workout-controls__header">
          <span class="workout-status ${u?"workout-status_paused":""}">
            ${u?"â¸ï¸ ÐÐ°ÑÐ·Ð°":"ð¥ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° Ð°ÐºÑÐ¸Ð²Ð½Ð°"}
          </span>
          ${v.name?`<span class="workout-name">${v.name}</span>`:""}
        </div>
        <div class="workout-controls__actions">
          ${u?'<button class="button" id="resume-workout-btn">ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ</button>':'<button class="button button_secondary" id="pause-workout-btn">ÐÐ°ÑÐ·Ð°</button>'}
          <button class="button button_destructive" id="finish-workout-btn">ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ</button>
        </div>
      </div>
    `}return un?`
      <div class="workout-controls card">
        <h3 class="subtitle" style="margin-top: 0">ÐÐ°ÑÐ°Ð»Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</h3>
        <form id="start-workout-form" style="display: flex; flex-direction: column; gap: 12px;">
          <input class="input" type="text" name="workoutName" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð¾Ð¿ÑÐ¸Ð¾Ð½Ð°Ð»ÑÐ½Ð¾)">
          <div style="display: flex; gap: 8px;">
            <button class="button" type="submit">ÐÐ°ÑÐ°ÑÑ</button>
            <button class="button button_secondary" type="button" id="cancel-start-workout-btn">ÐÑÐ¼ÐµÐ½Ð°</button>
          </div>
        </form>
      </div>
    `:`
    <button class="button" id="start-workout-btn" style="margin-bottom: 24px;">â¶ï¸ ÐÐ°ÑÐ°ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ</button>
  `}let wt=0,er="";function ar(v){const u=new Date;u.setHours(0,0,0,0);const c=new Date(u);c.setDate(u.getDate()-v*7),c.setHours(23,59,59,999);const g=new Date(c);return g.setDate(c.getDate()-6),g.setHours(0,0,0,0),{start:g,end:c,label:`${g.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})} - ${c.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})}`}}function yi(){var D;const v=W.getWorkoutTypes(),u=W.getLogs(),c=u[u.length-1],g=c==null?void 0:c.workoutTypeId,T=ct?u.find(E=>E.id===ct):null,{label:S}=ar(wt);return`
    <div class="page-content" id="main-content">
      ${pi()}
      <h1 class="title">${ct?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´ÑÐ¾Ð´Ð°":"ÐÐ¾Ð²ÑÐ¹ Ð¿Ð¾Ð´ÑÐ¾Ð´"}</h1>
      <form class="workout-form" id="log-form">
        <div class="form-group">
          <label class="label">Ð¢Ð¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸</label>
          <select class="select" name="typeId" required>
            ${v.map(E=>`<option value="${E.id}" ${(ct?T&&E.id===T.workoutTypeId:E.id===g)?"selected":""}>${E.name}</option>`).join("")}
          </select>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="label">ÐÐµÑ (ÐºÐ³)</label>
            <input class="input" type="number" name="weight" step="0.5" required placeholder="0" value="${ct&&T?T.weight:""}">
          </div>
          <div class="form-group">
            <label class="label">ÐÐ¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</label>
            <input class="input" type="number" name="reps" required placeholder="0" value="${ct&&T?T.reps:""}">
          </div>
        </div>
        <button class="button" type="submit">${ct?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ":"ÐÐ°ÑÐ¸ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ"}</button>
        ${ct?'<button class="button button_secondary" type="button" id="cancel-edit-btn" style="margin-top: 12px;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        ${!ct&&c?`<button class="button button_secondary" type="button" id="duplicate-last-btn" style="margin-top: 12px;">ÐÐ¾Ð²ÑÐ¾ÑÐ¸ÑÑ: ${(D=v.find(E=>E.id===c.workoutTypeId))==null?void 0:D.name} ${c.weight}ÐºÐ³ Ã ${c.reps}</button>`:""}
      </form>
      <div class="recent-logs">
        <div class="recent-logs__header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
           <button class="icon-btn" id="prev-week-btn">âï¸</button>
           <div id="week-label-container" style="display: flex; align-items: center; gap: 8px; position: relative;">
             <h2 class="subtitle" style="margin: 0;">${wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":S}</h2>
             <span style="font-size: 18px; position: relative; display: inline-block;">
               ð
               <input type="date" id="calendar-input" value="${er}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
             </span>
           </div>
           <button class="icon-btn" id="next-week-btn" ${wt===0?"disabled":""} style="${wt===0?"opacity: 0.3; cursor: default;":""}">â¶ï¸</button>
        </div>
        <div id="logs-list">
          ${ia()}
        </div>
      </div>
    </div>
  `}function ia(){const v=W.getLogs(),u=W.getWorkoutTypes(),{start:c,end:g}=ar(wt),T=v.filter(S=>{const D=new Date(S.date);return D>=c&&D<=g});return oa(T,u,!0)}function Jn(){const v=document.getElementById("logs-list"),u=document.querySelector("#week-label-container .subtitle");if(v&&(v.innerHTML=ia(),mi()),u){const{label:g}=ar(wt);u.textContent=wt===0?"ÐÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 7 Ð´Ð½ÐµÐ¹":g}const c=document.getElementById("next-week-btn");c&&(c.disabled=wt===0,c.style.opacity=wt===0?"0.3":"",c.style.cursor=wt===0?"default":"")}function mi(){document.querySelectorAll(".log-set__delete").forEach(v=>{v.addEventListener("click",async()=>{const u=v.getAttribute("data-id");u&&(ct===u&&(ct=null),await W.deleteLog(u),nt())})}),document.querySelectorAll(".log-set__edit").forEach(v=>{v.addEventListener("click",()=>{ct=v.getAttribute("data-id"),nt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(v=>{v.addEventListener("click",()=>{const u=v.getAttribute("data-date");u&&sa(u)})})}function oa(v,u,c){if(v.length===0)return'<p class="hint">ÐÐµÑ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð·Ð° ÑÑÐ¾Ñ Ð¿ÐµÑÐ¸Ð¾Ð´</p>';const g=new Map;[...v].sort((D,E)=>new Date(E.date).getTime()-new Date(D.date).getTime()).forEach(D=>{const K=new Date(D.date).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"});g.has(K)||g.set(K,[]),g.get(K).push(D)});const T=W.getWorkouts();let S="";return g.forEach((D,E)=>{var ft;const K=((ft=D[0])==null?void 0:ft.date.split("T")[0])||"",R=new Set;D.forEach(vt=>{vt.workoutId&&R.add(vt.workoutId)});const Y=Array.from(R).sort((vt,gt)=>{var bt,ot;const Tt=T.find(dt=>dt.id===vt),Ut=T.find(dt=>dt.id===gt),xt=(Tt==null?void 0:Tt.startTime)||((bt=D.find(dt=>dt.workoutId===vt))==null?void 0:bt.date)||"",yt=(Ut==null?void 0:Ut.startTime)||((ot=D.find(dt=>dt.workoutId===gt))==null?void 0:ot.date)||"";return new Date(yt).getTime()-new Date(xt).getTime()}),B=Y.length===1?Y[0]:null,V=B?T.find(vt=>vt.id===B):null,U=V&&V.name,Z=V?Math.round(W.getWorkoutDuration(V)):0;S+='<div class="log-day">',S+=`<div class="log-day__header">
      <span>${E}${U?` â¢ ${V.name}`:""}${V?` â¢ ${Z} Ð¼Ð¸Ð½`:""}</span>
      ${c?`<button class="share-btn" data-date="${K}" title="ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ">ð¤</button>`:""}
    </div>`,Y.forEach(vt=>{const gt=T.find(yt=>yt.id===vt),Tt=D.filter(yt=>yt.workoutId===vt);if(!(Y.length===1&&(U||!(gt!=null&&gt.name)))){const yt=gt?Math.round(W.getWorkoutDuration(gt)):0;S+=`<h3 class="workout-subheader">
                ${(gt==null?void 0:gt.name)||"Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°"} 
                <span class="workout-subheader__time">${yt} Ð¼Ð¸Ð½</span>
            </h3>`}const xt=new Map;Tt.forEach(yt=>{xt.has(yt.workoutTypeId)||xt.set(yt.workoutTypeId,[]),xt.get(yt.workoutTypeId).push(yt)}),xt.forEach((yt,bt)=>{const ot=u.find(dt=>dt.id===bt);S+=`
            <div class="log-exercise">
              <div class="log-exercise__name">${(ot==null?void 0:ot.name)||"Ð£Ð´Ð°Ð»ÐµÐ½Ð¾"}</div>
              <div class="log-exercise__sets">
                ${yt.map(dt=>`
                  <div class="log-set ${dt.id===ct?"log-set_active-edit":""} ${dt.id===Ce?"log-set_new":""}">
                    <div class="log-set__info">
                      <span class="log-set__weight">${dt.weight} ÐºÐ³</span>
                      <span class="log-set__times">Ã</span>
                      <span class="log-set__reps">${dt.reps}</span>
                    </div>
                    ${c?`
                    <div class="log-set__actions">
                      <button class="log-set__edit" data-id="${dt.id}">âï¸</button>
                      <button class="log-set__delete" data-id="${dt.id}">Ã</button>
                    </div>
                    `:""}
                  </div>
                `).join("")}
              </div>
            </div>
          `})}),S+="</div>"}),S}function vi(){const v=W.getWorkoutTypes(),u=Dt?v.find(c=>c.id===Dt):null;return`
    <div class="page-content">
      <h1 class="title">ÐÐ°ÑÑÑÐ¾Ð¹ÐºÐ¸</h1>
      <div class="settings-section">
        <h2 class="subtitle">${Dt?"Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸Ð¿Ð°":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸"}</h2>
        <form class="add-type-form" id="add-type-form" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 8px;">
            <input class="input" type="text" id="new-type-name" placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð½Ð°Ð¿Ñ. ÐÐ¸Ð¼ Ð³Ð°Ð½ÑÐµÐ»ÐµÐ¹)" required value="${u?u.name:""}">
            <button class="button" type="submit">${Dt?"Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ":"ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ"}</button>
          </div>
          ${Dt?'<button class="button button_secondary" type="button" id="cancel-edit-type-btn" style="margin-top: 8px; width: 100%;">ÐÑÐ¼ÐµÐ½Ð°</button>':""}
        </form>

        <h2 class="subtitle">Ð¢Ð¸Ð¿Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
        <div class="type-list">
          ${v.map(c=>`
            <div class="type-item">
              <span>${c.name}</span>
              <div style="display: flex; gap: 8px;">
                <button class="type-item__edit icon-btn" data-id="${c.id}" title="Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ">âï¸</button>
                <button class="type-item__delete icon-btn" data-id="${c.id}" title="Ð£Ð´Ð°Ð»Ð¸ÑÑ">Ã</button>
              </div>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `}function gi(){var K,R;const v=W.getProfile(),u=(v==null?void 0:v.isPublic)??!1,c=(v==null?void 0:v.displayName)||((R=(K=lt==null?void 0:lt.initDataUnsafe)==null?void 0:K.user)==null?void 0:R.first_name)||"",g=W.getProfileIdentifier(),T=g?`https://t.me/gymgym21bot/app?startapp=profile_${g}`:"",S=W.getLogs(),D=S.reduce((Y,B)=>Y+B.weight*B.reps,0),E=new Set(S.map(Y=>Y.date.split("T")[0])).size;return`
    <div class="page-content profile-page">
      <h1 class="title">ÐÑÐ¾ÑÐ¸Ð»Ñ</h1>
      
      <div class="profile-header">
        <div class="profile-avatar">
          ${v!=null&&v.photoUrl?`<img src="${v.photoUrl}" alt="${c}" class="profile-avatar-img">`:c.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${c}</div>
        <div class="profile-subtitle">${u?"ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ":"ÐÑÐ¸Ð²Ð°ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ"}</div>
      </div>

      <div class="profile-settings">
        <div class="settings-section">
          <div class="settings-section-title">ÐÐ¸Ð´Ð¸Ð¼Ð¾ÑÑÑ</div>
          <div class="toggle-row">
            <div class="toggle-label">
              <span class="toggle-label-text">ÐÑÐ±Ð»Ð¸ÑÐ½ÑÐ¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</span>
              <span class="toggle-label-hint">ÐÑÑÐ³Ð¸Ðµ ÑÐ¼Ð¾Ð³ÑÑ Ð²Ð¸Ð´ÐµÑÑ Ð²Ð°ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÑ</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="profile-public-toggle" ${u?"checked":""}>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="toggle-row" style="margin-top: 12px;">
            <div class="toggle-label">
              <span class="toggle-label-text">ÐÐ¾ÐºÐ°Ð·ÑÐ²Ð°ÑÑ Ð²ÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ</span>
              <span class="toggle-label-hint">ÐÐ¾Ð´ÑÐ¾Ð±Ð½ÑÐ¹ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð² Ð¿ÑÐ±Ð»Ð¸ÑÐ½Ð¾Ð¼ Ð¿ÑÐ¾ÑÐ¸Ð»Ðµ</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="profile-history-toggle" ${v!=null&&v.showFullHistory?"checked":""}>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="settings-section">
          <div class="settings-section-title">ÐÐ¼Ñ</div>
          <input class="input" type="text" id="profile-display-name" value="${c}" placeholder="ÐÐ°ÑÐµ Ð¸Ð¼Ñ">
        </div>

        ${u&&g?`
          <div class="settings-section">
            <div class="settings-section-title">Ð¡ÑÑÐ»ÐºÐ° Ð½Ð° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ</div>
            <div class="profile-link-section">
              <a href="${T}" target="_blank" class="profile-link-url">${T}</a>
              <div class="profile-link-actions">
                <button class="button button_secondary" id="copy-profile-link">ÐÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ</button>
                <button class="button" id="share-profile-link">ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ</button>
              </div>
            </div>
          </div>
        `:""}

        <div class="settings-section">
          <div class="settings-section-title">ÐÑÐµÐ²ÑÑ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</div>
          <div class="profile-stats">
            <div class="stat-card">
              <div class="stat-value">${E}</div>
              <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
            </div>
            <div class="stat-card">
              <div class="stat-value">${Math.round(D/1e3)}Ñ</div>
              <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
            </div>
          </div>
        </div>

        <button class="button" id="save-profile-btn">Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
      </div>
    </div>
  `}function bi(){if(!ra)return`
      <div class="page-content">
        <div class="profile-not-found">
          <div class="profile-not-found-icon">ð</div>
          <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½</div>
        </div>
      </div>
    `;if(!ln)return tr?`
        <div class="page-content">
          <div class="profile-not-found">
            <div class="profile-not-found-icon">ð</div>
            <div class="profile-not-found-text">ÐÑÐ¾ÑÐ¸Ð»Ñ ÑÐºÑÑÑ Ð¸Ð»Ð¸ Ð½Ðµ ÑÑÑÐµÑÑÐ²ÑÐµÑ</div>
          </div>
        </div>
      `:`
      <div class="page-content">
        <div class="profile-loading">ÐÐ°Ð³ÑÑÐ·ÐºÐ° Ð¿ÑÐ¾ÑÐ¸Ð»Ñ...</div>
      </div>
    `;const v=ln;return`
    <div class="page-content profile-page">
      <div class="profile-header">
        <div class="profile-avatar">
          ${v.photoUrl?`<img src="${v.photoUrl}" alt="${v.displayName}" class="profile-avatar-img">`:v.displayName.charAt(0).toUpperCase()}
        </div>
        <div class="profile-name">${v.displayName}</div>
        <div class="profile-subtitle">@${v.identifier}</div>
      </div>

      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-value">${v.stats.totalWorkouts}</div>
          <div class="stat-label">Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${Math.round(v.stats.totalVolume/1e3)}Ñ</div>
          <div class="stat-label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼</div>
        </div>
        ${v.stats.favoriteExercise?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${v.stats.favoriteExercise}</div>
            <div class="stat-label">ÐÑÐ±Ð¸Ð¼Ð¾Ðµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</div>
          </div>
        `:""}
        ${v.stats.lastWorkoutDate?`
          <div class="stat-card">
            <div class="stat-value" style="font-size: 1rem;">${new Date(v.stats.lastWorkoutDate).toLocaleDateString()}</div>
            <div class="stat-label">ÐÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ°</div>
          </div>
        `:""}
      </div>

      ${v.recentActivity.length>0?`
        <div class="activity-list">
          <h2 class="subtitle">ÐÐµÐ´Ð°Ð²Ð½ÑÑ Ð°ÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
          ${v.recentActivity.map(u=>`
            <div class="activity-item">
              <span class="activity-date">${new Date(u.date).toLocaleDateString()}</span>
              <span class="activity-count">${u.exerciseCount} ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ð¹</span>
            </div>
          `).join("")}
        </div>
      `:""}

      ${v.logs&&v.logs.length>0&&v.workoutTypes?`
        <div class="recent-logs">
          <h2 class="subtitle">ÐÑÑÐ¾ÑÐ¸Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
          <div id="logs-list">
            ${oa(v.logs,v.workoutTypes,!1)}
          </div>
        </div>
      `:""}
    </div>
  `}function wi(){const v=W.getLogs(),u=W.getWorkouts(),c=W.getWorkoutTypes();if(v.length===0)return`
      <div class="page-content">
        <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
        <p class="hint">ÐÐµÐ´Ð¾ÑÑÐ°ÑÐ¾ÑÐ½Ð¾ Ð´Ð°Ð½Ð½ÑÑ Ð´Ð»Ñ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸</p>
      </div>
    `;const g=v.reduce((E,K)=>E+K.weight*K.reps,0),T=v.reduce((E,K)=>E+K.reps,0),S=ni(u);let D=`
    <div class="page-content">
      <h1 class="title">Ð¡ÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ°</h1>
      <div class="stats-tabs">
        <button class="stats-tab ${sn==="overview"?"active":""}" data-tab="overview">ÐÐ±Ð·Ð¾Ñ</button>
        <button class="stats-tab ${sn==="progress"?"active":""}" data-tab="progress">ÐÑÐ¾Ð³ÑÐµÑÑ</button>
      </div>
  `;if(sn==="overview"){const E=ei(u,v);D+=`
        <div class="stats-section">
            <h2 class="subtitle">ÐÐºÑÐ¸Ð²Ð½Ð¾ÑÑÑ</h2>
            ${ri(E)}
        </div>

        <div class="stats-summary">
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</div>
                <div class="stat-metric__value">${E.size}</div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">Ð¡ÑÐµÐ´. Ð´Ð»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ</div>
                <div class="stat-metric__value">${S.averageMinutes}<span class="stat-metric__unit">Ð¼Ð¸Ð½</span></div>
            </div>
             <div class="stat-metric">
                <div class="stat-metric__label">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼</div>
                <div class="stat-metric__value">${Math.round(g/1e3)}<span class="stat-metric__unit">Ñ</span></div>
            </div>
            <div class="stat-metric">
                <div class="stat-metric__label">ÐÑÐµÐ³Ð¾ Ð¿Ð¾Ð²ÑÐ¾ÑÐµÐ½Ð¸Ð¹</div>
                <div class="stat-metric__value">${T}</div>
            </div>
        </div>

        <div class="charts-section">
            <h2 class="subtitle">ÐÐ»Ð¸ÑÐµÐ»ÑÐ½Ð¾ÑÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº</h2>
            <div class="chart-container">
                ${ii(u)}
            </div>
        </div>
     `}else if(D+=`
        <div class="form-group">
            <label class="label">Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ</label>
            <select class="select" id="stat-type-select">
                <option value="all">ÐÑÐµ ÑÐ¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ñ (ÐÐ±ÑÐµÐ¼)</option>
                ${c.map(E=>`<option value="${E.id}" ${me===E.id?"selected":""}>${E.name}</option>`).join("")}
            </select>
        </div>
    `,me==="all")D+=`
            <div class="charts-section">
                <h2 class="subtitle">ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÐµÐ¼ Ð¿Ð¾ Ð´Ð½ÑÐ¼</h2>
                <div class="chart-container">
                    ${Yr(v)}
                </div>
            </div>
        `;else{const E=v.filter(R=>R.workoutTypeId===me),K=ti(E,me);D+=`
             <div class="charts-section">
                <h2 class="subtitle">ÐÑÐ¾Ð³ÑÐµÑÑ ÑÐ¸Ð»Ð¾Ð²ÑÑ (1RM)</h2>
                <div class="chart-container">
                    ${ai(K)}
                </div>
            </div>
            
            <div class="charts-section" style="margin-top: 24px;">
                <h2 class="subtitle">ÐÐ±ÑÐµÐ¼ Ð½Ð°Ð³ÑÑÐ·ÐºÐ¸</h2>
                 <div class="chart-container">
                    ${Yr(E)}
                </div>
            </div>
        `}return D+="</div>",D}function _i(v){const u=W.getLogs(),c=W.getWorkoutTypes(),g=u.filter(R=>R.date.startsWith(v));if(g.length===0)return"";const S=new Date(g[0].date).toLocaleDateString("ru-RU",{day:"numeric",month:"long"}),D=new Map;g.forEach(R=>{D.has(R.workoutTypeId)||D.set(R.workoutTypeId,[]),D.get(R.workoutTypeId).push(R)});let E=`ðï¸ Ð¢ÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ° ${S}

`;D.forEach((R,Y)=>{const B=c.find(V=>V.id===Y);E+=`${(B==null?void 0:B.name)||"Ð£Ð¿ÑÐ°Ð¶Ð½ÐµÐ½Ð¸Ðµ"}:
`,R.forEach(V=>{E+=`  ${V.weight} ÐºÐ³ Ã ${V.reps}
`}),E+=`
`});const K=g.reduce((R,Y)=>R+Y.weight*Y.reps,0);return E+=`ðª ÐÐ±ÑÐ¸Ð¹ Ð¾Ð±ÑÑÐ¼: ${Math.round(K)} ÐºÐ³`,E}function sa(v){const u=_i(v);if(u)if(lt!=null&&lt.openTelegramLink){const c=`https://t.me/share/url?url=${encodeURIComponent("https://t.me/gymgym21bot")}&text=${encodeURIComponent(u)}`;lt.openTelegramLink(c)}else navigator.clipboard.writeText(u).then(()=>{alert("Ð¢ÐµÐºÑÑ ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½ Ð² Ð±ÑÑÐµÑ Ð¾Ð±Ð¼ÐµÐ½Ð°")})}function ki(){if(Et==="main"){const v=document.getElementById("start-workout-btn");v==null||v.addEventListener("click",()=>{un=!0,nt()});const u=document.getElementById("cancel-start-workout-btn");u==null||u.addEventListener("click",()=>{un=!1,nt()});const c=document.getElementById("start-workout-form");c==null||c.addEventListener("submit",async V=>{V.preventDefault();const Z=new FormData(c).get("workoutName");await W.startWorkout(Z),un=!1,nt()});const g=document.getElementById("pause-workout-btn");g==null||g.addEventListener("click",async()=>{await W.pauseWorkout(),nt()});const T=document.getElementById("resume-workout-btn");T==null||T.addEventListener("click",async()=>{await W.resumeWorkout(),nt()});const S=document.getElementById("finish-workout-btn");S==null||S.addEventListener("click",async()=>{confirm("ÐÐ°Ð²ÐµÑÑÐ¸ÑÑ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÑ?")&&(await W.finishWorkout(),nt())});const D=document.getElementById("log-form");D==null||D.addEventListener("submit",async V=>{V.preventDefault();const U=new FormData(D),Z={workoutTypeId:U.get("typeId"),weight:parseFloat(U.get("weight")),reps:parseInt(U.get("reps"),10)};if(ct){const vt=W.getLogs().find(gt=>gt.id===ct);vt&&(await W.updateLog({...vt,...Z}),ct=null)}else Ce=(await W.addLog(Z)).id;nt(),Ce=null});const E=document.getElementById("duplicate-last-btn");E==null||E.addEventListener("click",async()=>{const V=W.getLogs(),U=V[V.length-1];U&&(Ce=(await W.addLog({workoutTypeId:U.workoutTypeId,weight:U.weight,reps:U.reps})).id,nt(),Ce=null)});const K=document.getElementById("cancel-edit-btn");K==null||K.addEventListener("click",()=>{ct=null,nt()}),document.querySelectorAll(".log-set__delete").forEach(V=>{V.addEventListener("click",async()=>{const U=V.getAttribute("data-id");U&&(ct===U&&(ct=null),await W.deleteLog(U),nt())})}),document.querySelectorAll(".log-set__edit").forEach(V=>{V.addEventListener("click",()=>{ct=V.getAttribute("data-id"),nt(),window.scrollTo({top:0,behavior:"smooth"})})}),document.querySelectorAll(".share-btn").forEach(V=>{V.addEventListener("click",()=>{const U=V.getAttribute("data-date");U&&sa(U)})});const R=document.getElementById("prev-week-btn");R==null||R.addEventListener("click",()=>{wt++,Jn()});const Y=document.getElementById("next-week-btn");Y==null||Y.addEventListener("click",()=>{wt>0&&(wt--,Jn())});const B=document.getElementById("calendar-input");B==null||B.addEventListener("change",()=>{if(!B.value||B.value===er)return;er=B.value;const V=new Date(B.value),U=new Date;U.setHours(0,0,0,0);const Z=U.getTime()-V.getTime(),ft=Math.floor(Z/(1e3*60*60*24));wt=Math.max(0,Math.floor(ft/7)),Jn()})}if(Et==="settings"){const v=document.getElementById("add-type-form");v==null||v.addEventListener("submit",async c=>{c.preventDefault();const g=document.getElementById("new-type-name");g.value&&(Dt?(await W.updateWorkoutType(Dt,g.value),Dt=null):await W.addWorkoutType(g.value),nt())});const u=document.getElementById("cancel-edit-type-btn");u==null||u.addEventListener("click",()=>{Dt=null,nt()}),document.querySelectorAll(".type-item__edit").forEach(c=>{c.addEventListener("click",()=>{Dt=c.getAttribute("data-id"),nt();const g=document.getElementById("new-type-name");g==null||g.focus()})}),document.querySelectorAll(".type-item__delete").forEach(c=>{c.addEventListener("click",async()=>{const g=c.getAttribute("data-id");g&&confirm("Ð£Ð´Ð°Ð»Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ¸Ð¿ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²ÐºÐ¸?")&&(Dt===g&&(Dt=null),await W.deleteWorkoutType(g),nt())})})}if(Et==="stats"){const v=document.getElementById("stat-type-select");v==null||v.addEventListener("change",()=>{me=v.value,nt()})}if(Et==="profile-settings"){const v=document.getElementById("save-profile-btn");v==null||v.addEventListener("click",async()=>{const g=document.getElementById("profile-public-toggle"),T=document.getElementById("profile-history-toggle"),S=document.getElementById("profile-display-name");await W.updateProfileSettings({isPublic:(g==null?void 0:g.checked)??!1,showFullHistory:(T==null?void 0:T.checked)??!1,displayName:(S==null?void 0:S.value)||void 0}),nt()});const u=document.getElementById("copy-profile-link");u==null||u.addEventListener("click",()=>{const T=`https://t.me/gymgym21bot/app?startapp=profile_${W.getProfileIdentifier()}`;navigator.clipboard.writeText(T).then(()=>{Qr("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})});const c=document.getElementById("share-profile-link");c==null||c.addEventListener("click",()=>{const T=`https://t.me/gymgym21bot/app?startapp=profile_${W.getProfileIdentifier()}`;if(lt!=null&&lt.openTelegramLink){const S=`https://t.me/share/url?url=${encodeURIComponent(T)}&text=${encodeURIComponent("ÐÐ¾Ð¹ Ð¿ÑÐ¾ÑÐ¸Ð»Ñ ÑÑÐµÐ½Ð¸ÑÐ¾Ð²Ð¾Ðº ðª")}`;lt.openTelegramLink(S)}else navigator.clipboard.writeText(T).then(()=>{Qr("Ð¡ÑÑÐ»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°Ð½Ð°")})})}if(Et==="stats"){document.querySelectorAll(".stats-tab").forEach(c=>{c.addEventListener("click",()=>{const g=c.getAttribute("data-tab");(g==="overview"||g==="progress")&&(sn=g,nt())})});const u=document.getElementById("stat-type-select");u==null||u.addEventListener("change",c=>{me=c.target.value,nt()})}}const ne=document.createElement("div");ne.className="sync-status";document.body.appendChild(ne);function xi(v){switch(ne.className="sync-status visible "+v,v){case"saving":ne.textContent="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ðµ...";break;case"success":ne.textContent="Ð¡Ð¾ÑÑÐ°Ð½ÐµÐ½Ð¾";break;case"error":ne.textContent="ÐÑÐ¸Ð±ÐºÐ° ÑÐ¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ";break;default:ne.className="sync-status"}}W.onUpdate(()=>nt());W.onSyncStatusChange(xi);async function Si(){var D;const v=new URLSearchParams(window.location.search);if(v.has("hash")&&v.has("id")){const E={id:parseInt(v.get("id")||"0",10),first_name:v.get("first_name")||"",last_name:v.get("last_name")||void 0,username:v.get("username")||void 0,photo_url:v.get("photo_url")||void 0,auth_date:parseInt(v.get("auth_date")||"0",10),hash:v.get("hash")||""};Ya(E),v.delete("hash"),v.delete("id"),v.delete("first_name"),v.delete("last_name"),v.delete("username"),v.delete("photo_url"),v.delete("auth_date"),v.delete("auth");const K=v.toString(),R=window.location.pathname+(K?"?"+K:"");window.history.replaceState({},document.title,R),location.reload();return}const u=!!(lt!=null&&lt.initData),g=!!ea();if(!u&&!g){si(document.getElementById("app"));return}const S=new URLSearchParams(window.location.search).get("startapp")||((D=lt==null?void 0:lt.initDataUnsafe)==null?void 0:D.start_param);if(S&&S.startsWith("profile_")){const E=S.replace("profile_","");ra=E,Et="public-profile",tr=!1,nt(),ln=await W.getPublicProfile(E),ln||(tr=!0),nt()}else nt();await W.init()}Si();
